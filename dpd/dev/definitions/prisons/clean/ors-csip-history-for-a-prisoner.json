{
  "id": "Frbpm19LXwcAChwAAHCrXF81ACJIABRd",
  "name": "ORS CSIP History for a Prisoner",
  "description": "<br/>Displays a complete breakdown of CSIP History for a Prisoner selected at runtime.<br/>INC0031 v00.00.01 Last Modified: 14/01/2021",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "INC0031",
      "v00.00.01 CSIP",
      "Reviews"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3375850/DP1d",
      "name": "CSIP Referrals",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID, AT_OFFENDER_CSIP_REPORTS.CSIP_SEQ, AT_OFFENDER_CSIP_REPORTS.REFERRAL_COMPLETED_BY, AT_OFFENDER_CSIP_REPORTS.REFERRAL_COMPLETED_DATE, AT_OFFENDER_CSIP_REPORTS.REFERRAL_COMPLETE_FLAG, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_DATE, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE, TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_date) + (AT_OFFENDER_CSIP_REPORTS.rfr_incident_time - TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_time)) AS RFR_INCIDENT_TIME_, AT_REF_CSIP_TYPE.DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION, AT_REF_CSIP_LOC.DESCRIPTION AS RFR_INCIDENT_LOCATION_DESCRI33, AT_OFFENDER_CSIP_REPORTS.RFR_REPORTED_BY, AT_OFFENDER_CSIP_REPORTS.RFR_CSIP_FUNCTION, AT_REF_CSIP_FUNC.DESCRIPTION AS RFR_AREA_OF_WORK_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED, AT_OFFENDER_CSIP_REPORTS.RFR_COMMENT, AT_OFFENDER_CSIP_REPORTS.RFR_PROACTIVE_RESPONSE, AT_OFFENDER_CSIP_REPORTS.RFR_STAFF_ASSAULTED, AT_OFFENDER_CSIP_REPORTS.RFR_STAFF_NAME, AT_OFFENDER_CSIP_REPORTS.CSIP_ID, AT_OFFENDER_CSIP_REPORTS.CDR_RELEASE_DATE, AT_OFFENDER_CSIP_REPORTS.CDR_INVOLVEMENT, AT_REF_CSIP_INV.DESCRIPTION AS CDR_INVOLVEMENT_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.CDR_SENT_DENT, AT_OFFENDER_CSIP_REPORTS.CDR_OTHER_INFORMATION, AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR_ID, AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR, AT_REF_CSIP_FAC.DESCRIPTION AS CDR_FACTOR_DESCRIPTION, AT_OFFENDER_CSIP_FACTORS.COMMENTS, AT_OFFENDER_CSIP_REPORTS.INV_KNOWN_REASONS, AT_OFFENDER_CSIP_REPORTS.CDR_CONCERN_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.CDR_DECISION_REASON, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME, AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION AS CDR_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME_DATE, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME_RECORDED_BY, AT_OFFENDER_CSIP_REPORTS.INV_STAFF_INVOLVED, AT_OFFENDER_CSIP_REPORTS.INV_EVIDENCE_SECURED, AT_OFFENDER_CSIP_REPORTS.INV_OCCURRENCE_REASON, AT_OFFENDER_CSIP_REPORTS.INV_USUAL_BEHAVIOUR, AT_OFFENDER_CSIP_REPORTS.INV_PERSONS_TRIGGER, AT_OFFENDER_CSIP_REPORTS.INV_PROTECTIVE_FACTORS, AT_OFFENDER_CSIP_INTVW.CSIP_INTVW_ID, AT_OFFENDER_CSIP_INTVW.CSIP_INTERVIEWEE, AT_OFFENDER_CSIP_INTVW.INTVW_DATE, AT_OFFENDER_CSIP_INTVW.INTVW_ROLE, AT_REF_CSIP_INT_ROLE.DESCRIPTION AS INV_INTERVIEW_ROLE_DESCRIPTION, AT_OFFENDER_CSIP_INTVW.COMMENTS AS INV_INTERVIEW_COMMENTS, AT_OFFENDER_CSIP_REPORTS.OPEN_CSIP_ALERT, AT_OFFENDER_CSIP_REPORTS.INV_CONCLUSION, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME, AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION AS DEC_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_SIGNED_OFF_BY, AT_REF_CSIP_DECISION_ROLE.DESCRIPTION AS DEC_SIGNED_OFF_BY_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_NAME, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME_RECORDED_BY, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME_DATE, AT_OFFENDER_CSIP_REPORTS.INV_NEXT_STEPS, AT_OFFENDER_CSIP_REPORTS.INV_NOMIS_CASE_NOTE, AT_OFFENDER_CSIP_REPORTS.INV_NON_ASSOC_UPDATED, AT_OFFENDER_CSIP_REPORTS.INV_OBSERVATION_BOOK, AT_OFFENDER_CSIP_REPORTS.INV_MOVE, AT_OFFENDER_CSIP_REPORTS.INV_REVIEW, AT_OFFENDER_CSIP_REPORTS.INV_SERVICE_REFERRAL, AT_OFFENDER_CSIP_REPORTS.INV_SIM_REFERRAL, AT_OFFENDER_CSIP_REPORTS.INV_OTHER, AT_OFFENDER_CSIP_REPORTS.CASE_REV_DATE, AT_OFFENDER_CSIP_REPORTS.CASE_MANAGER, AT_OFFENDER_CSIP_REPORTS.REASON, AT_OFFENDER_CSIP_PLANS.IDENTIFIED_NEED, AT_OFFENDER_CSIP_PLANS.BY_WHOM, AT_OFFENDER_CSIP_PLANS.CREATE_DATE, AT_OFFENDER_CSIP_PLANS.TARGET_DATE, AT_OFFENDER_CSIP_PLANS.CLOSED_DATE, AT_OFFENDER_CSIP_PLANS.INTERVENTION, AT_OFFENDER_CSIP_PLANS.PROGRESSION, AT_OFFENDER_CSIP_PLANS.PLAN_ID, AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR AS DTL_FACTOR_CODE, AT_REF_CSIP_FAC.DESCRIPTION AS DTL_FACTOR_DESCRIPTION, AT_OFFENDER_CSIP_FACTORS.COMMENTS AS DTL_COMMENTS, AT_OFFENDER_CSIP_REPORTS.INV_PERSONS_TRIGGER AS DTL_PERSONS_TRIGGER, AT_OFFENDER_CSIP_REVIEWS.NEXT_REVIEW_DATE, AT_OFFENDER_CSIP_REVIEWS.SUMMARY, AT_OFFENDER_CSIP_REVIEWS.REVIEW_SEQ, AT_STAFF_MEMBERS_CSIP.LAST_NAME || ', ' || AT_STAFF_MEMBERS_CSIP.FIRST_NAME || ' ' || AT_STAFF_MEMBERS_CSIP.MIDDLE_NAME AS REV_RECORDED_BY, AT_OFFENDER_CSIP_REVIEWS.CREATE_DATE AS REV_DATE, AT_OFFENDER_CSIP_REVIEWS.CASE_NOTE, AT_OFFENDER_CSIP_REVIEWS.PEOPLE_INFORMED, AT_OFFENDER_CSIP_REVIEWS.REMAIN_ON_CSIP, AT_OFFENDER_CSIP_REVIEWS.CSIP_UPDATED, AT_OFFENDER_CSIP_REVIEWS.CLOSE_CSIP, AT_OFFENDER_CSIP_REVIEWS.CLOSE_DATE, AT_OFFENDER.BIRTH_DATE, TRUNC(MONTHS_BETWEEN(CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12) AS AGE, CASE WHEN AT_OFFENDER.SEX_CODE = 'M' THEN 'Male' WHEN AT_OFFENDER.SEX_CODE = 'F' THEN 'Female' ELSE 'Unknown' END AS GENDER_DESCRIPTION, AT_HEADER_BLOCK.OFFICER, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END || '-' || CASE WHEN AT_ETHNICITY_DESC.CODE = 'W8' THEN 'White: Gypsy or Irish Traveller' WHEN AT_ETHNICITY_DESC.CODE = 'O1' THEN 'Asian/Asian British: Chinese' ELSE AT_ETHNICITY_DESC.DESCRIPTION END AS ETHNIC_DESCRIPTION, AT_NATIONALITY.DESCRIPTION AS NATIONALITY, DT_CURRENT_OFFENDER_IEP_LEVEL.IEP_LEVEL, AT_OFFENDER_CSIP_ATTENDEES.ATTENDEE_NAME, AT_OFFENDER_CSIP_ATTENDEES.ATTENDEE_ROLE, AT_OFFENDER_CSIP_ATTENDEES.ATTENDED, AT_OFFENDER_CSIP_ATTENDEES.CONTRIBUTION, AT_OFFENDER_CSIP_ATTENDEES.REVIEW_ID, AT_OFFENDER_CSIP_ATTENDEES.ATTENDEE_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_TYPE, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_LOC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FUNC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_INV, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FAC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_CONSID_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_INT_ROLE, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_DECISION_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_DECISION_ROLE, OMS_OWNER.REFERENCE_CODES AT_ETHNICITY_DESC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_PROFILE_DETAILS AT_OFF_PROF_DET_NAT, (SELECT offender_book_id, iep_date, iep_time, agy_loc_id, iep_level FROM (SELECT offender_book_id, iep_date, iep_time, agy_loc_id, iep_level, ROW_NUMBER() OVER (PARTITION BY offender_book_id ORDER BY iep_time DESC, iep_level_seq DESC) AS row_seq_filter FROM oms_owner.offender_iep_levels) WHERE row_seq_filter = 1) DT_CURRENT_OFFENDER_IEP_LEVEL, OMS_OWNER.V_HEADER_BLOCK AT_HEADER_BLOCK, OMS_OWNER.STAFF_MEMBERS AT_STAFF_MEMBERS_CSIP, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS, OMS_OWNER.OFFENDER_CSIP_FACTORS AT_OFFENDER_CSIP_FACTORS, OMS_OWNER.OFFENDER_CSIP_INTVW AT_OFFENDER_CSIP_INTVW, OMS_OWNER.OFFENDER_CSIP_PLANS AT_OFFENDER_CSIP_PLANS, OMS_OWNER.OFFENDER_CSIP_REVIEWS AT_OFFENDER_CSIP_REVIEWS, OMS_OWNER.PROFILE_CODES AT_NATIONALITY, OMS_OWNER.OFFENDER_CSIP_ATTENDEES AT_OFFENDER_CSIP_ATTENDEES WHERE (AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID) AND (AT_OFFENDER_CSIP_REVIEWS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID) AND (AT_OFFENDER_CSIP_FACTORS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID) AND (AT_OFFENDER_CSIP_INTVW.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID) AND (AT_OFFENDER_CSIP_PLANS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID) AND (AT_OFFENDER_CSIP_ATTENDEES.REVIEW_ID (+) = AT_OFFENDER_CSIP_REVIEWS.REVIEW_ID) AND (AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE = AT_REF_CSIP_TYPE.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION = AT_REF_CSIP_LOC.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.RFR_CSIP_FUNCTION = AT_REF_CSIP_FUNC.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.CDR_INVOLVEMENT = AT_REF_CSIP_INV.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME = AT_REF_CSIP_CONSID_OUTCOME.CODE (+)) AND (AT_REF_CSIP_FAC.CODE (+) = AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR) AND (AT_REF_CSIP_INT_ROLE.CODE (+) = AT_OFFENDER_CSIP_INTVW.INTVW_ROLE) AND (AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME = AT_REF_CSIP_DECISION_OUTCOME.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.INV_SIGNED_OFF_BY = AT_REF_CSIP_DECISION_ROLE.CODE (+)) AND (AT_STAFF_MEMBERS_CSIP.USER_ID (+) = AT_OFFENDER_CSIP_REVIEWS.CREATE_USER) AND (AT_REF_CSIP_DECISION_OUTCOME.domain (+) = 'CSIP_OUT') AND (AT_REF_CSIP_CONSID_OUTCOME.domain (+) = 'CSIP_OUT') AND (AT_REF_CSIP_INV.domain (+) = 'CSIP_INV') AND (AT_REF_CSIP_FUNC.domain (+) = 'CSIP_FUNC') AND (AT_REF_CSIP_LOC.domain (+) = 'CSIP_LOC') AND (AT_REF_CSIP_TYPE.domain (+) = 'CSIP_TYP') AND (AT_REF_CSIP_DECISION_ROLE.DOMAIN (+) = 'CSIP_ROLE') AND (AT_REF_CSIP_FAC.domain (+) = 'CSIP_FAC') AND (AT_REF_CSIP_INT_ROLE.domain (+) = 'CSIP_INTVROL') AND (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_ETHNICITY_DESC.DOMAIN (+) = 'ETHNICITY') AND (AT_ETHNICITY_DESC.CODE (+) = AT_OFFENDER.RACE_CODE) AND (DT_CURRENT_OFFENDER_IEP_LEVEL.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFF_PROF_DET_NAT.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFF_PROF_DET_NAT.PROFILE_TYPE (+) = ('NAT')) AND (AT_NATIONALITY.PROFILE_TYPE (+) = AT_OFF_PROF_DET_NAT.PROFILE_TYPE AND AT_NATIONALITY.PROFILE_CODE (+) = AT_OFF_PROF_DET_NAT.PROFILE_CODE) AND (AT_NATIONALITY.PROFILE_TYPE (+) = ('NAT')) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_HEADER_BLOCK.OFFENDER_BOOK_ID (+)) AND AT_OFFENDER.OFFENDER_ID_DISPLAY = (SELECT PRISONER_NUMBER FROM prompt_ /* = #prompt('Enter NOMS Number:','A',,Mono,Free,Not_Persistent,,User:0) */)), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGY_LOC_ID, CSIP_SEQ, REFERRAL_COMPLETED_BY, REFERRAL_COMPLETED_DATE, REFERRAL_COMPLETE_FLAG, RFR_INCIDENT_DATE, RFR_INCIDENT_TYPE, RFR_INCIDENT_TIME_, DESCRIPTION, RFR_INCIDENT_LOCATION, RFR_INCIDENT_LOCATION_DESCRI33, RFR_REPORTED_BY, RFR_CSIP_FUNCTION, RFR_AREA_OF_WORK_DESCRIPTION, RFR_DATE_REPORTED, RFR_COMMENT, RFR_PROACTIVE_RESPONSE, RFR_STAFF_ASSAULTED, RFR_STAFF_NAME, CSIP_ID, CDR_RELEASE_DATE, CDR_INVOLVEMENT, CDR_INVOLVEMENT_DESCRIPTION, CDR_SENT_DENT, CDR_OTHER_INFORMATION, CSIP_FACTOR_ID, CSIP_FACTOR, CDR_FACTOR_DESCRIPTION, COMMENTS, INV_KNOWN_REASONS, CDR_CONCERN_DESCRIPTION, CDR_DECISION_REASON, CDR_OUTCOME, CDR_OUTCOME_DESCRIPTION, CDR_OUTCOME_DATE, CDR_OUTCOME_RECORDED_BY, INV_STAFF_INVOLVED, INV_EVIDENCE_SECURED, INV_OCCURRENCE_REASON, INV_USUAL_BEHAVIOUR, INV_PERSONS_TRIGGER, INV_PROTECTIVE_FACTORS, CSIP_INTVW_ID, CSIP_INTERVIEWEE, INTVW_DATE, INTVW_ROLE, INV_INTERVIEW_ROLE_DESCRIPTION, INV_INTERVIEW_COMMENTS, OPEN_CSIP_ALERT, INV_CONCLUSION, INV_OUTCOME, DEC_OUTCOME_DESCRIPTION, INV_SIGNED_OFF_BY, DEC_SIGNED_OFF_BY_DESCRIPTION, INV_NAME, INV_OUTCOME_RECORDED_BY, INV_OUTCOME_DATE, INV_NEXT_STEPS, INV_NOMIS_CASE_NOTE, INV_NON_ASSOC_UPDATED, INV_OBSERVATION_BOOK, INV_MOVE, INV_REVIEW, INV_SERVICE_REFERRAL, INV_SIM_REFERRAL, INV_OTHER, CASE_REV_DATE, CASE_MANAGER, REASON, IDENTIFIED_NEED, BY_WHOM, CREATE_DATE, TARGET_DATE, CLOSED_DATE, INTERVENTION, PROGRESSION, PLAN_ID, DTL_FACTOR_CODE, DTL_FACTOR_DESCRIPTION, DTL_COMMENTS, DTL_PERSONS_TRIGGER, NEXT_REVIEW_DATE, SUMMARY, REVIEW_SEQ, REV_RECORDED_BY, REV_DATE, CASE_NOTE, PEOPLE_INFORMED, REMAIN_ON_CSIP, CSIP_UPDATED, CLOSE_CSIP, CLOSE_DATE, BIRTH_DATE, AGE, GENDER_DESCRIPTION, OFFICER, ETHNIC_DESCRIPTION, NATIONALITY, IEP_LEVEL, ATTENDEE_NAME, ATTENDEE_ROLE, ATTENDED, CONTRIBUTION, REVIEW_ID, ATTENDEE_ID FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "prisoner_number",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter NOMS Number:",
          "description": "@prompt('Enter NOMS Number:','A',,Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP1d.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP1d.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP1d.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "CSIP Agy Loc Id",
            "legacyId": "DP1d.DO6c4",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "CSIP_SEQ",
            "type": "string",
            "display": "CSIP Log #",
            "legacyId": "DP1d.DO65d",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "REFERRAL_COMPLETED_BY",
            "type": "string",
            "display": "RFR Completed By",
            "legacyId": "DP1d.DO6c5",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "REFERRAL_COMPLETED_DATE",
            "type": "date",
            "display": "RFR Completed Date",
            "legacyId": "DP1d.DO6c6",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "REFERRAL_COMPLETE_FLAG",
            "type": "string",
            "display": "RFR Complete Flag",
            "legacyId": "DP1d.DO6c7",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "RFR_INCIDENT_DATE",
            "type": "date",
            "display": "RFR Incident Date",
            "legacyId": "DP1d.DO65e",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "RFR_INCIDENT_TYPE",
            "type": "string",
            "display": "RFR Incident Type Code",
            "legacyId": "DP1d.DO660",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "RFR_INCIDENT_TIME_",
            "type": "date",
            "display": "RFR Incident Time (see description)",
            "legacyId": "DP1d.DO65f",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "RFR Incident Type Description",
            "legacyId": "DP1d.DO679",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "RFR_INCIDENT_LOCATION",
            "type": "string",
            "display": "RFR Incident Location Code",
            "legacyId": "DP1d.DO661",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "RFR_INCIDENT_LOCATION_DESCRI33",
            "type": "string",
            "display": "RFR Incident Location Description",
            "legacyId": "DP1d.DO67a",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "RFR_REPORTED_BY",
            "type": "string",
            "display": "RFR Referred By",
            "legacyId": "DP1d.DO663",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "RFR_CSIP_FUNCTION",
            "type": "string",
            "display": "RFR Area of Work Code",
            "legacyId": "DP1d.DO662",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "RFR_AREA_OF_WORK_DESCRIPTION",
            "type": "string",
            "display": "RFR Area of Work Description",
            "legacyId": "DP1d.DO67b",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "RFR_DATE_REPORTED",
            "type": "date",
            "display": "RFR Date Referred",
            "legacyId": "DP1d.DO664",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "RFR_COMMENT",
            "type": "string",
            "display": "RFR Comment",
            "legacyId": "DP1d.DO665",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "RFR_PROACTIVE_RESPONSE",
            "type": "string",
            "display": "RFR Proactive Referral (Prevention)",
            "legacyId": "DP1d.DO666",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "RFR_STAFF_ASSAULTED",
            "type": "string",
            "display": "RFR Staff Assaulted",
            "legacyId": "DP1d.DO667",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "RFR_STAFF_NAME",
            "type": "string",
            "display": "RFR Staff Name",
            "legacyId": "DP1d.DO668",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CSIP_ID",
            "type": "double",
            "display": "RFR CSIP ID",
            "legacyId": "DP1d.DO65c",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "CDR_RELEASE_DATE",
            "type": "date",
            "display": "CDR Release Date",
            "legacyId": "DP1d.DO670",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "CDR_INVOLVEMENT",
            "type": "string",
            "display": "CDR Involvement Code",
            "legacyId": "DP1d.DO66e",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "CDR_INVOLVEMENT_DESCRIPTION",
            "type": "string",
            "display": "CDR Involvement Description",
            "legacyId": "DP1d.DO67c",
            "legacySqlClass": "column"
          },
          {
            "index": 26,
            "name": "CDR_SENT_DENT",
            "type": "string",
            "display": "CDR Sent to Safer Custody Team",
            "legacyId": "DP1d.DO66f",
            "legacySqlClass": "column"
          },
          {
            "index": 27,
            "name": "CDR_OTHER_INFORMATION",
            "type": "string",
            "display": "CDR Other Information",
            "legacyId": "DP1d.DO66c",
            "legacySqlClass": "column"
          },
          {
            "index": 28,
            "name": "CSIP_FACTOR_ID",
            "type": "double",
            "display": "CDR Factor Id",
            "legacyId": "DP1d.DO67d",
            "legacySqlClass": "column"
          },
          {
            "index": 29,
            "name": "CSIP_FACTOR",
            "type": "string",
            "display": "CDR Factor Code",
            "legacyId": "DP1d.DO67e",
            "legacySqlClass": "column"
          },
          {
            "index": 30,
            "name": "CDR_FACTOR_DESCRIPTION",
            "type": "string",
            "display": "CDR Factor Description",
            "legacyId": "DP1d.DO681",
            "legacySqlClass": "column"
          },
          {
            "index": 31,
            "name": "COMMENTS",
            "type": "string",
            "display": "CDR Comments",
            "legacyId": "DP1d.DO67f",
            "legacySqlClass": "column"
          },
          {
            "index": 32,
            "name": "INV_KNOWN_REASONS",
            "type": "string",
            "display": "CDR Known Reasons",
            "legacyId": "DP1d.DO671",
            "legacySqlClass": "column"
          },
          {
            "index": 33,
            "name": "CDR_CONCERN_DESCRIPTION",
            "type": "string",
            "display": "CDR Concern Description",
            "legacyId": "DP1d.DO66d",
            "legacySqlClass": "column"
          },
          {
            "index": 34,
            "name": "CDR_DECISION_REASON",
            "type": "string",
            "display": "CDR Decision Reason",
            "legacyId": "DP1d.DO6c8",
            "legacySqlClass": "column"
          },
          {
            "index": 35,
            "name": "CDR_OUTCOME",
            "type": "string",
            "display": "CDR Outcome Code",
            "legacyId": "DP1d.DO669",
            "legacySqlClass": "column"
          },
          {
            "index": 36,
            "name": "CDR_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "CDR Outcome Description",
            "legacyId": "DP1d.DO680",
            "legacySqlClass": "column"
          },
          {
            "index": 37,
            "name": "CDR_OUTCOME_DATE",
            "type": "date",
            "display": "CDR Outcome Date",
            "legacyId": "DP1d.DO66b",
            "legacySqlClass": "column"
          },
          {
            "index": 38,
            "name": "CDR_OUTCOME_RECORDED_BY",
            "type": "string",
            "display": "CDR Outcome Recorded By",
            "legacyId": "DP1d.DO66a",
            "legacySqlClass": "column"
          },
          {
            "index": 39,
            "name": "INV_STAFF_INVOLVED",
            "type": "string",
            "display": "INV Staff Involved",
            "legacyId": "DP1d.DO673",
            "legacySqlClass": "column"
          },
          {
            "index": 40,
            "name": "INV_EVIDENCE_SECURED",
            "type": "string",
            "display": "INV Evidence Secured",
            "legacyId": "DP1d.DO674",
            "legacySqlClass": "column"
          },
          {
            "index": 41,
            "name": "INV_OCCURRENCE_REASON",
            "type": "string",
            "display": "INV Occurrence Reason",
            "legacyId": "DP1d.DO676",
            "legacySqlClass": "column"
          },
          {
            "index": 42,
            "name": "INV_USUAL_BEHAVIOUR",
            "type": "string",
            "display": "INV Usual Behaviour",
            "legacyId": "DP1d.DO677",
            "legacySqlClass": "column"
          },
          {
            "index": 43,
            "name": "INV_PERSONS_TRIGGER",
            "type": "string",
            "display": "INV Persons Trigger",
            "legacyId": "DP1d.DO672",
            "legacySqlClass": "column"
          },
          {
            "index": 44,
            "name": "INV_PROTECTIVE_FACTORS",
            "type": "string",
            "display": "INV Protective Factors",
            "legacyId": "DP1d.DO678",
            "legacySqlClass": "column"
          },
          {
            "index": 45,
            "name": "CSIP_INTVW_ID",
            "type": "double",
            "display": "INV Interview ID",
            "legacyId": "DP1d.DO687",
            "legacySqlClass": "column"
          },
          {
            "index": 46,
            "name": "CSIP_INTERVIEWEE",
            "type": "string",
            "display": "INV Interviewee",
            "legacyId": "DP1d.DO683",
            "legacySqlClass": "column"
          },
          {
            "index": 47,
            "name": "INTVW_DATE",
            "type": "date",
            "display": "INV Interview Date",
            "legacyId": "DP1d.DO684",
            "legacySqlClass": "column"
          },
          {
            "index": 48,
            "name": "INTVW_ROLE",
            "type": "string",
            "display": "INV Interview Role Code",
            "legacyId": "DP1d.DO685",
            "legacySqlClass": "column"
          },
          {
            "index": 49,
            "name": "INV_INTERVIEW_ROLE_DESCRIPTION",
            "type": "string",
            "display": "INV Interview Role Description",
            "legacyId": "DP1d.DO682",
            "legacySqlClass": "column"
          },
          {
            "index": 50,
            "name": "INV_INTERVIEW_COMMENTS",
            "type": "string",
            "display": "INV Interview Comments",
            "legacyId": "DP1d.DO686",
            "legacySqlClass": "column"
          },
          {
            "index": 51,
            "name": "OPEN_CSIP_ALERT",
            "type": "string",
            "display": "DEC Open CSIP Alert",
            "legacyId": "DP1d.DO6c9",
            "legacySqlClass": "column"
          },
          {
            "index": 52,
            "name": "INV_CONCLUSION",
            "type": "string",
            "display": "DEC Conclusion",
            "legacyId": "DP1d.DO688",
            "legacySqlClass": "column"
          },
          {
            "index": 53,
            "name": "INV_OUTCOME",
            "type": "string",
            "display": "DEC Outcome Code",
            "legacyId": "DP1d.DO689",
            "legacySqlClass": "column"
          },
          {
            "index": 54,
            "name": "DEC_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "DEC Outcome Description",
            "legacyId": "DP1d.DO697",
            "legacySqlClass": "column"
          },
          {
            "index": 55,
            "name": "INV_SIGNED_OFF_BY",
            "type": "string",
            "display": "DEC Signed Off By Code",
            "legacyId": "DP1d.DO68a",
            "legacySqlClass": "column"
          },
          {
            "index": 56,
            "name": "DEC_SIGNED_OFF_BY_DESCRIPTION",
            "type": "string",
            "display": "DEC Signed Off By Description",
            "legacyId": "DP1d.DO698",
            "legacySqlClass": "column"
          },
          {
            "index": 57,
            "name": "INV_NAME",
            "type": "string",
            "display": "DEC Name",
            "legacyId": "DP1d.DO68b",
            "legacySqlClass": "column"
          },
          {
            "index": 58,
            "name": "INV_OUTCOME_RECORDED_BY",
            "type": "string",
            "display": "DEC Outcome Recorded By",
            "legacyId": "DP1d.DO68c",
            "legacySqlClass": "column"
          },
          {
            "index": 59,
            "name": "INV_OUTCOME_DATE",
            "type": "date",
            "display": "DEC Outcome Date",
            "legacyId": "DP1d.DO68d",
            "legacySqlClass": "column"
          },
          {
            "index": 60,
            "name": "INV_NEXT_STEPS",
            "type": "string",
            "display": "DEC Next Steps",
            "legacyId": "DP1d.DO695",
            "legacySqlClass": "column"
          },
          {
            "index": 61,
            "name": "INV_NOMIS_CASE_NOTE",
            "type": "string",
            "display": "DEC NOMIS Case Note",
            "legacyId": "DP1d.DO696",
            "legacySqlClass": "column"
          },
          {
            "index": 62,
            "name": "INV_NON_ASSOC_UPDATED",
            "type": "string",
            "display": "DEC Non Assoc Updated",
            "legacyId": "DP1d.DO68e",
            "legacySqlClass": "column"
          },
          {
            "index": 63,
            "name": "INV_OBSERVATION_BOOK",
            "type": "string",
            "display": "DEC Observation Book",
            "legacyId": "DP1d.DO68f",
            "legacySqlClass": "column"
          },
          {
            "index": 64,
            "name": "INV_MOVE",
            "type": "string",
            "display": "DEC Unit / Cell Room Move",
            "legacyId": "DP1d.DO690",
            "legacySqlClass": "column"
          },
          {
            "index": 65,
            "name": "INV_REVIEW",
            "type": "string",
            "display": "DEC CSRA/RSRA Review",
            "legacyId": "DP1d.DO691",
            "legacySqlClass": "column"
          },
          {
            "index": 66,
            "name": "INV_SERVICE_REFERRAL",
            "type": "string",
            "display": "DEC Service Referral",
            "legacyId": "DP1d.DO692",
            "legacySqlClass": "column"
          },
          {
            "index": 67,
            "name": "INV_SIM_REFERRAL",
            "type": "string",
            "display": "DEC Sim Referral",
            "legacyId": "DP1d.DO693",
            "legacySqlClass": "column"
          },
          {
            "index": 68,
            "name": "INV_OTHER",
            "type": "string",
            "display": "DEC Other",
            "legacyId": "DP1d.DO694",
            "legacySqlClass": "column"
          },
          {
            "index": 69,
            "name": "CASE_REV_DATE",
            "type": "date",
            "display": "PLN Case Rev Date",
            "legacyId": "DP1d.DO6ca",
            "legacySqlClass": "column"
          },
          {
            "index": 70,
            "name": "CASE_MANAGER",
            "type": "string",
            "display": "PLN Case Manager",
            "legacyId": "DP1d.DO699",
            "legacySqlClass": "column"
          },
          {
            "index": 71,
            "name": "REASON",
            "type": "string",
            "display": "PLN Reason",
            "legacyId": "DP1d.DO69a",
            "legacySqlClass": "column"
          },
          {
            "index": 72,
            "name": "IDENTIFIED_NEED",
            "type": "string",
            "display": "PLN Identified Need",
            "legacyId": "DP1d.DO69c",
            "legacySqlClass": "column"
          },
          {
            "index": 73,
            "name": "BY_WHOM",
            "type": "string",
            "display": "PLN By Whom",
            "legacyId": "DP1d.DO69e",
            "legacySqlClass": "column"
          },
          {
            "index": 74,
            "name": "CREATE_DATE",
            "type": "date",
            "display": "PLN Create Date",
            "legacyId": "DP1d.DO69d",
            "legacySqlClass": "column"
          },
          {
            "index": 75,
            "name": "TARGET_DATE",
            "type": "date",
            "display": "PLN Target Date",
            "legacyId": "DP1d.DO6a0",
            "legacySqlClass": "column"
          },
          {
            "index": 76,
            "name": "CLOSED_DATE",
            "type": "date",
            "display": "PLN Closed Date",
            "legacyId": "DP1d.DO6a1",
            "legacySqlClass": "column"
          },
          {
            "index": 77,
            "name": "INTERVENTION",
            "type": "string",
            "display": "PLN Intervention",
            "legacyId": "DP1d.DO6a2",
            "legacySqlClass": "column"
          },
          {
            "index": 78,
            "name": "PROGRESSION",
            "type": "string",
            "display": "PLN Progression",
            "legacyId": "DP1d.DO6a3",
            "legacySqlClass": "column"
          },
          {
            "index": 79,
            "name": "PLAN_ID",
            "type": "double",
            "display": "PLN Plan Id",
            "legacyId": "DP1d.DO69b",
            "legacySqlClass": "column"
          },
          {
            "index": 80,
            "name": "DTL_FACTOR_CODE",
            "type": "string",
            "display": "DTL Factor Code",
            "legacyId": "DP1d.DO6c1",
            "legacySqlClass": "column"
          },
          {
            "index": 81,
            "name": "DTL_FACTOR_DESCRIPTION",
            "type": "string",
            "display": "DTL Factor Description",
            "legacyId": "DP1d.DO6c2",
            "legacySqlClass": "column"
          },
          {
            "index": 82,
            "name": "DTL_COMMENTS",
            "type": "string",
            "display": "DTL Comments",
            "legacyId": "DP1d.DO6c3",
            "legacySqlClass": "column"
          },
          {
            "index": 83,
            "name": "DTL_PERSONS_TRIGGER",
            "type": "string",
            "display": "DTL Persons Trigger",
            "legacyId": "DP1d.DO6c0",
            "legacySqlClass": "column"
          },
          {
            "index": 84,
            "name": "NEXT_REVIEW_DATE",
            "type": "date",
            "display": "REV Next Review Date",
            "legacyId": "DP1d.DO6a4",
            "legacySqlClass": "column"
          },
          {
            "index": 85,
            "name": "SUMMARY",
            "type": "string",
            "display": "REV Summary",
            "legacyId": "DP1d.DO6a5",
            "legacySqlClass": "column"
          },
          {
            "index": 86,
            "name": "REVIEW_SEQ",
            "type": "double",
            "display": "REV Review Seq",
            "legacyId": "DP1d.DO6a6",
            "legacySqlClass": "column"
          },
          {
            "index": 87,
            "name": "REV_RECORDED_BY",
            "type": "string",
            "display": "REV Recorded By",
            "legacyId": "DP1d.DO6ae",
            "legacySqlClass": "column"
          },
          {
            "index": 88,
            "name": "REV_DATE",
            "type": "date",
            "display": "REV Date",
            "legacyId": "DP1d.DO6a7",
            "legacySqlClass": "column"
          },
          {
            "index": 89,
            "name": "CASE_NOTE",
            "type": "string",
            "display": "REV Case Note Completed",
            "legacyId": "DP1d.DO6a8",
            "legacySqlClass": "column"
          },
          {
            "index": 90,
            "name": "PEOPLE_INFORMED",
            "type": "string",
            "display": "REV Responsible People Informed",
            "legacyId": "DP1d.DO6a9",
            "legacySqlClass": "column"
          },
          {
            "index": 91,
            "name": "REMAIN_ON_CSIP",
            "type": "string",
            "display": "REV Remain On CSIP",
            "legacyId": "DP1d.DO6aa",
            "legacySqlClass": "column"
          },
          {
            "index": 92,
            "name": "CSIP_UPDATED",
            "type": "string",
            "display": "REV CSIP Updated",
            "legacyId": "DP1d.DO6ab",
            "legacySqlClass": "column"
          },
          {
            "index": 93,
            "name": "CLOSE_CSIP",
            "type": "string",
            "display": "REV Close CSIP",
            "legacyId": "DP1d.DO6ac",
            "legacySqlClass": "column"
          },
          {
            "index": 94,
            "name": "CLOSE_DATE",
            "type": "date",
            "display": "REV Close Date",
            "legacyId": "DP1d.DO6ad",
            "legacySqlClass": "column"
          },
          {
            "index": 95,
            "name": "BIRTH_DATE",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DP1d.DO10075",
            "legacySqlClass": "column"
          },
          {
            "index": 96,
            "name": "AGE",
            "type": "double",
            "display": "Age",
            "legacyId": "DP1d.DO10072",
            "legacySqlClass": "column"
          },
          {
            "index": 97,
            "name": "GENDER_DESCRIPTION",
            "type": "string",
            "display": "Gender Description",
            "legacyId": "DP1d.DO100ae",
            "legacySqlClass": "column"
          },
          {
            "index": 98,
            "name": "OFFICER",
            "type": "string",
            "display": "Personal Officer",
            "legacyId": "DP1d.DO10ea2",
            "legacySqlClass": "column"
          },
          {
            "index": 99,
            "name": "ETHNIC_DESCRIPTION",
            "type": "string",
            "display": "Ethnic Description",
            "legacyId": "DP1d.DO1009d",
            "legacySqlClass": "column"
          },
          {
            "index": 100,
            "name": "NATIONALITY",
            "type": "string",
            "display": "Nationality",
            "legacyId": "DP1d.DO10b7e",
            "legacySqlClass": "column"
          },
          {
            "index": 101,
            "name": "IEP_LEVEL",
            "type": "string",
            "display": "Current IEP Band",
            "legacyId": "DP1d.DO1049c",
            "legacySqlClass": "column"
          },
          {
            "index": 102,
            "name": "ATTENDEE_NAME",
            "type": "string",
            "display": "ATT Attendee Name",
            "legacyId": "DP1d.DO6af",
            "legacySqlClass": "column"
          },
          {
            "index": 103,
            "name": "ATTENDEE_ROLE",
            "type": "string",
            "display": "ATT Attendee Role",
            "legacyId": "DP1d.DO6b0",
            "legacySqlClass": "column"
          },
          {
            "index": 104,
            "name": "ATTENDED",
            "type": "string",
            "display": "ATT Attended",
            "legacyId": "DP1d.DO6b1",
            "legacySqlClass": "column"
          },
          {
            "index": 105,
            "name": "CONTRIBUTION",
            "type": "string",
            "display": "ATT Contribution",
            "legacyId": "DP1d.DO6b2",
            "legacySqlClass": "column"
          },
          {
            "index": 106,
            "name": "REVIEW_ID",
            "type": "double",
            "display": "ATT Review Id",
            "legacyId": "DP1d.DO6b3",
            "legacySqlClass": "column"
          },
          {
            "index": 107,
            "name": "ATTENDEE_ID",
            "type": "double",
            "display": "ATT Attendee Id",
            "legacyId": "DP1d.DO6b4",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376286/DP27",
      "name": "Main Offence",
      "description": "OR - Sentence",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_OFFENCES.DESCRIPTION FROM OMS_OWNER.COURT_EVENTS AT_OFFENDER_COURT_EVENTS, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENCES AT_OFFENCES, OMS_OWNER.COURT_EVENT_CHARGES AT_COURT_EVENT_CHARGES, OMS_OWNER.OFFENDER_CHARGES AT_OFFENDER_CHARGES, OMS_OWNER.OFFENDER_CASES AT_OFFENDER_CASES WHERE (AT_COURT_EVENT_CHARGES.EVENT_ID (+) = AT_OFFENDER_COURT_EVENTS.EVENT_ID) AND (AT_OFFENDER_CHARGES.OFFENDER_CHARGE_ID (+) = AT_COURT_EVENT_CHARGES.OFFENDER_CHARGE_ID) AND (AT_OFFENDER_COURT_EVENTS.CASE_ID = AT_OFFENDER_CASES.CASE_ID) AND (AT_OFFENDER_CHARGES.OFFENCE_CODE = AT_OFFENCES.OFFENCE_CODE (+)) AND (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_CASES.OFFENDER_BOOK_ID (+)) AND (AT_COURT_EVENT_CHARGES.MOST_SERIOUS_FLAG IN ('Y') AND AT_OFFENDER.OFFENDER_ID_DISPLAY = (SELECT PRISONER_NUMBER FROM prompt_ /* = #prompt('Enter NOMS Number:','A',,Mono,Free,Not_Persistent,,User:0) */))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DESCRIPTION FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "prisoner_number",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter NOMS Number:",
          "description": "@prompt('Enter NOMS Number:','A',,Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP27.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Offence Description",
            "legacyId": "DP27.DO974",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375850/DP28",
      "name": "Establishment Code",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, USER_ACCESSIBLE_CASELOADS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND AT_OFFENDER.OFFENDER_ID_DISPLAY = (SELECT PRISONER_NUMBER FROM prompt_ /* = #prompt('Enter NOMS Number:','A',,Mono,Free,Persistent,,User:0) */)), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, AGY_LOC_ID FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "prisoner_number",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter NOMS Number:",
          "description": "@prompt('Enter NOMS Number:','A',,Mono,Free,Persistent,,User:0)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP28.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "Establishment.Establishment Code",
            "legacyId": "DP28.DO1043b",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "166802.RS",
      "name": "CSIP",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375850/DP1d",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-section",
        "field": [
          {
            "name": "$ref:CSIP_SEQ",
            "display": "CSIP Log #",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO65d"
          },
          {
            "name": "$ref:RFR_INCIDENT_TIME_",
            "display": "RFR Incident Time (see description)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO65f"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "RFR Incident Type Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO679"
          },
          {
            "name": "$ref:RFR_INCIDENT_LOCATION_DESCRI33",
            "display": "RFR Incident Location Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO67a"
          },
          {
            "name": "$ref:RFR_REPORTED_BY",
            "display": "RFR Referred By",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO663"
          },
          {
            "name": "$ref:RFR_AREA_OF_WORK_DESCRIPTION",
            "display": "RFR Area of Work Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO67b"
          },
          {
            "name": "$ref:RFR_DATE_REPORTED",
            "display": "RFR Date Referred",
            "formula": "format_date(${RFR_DATE_REPORTED}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO664"
          }
        ]
      }
    }
  ],
  "errors": []
}