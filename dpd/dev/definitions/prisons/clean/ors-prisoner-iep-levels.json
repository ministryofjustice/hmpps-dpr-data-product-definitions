{
  "id": "Fi1uwFufAg8AuroAAHDLtV8FACJIABRd",
  "name": "ORS Prisoner IEP Levels",
  "description": "This report returns information about the IEP levels within a prison population. The report contains multiple tabs giving different groupings/sorts of the same data 1) By IEP Level and IEP Date 2) By Legal Status and IEP Date 3) By Prisoner 4) By Location  5) By NOMS Number 6) By Nationality 7) Simple By Location 8) Simple By Alpha<br/>PDD0029 - v00.00.10 Last Modified: 03/06/2019",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "PDD0029 v00.00.10",
      "IEP"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3377299/DP11",
      "name": "Prisoner IEP Levels",
      "description": "Demographic",
      "datasource": "nomis",
      "query": "DP1b_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS ID, CASE WHEN NOT AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE WHEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN DT_LAST_RELEASE_DATE.LAST_REL_DATE ELSE NULL END AS CURRENT_RELEASE_DATE, CURR_EFF_SENT_LEN.CURR_EFF_SENT_LEN, DT_ADMISSION.ADMISSION_DATE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_RELEASE_DETAILS AT_OFFENDER_RELEASE_DETAILS, ( SELECT AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID, CASE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE ELSE NULL END AS Last_Rel_Date, EFFECTIVE_SENTENCE_LENGTH FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = ( SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID ) ) DT_LAST_RELEASE_DATE, ( SELECT OFF_BOOK.OFFENDER_BOOK_ID, CASE WHEN LIFE_FLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE SENT_CALC.EFFECTIVE_SENTENCE_LENGTH END AS CURR_EFF_SENT_LEN FROM ( SELECT DISTINCT OFFENDER_SENTENCE_TERMS.OFFENDER_BOOK_ID, OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG FROM OFFENDER_SENTENCE_TERMS WHERE OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y' ) LIFE_FLAG, OMS_OWNER.OFFENDER_SENT_CALCULATIONS SENT_CALC, OMS_OWNER.OFFENDER_BOOKINGS OFF_BOOK WHERE ( OFF_BOOK.OFFENDER_BOOK_ID = SENT_CALC.OFFENDER_BOOK_ID (+) ) AND ( LIFE_FLAG.OFFENDER_BOOK_ID (+) = SENT_CALC.OFFENDER_BOOK_ID ) AND SENT_CALC.OFFENDER_SENT_CALCULATION_ID = ( SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE SENT_CALC.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID ) ) CURR_EFF_SENT_LEN, ( SELECT DISTINCT m.OFFENDER_BOOK_ID, MAX(m.MOVEMENT_TIME) AS ADMISSION_DATE FROM OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS m, OMS_OWNER.offender_bookings h WHERE h.booking_status = 'O' AND h.active_flag = 'Y' AND m.direction_code = 'IN' AND m.Movement_reason_code <> 'R' AND m.Movement_type = 'ADM' AND m.to_agy_loc_id = h.agy_loc_id AND h.offender_book_id = m.offender_book_id GROUP BY m.OFFENDER_BOOK_ID ) DT_ADMISSION WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_RELEASE_DETAILS.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_LAST_RELEASE_DATE.OFFENDER_BOOK_ID (+) ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( CURR_EFF_SENT_LEN.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_ADMISSION.OFFENDER_BOOK_ID (+) ) AND ( (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = (SELECT establishment_code from prompt_)) ) ), dataset_base_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, CASE WHEN INSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1 ) = 0 THEN NULL ELSE SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, INSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1 ) + 1, CASE WHEN INSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2 ) = 0 THEN LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ELSE INSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 2 ) - INSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, '-', 1, 1 ) END - 1 ) END AS UNIT_CODE_1, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, 5, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS LOCATION, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, COALESCE(DT_IEP_BAND_LAST.DESCRIPTION, 'Missing') AS IEP_LEVEL, AT_OFFENDER_BOOKING.BOOKING_BEGIN_DATE, DT_IEP_BAND_LAST.IEP_DATE, AT_NATIONALITY.PROFILE_CODE, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END AS ETHNIC_CODE, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END || '-' || CASE WHEN AT_ETHNICITY_DESC.CODE = 'W8' THEN 'White: Gypsy or Irish Traveller' WHEN AT_ETHNICITY_DESC.CODE = 'O1' THEN 'Asian/Asian British: Chinese' ELSE AT_ETHNICITY_DESC.DESCRIPTION END AS ETHNIC_DESCRIPTION, AT_OFFENDER_IMPRISON_STATUSES.EFFECTIVE_DATE, CASE WHEN AT_IMPRISON_STATUSES_SEQ.BAND_CODE IN ('9', '10', '11', '12', '13') THEN 'Unconvicted' WHEN AT_IMPRISON_STATUSES_SEQ.IMPRISONMENT_STATUS IN ( 'SINE DIE', 'DISCONT', 'POLICE', 'DISCHARGED', 'RX', 'S48MHA' ) THEN 'Unconvicted' WHEN AT_IMPRISON_STATUSES_SEQ.IMPRISONMENT_STATUS IN ('UNKNOWN', 'BOBC', 'UNFIT', 'UNK_CUST', 'DIED') THEN 'Check Record' ELSE 'Convicted' END AS CONVICTED_UNCONVICTED_STATUS, TRUNC(CURRENT_TIMESTAMP) AS TODAY_, TRUNC( MONTHS_BETWEEN(CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12 ) AS AGE_IN_YEARS, AT_OFFENDER_RELIGION.PROFILE_CODE AS RELIGION, DP1b_.ADMISSION_DATE, DP1b_.CURRENT_RELEASE_DATE, DP1b_.CURR_EFF_SENT_LEN FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.REFERENCE_CODES AT_ETHNICITY_DESC, ( SELECT iep_level, description, agy_loc_id, offender_book_id, iep_date FROM ( SELECT iep.iep_level, rc.description, iep.agy_loc_id, iep.offender_book_id, iep.iep_date, ROW_NUMBER() OVER ( PARTITION BY iep.offender_book_id ORDER BY iep.iep_time DESC, iep.iep_level_seq DESC ) AS row_seq_filter FROM oms_owner.offender_iep_levels iep LEFT OUTER JOIN oms_owner.reference_codes rc ON iep.iep_level = rc.code AND rc.domain = 'IEP_LEVEL' ) WHERE row_seq_filter = 1 ) DT_IEP_BAND_LAST, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.OFFENDER_PROFILE_DETAILS AT_OFFENDER_RELIGION, OMS_OWNER.OFFENDER_PROFILE_DETAILS AT_OFF_PROF_DET_NAT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.IMPRISONMENT_STATUSES AT_IMPRISON_STATUSES_SEQ, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.PROFILE_CODES AT_NATIONALITY, OMS_OWNER.OFFENDER_IMPRISON_STATUSES AT_OFFENDER_IMPRISON_STATUSES, OMS_OWNER.OFFENDER_IMPRISON_STATUSES AT_OFFENDER_IMPRISON_STS, DP1b_ WHERE ( ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND (AT_ETHNICITY_DESC.DOMAIN = 'ETHNICITY') AND (AT_ETHNICITY_DESC.CODE = AT_OFFENDER.RACE_CODE) AND ( AT_OFFENDER_RELIGION.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND (AT_OFFENDER_RELIGION.PROFILE_TYPE = 'RELF') AND ( AT_OFFENDER_IMPRISON_STATUSES.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS = 'Y' OR AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS IS NULL ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( DT_IEP_BAND_LAST.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFF_PROF_DET_NAT.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND (AT_OFF_PROF_DET_NAT.PROFILE_TYPE = ('NAT')) AND ( AT_NATIONALITY.PROFILE_TYPE = AT_OFF_PROF_DET_NAT.PROFILE_TYPE AND AT_NATIONALITY.PROFILE_CODE = AT_OFF_PROF_DET_NAT.PROFILE_CODE ) AND (AT_NATIONALITY.PROFILE_TYPE = ('NAT')) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( AT_OFFENDER_IMPRISON_STS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_IMPRISON_STATUSES_SEQ.IMPRISONMENT_STATUS = AT_OFFENDER_IMPRISON_STS.IMPRISONMENT_STATUS ) AND (AT_OFFENDER_IMPRISON_STS.LATEST_STATUS = 'Y') AND ( WING_CASELOAD_SECURITY.USERNAME = (SELECT username from context_) ) AND ( (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = (SELECT establishment_code from prompt_)) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') ) ) AND (DP1b_.ID = OFFENDER_ID_DISPLAY) ), dataset_ AS ( SELECT OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, UNIT_CODE_1, LOCATION, CAPACITY, IEP_LEVEL, BOOKING_BEGIN_DATE, IEP_DATE, PROFILE_CODE, ETHNIC_CODE, ETHNIC_DESCRIPTION, EFFECTIVE_DATE, CONVICTED_UNCONVICTED_STATUS, TODAY_, AGE_IN_YEARS, RELIGION, ADMISSION_DATE AS V_ADMISSIONDATE, CASE WHEN CURR_EFF_SENT_LEN = '00/00/00' THEN '' ELSE CURR_EFF_SENT_LEN END AS VSENTENCELENGTH, CURRENT_RELEASE_DATE AS VRELEASE, (TODAY_ - IEP_DATE) AS DAYS_ON_IEP FROM dataset_base_ )",
      "parameters": [{
        "index": 0,
        "name": "establishment_code",
        "filterType": "autocomplete",
        "referenceType": "establishment",
        "reportFieldType": "string",
        "display": "Establishment",
        "description": "@Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3)",
        "mandatory": "true"
      }],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP11.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP11.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP11.DO46",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "UNIT_CODE_1",
            "type": "string",
            "display": "Unit Code 1",
            "legacyId": "DP11.DO472",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "LOCATION",
            "type": "string",
            "display": "Location",
            "legacyId": "DP11.DO51f",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "CAPACITY",
            "type": "double",
            "display": "Unit Description 4 Capacity",
            "legacyId": "DP11.DO1095",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "IEP_LEVEL",
            "type": "string",
            "display": "IEP Level",
            "legacyId": "DP11.DO521",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "BOOKING_BEGIN_DATE",
            "type": "date",
            "display": "Booking Begin Date",
            "legacyId": "DP11.DOb97",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "IEP_DATE",
            "type": "date",
            "display": "IEP Date",
            "legacyId": "DP11.DOe41",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "PROFILE_CODE",
            "type": "string",
            "display": "Nationality Code",
            "legacyId": "DP11.DO10d6",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "ETHNIC_CODE",
            "type": "string",
            "display": "Ethnic Code",
            "legacyId": "DP11.DO88",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "ETHNIC_DESCRIPTION",
            "type": "string",
            "display": "Ethnic Description",
            "legacyId": "DP11.DO9d",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "EFFECTIVE_DATE",
            "type": "date",
            "display": "Main Legal Status Effective Date",
            "legacyId": "DP11.DObb5",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "CONVICTED_UNCONVICTED_STATUS",
            "type": "string",
            "display": "Convicted / Unconvicted Status",
            "legacyId": "DP11.DO716",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "TODAY_",
            "type": "date",
            "display": "Today (Date only)",
            "legacyId": "DP11.DO712",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "AGE_IN_YEARS",
            "type": "double",
            "display": "Age in Years",
            "legacyId": "DP11.DOa15",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "RELIGION",
            "type": "string",
            "display": "Religion",
            "legacyId": "DP11.DOb0",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "V_ADMISSIONDATE",
            "type": "string",
            "display": "V_ADMISSIONDATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 18,
            "name": "VSENTENCELENGTH",
            "type": "string",
            "display": "VSENTENCELENGTH",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 19,
            "name": "VRELEASE",
            "type": "string",
            "display": "VRELEASE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 20,
            "name": "DAYS_ON_IEP",
            "type": "long",
            "display": "Days On IEP",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "prisoner-distinct-count-per-location-and-iep-level",
      "name": "Distinct prisoner count",
      "datasource": "redshift",
      "query": "select t1.UNIT_CODE_1, t1.UNIT_CODE_1 as LOCATION, t1.IEP_LEVEL, t1.PRISONER_COUNT, ROUND(PRISONER_COUNT * 100.0/t2.total_count, 2) as percentage from (select UNIT_CODE_1, IEP_LEVEL, count(distinct OFFENDER_ID_DISPLAY) as PRISONER_COUNT from ${tableId} GROUP BY UNIT_CODE_1, IEP_LEVEL) as t1, (SELECT COUNT(distinct OFFENDER_ID_DISPLAY) as total_count FROM ${tableId}) as t2",
      "schema": {
        "field": [
          {
            "name": "UNIT_CODE_1",
            "type": "string",
            "display": "Location"
          },
          {
            "name": "LOCATION",
            "type": "string",
            "display": "Location"
          },
          {
            "name": "IEP_LEVEL",
            "type": "string",
            "display": "IEP Level"
          },
          {
            "name": "PRISONER_COUNT",
            "type": "long",
            "display": "Prisoner Count"
          },
          {
            "name": "PERCENTAGE",
            "type": "double",
            "display": "Percentage"
          }
        ]
      }
    },
    {
      "id": "prisoner-total-row-count-per-location-and-iep-level",
      "name": "Total prisoner row count",
      "datasource": "redshift",
      "query": "select UNIT_CODE_1, SUM(TOTAL_BY_GROUP) as TOTAL_ROWS FROM (select UNIT_CODE_1, IEP_LEVEL, count(*) as TOTAL_BY_GROUP from ${tableId} GROUP BY UNIT_CODE_1, IEP_LEVEL) GROUP BY UNIT_CODE_1",
      "schema": {
        "field": [
          {
            "name": "UNIT_CODE_1",
            "type": "string",
            "display": "Location"
          },
          {
            "name": "TOTAL_ROWS",
            "type": "long",
            "display": "Total Rows"
          }
        ]
      }
    },
    {
      "id": "prisoner-total-row-count-per-legal-status",
      "name": "Total prisoner row count",
      "datasource": "redshift",
      "query": "select CONVICTED_UNCONVICTED_STATUS, COUNT(*) as TOTAL_ROWS FROM ${tableId} GROUP BY CONVICTED_UNCONVICTED_STATUS",
      "schema": {
        "field": [
          {
            "name": "CONVICTED_UNCONVICTED_STATUS",
            "type": "string",
            "display": "Legal Status"
          },
          {
            "name": "TOTAL_ROWS",
            "type": "long",
            "display": "Total"
          }
        ]
      }
    },
    {
      "id": "prisoner-sum-total-count-per-location-and-iep-level-non-section",
      "name": "Total prisoner row count",
      "datasource": "redshift",
      "query": "select SUM(TOTAL_BY_GROUP) as TOTAL_ROWS FROM (select UNIT_CODE_1, IEP_LEVEL, count(*) as TOTAL_BY_GROUP from ${tableId} GROUP BY UNIT_CODE_1, IEP_LEVEL)",
      "schema": {
        "field": [
          {
            "name": "TOTAL_ROWS",
            "type": "long",
            "display": "Total"
          }
        ]
      }
    },
    {
      "id": "prisoner-total-row-count",
      "name": "Total prisoner row count ungrouped",
      "datasource": "redshift",
      "query": "select count(*) as TOTAL from ${tableId}",
      "schema": {
        "field": [
          {
            "name": "TOTAL",
            "type": "long",
            "display": "Grand Total"
          }
        ]
      }
    },
    {
      "id": "prisoner-distinct-count-by-iep-level",
      "name": "Distinct prisoner count by IEP Level",
      "datasource": "redshift",
      "query": "select t1.IEP_LEVEL, t1.IEP_LEVEL as IEP_LEVEL2, t1.PRISONER_COUNT, ROUND(PRISONER_COUNT * 100.0/t2.total_count, 2) as percentage from (select IEP_LEVEL, count(distinct OFFENDER_ID_DISPLAY) as PRISONER_COUNT from ${tableId} GROUP BY IEP_LEVEL) as t1, (SELECT COUNT(distinct OFFENDER_ID_DISPLAY) as total_count FROM ${tableId}) as t2",
      "schema": {
        "field": [
          {
            "name": "IEP_LEVEL",
            "type": "string",
            "display": "IEP Level"
          },
          {
            "name": "IEP_LEVEL2",
            "type": "string",
            "display": "IEP Level"
          },
          {
            "name": "PRISONER_COUNT",
            "type": "long",
            "display": "Prisoner Count"
          },
          {
            "name": "PERCENTAGE",
            "type": "double",
            "display": "Percentage"
          }
        ]
      }
    },
    {
      "id": "prisoner-distinct-count-by-iep-level-non-sectioned",
      "name": "Distinct prisoner count by IEP Level",
      "datasource": "redshift",
      "query": "select t1.IEP_LEVEL, t1.PRISONER_COUNT, ROUND(PRISONER_COUNT * 100.0/t2.total_count, 2) as percentage from (select IEP_LEVEL, count(distinct OFFENDER_ID_DISPLAY) as PRISONER_COUNT from ${tableId} GROUP BY IEP_LEVEL) as t1, (SELECT COUNT(distinct OFFENDER_ID_DISPLAY) as total_count FROM ${tableId}) as t2",
      "schema": {
        "field": [
          {
            "name": "IEP_LEVEL",
            "type": "string",
            "display": "IEP Level"
          },
          {
            "name": "PRISONER_COUNT",
            "type": "long",
            "display": "Prisoner Count"
          },
          {
            "name": "PERCENTAGE",
            "type": "double",
            "display": "Percentage"
          }
        ]
      }
    },
    {
      "id": "prisoner-distinct-count-per-location-and-iep-level-non-sectioned",
      "name": "Distinct prisoner count",
      "datasource": "redshift",
      "query": "select t1.UNIT_CODE_1 as LOCATION, t1.IEP_LEVEL, t1.PRISONER_COUNT, ROUND(PRISONER_COUNT * 100.0/t2.total_count, 2) as percentage from (select UNIT_CODE_1, IEP_LEVEL, count(distinct OFFENDER_ID_DISPLAY) as PRISONER_COUNT from ${tableId} GROUP BY UNIT_CODE_1, IEP_LEVEL) as t1, (SELECT COUNT(distinct OFFENDER_ID_DISPLAY) as total_count FROM ${tableId}) as t2",
      "schema": {
        "field": [
          {
            "name": "LOCATION",
            "type": "string",
            "display": "Location"
          },
          {
            "name": "IEP_LEVEL",
            "type": "string",
            "display": "IEP Level"
          },
          {
            "name": "PRISONER_COUNT",
            "type": "long",
            "display": "Prisoner Count"
          },
          {
            "name": "PERCENTAGE",
            "type": "double",
            "display": "%"
          }
        ]
      }
    },
    {
      "id": "prisoner-total-row-count-by-iep-level",
      "name": "Total prisoner row count by IEP level",
      "datasource": "redshift",
      "query": "select IEP_LEVEL, count(*) as TOTAL_BY_GROUP from ${tableId} GROUP BY IEP_LEVEL",
      "schema": {
        "field": [
          {
            "name": "IEP_LEVEL",
            "type": "string",
            "display": "Location"
          },
          {
            "name": "TOTAL_BY_GROUP",
            "type": "long",
            "display": "Total"
          }
        ]
      }
    },
    {
      "id": "3377299/DP1a",
      "name": "All IEP Levels",
      "description": "Demographic",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_IEP_LEVEL_DESC.DESCRIPTION AS DESCRIPTION FROM OMS_OWNER.REFERENCE_CODES AT_OFFENDER_IEP_LEVEL_DESC WHERE (AT_OFFENDER_IEP_LEVEL_DESC.DOMAIN (+) = 'IEP_LEVEL')), dataset_ AS (SELECT DESCRIPTION FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "IEP Band Description",
            "legacyId": "DP1a.DO263",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3377299/DP1b",
      "name": "Prisoner Sentence and Admission Dates",
      "description": "Demographic",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, CASE WHEN NOT AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE WHEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN DT_LAST_RELEASE_DATE.LAST_REL_DATE ELSE NULL END AS CURRENT_RELEASE_DATE, CURR_EFF_SENT_LEN.CURR_EFF_SENT_LEN AS CURR_EFF_SENT_LEN, DT_ADMISSION.ADMISSION_DATE AS ADMISSION_DATE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_RELEASE_DETAILS AT_OFFENDER_RELEASE_DETAILS, (SELECT AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID, CASE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE ELSE NULL END AS Last_Rel_Date, EFFECTIVE_SENTENCE_LENGTH FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = (SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID)) DT_LAST_RELEASE_DATE, (SELECT OFF_BOOK.OFFENDER_BOOK_ID, CASE WHEN LIFE_FLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE SENT_CALC.EFFECTIVE_SENTENCE_LENGTH END AS CURR_EFF_SENT_LEN FROM (SELECT DISTINCT OFFENDER_SENTENCE_TERMS.OFFENDER_BOOK_ID, OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG FROM OFFENDER_SENTENCE_TERMS WHERE OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y') LIFE_FLAG, OMS_OWNER.OFFENDER_SENT_CALCULATIONS SENT_CALC, OMS_OWNER.OFFENDER_BOOKINGS OFF_BOOK WHERE (OFF_BOOK.OFFENDER_BOOK_ID = SENT_CALC.OFFENDER_BOOK_ID (+)) AND (LIFE_FLAG.OFFENDER_BOOK_ID (+) = SENT_CALC.OFFENDER_BOOK_ID) AND SENT_CALC.OFFENDER_SENT_CALCULATION_ID = (SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE SENT_CALC.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID)) CURR_EFF_SENT_LEN, (SELECT DISTINCT m.OFFENDER_BOOK_ID, MAX(m.MOVEMENT_TIME) AS ADMISSION_DATE FROM OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS m, OMS_OWNER.offender_bookings h WHERE h.booking_status = 'O' AND h.active_flag = 'Y' AND m.direction_code = 'IN' AND m.Movement_reason_code <> 'R' AND m.Movement_type = 'ADM' AND m.to_agy_loc_id = h.agy_loc_id AND h.offender_book_id = m.offender_book_id GROUP BY m.OFFENDER_BOOK_ID) DT_ADMISSION WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_RELEASE_DETAILS.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_LAST_RELEASE_DATE.OFFENDER_BOOK_ID (+)) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (CURR_EFF_SENT_LEN.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_ADMISSION.OFFENDER_BOOK_ID (+)) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = 'BFI'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, CURRENT_RELEASE_DATE, CURR_EFF_SENT_LEN, ADMISSION_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP1b.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "CURRENT_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DP1b.DOb29",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "CURR_EFF_SENT_LEN",
            "type": "string",
            "display": "Current Effective Sentence Length",
            "legacyId": "DP1b.DObf6",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "ADMISSION_DATE",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DP1b.DOc6a",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "168911.RS",
      "name": "Summary",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP11",
      "summary": [
        {
          "id": "prisoner-distinct-count-per-location-and-iep-level-non-sectioned",
          "template": "page-header",
          "dataset": "$ref:prisoner-distinct-count-per-location-and-iep-level-non-sectioned"
        },
        {
          "id": "prisoner-sum-total-count-per-location-and-iep-level-non-section",
          "template": "page-header",
          "dataset": "$ref:prisoner-sum-total-count-per-location-and-iep-level-non-section"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
        ]
      }
    },
    {
      "id": "166802.RS",
      "name": "By IEP Level and IEP Date",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP11",
      "summary": [
        {
          "id": "prisoner-distinct-count-by-iep-level",
          "template": "section-header",
          "dataset": "$ref:prisoner-distinct-count-by-iep-level"
        },
        {
          "id": "prisoner-total-row-count-by-iep-level",
          "template": "section-footer",
          "dataset": "$ref:prisoner-total-row-count-by-iep-level"
        },
        {
          "id": "prisoner-grand-total-row-count",
          "template": "page-footer",
          "dataset": "$ref:prisoner-total-row-count"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-section",
        "section": ["IEP_LEVEL"],
        "field": [
          {
            "name": "$ref:IEP_LEVEL",
            "display": "IEP Level",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO521"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO44"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO45"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO46"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOa15"
          },
          {
            "name": "$ref:PROFILE_CODE",
            "display": "Nationality",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO10d6"
          },
          {
            "name": "$ref:RELIGION",
            "display": "Religion",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOb0"
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO88"
          },
          {
            "name": "$ref:V_ADMISSIONDATE",
            "display": "Admission Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Admission Date]"
          },
          {
            "name": "$ref:CONVICTED_UNCONVICTED_STATUS",
            "display": "Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO716"
          },
          {
            "name": "$ref:EFFECTIVE_DATE",
            "display": "Legal Status Start Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DObb5"
          },
          {
            "name": "$ref:VSENTENCELENGTH",
            "display": "Sentence Length",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([Current Effective Sentence Length]=\"00/00/00\";\"\";[Current Effective Sentence Length])"
          },
          {
            "name": "$ref:VRELEASE",
            "display": "Release Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Current Release Date]"
          },
          {
            "name": "$ref:LOCATION",
            "display": "Cell",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO51f"
          },
          {
            "name": "$ref:BOOKING_BEGIN_DATE",
            "display": "Booking Start Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOb97"
          },
          {
            "name": "$ref:IEP_DATE",
            "display": "Current IEP Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOe41"
          },
          {
            "name": "$ref:DAYS_ON_IEP",
            "display": "Days on IEP",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOe41"
          }
        ]
      }
    },
    {
      "id": "167310.RS",
      "name": "By Legal Status and IEP Level",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP11",
      "summary": [
        {
          "id": "prisoner-total-row-count-per-legal-status",
          "template": "section-footer",
          "dataset": "$ref:prisoner-total-row-count-per-legal-status"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-section",
        "section": ["CONVICTED_UNCONVICTED_STATUS"],
        "field": [
          {
            "name": "$ref:CONVICTED_UNCONVICTED_STATUS",
            "display": "Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO716"
          },
          {
            "name": "$ref:IEP_LEVEL",
            "display": "IEP Level",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true,
            "legacyId": "DP11.DO521"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO44"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO45"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO46"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOa15"
          },
          {
            "name": "$ref:PROFILE_CODE",
            "display": "Nationality",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO10d6"
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO88"
          },
          {
            "name": "$ref:V_ADMISSIONDATE",
            "display": "Admission Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Admission Date]"
          },
          {
            "name": "$ref:EFFECTIVE_DATE",
            "display": "Legal Status Start Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DObb5"
          },
          {
            "name": "$ref:VSENTENCELENGTH",
            "display": "Sentence Length",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([Current Effective Sentence Length]=\"00/00/00\";\"\";[Current Effective Sentence Length])"
          },
          {
            "name": "$ref:VRELEASE",
            "display": "Release Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Current Release Date]"
          },
          {
            "name": "$ref:LOCATION",
            "display": "Cell",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO51f"
          },
          {
            "name": "$ref:BOOKING_BEGIN_DATE",
            "display": "Booking Start Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOb97"
          },
          {
            "name": "$ref:IEP_DATE",
            "display": "Current IEP Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOe41"
          },
          {
            "name": "$ref:DAYS_ON_IEP",
            "display": "Days on IEP",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOe41"
          }
        ]
      }
    },
    {
      "id": "168038.RS",
      "name": "By Location",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP11",
      "summary": [
        {
          "id": "prisoner-distinct-count-per-location-and-iep-level",
          "template": "section-header",
          "dataset": "$ref:prisoner-distinct-count-per-location-and-iep-level"
        },
        {
          "id": "prisoner-total-row-count-per-location-and-iep-level",
          "template": "section-footer",
          "dataset": "$ref:prisoner-total-row-count-per-location-and-iep-level"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-section",
        "section": ["UNIT_CODE_1"],
        "field": [
          {
            "name": "$ref:UNIT_CODE_1",
            "display": "Wing",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO472"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO44"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO45"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO46"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOa15"
          },
          {
            "name": "$ref:PROFILE_CODE",
            "display": "Nationality",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO10d6"
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO88"
          },
          {
            "name": "$ref:V_ADMISSIONDATE",
            "display": "Admission Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Admission Date]"
          },
          {
            "name": "$ref:CONVICTED_UNCONVICTED_STATUS",
            "display": "Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO716"
          },
          {
            "name": "$ref:EFFECTIVE_DATE",
            "display": "Legal Status Start Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DObb5"
          },
          {
            "name": "$ref:VSENTENCELENGTH",
            "display": "Sentence Length",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([Current Effective Sentence Length]=\"00/00/00\";\"\";[Current Effective Sentence Length])"
          },
          {
            "name": "$ref:VRELEASE",
            "display": "Release Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Current Release Date]"
          },
          {
            "name": "$ref:LOCATION",
            "display": "Cell",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO51f"
          },
          {
            "name": "$ref:CAPACITY",
            "display": "Cell Cap",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:BOOKING_BEGIN_DATE",
            "display": "Booking Start Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOb97"
          },
          {
            "name": "$ref:IEP_LEVEL",
            "display": "Current IEP",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO521"
          },
          {
            "name": "$ref:IEP_DATE",
            "display": "Current IEP Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOe41"
          },
          {
            "name": "$ref:DAYS_ON_IEP",
            "display": "Days on IEP",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOe41"
          }
        ]
      }
    },
    {
      "id": "167497.RS",
      "name": "By Prisoner",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP11",
      "summary": [
        {
          "id": "prisoner-total-row-count",
          "template": "page-footer",
          "dataset": "$ref:prisoner-total-row-count"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO44"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO45"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO46"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOa15"
          },
          {
            "name": "$ref:PROFILE_CODE",
            "display": "Nationality",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO10d6"
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO88"
          },
          {
            "name": "$ref:V_ADMISSIONDATE",
            "display": "Admission Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Admission Date]"
          },
          {
            "name": "$ref:CONVICTED_UNCONVICTED_STATUS",
            "display": "Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO716"
          },
          {
            "name": "$ref:EFFECTIVE_DATE",
            "display": "Legal Status Start Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DObb5"
          },
          {
            "name": "$ref:VSENTENCELENGTH",
            "display": "Sentence Length",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([Current Effective Sentence Length]=\"00/00/00\";\"\";[Current Effective Sentence Length])"
          },
          {
            "name": "$ref:VRELEASE",
            "display": "Release Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Current Release Date]"
          },
          {
            "name": "$ref:LOCATION",
            "display": "Cell",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO51f"
          },
          {
            "name": "$ref:BOOKING_BEGIN_DATE",
            "display": "Booking Start Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOb97"
          },
          {
            "name": "$ref:IEP_LEVEL",
            "display": "Current IEP",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO521"
          },
          {
            "name": "$ref:IEP_DATE",
            "display": "Current IEP Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOe41"
          },
          {
            "name": "$ref:DAYS_ON_IEP",
            "display": "Days on IEP",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOe41"
          }
        ]
      }
    },
    {
      "id": "168589.RS",
      "name": "By NOMS Number",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP11",
      "summary": [
        {
          "id": "prisoner-total-row-count",
          "template": "page-footer",
          "dataset": "$ref:prisoner-total-row-count"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO44"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO45"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO46"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOa15"
          },
          {
            "name": "$ref:PROFILE_CODE",
            "display": "Nationality",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO10d6"
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO88"
          },
          {
            "name": "$ref:V_ADMISSIONDATE",
            "display": "Admission Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Admission Date]"
          },
          {
            "name": "$ref:CONVICTED_UNCONVICTED_STATUS",
            "display": "Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO716"
          },
          {
            "name": "$ref:EFFECTIVE_DATE",
            "display": "Legal Status Start Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DObb5"
          },
          {
            "name": "$ref:VSENTENCELENGTH",
            "display": "Sentence Length",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([Current Effective Sentence Length]=\"00/00/00\";\"\";[Current Effective Sentence Length])"
          },
          {
            "name": "$ref:VRELEASE",
            "display": "Release Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Current Release Date]"
          },
          {
            "name": "$ref:LOCATION",
            "display": "Cell",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO51f"
          },
          {
            "name": "$ref:BOOKING_BEGIN_DATE",
            "display": "Booking Start Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOb97"
          },
          {
            "name": "$ref:IEP_LEVEL",
            "display": "Current IEP",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO521"
          },
          {
            "name": "$ref:IEP_DATE",
            "display": "Current IEP Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOe41"
          },
          {
            "name": "$ref:DAYS_ON_IEP",
            "display": "Days on IEP",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOe41"
          }
        ]
      }
    },
    {
      "id": "168698.RS",
      "name": "By Nationality",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP11",
      "summary": [
        {
          "id": "prisoner-total-row-count",
          "template": "page-footer",
          "dataset": "$ref:prisoner-total-row-count"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO44"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO45"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO46"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOa15"
          },
          {
            "name": "$ref:PROFILE_CODE",
            "display": "Nationality",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO10d6"
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO88"
          },
          {
            "name": "$ref:V_ADMISSIONDATE",
            "display": "Admission Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Admission Date]"
          },
          {
            "name": "$ref:CONVICTED_UNCONVICTED_STATUS",
            "display": "Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO716"
          },
          {
            "name": "$ref:EFFECTIVE_DATE",
            "display": "Legal Status Start Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([Current Effective Sentence Length]=\"00/00/00\";\"\";[Current Effective Sentence Length])"
          },
          {
            "name": "$ref:VSENTENCELENGTH",
            "display": "Sentence Length",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([Current Effective Sentence Length]=\"00/00/00\";\"\";[Current Effective Sentence Length])"
          },
          {
            "name": "$ref:VRELEASE",
            "display": "Release Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Current Release Date]"
          },
          {
            "name": "$ref:LOCATION",
            "display": "Cell",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO51f"
          },
          {
            "name": "$ref:BOOKING_BEGIN_DATE",
            "display": "Booking Start Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOb97"
          },
          {
            "name": "$ref:IEP_LEVEL",
            "display": "Current IEP",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO521"
          },
          {
            "name": "$ref:IEP_DATE",
            "display": "Current IEP Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOe41"
          },
          {
            "name": "$ref:DAYS_ON_IEP",
            "display": "Days on IEP",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DOe41"
          }
        ]
      }
    },
    {
      "id": "169161.RS",
      "name": "Simple By Location",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP11",
      "summary": [
        {
          "id": "prisoner-distinct-count-by-iep-level-non-sectioned",
          "template": "page-header",
          "dataset": "$ref:prisoner-distinct-count-by-iep-level-non-sectioned"
        },
        {
          "id": "prisoner-grand-total-row-count",
          "template": "page-footer",
          "dataset": "$ref:prisoner-total-row-count"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:LOCATION",
            "display": "Cell",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true,
            "legacyId": "DP11.DO51f"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO45"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO44"
          },
          {
            "name": "$ref:IEP_LEVEL",
            "display": "IEP Level",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO521"
          }
        ]
      }
    },
    {
      "id": "169357.RS",
      "name": "Simple By Last Name",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP11",
      "summary": [
        {
          "id": "prisoner-distinct-count-by-iep-level-non-sectioned",
          "template": "page-header",
          "dataset": "$ref:prisoner-distinct-count-by-iep-level-non-sectioned"
        },
        {
          "id": "prisoner-grand-total-row-count",
          "template": "page-footer",
          "dataset": "$ref:prisoner-total-row-count"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:LOCATION",
            "display": "Cell",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP11.DO51f"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true,
            "legacyId": "DP11.DO45"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO44"
          },
          {
            "name": "$ref:IEP_LEVEL",
            "display": "IEP Level",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP11.DO521"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "sqlQuery",
      "error": "Error: ORA-00918: column ambiguously defined\nHelp: https://docs.oracle.com/error-help/db/ora-00918/",
      "entityId": "3377299/DP11",
      "entityType": "dataset"
    }
  ]
}