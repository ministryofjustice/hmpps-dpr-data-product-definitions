{
  "id": "olAlEScADWqYOJoARP_D8K7Bn64",
  "name": "MIS National Report of CSRA Errors",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "PND0002 v00.00.02"
    ]
  },
  "description": "This summary report shows the number of prisoners by establishment without a cell sharing risk assessment (CSRA), the number of prisoners whose last approved CSRA of High is overdue for review, the number of prisoners who still have Low or Medium as their current CSRA rating and the number of unapproved High CSRAs. Now includes Prisoner details.<br/>PND0002 - v00.00.02 Last Modified: 24/05/18",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3376639/DP1",
      "name": "Overdue High",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK, DT_PND_CURRENT_EST.ESTABLISHMENT_DESCRIPTION, DT_CSRA_HIGH_ODUE.CSRA_HODUE FROM (SELECT AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK, COUNT(DISTINCT (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY)) AS CSRA_HODUE FROM BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_OFFENDER_ASSESSMENT AT_DIM_OFFENDER_ASSESSMENTS WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND (CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6 OR CSL.ENDYEAR = '2999'))) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_DIM_OFFENDER_ASSESSMENTS.OFFENDER_BOOKING_SK) AND (AT_DIM_OFFENDER_ASSESSMENTS.CURRENT_CSRA_LEVEL = 'High' AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_OFFENDER_BOOKING.BOOKING_STATUS = 'O') AND AT_DIM_OFFENDER_ASSESSMENTS.CURRENT_CSRA_REVIEW_DATE <= TRUNC(CURRENT_TIMESTAMP - 1)) GROUP BY AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK) DT_CSRA_HIGH_ODUE, BODIMIS.DIM_ESTABLISHMENT DT_PND_CURRENT_EST WHERE (DT_PND_CURRENT_EST.ACTIVE_FLAG = 'Y') AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK IN (SELECT SAC.CASELOAD_ID FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC WHERE SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)))) AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK = DT_CSRA_HIGH_ODUE.ESTABLISHMENT_CODE_NK) AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK <> 'ZZGHI')), dataset_ AS (SELECT ESTABLISHMENT_CODE_NK, ESTABLISHMENT_DESCRIPTION, CSRA_HODUE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "ESTABLISHMENT_CODE_NK",
            "type": "string",
            "display": "Prison Code",
            "legacyId": "DP1.DO110",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Prison Name",
            "legacyId": "DP1.DO111",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "CSRA_HODUE",
            "type": "double",
            "display": "CSRA Overdue High Only",
            "legacyId": "DP1.DOa60",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP3",
      "name": "Last ETL Refresh",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT BODIMIS.ETL_LOAD_LOG.BUSINESS_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT BUSINESS_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BUSINESS_DATE",
            "type": "date",
            "display": "Latest Business Date Available",
            "legacyId": "DP3.DO4dd",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP4",
      "name": "Population",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK, DT_PND_CURRENT_EST.ESTABLISHMENT_DESCRIPTION, COUNT(DISTINCT AT_PND_PRISONER_BOOKING.OFFENDER_ID_DISPLAY) AS PRISON_POPULATION FROM BODIMIS.DIM_ESTABLISHMENT DT_PND_CURRENT_EST, BODIMIS.DIM_OFFENDER_BOOKING AT_PND_PRISONER_BOOKING WHERE (AT_PND_PRISONER_BOOKING.ESTABLISHMENT_SK = DT_PND_CURRENT_EST.ESTABLISHMENT_SK) AND (DT_PND_CURRENT_EST.ACTIVE_FLAG = 'Y') AND (AT_PND_PRISONER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK IN (SELECT SAC.CASELOAD_ID FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC WHERE SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)))) AND (AT_PND_PRISONER_BOOKING.ACTIVE_STATUS IN ('Active In', 'Active Out')) AND (AT_PND_PRISONER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_PND_PRISONER_BOOKING.BOOKING_STATUS = 'O') AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK <> 'ZZGHI') GROUP BY DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK, DT_PND_CURRENT_EST.ESTABLISHMENT_DESCRIPTION), dataset_ AS (SELECT ESTABLISHMENT_CODE_NK, ESTABLISHMENT_DESCRIPTION, PRISON_POPULATION FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "ESTABLISHMENT_CODE_NK",
            "type": "string",
            "display": "Prison Code",
            "legacyId": "DP4.DO110",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Prison Name",
            "legacyId": "DP4.DO111",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "PRISON_POPULATION",
            "type": "double",
            "display": "Prison Population",
            "legacyId": "DP4.DOfe",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP5",
      "name": "All Establishments",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK, DT_PND_CURRENT_EST.ESTABLISHMENT_DESCRIPTION FROM BODIMIS.DIM_ESTABLISHMENT DT_PND_CURRENT_EST WHERE (DT_PND_CURRENT_EST.ACTIVE_FLAG = 'Y') AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK IN (SELECT SAC.CASELOAD_ID FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC WHERE SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)))) AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK <> 'ZZGHI')), dataset_ AS (SELECT ESTABLISHMENT_CODE_NK, ESTABLISHMENT_DESCRIPTION FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "ESTABLISHMENT_CODE_NK",
            "type": "string",
            "display": "Prison Code",
            "legacyId": "DP5.DO110",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Prison Name",
            "legacyId": "DP5.DO111",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP6",
      "name": "Missing",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK, DT_PND_CURRENT_EST.ESTABLISHMENT_DESCRIPTION, DT_CSRA_MISSING.CSRA_MISSING FROM (SELECT AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK, COUNT(DISTINCT (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY)) AS CSRA_MISSING FROM BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_OFFENDER_ASSESSMENT AT_DIM_OFFENDER_ASSESSMENTS WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND (CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6 OR CSL.ENDYEAR = '2999'))) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_DIM_OFFENDER_ASSESSMENTS.OFFENDER_BOOKING_SK (+)) AND (AT_DIM_OFFENDER_ASSESSMENTS.CURRENT_CSRA_LEVEL IS NULL OR AT_DIM_OFFENDER_ASSESSMENTS.CURRENT_CSRA_LEVEL = 'Pending' AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_OFFENDER_BOOKING.BOOKING_STATUS = 'O')) GROUP BY AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK) DT_CSRA_MISSING, BODIMIS.DIM_ESTABLISHMENT DT_PND_CURRENT_EST WHERE (DT_PND_CURRENT_EST.ACTIVE_FLAG = 'Y') AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK IN (SELECT SAC.CASELOAD_ID FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC WHERE SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)))) AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK = DT_CSRA_MISSING.ESTABLISHMENT_CODE_NK) AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK <> 'ZZGHI')), dataset_ AS (SELECT ESTABLISHMENT_CODE_NK, ESTABLISHMENT_DESCRIPTION, CSRA_MISSING FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "ESTABLISHMENT_CODE_NK",
            "type": "string",
            "display": "Prison Code",
            "legacyId": "DP6.DO110",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Prison Name",
            "legacyId": "DP6.DO111",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "CSRA_MISSING",
            "type": "double",
            "display": "CSRA Missing",
            "legacyId": "DP6.DOa2f",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP7",
      "name": "Unapproved High",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK, DT_PND_CURRENT_EST.ESTABLISHMENT_DESCRIPTION, DT_CSRA_HIGH_UNAPP.CSRHIUNAP FROM (SELECT DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK, COUNT(DISTINCT (DT_PND_PRISONER_BOOKING.OFFENDER_ID_DISPLAY)) AS CSRHIUNAP FROM BODIMIS.DIM_ESTABLISHMENT DT_PND_CURRENT_EST, BODIMIS.DIM_OFFENDER_BOOKING DT_PND_PRISONER_BOOKING, (SELECT offender_booking_sk, next_review_date, calc_sup_level_type, review_sup_level_type FROM bodimis.dim_offender_assessment WHERE current_csra_flag = 'Y') DT_DETAIL WHERE (DT_PND_PRISONER_BOOKING.ESTABLISHMENT_SK = DT_PND_CURRENT_EST.ESTABLISHMENT_SK) AND (DT_PND_CURRENT_EST.ACTIVE_FLAG = 'Y') AND (DT_PND_PRISONER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK IN (SELECT SAC.CASELOAD_ID FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC WHERE SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)))) AND (DT_PND_PRISONER_BOOKING.ACTIVE_STATUS IN ('Active In', 'Active Out')) AND (DT_PND_PRISONER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND (CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6 OR CSL.ENDYEAR = '2999'))) AND (DT_PND_PRISONER_BOOKING.BOOKING_STATUS = 'O') AND (DT_PND_PRISONER_BOOKING.OFFENDER_BOOKING_SK = DT_DETAIL.OFFENDER_BOOKING_SK) AND (DT_PND_PRISONER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y' AND DT_PND_PRISONER_BOOKING.BOOKING_STATUS = 'O' AND DT_DETAIL.CALC_SUP_LEVEL_TYPE = 'High' AND DT_DETAIL.REVIEW_SUP_LEVEL_TYPE IS NULL) GROUP BY DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK) DT_CSRA_HIGH_UNAPP, BODIMIS.DIM_ESTABLISHMENT DT_PND_CURRENT_EST WHERE (DT_PND_CURRENT_EST.ACTIVE_FLAG = 'Y') AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK IN (SELECT SAC.CASELOAD_ID FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC WHERE SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)))) AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK <> 'ZZGHI') AND (DT_CSRA_HIGH_UNAPP.ESTABLISHMENT_CODE_NK = DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK)), dataset_ AS (SELECT ESTABLISHMENT_CODE_NK, ESTABLISHMENT_DESCRIPTION, CSRHIUNAP FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "ESTABLISHMENT_CODE_NK",
            "type": "string",
            "display": "Prison Code",
            "legacyId": "DP7.DO110",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Prison Name",
            "legacyId": "DP7.DO111",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "CSRHIUNAP",
            "type": "double",
            "display": "CSRA Unapproved High",
            "legacyId": "DP7.DOa35",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP8",
      "name": "Old",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK, DT_PND_CURRENT_EST.ESTABLISHMENT_DESCRIPTION, DT_CSRA_OLD.CSRA_OLD FROM BODIMIS.DIM_ESTABLISHMENT DT_PND_CURRENT_EST, (SELECT AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK, COUNT(DISTINCT (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY)) AS CSRA_OLD FROM BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_OFFENDER_ASSESSMENT AT_DIM_OFFENDER_ASSESSMENTS WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND (CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6 OR CSL.ENDYEAR = '2999'))) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_DIM_OFFENDER_ASSESSMENTS.OFFENDER_BOOKING_SK) AND (AT_DIM_OFFENDER_ASSESSMENTS.CURRENT_CSRA_LEVEL IN ('Low', 'Medium') AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_OFFENDER_BOOKING.BOOKING_STATUS = 'O')) GROUP BY AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK) DT_CSRA_OLD WHERE (DT_PND_CURRENT_EST.ACTIVE_FLAG = 'Y') AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK IN (SELECT SAC.CASELOAD_ID FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC WHERE SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)))) AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK = DT_CSRA_OLD.ESTABLISHMENT_CODE_NK) AND (DT_PND_CURRENT_EST.ESTABLISHMENT_CODE_NK <> 'ZZGHI')), dataset_ AS (SELECT ESTABLISHMENT_CODE_NK, ESTABLISHMENT_DESCRIPTION, CSRA_OLD FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "ESTABLISHMENT_CODE_NK",
            "type": "string",
            "display": "Prison Code",
            "legacyId": "DP8.DO110",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Prison Name",
            "legacyId": "DP8.DO111",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "CSRA_OLD",
            "type": "double",
            "display": "CSRA Old",
            "legacyId": "DP8.DOa3a",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP9",
      "name": "NOMS",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.FIRST_NAME, AT_DIM_OFFENDER_ASSESSMENTS.NEXT_REVIEW_DATE, AT_DIM_OFFENDER_ASSESSMENTS.CURRENT_CSRA_REVIEW_DATE, AT_DIM_OFFENDER_ASSESSMENTS.CURRENT_CSRA_FLAG, AT_DIM_OFFENDER_ASSESSMENTS.ASSESSMENT_DATE, AT_DIM_OFFENDER_ASSESSMENTS.CURRENT_CSRA_LEVEL, AT_DIM_OFFENDER_ASSESSMENTS.REVIEW_SUP_LEVEL_TYPE, AT_ESTABLISHMENT_TAP.ESTABLISHMENT_DESCRIPTION, AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK FROM BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_OFFENDER_ASSESSMENT AT_DIM_OFFENDER_ASSESSMENTS WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_DIM_OFFENDER_ASSESSMENTS.OFFENDER_BOOKING_SK (+)) AND ((AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Associated Establishment\\Associated Establishment Code',multi,free,Not_Persistent,User:69) */) OR 'All' IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Associated Establishment\\Associated Establishment Code',multi,free,Not_Persistent,User:69) */)) AND AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK <> 'ZZGHI' AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_DIM_OFFENDER_ASSESSMENTS.CURRENT_CSRA_LEVEL IS NULL OR AT_DIM_OFFENDER_ASSESSMENTS.CURRENT_CSRA_FLAG = 'Y'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, SURNAME, FIRST_NAME, NEXT_REVIEW_DATE, CURRENT_CSRA_REVIEW_DATE, CURRENT_CSRA_FLAG, ASSESSMENT_DATE, CURRENT_CSRA_LEVEL, REVIEW_SUP_LEVEL_TYPE, ESTABLISHMENT_DESCRIPTION, ESTABLISHMENT_CODE_NK FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code (All for all)','A','Associated Establishment\\Associated Establishment Code',multi,free,Not_Persistent,User:69)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP9.DO76",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP9.DO7b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "Offender Given Name 1",
            "legacyId": "DP9.DO80",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "NEXT_REVIEW_DATE",
            "type": "date",
            "display": "Next Review Date",
            "legacyId": "DP9.DO82b",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "CURRENT_CSRA_REVIEW_DATE",
            "type": "date",
            "display": "CSRA - Current Review Date",
            "legacyId": "DP9.DO82f",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "CURRENT_CSRA_FLAG",
            "type": "string",
            "display": "CSRA  - Current Flag",
            "legacyId": "DP9.DO82d",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "ASSESSMENT_DATE",
            "type": "date",
            "display": "Assessment Date",
            "legacyId": "DP9.DO824",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "CURRENT_CSRA_LEVEL",
            "type": "string",
            "display": "CSRA - Current Level",
            "legacyId": "DP9.DO831",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "REVIEW_SUP_LEVEL_TYPE",
            "type": "string",
            "display": "Approved Result",
            "legacyId": "DP9.DO82a",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Associated Establishment Name",
            "legacyId": "DP9.DO7b1",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "ESTABLISHMENT_CODE_NK",
            "type": "string",
            "display": "Associated Establishment Code",
            "legacyId": "DP9.DO7b2",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "199437.RS",
      "name": "National  Report of CSRA Errors",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376639/DP4",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE ESTABLISHMENT_CODE <> 'ZZGHI')"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:PRISON_POPULATION",
            "display": "Prison Population",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP4.DOfe"
          },
          {
            "name": "$ref:CSRA_MISSING",
            "display": "CSRA Missing",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP6.DOa2f"
          },
          {
            "name": "$ref:CSRA_HODUE",
            "display": "CSRA Overdue High Only",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1.DOa60"
          },
          {
            "name": "$ref:CSRA_OLD",
            "display": "CSRA Old",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP8.DOa3a"
          },
          {
            "name": "$ref:CSRHIUNAP",
            "display": "CSRA Unapproved High",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP7.DOa35"
          },
          {
            "name": "$ref:CSRA_MISSING",
            "display": "CSRA Missing",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP6.DOa2f"
          },
          {
            "name": "$ref:CSRA_OLD",
            "display": "CSRA Old",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP8.DOa3a"
          },
          {
            "name": "$ref:CSRHIUNAP",
            "display": "CSRA Unapproved High",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP7.DOa35"
          }
        ]
      }
    },
    {
      "id": "199507.RS",
      "name": "Prisoners - No CSRA",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376639/DP9",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_CSRA_NULL_OR_PENDING = 1)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Associated Establishment Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO7b1"
          },
          {
            "name": "$ref:ESTABLISHMENT_CODE_NK",
            "display": "Associated Establishment Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO7b2"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO76"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO7b"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Offender Given Name 1",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO80"
          },
          {
            "name": "$ref:CURRENT_CSRA_LEVEL",
            "display": "CSRA - Current Level",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO831"
          },
          {
            "name": "$ref:REVIEW_SUP_LEVEL_TYPE",
            "display": "Approved Result",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO82a"
          },
          {
            "name": "$ref:ASSESSMENT_DATE",
            "display": "Assessment Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO824"
          },
          {
            "name": "$ref:CURRENT_CSRA_REVIEW_DATE",
            "display": "CSRA - Current Review Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO82f"
          }
        ]
      }
    },
    {
      "id": "199866.RS",
      "name": "Prisoners - High Overdue",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376639/DP9",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_HIGH_REVIEW_OVERDUE = 'OVERDUE REVIEW')"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Associated Establishment Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO7b1"
          },
          {
            "name": "$ref:ESTABLISHMENT_CODE_NK",
            "display": "Associated Establishment Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO7b2"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO76"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO7b"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Offender Given Name 1",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO80"
          },
          {
            "name": "$ref:CURRENT_CSRA_LEVEL",
            "display": "CSRA - Current Level",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO831"
          },
          {
            "name": "$ref:REVIEW_SUP_LEVEL_TYPE",
            "display": "Approved Result",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO82a"
          },
          {
            "name": "$ref:ASSESSMENT_DATE",
            "display": "Assessment Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO824"
          },
          {
            "name": "$ref:CURRENT_CSRA_REVIEW_DATE",
            "display": "CSRA - Current Review Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO82f"
          }
        ]
      }
    },
    {
      "id": "199929.RS",
      "name": "Prisoners - Old Values",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376639/DP9",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_OLD_VALUES = 1)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Associated Establishment Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO7b1"
          },
          {
            "name": "$ref:ESTABLISHMENT_CODE_NK",
            "display": "Associated Establishment Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO7b2"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO76"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO7b"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Offender Given Name 1",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO80"
          },
          {
            "name": "$ref:CURRENT_CSRA_LEVEL",
            "display": "CSRA - Current Level",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO831"
          },
          {
            "name": "$ref:REVIEW_SUP_LEVEL_TYPE",
            "display": "Approved Result",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO82a"
          },
          {
            "name": "$ref:ASSESSMENT_DATE",
            "display": "Assessment Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO824"
          },
          {
            "name": "$ref:CURRENT_CSRA_REVIEW_DATE",
            "display": "CSRA - Current Review Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO82f"
          }
        ]
      }
    },
    {
      "id": "199992.RS",
      "name": "Prisoners - Unapproved High",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376639/DP9",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_CSRA_HIGH_UNNAPROVED = 1)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Associated Establishment Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO7b1"
          },
          {
            "name": "$ref:ESTABLISHMENT_CODE_NK",
            "display": "Associated Establishment Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO7b2"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO76"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO7b"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Offender Given Name 1",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO80"
          },
          {
            "name": "$ref:CURRENT_CSRA_LEVEL",
            "display": "CSRA - Current Level",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO831"
          },
          {
            "name": "$ref:REVIEW_SUP_LEVEL_TYPE",
            "display": "Approved Result",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO82a"
          },
          {
            "name": "$ref:ASSESSMENT_DATE",
            "display": "Assessment Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO824"
          },
          {
            "name": "$ref:CURRENT_CSRA_REVIEW_DATE",
            "display": "CSRA - Current Review Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP9.DO82f"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "schema",
      "error": "Report field CSRA_MISSING does not have corresponding dataset schema field",
      "entityId": "199437.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field CSRA_HODUE does not have corresponding dataset schema field",
      "entityId": "199437.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field CSRA_OLD does not have corresponding dataset schema field",
      "entityId": "199437.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field CSRHIUNAP does not have corresponding dataset schema field",
      "entityId": "199437.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field CSRA_MISSING does not have corresponding dataset schema field",
      "entityId": "199437.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field CSRA_OLD does not have corresponding dataset schema field",
      "entityId": "199437.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field CSRHIUNAP does not have corresponding dataset schema field",
      "entityId": "199437.RS",
      "entityType": "variant"
    }
  ]
}