{
  "id": "kln3Pr4ACNeAMQQBNv8AFE.rcVQ",
  "name": "MIS API Report Check",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "Local Report"
    ]
  },
  "description": "Run report to see which Local reports are currently being accessed, and by whom, in order to advise users of a preferred Standard Report that will cover their requirements.",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "undefined/DP8",
      "name": "Top Documents by Refreshes",
      "description": "Activity",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DERIVED_DOCUMENT_NAME.Detail_Text, DERIVED_OBJECT_PATH.Detail_Text AS PATH, AUDIT_EVENT.User_Name, AUDIT_EVENT.Event_ID, AUDIT_EVENT.Start_Timestamp FROM (SELECT AUDIT_EVENT.Server_CUID, AUDIT_EVENT.Event_ID, RTRIM(TO_CHAR(AUDIT_DETAIL.Detail_Text), CHR(0)) AS Detail_Text FROM AUDIT_EVENT, AUDIT_DETAIL WHERE (AUDIT_EVENT.Server_CUID = AUDIT_DETAIL.Server_CUID) AND (AUDIT_EVENT.Event_ID = AUDIT_DETAIL.Event_ID) AND (AUDIT_DETAIL.Detail_Type_ID = 8)) DERIVED_DOCUMENT_NAME, (SELECT AUDIT_EVENT.Server_CUID, AUDIT_EVENT.Event_ID, AUDIT_EVENT.Event_Type_ID, RTRIM(TO_CHAR(AUDIT_DETAIL.Detail_Text), CHR(0)) AS Detail_Text FROM AUDIT_EVENT, AUDIT_DETAIL WHERE (AUDIT_EVENT.Server_CUID = AUDIT_DETAIL.Server_CUID) AND (AUDIT_EVENT.Event_ID = AUDIT_DETAIL.Event_ID) AND (AUDIT_DETAIL.Detail_Type_ID = 43)) DERIVED_OBJECT_PATH, AUDIT_EVENT WHERE (AUDIT_EVENT.Event_ID = DERIVED_DOCUMENT_NAME.Event_ID AND AUDIT_EVENT.Server_CUID = DERIVED_DOCUMENT_NAME.Server_CUID) AND (AUDIT_EVENT.Event_ID = DERIVED_OBJECT_PATH.EVENT_ID AND AUDIT_EVENT.Server_CUID = DERIVED_OBJECT_PATH.SERVER_CUID) AND (AUDIT_EVENT.Event_Type_ID = 19 AND AUDIT_EVENT.Object_Type = 'Web Intelligence' AND AUDIT_EVENT.Start_Timestamp BETWEEN TO_DATE('23-10-2017 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND TO_DATE('24-10-2017 00:00:00', 'DD-MM-YYYY HH24:MI:SS'))), dataset_ AS (SELECT DETAIL_TEXT, PATH, USER_NAME, EVENT_ID, START_TIMESTAMP, PATH || DETAIL_TEXT AS V_DOC_PATH_AND_NAME, COUNTDISTINCT(EVENT_ID) AS NUMBER_OF_REFRESHES, COUNTDISTINCT(V_DOC_PATH_AND_NAME) AS NUMBER_OF_DOCUMENTS FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "DETAIL_TEXT",
            "type": "string",
            "display": "Document Name",
            "legacyId": "DP8.DO40",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "PATH",
            "type": "string",
            "display": "Path",
            "legacyId": "DP8.DO73",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "USER_NAME",
            "type": "string",
            "display": "User Name",
            "legacyId": "DP8.DO20",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "EVENT_ID",
            "type": "string",
            "display": "Action ID",
            "legacyId": "DP8.DO21",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "START_TIMESTAMP",
            "type": "date",
            "display": "Action Time",
            "legacyId": "DP8.DO9f",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "V_DOC_PATH_AND_NAME",
            "type": "string",
            "display": "V_DOC_PATH_AND_NAME",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 6,
            "name": "NUMBER_OF_REFRESHES",
            "type": "string",
            "display": "NUMBER_OF_REFRESHES",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 7,
            "name": "NUMBER_OF_DOCUMENTS",
            "type": "string",
            "display": "NUMBER_OF_DOCUMENTS",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "20352.RS",
      "name": "Main Data",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "undefined/DP8",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_LOCAL_REPORT IN ('Other'))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:V_DOC_PATH_AND_NAME",
            "display": "Document Path and Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Path]+[Document Name]"
          },
          {
            "name": "$ref:V_DOCUMENT_REFRESH_COUNT",
            "display": "Total Doc Refreshes",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Number of Refreshes] In ([v_doc_path_and_name])"
          },
          {
            "name": "$ref:V_NUMBER_OF_USERS_FOR_DOCUMENT",
            "display": "Number of Users",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Number of Users] In ([v_doc_path_and_name])"
          },
          {
            "name": "$ref:USER_NAME",
            "display": "User Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP8.DO20"
          },
          {
            "name": "$ref:NUMBER_OF_REFRESHES",
            "display": "Refreshes of this document",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([Action ID]; Distinct)"
          }
        ]
      }
    },
    {
      "id": "20274.RS",
      "name": "Total Refreshes by Document",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_LOCAL_REPORT IN ('Other'))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      },
      "dataset": "MISSING"
    },
    {
      "id": "20337.RS",
      "name": "Total Refreshes by User",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "undefined/DP8",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_LOCAL_REPORT = 'Other')"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-tab",
        "field": [
          {
            "name": "$ref:USER_NAME",
            "display": "User Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP8.DO20"
          },
          {
            "name": "$ref:NUMBER_OF_DOCUMENTS",
            "display": "=NameOf([User Name])",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([v_doc_path_and_name]; Distinct)"
          },
          {
            "name": "$ref:NUMBER_OF_REFRESHES",
            "display": "Number of Documents",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([Action ID]; Distinct)"
          }
        ]
      }
    },
    {
      "id": "137680.RS",
      "name": "Total Refresh by Doc Name",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "undefined/DP8",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_LOCAL_REPORT = 'Other')"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-tab",
        "field": [
          {
            "name": "$ref:USER_NAME",
            "display": "User Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP8.DO20"
          },
          {
            "name": "$ref:NUMBER_OF_DOCUMENTS",
            "display": "=NameOf([User Name])",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([v_doc_path_and_name]; Distinct)"
          },
          {
            "name": "$ref:DETAIL_TEXT",
            "display": "Document Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP8.DO40"
          },
          {
            "name": "$ref:NUMBER_OF_REFRESHES",
            "display": "=NameOf([Document Name])",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([Action ID]; Distinct)"
          }
        ]
      }
    },
    {
      "id": "20557.RS",
      "name": "Overall Stats",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      },
      "dataset": "MISSING"
    },
    {
      "id": "137711.RS",
      "name": "Document Name and Path",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "undefined/DP8",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_LOCAL_REPORT IN ('Other'))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:DETAIL_TEXT",
            "display": "Document Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP8.DO40"
          },
          {
            "name": "$ref:PATH",
            "display": "Path",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP8.DO73"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : V_DOCUMENT_REFRESH_COUNT :: Error: Invalid expression / Unexpected token. Line 1, Col: 24.\n  NUMBER_OF_REFRESHES IN \u001b[4m,\u001b[0mV_DOC_PATH_AND_NAME,",
      "entityId": "kln3Pr4ACNeAMQQBNv8AFE.rcVQ",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : V_NUMBER_OF_USERS_FOR_DOCUMENT :: Error: Invalid expression / Unexpected token. Line 1, Col: 20.\n  NUMBER_OF_USERS IN \u001b[4m,\u001b[0mV_DOC_PATH_AND_NAME,",
      "entityId": "kln3Pr4ACNeAMQQBNv8AFE.rcVQ",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[1] requires property \"dataset\"",
      "entityId": "kln3Pr4ACNeAMQQBNv8AFE.rcVQ",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[4] requires property \"dataset\"",
      "entityId": "kln3Pr4ACNeAMQQBNv8AFE.rcVQ",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Report field V_DOCUMENT_REFRESH_COUNT does not have corresponding dataset schema field",
      "entityId": "20352.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_NUMBER_OF_USERS_FOR_DOCUMENT does not have corresponding dataset schema field",
      "entityId": "20352.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report Variant 20274.RS does not have corresponding dataset undefined",
      "entityId": "20274.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report Variant 20557.RS does not have corresponding dataset undefined",
      "entityId": "20557.RS",
      "entityType": "variant"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "undefined/DP8",
      "entityType": "dataset"
    }
  ]
}