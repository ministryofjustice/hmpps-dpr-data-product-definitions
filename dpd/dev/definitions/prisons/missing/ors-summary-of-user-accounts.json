{
  "id": "olBtjc4ABokkNboATf_D8K7BMIA",
  "name": "ORS Summary of User Accounts",
  "description": "This summary report simply counts the accounts defined in Prison-NOMIS by staff status and account type.<br/>UAR0005 v00.00.01 Last Modified: 13/09/12 ",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "UAR0005 v00.00.01 LSRIT039"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3376701/DPb",
      "name": "Accounts",
      "description": "Users and Roles",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_STATUS_REF.DESCRIPTION, AT_STAFF_USER_ACCOUNTS.STAFF_USER_TYPE, COUNT(AT_STAFF_USER_ACCOUNTS.USERNAME) AS ACCOUNT_NAME_COUNT FROM OMS_OWNER.STAFF_MEMBERS AT_STAFF_MEMBERS, OMS_OWNER.STAFF_USER_ACCOUNTS AT_STAFF_USER_ACCOUNTS, OMS_OWNER.REFERENCE_CODES AT_STATUS_REF WHERE (AT_STAFF_MEMBERS.STAFF_ID = AT_STAFF_USER_ACCOUNTS.STAFF_ID) AND (AT_STATUS_REF.DOMAIN = 'STAFF_STATUS') AND (AT_STATUS_REF.CODE = AT_STAFF_MEMBERS.STATUS) AND (AT_STATUS_REF.ACTIVE_FLAG = 'Y') AND ((AT_STATUS_REF.CODE IN ('ACTIVE') OR 'All' IN ('ACTIVE')) AND NOT AT_STAFF_USER_ACCOUNTS.USERNAME LIKE '%_CR' AND NOT AT_STAFF_USER_ACCOUNTS.USERNAME IN ('OMS_OWNER', 'XTAG')) GROUP BY AT_STATUS_REF.DESCRIPTION, AT_STAFF_USER_ACCOUNTS.STAFF_USER_TYPE), dataset_ AS (SELECT DESCRIPTION, STAFF_USER_TYPE, ACCOUNT_NAME_COUNT FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Staff Status",
            "legacyId": "DPb.DO18",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "STAFF_USER_TYPE",
            "type": "string",
            "display": "Account Type",
            "legacyId": "DPb.DO41",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "ACCOUNT_NAME_COUNT",
            "type": "double",
            "display": "Account Name Count",
            "legacyId": "DPb.DO13b",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "172226.RS",
      "name": "Summary of User Accounts",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376701/DPb",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "crosstab",
        "field": [
          {
            "name": "$ref:ACCOUNT_NAME_COUNT",
            "display": "Account Name Count",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPb.DO13b"
          },
          {
            "name": "$ref:ACCOUNT_NAME_COUNT",
            "display": "Account Name Count",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPb.DO13b"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Staff Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPb.DO18"
          },
          {
            "name": "$ref:ACCOUNT_NAME_COUNT",
            "display": "Account Name Count",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPb.DO13b"
          },
          {
            "name": "$ref:ACCOUNT_NAME_COUNT",
            "display": "Account Name Count",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPb.DO13b"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "schema",
      "error": "instance.report[0].specification.template is not one of enum values: list,list-section,list-tab,summary,summary-section,parent-child",
      "entityId": "olBtjc4ABokkNboATf_D8K7BMIA",
      "entityType": "dpd"
    }
  ]
}