{
  "id": "FnxdAQH0qQ0ASQ4AAACnrp72ACJIAGc1",
  "name": "MIS Non Returns from Court List test",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "MOV0007 v00.00.06 LSRIT039"
    ]
  },
  "description": "Returns a list of all prisoners who were discharged to court and who did not return to the establishment but are still on the prison roll as 'Active Out'. The data is ordered by prisoner last name.<br/>MOV0007 v00.00.06 Last Modified: 14/07/09",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3376639/DP2",
      "name": "Non Returns From Court List",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.IN_OUT, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.INITIALS, CASE WHEN (FLOOR((MONTHS_BETWEEN((TRUNC(CURRENT_TIMESTAMP)), (CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END))) / 12)) <= 17 THEN 'Juvenile' WHEN (FLOOR((MONTHS_BETWEEN((TRUNC(CURRENT_TIMESTAMP)), (CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END))) / 12)) BETWEEN 18 AND 20 THEN 'Young Person' WHEN (FLOOR((MONTHS_BETWEEN((TRUNC(CURRENT_TIMESTAMP)), (CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END))) / 12)) >= 21 THEN 'Adult' END AS ADULT_YOUNG_PERSON_INDICATOR, AT_LATEST_DATE.DAY_DATE, AT_FACT_MOV_EXT.MOVEMENT_TIME, AT_LATEST_TO_COURT.COURT_DESCRIPTION FROM BODIMIS.DIM_COURT AT_LATEST_TO_COURT, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_DOB, BODIMIS.DIM_DATE AT_LATEST_DATE, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT WHERE (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_FACT_MOV_EXT.TO_LOCATION_SK = AT_LATEST_TO_COURT.COURT_SK AND AT_FACT_MOV_EXT.TO_LOCATION_TYPE = 'Court') AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_FACT_MOV_EXT.DATE_SK = AT_LATEST_DATE.DATE_SK) AND ((AT_OFFENDER_BOOKING.IN_OUT = 'OUT') AND (AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK = (SELECT establishment_code FROM prompt_)) AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_FACT_MOV_EXT.ACTIVE_FLAG = 'Y' AND AT_FACT_MOV_EXT.TO_LOCATION_TYPE = 'Court'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, IN_OUT, SURNAME, INITIALS, ADULT_YOUNG_PERSON_INDICATOR, DAY_DATE, MOVEMENT_TIME, COURT_DESCRIPTION FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP2.DO76",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "IN_OUT",
            "type": "string",
            "display": "In Out",
            "legacyId": "DP2.DO4d4",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP2.DO7b",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "INITIALS",
            "type": "string",
            "display": "Offender Initials",
            "legacyId": "DP2.DO12d",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "ADULT_YOUNG_PERSON_INDICATOR",
            "type": "string",
            "display": "Adult/Young Person Indicator",
            "legacyId": "DP2.DO83",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date",
            "legacyId": "DP2.DO770",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Movement Time",
            "legacyId": "DP2.DO783",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "COURT_DESCRIPTION",
            "type": "string",
            "display": "Movement To Description",
            "legacyId": "DP2.DO77a",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP3",
      "name": "MIS Load",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT BODIMIS.ETL_LOAD_LOG.BUSINESS_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT BUSINESS_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BUSINESS_DATE",
            "type": "date",
            "display": "Latest Business Date Available",
            "legacyId": "DP3.DO4dd",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "193534.RS",
      "name": "Non Returns From Court List",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376639/DP2",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO76"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO7b"
          },
          {
            "name": "$ref:INITIALS",
            "display": "Offender Initials",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO12d"
          },
          {
            "name": "$ref:ADULT_YOUNG_PERSON_INDICATOR",
            "display": "Adult/Young Person Indicator",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO83"
          },
          {
            "name": "$ref:DAY_DATE",
            "display": "Movement Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO770"
          },
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Movement Time",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO783"
          },
          {
            "name": "$ref:COURT_DESCRIPTION",
            "display": "Movement To Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO77a"
          }
        ]
      }
    }
  ],
  "errors": []
}