{
  "id": "FslvNQCkpAwAw9UaAACn7nwAACJIAGE1",
  "name": "ORS  Bed Allocation Report",
  "description": "This report provides a list of cells that are not fully occupied, along with the current Prisoners in those cells, their CSRA, IEP Level, and Release date. Another tab is available for those Prisoners who have been allocated to Reception, CSWAP or Court, another tab to show unoccupied cells and one to show cells currently out of use<br/>ACC0029 - v00.00.04 Last Modified: 13/12/22",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "ACC0029 v00.00.04"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3377299/DP0",
      "name": "Prisoner Location",
      "description": "OR - Demographics",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT * FROM ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION, nvl(sum(DT_CERTCELL_CNA.CNA_NO),0) FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION, (  SELECT DISTINCT decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) as UnitCode1 , AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.Parent_Internal_Location_ID, AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_code, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_type, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_id, AT_AGENCY_INTERNAL_LOCATION_L4.CNA_NO FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4 WHERE AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_Location_type = 'CELL' and AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY >0 and AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG='Y' ) DT_CERTCELL_CNA, ( SELECT iep_level, description, agy_loc_id, offender_book_id, iep_date FROM ( SELECT iep.iep_level, rc.description, iep.agy_loc_id, iep.offender_book_id, iep.iep_date, ROW_NUMBER() OVER (PARTITION BY iep.offender_book_id ORDER BY iep.iep_time DESC, iep.iep_level_seq DESC) row_seq_filter FROM oms_owner.offender_iep_levels iep LEFT OUTER JOIN oms_owner.reference_codes rc ON iep.iep_level = rc.code AND rc.domain = 'IEP_LEVEL' ) WHERE row_seq_filter = 1 ) DT_IEP_BAND_LAST, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS, ( select OFFENDER_BOOK_ID, max(Bed_Assign_Seq) as Latest_Assign_Seq, max(Assignment_Date) as Latest_Assign_Date, max(Assignment_Time) as Latest_Assign_Time from OMS_OWNER.BED_ASSIGNMENT_HISTORIES Group by offender_book_id ) DT_LATEST_BED, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS WHERE ( AT_OFFENDER.OFFENDER_ID=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE='INST' ) AND ( DT_IEP_BAND_LAST.OFFENDER_BOOK_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID=USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_LIVING_UNITS.HOUSING_UNIT_TYPE NOT IN ('OU','REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID(+)=AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDERS_LOCATIONS.AGY_LOC_ID(+) ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID NOT IN ('OUT','TRN') AND AT_CASELOAD_LOCATIONS.CASELOAD_ID NOT IN ('ADMINC', 'CADM_I','MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID=WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_CERTCELL_CNA.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_CERTCELL_CNA.PARENT_INTERNAL_LOCATION_ID(+) ) AND ( DT_LATEST_BED.OFFENDER_BOOK_ID=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.AGY_LOC_ID=AT_AGENCY_INTERNAL_LOCATION.AGY_LOC_ID and AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION.INTERNAL_LOCATION_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION.ACTIVE_FLAG='Y' ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( ( AT_OFFENDER_BOOKING.ACTIVE_FLAG='Y' ) AND ( /* START Filter: Hierarchies/Establishment/''Establishment Code'' */ AT_OFFENDERS_LOCATIONS.AGY_LOC_ID in ((SELECT establishment_code from prompt_)) /* END Filter: Hierarchies/Establishment/''Establishment Code'' */ ) AND ( AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE IN ('All') or 'All' in ('All') ) ) GROUP BY AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION ) _query0 FULL OUTER JOIN ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION, sum(DT_LOCKUP.LOCKUPFIGURE), nvl(sum(DT_LOCKUP.LOCKUPFIGURE),0) FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION, ( SELECT iep_level, description, agy_loc_id, offender_book_id, iep_date FROM ( SELECT iep.iep_level, rc.description, iep.agy_loc_id, iep.offender_book_id, iep.iep_date, ROW_NUMBER() OVER (PARTITION BY iep.offender_book_id ORDER BY iep.iep_time DESC, iep.iep_level_seq DESC) row_seq_filter FROM oms_owner.offender_iep_levels iep LEFT OUTER JOIN oms_owner.reference_codes rc ON iep.iep_level = rc.code AND rc.domain = 'IEP_LEVEL' ) WHERE row_seq_filter = 1 ) DT_IEP_BAND_LAST, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS, ( select OFFENDER_BOOK_ID, max(Bed_Assign_Seq) as Latest_Assign_Seq, max(Assignment_Date) as Latest_Assign_Date, max(Assignment_Time) as Latest_Assign_Time from OMS_OWNER.BED_ASSIGNMENT_HISTORIES Group by offender_book_id ) DT_LATEST_BED, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, (  SELECT AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.parent_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, COUNT( DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY) as LockUpFigure FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDERS AT_OFFENDER WHERE ( AT_OFFENDER.OFFENDER_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=AT_OFFENDERS_LOCATIONS.AGY_LOC_ID(+) ) AND AT_OFFENDER_BOOKING.IN_OUT_STATUS = 'IN' AND AT_OFFENDER_BOOKING.ACTIVE_FLAG='Y' AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE='INST' )  AND AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_Location_type = 'CELL' GROUP BY AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.parent_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) DT_LOCKUP WHERE ( AT_OFFENDER.OFFENDER_ID=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE='INST' ) AND ( DT_IEP_BAND_LAST.OFFENDER_BOOK_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID=USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_LOCKUP.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_LIVING_UNITS.HOUSING_UNIT_TYPE NOT IN ('OU','REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID(+)=AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDERS_LOCATIONS.AGY_LOC_ID(+) ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID NOT IN ('OUT','TRN') AND AT_CASELOAD_LOCATIONS.CASELOAD_ID NOT IN ('ADMINC', 'CADM_I','MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID=WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( DT_LOCKUP.INTERNAL_LOCATION_ID(+)=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( DT_LATEST_BED.OFFENDER_BOOK_ID=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.AGY_LOC_ID=AT_AGENCY_INTERNAL_LOCATION.AGY_LOC_ID and AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION.INTERNAL_LOCATION_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION.ACTIVE_FLAG='Y' ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( ( AT_OFFENDER_BOOKING.ACTIVE_FLAG='Y' ) AND ( /* START Filter: Hierarchies/Establishment/''Establishment Code'' */ AT_OFFENDERS_LOCATIONS.AGY_LOC_ID in ((SELECT establishment_code from prompt_)) /* END Filter: Hierarchies/Establishment/''Establishment Code'' */ ) AND ( AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE IN ('All') or 'All' in ('All') ) ) GROUP BY AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION ) _query1 ON _query0.OFFENDER_ID_DISPLAY = _query1.OFFENDER_ID_DISPLAY ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION, nvl(sum(DT_CERTCELL_CNA.CNA_NO),0) FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION, (  SELECT DISTINCT decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) as UnitCode1 , AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.Parent_Internal_Location_ID, AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_code, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_type, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_id, AT_AGENCY_INTERNAL_LOCATION_L4.CNA_NO FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4 WHERE AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_Location_type = 'CELL' and AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY >0 and AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG='Y' ) DT_CERTCELL_CNA, ( SELECT iep_level, description, agy_loc_id, offender_book_id, iep_date FROM ( SELECT iep.iep_level, rc.description, iep.agy_loc_id, iep.offender_book_id, iep.iep_date, ROW_NUMBER() OVER (PARTITION BY iep.offender_book_id ORDER BY iep.iep_time DESC, iep.iep_level_seq DESC) row_seq_filter FROM oms_owner.offender_iep_levels iep LEFT OUTER JOIN oms_owner.reference_codes rc ON iep.iep_level = rc.code AND rc.domain = 'IEP_LEVEL' ) WHERE row_seq_filter = 1 ) DT_IEP_BAND_LAST, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS, ( select OFFENDER_BOOK_ID, max(Bed_Assign_Seq) as Latest_Assign_Seq, max(Assignment_Date) as Latest_Assign_Date, max(Assignment_Time) as Latest_Assign_Time from OMS_OWNER.BED_ASSIGNMENT_HISTORIES Group by offender_book_id ) DT_LATEST_BED, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS WHERE ( AT_OFFENDER.OFFENDER_ID=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE='INST' ) AND ( DT_IEP_BAND_LAST.OFFENDER_BOOK_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID=USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_LIVING_UNITS.HOUSING_UNIT_TYPE NOT IN ('OU','REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID(+)=AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDERS_LOCATIONS.AGY_LOC_ID(+) ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID NOT IN ('OUT','TRN') AND AT_CASELOAD_LOCATIONS.CASELOAD_ID NOT IN ('ADMINC', 'CADM_I','MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID=WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_CERTCELL_CNA.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_CERTCELL_CNA.PARENT_INTERNAL_LOCATION_ID(+) ) AND ( DT_LATEST_BED.OFFENDER_BOOK_ID=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.AGY_LOC_ID=AT_AGENCY_INTERNAL_LOCATION.AGY_LOC_ID and AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION.INTERNAL_LOCATION_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION.ACTIVE_FLAG='Y' ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( ( AT_OFFENDER_BOOKING.ACTIVE_FLAG='Y' ) AND ( /* START Filter: Hierarchies/Establishment/''Establishment Code'' */ AT_OFFENDERS_LOCATIONS.AGY_LOC_ID in ((SELECT establishment_code from prompt_)) /* END Filter: Hierarchies/Establishment/''Establishment Code'' */ ) AND ( AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE IN ('All') or 'All' in ('All') ) ) GROUP BY AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION ) _query0 FULL OUTER JOIN ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION, nvl(sum(DT_ACTCERT_CELLS.OPERATION_CAPACITY),0), nvl(sum(DT_ACTCERT_CELLS.CAPACITY),0), nvl(sum(DT_ACTCERT_CELLS.NO_OF_OCCUPANT),0), nvl(sum(DT_ACTCERT_CELLS.CNA_NO),0) FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION, ( SELECT iep_level, description, agy_loc_id, offender_book_id, iep_date FROM ( SELECT iep.iep_level, rc.description, iep.agy_loc_id, iep.offender_book_id, iep.iep_date, ROW_NUMBER() OVER (PARTITION BY iep.offender_book_id ORDER BY iep.iep_time DESC, iep.iep_level_seq DESC) row_seq_filter FROM oms_owner.offender_iep_levels iep LEFT OUTER JOIN oms_owner.reference_codes rc ON iep.iep_level = rc.code AND rc.domain = 'IEP_LEVEL' ) WHERE row_seq_filter = 1 ) DT_IEP_BAND_LAST, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS, ( select OFFENDER_BOOK_ID, max(Bed_Assign_Seq) as Latest_Assign_Seq, max(Assignment_Date) as Latest_Assign_Date, max(Assignment_Time) as Latest_Assign_Time from OMS_OWNER.BED_ASSIGNMENT_HISTORIES Group by offender_book_id ) DT_LATEST_BED, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, (  SELECT DISTINCT decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) as UnitCode1 , AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_code, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_type, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_id, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.CNA_NO, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4 WHERE AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_Location_type = 'CELL' and AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY >0 and AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG='Y' and AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG='Y' ) DT_ACTCERT_CELLS WHERE ( AT_OFFENDER.OFFENDER_ID=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE='INST' ) AND ( DT_IEP_BAND_LAST.OFFENDER_BOOK_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID=USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_LIVING_UNITS.HOUSING_UNIT_TYPE NOT IN ('OU','REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID(+)=AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDERS_LOCATIONS.AGY_LOC_ID(+) ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID NOT IN ('OUT','TRN') AND AT_CASELOAD_LOCATIONS.CASELOAD_ID NOT IN ('ADMINC', 'CADM_I','MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID=WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_ACTCERT_CELLS.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_ACTCERT_CELLS.INTERNAL_LOCATION_ID(+) ) AND ( DT_LATEST_BED.OFFENDER_BOOK_ID=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.AGY_LOC_ID=AT_AGENCY_INTERNAL_LOCATION.AGY_LOC_ID and AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION.INTERNAL_LOCATION_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION.ACTIVE_FLAG='Y' ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( ( AT_OFFENDER_BOOKING.ACTIVE_FLAG='Y' ) AND ( /* START Filter: Hierarchies/Establishment/''Establishment Code'' */ AT_OFFENDERS_LOCATIONS.AGY_LOC_ID in ((SELECT establishment_code from prompt_)) /* END Filter: Hierarchies/Establishment/''Establishment Code'' */ ) AND ( AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE IN ('All') or 'All' in ('All') ) ) GROUP BY AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION ) _query3 ON _query0.OFFENDER_ID_DISPLAY = _query3.OFFENDER_ID_DISPLAY ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION, nvl(sum(DT_CERTCELL_CNA.CNA_NO),0) FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION, (  SELECT DISTINCT decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) as UnitCode1 , AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.Parent_Internal_Location_ID, AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_code, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_type, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_id, AT_AGENCY_INTERNAL_LOCATION_L4.CNA_NO FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4 WHERE AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_Location_type = 'CELL' and AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY >0 and AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG='Y' ) DT_CERTCELL_CNA, ( SELECT iep_level, description, agy_loc_id, offender_book_id, iep_date FROM ( SELECT iep.iep_level, rc.description, iep.agy_loc_id, iep.offender_book_id, iep.iep_date, ROW_NUMBER() OVER (PARTITION BY iep.offender_book_id ORDER BY iep.iep_time DESC, iep.iep_level_seq DESC) row_seq_filter FROM oms_owner.offender_iep_levels iep LEFT OUTER JOIN oms_owner.reference_codes rc ON iep.iep_level = rc.code AND rc.domain = 'IEP_LEVEL' ) WHERE row_seq_filter = 1 ) DT_IEP_BAND_LAST, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS, ( select OFFENDER_BOOK_ID, max(Bed_Assign_Seq) as Latest_Assign_Seq, max(Assignment_Date) as Latest_Assign_Date, max(Assignment_Time) as Latest_Assign_Time from OMS_OWNER.BED_ASSIGNMENT_HISTORIES Group by offender_book_id ) DT_LATEST_BED, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS WHERE ( AT_OFFENDER.OFFENDER_ID=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE='INST' ) AND ( DT_IEP_BAND_LAST.OFFENDER_BOOK_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID=USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_LIVING_UNITS.HOUSING_UNIT_TYPE NOT IN ('OU','REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID(+)=AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDERS_LOCATIONS.AGY_LOC_ID(+) ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID NOT IN ('OUT','TRN') AND AT_CASELOAD_LOCATIONS.CASELOAD_ID NOT IN ('ADMINC', 'CADM_I','MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID=WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_CERTCELL_CNA.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_CERTCELL_CNA.PARENT_INTERNAL_LOCATION_ID(+) ) AND ( DT_LATEST_BED.OFFENDER_BOOK_ID=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.AGY_LOC_ID=AT_AGENCY_INTERNAL_LOCATION.AGY_LOC_ID and AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION.INTERNAL_LOCATION_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION.ACTIVE_FLAG='Y' ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( ( AT_OFFENDER_BOOKING.ACTIVE_FLAG='Y' ) AND ( /* START Filter: Hierarchies/Establishment/''Establishment Code'' */ AT_OFFENDERS_LOCATIONS.AGY_LOC_ID in ((SELECT establishment_code from prompt_)) /* END Filter: Hierarchies/Establishment/''Establishment Code'' */ ) AND ( AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE IN ('All') or 'All' in ('All') ) ) GROUP BY AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION ) _query0 FULL OUTER JOIN ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION, nvl(sum(DT_LOCKUP.LOCKUPFIGURE+DT_TEMPREL_BY_LOC.TEMPREL),0) FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION, ( SELECT iep_level, description, agy_loc_id, offender_book_id, iep_date FROM ( SELECT iep.iep_level, rc.description, iep.agy_loc_id, iep.offender_book_id, iep.iep_date, ROW_NUMBER() OVER (PARTITION BY iep.offender_book_id ORDER BY iep.iep_time DESC, iep.iep_level_seq DESC) row_seq_filter FROM oms_owner.offender_iep_levels iep LEFT OUTER JOIN oms_owner.reference_codes rc ON iep.iep_level = rc.code AND rc.domain = 'IEP_LEVEL' ) WHERE row_seq_filter = 1 ) DT_IEP_BAND_LAST, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, (  SELECT AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.parent_INTERNAL_LOCATION_ID, COUNT( DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY) as TempRel FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS WHERE ( AT_OFFENDER.OFFENDER_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID(+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID=AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=AT_OFFENDERS_LOCATIONS.AGY_LOC_ID(+) ) AND AT_OFFENDER_BOOKING.ACTIVE_FLAG='Y' AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE='INST' ) AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE = 'OUT' AND AT_OFFENDER_BOOKING.IN_OUT_STATUS = 'OUT' AND AT_OFFENDER_BOOKING.LIVING_UNIT_ID is not null And AT_OFFENDER_EXTERNAL_MOVEMENTS.ACTIVE_FLAG = 'Y' And (AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID, AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE, AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TIME) in (Select OFFENDER_BOOK_ID, Max(MOVEMENT_DATE), Max(MOVEMENT_TIME) From OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS Group By OFFENDER_BOOK_ID) GROUP BY AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.parent_INTERNAL_LOCATION_ID ) DT_TEMPREL_BY_LOC, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS, ( select OFFENDER_BOOK_ID, max(Bed_Assign_Seq) as Latest_Assign_Seq, max(Assignment_Date) as Latest_Assign_Date, max(Assignment_Time) as Latest_Assign_Time from OMS_OWNER.BED_ASSIGNMENT_HISTORIES Group by offender_book_id ) DT_LATEST_BED, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, (  SELECT AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.parent_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, COUNT( DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY) as LockUpFigure FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDERS AT_OFFENDER WHERE ( AT_OFFENDER.OFFENDER_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=AT_OFFENDERS_LOCATIONS.AGY_LOC_ID(+) ) AND AT_OFFENDER_BOOKING.IN_OUT_STATUS = 'IN' AND AT_OFFENDER_BOOKING.ACTIVE_FLAG='Y' AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE='INST' )  AND AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_Location_type = 'CELL' GROUP BY AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.parent_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) DT_LOCKUP WHERE ( AT_OFFENDER.OFFENDER_ID=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE='INST' ) AND ( DT_IEP_BAND_LAST.OFFENDER_BOOK_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID=USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_TEMPREL_BY_LOC.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_TEMPREL_BY_LOC.PARENT_INTERNAL_LOCATION_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_LOCKUP.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_LIVING_UNITS.HOUSING_UNIT_TYPE NOT IN ('OU','REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID(+)=AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDERS_LOCATIONS.AGY_LOC_ID(+) ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID NOT IN ('OUT','TRN') AND AT_CASELOAD_LOCATIONS.CASELOAD_ID NOT IN ('ADMINC', 'CADM_I','MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID=WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( DT_LOCKUP.INTERNAL_LOCATION_ID(+)=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( DT_LATEST_BED.OFFENDER_BOOK_ID=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.AGY_LOC_ID=AT_AGENCY_INTERNAL_LOCATION.AGY_LOC_ID and AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION.INTERNAL_LOCATION_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION.ACTIVE_FLAG='Y' ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( ( AT_OFFENDER_BOOKING.ACTIVE_FLAG='Y' ) AND ( /* START Filter: Hierarchies/Establishment/''Establishment Code'' */ AT_OFFENDERS_LOCATIONS.AGY_LOC_ID in ((SELECT establishment_code from prompt_)) /* END Filter: Hierarchies/Establishment/''Establishment Code'' */ ) AND ( AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE IN ('All') or 'All' in ('All') ) ) GROUP BY AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION ) _query5 ON _query0.OFFENDER_ID_DISPLAY = _query5.OFFENDER_ID_DISPLAY ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION, nvl(sum(DT_CERTCELL_CNA.CNA_NO),0) FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION, (  SELECT DISTINCT decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) as UnitCode1 , AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.Parent_Internal_Location_ID, AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_code, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_type, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_id, AT_AGENCY_INTERNAL_LOCATION_L4.CNA_NO FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4 WHERE AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_Location_type = 'CELL' and AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY >0 and AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG='Y' ) DT_CERTCELL_CNA, ( SELECT iep_level, description, agy_loc_id, offender_book_id, iep_date FROM ( SELECT iep.iep_level, rc.description, iep.agy_loc_id, iep.offender_book_id, iep.iep_date, ROW_NUMBER() OVER (PARTITION BY iep.offender_book_id ORDER BY iep.iep_time DESC, iep.iep_level_seq DESC) row_seq_filter FROM oms_owner.offender_iep_levels iep LEFT OUTER JOIN oms_owner.reference_codes rc ON iep.iep_level = rc.code AND rc.domain = 'IEP_LEVEL' ) WHERE row_seq_filter = 1 ) DT_IEP_BAND_LAST, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS, ( select OFFENDER_BOOK_ID, max(Bed_Assign_Seq) as Latest_Assign_Seq, max(Assignment_Date) as Latest_Assign_Date, max(Assignment_Time) as Latest_Assign_Time from OMS_OWNER.BED_ASSIGNMENT_HISTORIES Group by offender_book_id ) DT_LATEST_BED, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS WHERE ( AT_OFFENDER.OFFENDER_ID=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE='INST' ) AND ( DT_IEP_BAND_LAST.OFFENDER_BOOK_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID=USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_LIVING_UNITS.HOUSING_UNIT_TYPE NOT IN ('OU','REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID(+)=AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDERS_LOCATIONS.AGY_LOC_ID(+) ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID NOT IN ('OUT','TRN') AND AT_CASELOAD_LOCATIONS.CASELOAD_ID NOT IN ('ADMINC', 'CADM_I','MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID=WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_CERTCELL_CNA.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_CERTCELL_CNA.PARENT_INTERNAL_LOCATION_ID(+) ) AND ( DT_LATEST_BED.OFFENDER_BOOK_ID=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.AGY_LOC_ID=AT_AGENCY_INTERNAL_LOCATION.AGY_LOC_ID and AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION.INTERNAL_LOCATION_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION.ACTIVE_FLAG='Y' ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( ( AT_OFFENDER_BOOKING.ACTIVE_FLAG='Y' ) AND ( /* START Filter: Hierarchies/Establishment/''Establishment Code'' */ AT_OFFENDERS_LOCATIONS.AGY_LOC_ID in ((SELECT establishment_code from prompt_)) /* END Filter: Hierarchies/Establishment/''Establishment Code'' */ ) AND ( AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE IN ('All') or 'All' in ('All') ) ) GROUP BY AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION ) _query0 FULL OUTER JOIN ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION, sum(DT_TAP_BY_LOC.TEMPABS) FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION, ( SELECT iep_level, description, agy_loc_id, offender_book_id, iep_date FROM ( SELECT iep.iep_level, rc.description, iep.agy_loc_id, iep.offender_book_id, iep.iep_date, ROW_NUMBER() OVER (PARTITION BY iep.offender_book_id ORDER BY iep.iep_time DESC, iep.iep_level_seq DESC) row_seq_filter FROM oms_owner.offender_iep_levels iep LEFT OUTER JOIN oms_owner.reference_codes rc ON iep.iep_level = rc.code AND rc.domain = 'IEP_LEVEL' ) WHERE row_seq_filter = 1 ) DT_IEP_BAND_LAST, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, (  SELECT AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.parent_INTERNAL_LOCATION_ID, COUNT( DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY) as TempAbs FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS WHERE ( AT_OFFENDER.OFFENDER_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID(+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID=AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=AT_OFFENDERS_LOCATIONS.AGY_LOC_ID(+) ) and AT_OFFENDER_BOOKING.ACTIVE_FLAG='Y' AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE='INST' ) AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE = 'OUT' and AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE='TAP' And AT_OFFENDER_EXTERNAL_MOVEMENTS.ACTIVE_FLAG = 'Y' AND AT_OFFENDER_BOOKING.IN_OUT_STATUS = 'OUT' And (AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID, AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE, AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TIME) in (Select OFFENDER_BOOK_ID, Max(MOVEMENT_DATE), Max(MOVEMENT_TIME) From OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS Group By OFFENDER_BOOK_ID) GROUP BY AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.parent_INTERNAL_LOCATION_ID ) DT_TAP_BY_LOC, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS, ( select OFFENDER_BOOK_ID, max(Bed_Assign_Seq) as Latest_Assign_Seq, max(Assignment_Date) as Latest_Assign_Date, max(Assignment_Time) as Latest_Assign_Time from OMS_OWNER.BED_ASSIGNMENT_HISTORIES Group by offender_book_id ) DT_LATEST_BED, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS WHERE ( AT_OFFENDER.OFFENDER_ID=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE='INST' ) AND ( DT_IEP_BAND_LAST.OFFENDER_BOOK_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID=USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_TAP_BY_LOC.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_TAP_BY_LOC.PARENT_INTERNAL_LOCATION_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_LIVING_UNITS.HOUSING_UNIT_TYPE NOT IN ('OU','REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID(+)=AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID=AT_OFFENDERS_LOCATIONS.AGY_LOC_ID(+) ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID NOT IN ('OUT','TRN') AND AT_CASELOAD_LOCATIONS.CASELOAD_ID NOT IN ('ADMINC', 'CADM_I','MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID=WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( DT_LATEST_BED.OFFENDER_BOOK_ID=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.AGY_LOC_ID=AT_AGENCY_INTERNAL_LOCATION.AGY_LOC_ID and AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION.INTERNAL_LOCATION_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION.ACTIVE_FLAG='Y' ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( WING_CASELOAD_SECURITY.USERNAME=(SELECT username from context_) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME=(SELECT username from context_) ) AND ( ( AT_OFFENDER_BOOKING.ACTIVE_FLAG='Y' ) AND ( /* START Filter: Hierarchies/Establishment/''Establishment Code'' */ AT_OFFENDERS_LOCATIONS.AGY_LOC_ID in ((SELECT establishment_code from prompt_)) /* END Filter: Hierarchies/Establishment/''Establishment Code'' */ ) AND ( AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE IN ('All') or 'All' in ('All') ) ) GROUP BY AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_ALL_LIVING_UNITS.AGY_LOC_ID||'-'||AT_ALL_LIVING_UNITS.LEVEL_1_CODE, AT_ALL_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)+1,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-1)), decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,4)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_3_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,3)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_2_CODE, decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)), AT_OFFENDERS_LOCATIONS.HOUSING_LEV_1_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, CASE When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='NA' then 'Normal Accommodation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HC' then 'Healthcare' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SEG' then 'Segregation' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='REC' then 'Reception' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='HOLC' then 'Holding Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='SPLC' then 'Speciallist Cell' When AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE='OU' then 'Other Use' Else AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE END, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_CODE, AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.PARENT_INTERNAL_LOCATION_ID, AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG, AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE, AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG, '-', '-', AT_WING_ESTABLISHMENT.AGY_LOC_ID, AT_WING_ESTABLISHMENT.DESCRIPTION, DT_LATEST_BED.LATEST_ASSIGN_DATE, DT_LATEST_BED.LATEST_ASSIGN_TIME, DT_LATEST_BED.LATEST_ASSIGN_SEQ, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_BOOKING.IN_OUT_STATUS, substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,length(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID)+2,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)), AT_OFFENDERS_LOCATIONS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_OFFENDER_BOOKING.LIVING_UNIT_ID, DT_IEP_BAND_LAST.IEP_LEVEL, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_LIVING_UNITS.DESCRIPTION ) _query7 ON _query0.OFFENDER_ID_DISPLAY = _query7.OFFENDER_ID_DISPLAY), dataset_ AS (SELECT FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": []
      }
    },
    {
      "id": "3377299/DP3",
      "name": "CSRA and Release",
      "description": "OR - Demographics",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY, CASE WHEN NOT AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE WHEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN DT_LAST_RELEASE_DATE.LAST_REL_DATE ELSE NULL END AS CURRENT_RELEASE_DATE, AT_OFFENDERS_LOCATIONS.DESCRIPTION, DT_OFFENDER_CSR_ASSESSMENT.APPROVED_RESULT, DT_OFFENDER_CSR_ASSESSMENT.CALC_SUP_LEVEL_TYPE, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, TRUNC(MONTHS_BETWEEN(CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12) AS AGE_IN_YEARS, COALESCE(DT_IEP_BAND_LAST.DESCRIPTION, 'Missing') AS IEP_LEVEL FROM OMS_OWNER.OFFENDERS AT_OFFENDER, (SELECT iep_level, description, agy_loc_id, offender_book_id, iep_date FROM (SELECT iep.iep_level, rc.description, iep.agy_loc_id, iep.offender_book_id, iep.iep_date, ROW_NUMBER() OVER (PARTITION BY iep.offender_book_id ORDER BY iep.iep_time DESC, iep.iep_level_seq DESC) AS row_seq_filter FROM oms_owner.offender_iep_levels iep LEFT OUTER JOIN oms_owner.reference_codes rc ON iep.iep_level = rc.code AND rc.domain = 'IEP_LEVEL') WHERE row_seq_filter = 1) DT_IEP_BAND_LAST, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_RELEASE_DETAILS AT_OFFENDER_RELEASE_DETAILS, (SELECT AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID, CASE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE ELSE NULL END AS Last_Rel_Date, EFFECTIVE_SENTENCE_LENGTH FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = (SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID)) DT_LAST_RELEASE_DATE, USER_ACCESSIBLE_CASELOADS, (SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, coalesced_result_description, row_seq_filter FROM (SELECT v.*, rc.description AS coalesced_result_description FROM (SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, CASE WHEN row_seq_filter_latest = 1 THEN 1 ELSE row_seq_filter_previous END AS row_seq_filter FROM (SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, CASE WHEN row_seq_filter_latest = 1 AND assess_status = 'A' THEN 1 ELSE 0 END AS row_seq_filter_latest, COUNT(CASE WHEN row_seq_filter_previous = 1 AND assess_status <> 'A' THEN 1 END) OVER (PARTITION BY offender_book_id) + row_seq_filter_previous AS row_seq_filter_previous FROM (SELECT oa.offender_book_id, oa.assessment_date, a.description AS assessment_type, oa.calc_sup_level_type, oa.overrided_sup_level_type, oa.review_sup_level_type AS approved_result, oa.review_committe_code AS authority, oa.next_review_date, oa.assessment_seq, oa.assess_status, oa.score, COALESCE(oa.review_sup_level_type, oa.overrided_sup_level_type, oa.calc_sup_level_type) AS coalesced_result, ROW_NUMBER() OVER (PARTITION BY oa.offender_book_id ORDER BY oa.assess_status, oa.assessment_date DESC, oa.assessment_seq DESC) AS row_seq_filter_latest, ROW_NUMBER() OVER (PARTITION BY oa.offender_book_id ORDER BY oa.assessment_date DESC, oa.assessment_seq DESC) AS row_seq_filter_previous FROM offender_assessments oa INNER JOIN assessments a ON a.assessment_id = oa.assessment_type_id AND a.assessment_class = 'TYPE' AND a.cell_sharing_alert_flag = 'Y'))) v LEFT OUTER JOIN reference_codes rc ON rc.code = v.coalesced_result AND rc.domain = 'SUP_LVL_TYPE')) DT_OFFENDER_CSR_ASSESSMENT, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_RELEASE_DETAILS.OFFENDER_BOOK_ID (+)) AND (DT_IEP_BAND_LAST.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (USER_ACCESSIBLE_CASELOADS.USERNAME = (SELECT username FROM context_)) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_LAST_RELEASE_DATE.OFFENDER_BOOK_ID (+)) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_OFFENDER_CSR_ASSESSMENT.OFFENDER_BOOK_ID (+)) AND (USER_ACCESSIBLE_CASELOADS.USERNAME = (SELECT username FROM context_)) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (DT_OFFENDER_CSR_ASSESSMENT.row_seq_filter = 1 OR DT_OFFENDER_CSR_ASSESSMENT.row_seq_filter IS NULL) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ((SELECT establishment_code FROM prompt_)) /* END Filter: Hierarchies/Establishment/''Establishment Code'' */) /* START Filter: Hierarchies/Establishment/''Establishment Code'' */ AND (AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE IN ('All') OR 'All' IN ('All')))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, CURRENT_RELEASE_DATE, DESCRIPTION, APPROVED_RESULT, CALC_SUP_LEVEL_TYPE, LAST_NAME, FIRST_NAME, AGE_IN_YEARS, IEP_LEVEL FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP3.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "CURRENT_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DP3.DOb29",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Establishment Name",
            "legacyId": "DP3.DO33b",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "APPROVED_RESULT",
            "type": "string",
            "display": "CSRA Approved Result",
            "legacyId": "DP3.DOc50",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "CALC_SUP_LEVEL_TYPE",
            "type": "string",
            "display": "CSRA Calculated Result",
            "legacyId": "DP3.DOc2f",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP3.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP3.DO46",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "AGE_IN_YEARS",
            "type": "double",
            "display": "Age in Years",
            "legacyId": "DP3.DOa15",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "IEP_LEVEL",
            "type": "string",
            "display": "IEP Level",
            "legacyId": "DP3.DO521",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3377299/DP6",
      "name": "Vacant Cells",
      "description": "OR - Demographics",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY WHERE (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('DPRWS')) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID IN ((SELECT establishment_code FROM prompt_)) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('DPRWS')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG = 'Y' AND AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG = 'Y'))), dataset_ AS (SELECT DESCRIPTION, NO_OF_OCCUPANT, CAPACITY, UNIT_DESCRIPTION_4_SHORT FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Level 1 Living Unit",
            "legacyId": "DP6.DO9fb",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "NO_OF_OCCUPANT",
            "type": "double",
            "display": "Current Cell Occupants",
            "legacyId": "DP6.DO1096",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "CAPACITY",
            "type": "double",
            "display": "Unit Description 4 Capacity",
            "legacyId": "DP6.DO1095",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "UNIT_DESCRIPTION_4_SHORT",
            "type": "string",
            "display": "Unit Description 4 Short",
            "legacyId": "DP6.DO427",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3377299/DPa",
      "name": "Out of Use",
      "description": "OR - Demographics",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_LIVING_UNITS.DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_DATE, AT_CELL_USAGE_DESCRIPTION.DESCRIPTION AS DEACTIVATE_REASON_DESCRIPTION, AT_AGENCY_INTERNAL_LOCATION_L4.REACTIVATE_DATE, AT_AGENCY_INTERNAL_LOCATION_L4.COMMENT_TEXT, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.REFERENCE_CODES AT_CELL_USAGE_DESCRIPTION, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY WHERE (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (AT_CELL_USAGE_DESCRIPTION.DOMAIN (+) = 'LIV_UN_RSN' AND AT_CELL_USAGE_DESCRIPTION.ACTIVE_FLAG (+) = 'Y') AND (AT_AGENCY_INTERNAL_LOCATION_L4.DEACTIVATE_REASON_CODE = AT_CELL_USAGE_DESCRIPTION.CODE (+)) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID IN ((SELECT establishment_code FROM prompt_)) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER('DPRWS')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG = 'N' AND AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG = 'Y'))), dataset_ AS (SELECT DESCRIPTION, DEACTIVATE_DATE, DEACTIVATE_REASON_DESCRIPTION, REACTIVATE_DATE, COMMENT_TEXT, NO_OF_OCCUPANT, CAPACITY FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Level 1 Living Unit",
            "legacyId": "DPa.DO9fb",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DEACTIVATE_DATE",
            "type": "date",
            "display": "Deactivate Date",
            "legacyId": "DPa.DO1132",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "DEACTIVATE_REASON_DESCRIPTION",
            "type": "string",
            "display": "Deactivate Reason Description",
            "legacyId": "DPa.DO1145",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "REACTIVATE_DATE",
            "type": "date",
            "display": "Reactivate Date",
            "legacyId": "DPa.DO1133",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "COMMENT_TEXT",
            "type": "string",
            "display": "Comment Text",
            "legacyId": "DPa.DO1135",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "NO_OF_OCCUPANT",
            "type": "double",
            "display": "Current Cell Occupants",
            "legacyId": "DPa.DO1096",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "CAPACITY",
            "type": "double",
            "display": "Unit Description 4 Capacity",
            "legacyId": "DPa.DO1095",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "166087.RS",
      "name": "All Cells",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      },
      "dataset": "MISSING"
    },
    {
      "id": "167918.RS",
      "name": "All Cells By Availability",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_CELL_LENGTH >= 8)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      },
      "dataset": "MISSING"
    },
    {
      "id": "167192.RS",
      "name": "Vacancies By Cell Location",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP0",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (V_SPARE_CELL = 1 AND V_COURT_RECEP_CSWAP = 0))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:DP0_DO44",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO45",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO46",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DOA15",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_LOCATION_ACTIVE_OUT",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Prisoner Location].[Unit Description 4 Short]);\"z-Active Out\";[Prisoner Location].[Unit Description 4 Short])"
          },
          {
            "name": "$ref:DP0_DO1096",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DOFFC",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_AVAILABLE_CELLS",
            "display": "Available",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=([Capacity]-[Prisoner Location].[Current Cell Occupants])"
          },
          {
            "name": "$ref:DP0_DO715",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_CSRA_CALC",
            "display": "CSRA Calc Result",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[CSRA Calculated Result]"
          },
          {
            "name": "$ref:V_CSRA_APP",
            "display": "CSRA Approved Result",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[CSRA Approved Result]"
          },
          {
            "name": "$ref:DP0_DOCDE",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_CURRENTRELEASEDATE",
            "display": "Release Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Current Release Date]"
          }
        ]
      }
    },
    {
      "id": "165584.RS",
      "name": "Vacancies By Surname",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP0",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (V_SPARE_CELL = 1 AND V_COURT_RECEP_CSWAP = 0))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:DP0_DO44",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO45",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO46",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DOA15",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO427",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO1096",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DOFFC",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_AVAILABLE_CELLS",
            "display": "Available",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=([Capacity]-[Prisoner Location].[Current Cell Occupants])"
          },
          {
            "name": "$ref:DP0_DO715",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_CSRA_CALC",
            "display": "CSRA Calc Result",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[CSRA Calculated Result]"
          },
          {
            "name": "$ref:V_CSRA_APP",
            "display": "CSRA Approved Result",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[CSRA Approved Result]"
          },
          {
            "name": "$ref:DP0_DOCDE",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_CURRENTRELEASEDATE",
            "display": "Release Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Current Release Date]"
          }
        ]
      }
    },
    {
      "id": "166160.RS",
      "name": "Vacancies By Release Date",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP0",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (V_SPARE_CELL = 1 AND V_COURT_RECEP_CSWAP = 0))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:DP0_DO44",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO45",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO46",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DOA15",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO427",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO1096",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DOFFC",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_AVAILABLE_CELLS",
            "display": "Available",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=([Capacity]-[Prisoner Location].[Current Cell Occupants])"
          },
          {
            "name": "$ref:DP0_DO715",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_CSRA_CALC",
            "display": "CSRA Calc Result",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[CSRA Calculated Result]"
          },
          {
            "name": "$ref:V_CSRA_APP",
            "display": "CSRA Approved Result",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[CSRA Approved Result]"
          },
          {
            "name": "$ref:DP0_DOCDE",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_CURRENTRELEASEDATE",
            "display": "Release Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Current Release Date]"
          }
        ]
      }
    },
    {
      "id": "165855.RS",
      "name": "Court,Recep or CSWAP",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP0",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_COURT_RECEP_CSWAP = 1)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:DP0_DO44",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO45",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO46",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO427",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP0_DO715",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_CSRA_CALC",
            "display": "CSRA Calc Result",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[CSRA Calculated Result]"
          },
          {
            "name": "$ref:V_CSRA_APP",
            "display": "CSRA Approved Result",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[CSRA Approved Result]"
          },
          {
            "name": "$ref:DP0_DOCDE",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_CURRENTRELEASEDATE",
            "display": "Release Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Current Release Date]"
          }
        ]
      }
    },
    {
      "id": "166512.RS",
      "name": "Unoccupied Cells",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP6",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (VACANT_CELLS_CURRENT_CELL_OC35 = 0 AND V_CELL_LENGTH >= 8))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:DESCRIPTION",
            "display": "Level 1 Living Unit",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP6.DO9fb"
          },
          {
            "name": "$ref:NO_OF_OCCUPANT",
            "display": "Current Cell Occupants",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP6.DO1096"
          },
          {
            "name": "$ref:CAPACITY",
            "display": "Unit Description 4 Capacity",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP6.DO1095"
          }
        ]
      }
    },
    {
      "id": "166761.RS",
      "name": "Out of Use",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DPa",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (VACANT_CELLS_CURRENT_CELL_OC35 = 0 AND V_CELL_LENGTH >= 8))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:DESCRIPTION",
            "display": "Level 1 Living Unit",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPa.DO9fb"
          },
          {
            "name": "$ref:NO_OF_OCCUPANT",
            "display": "Current Cell Occupants",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPa.DO1096"
          },
          {
            "name": "$ref:CAPACITY",
            "display": "Unit Description 4 Capacity",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPa.DO1095"
          },
          {
            "name": "$ref:DEACTIVATE_DATE",
            "display": "Deactivate Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPa.DO1132"
          },
          {
            "name": "$ref:DEACTIVATE_REASON_DESCRIPTION",
            "display": "Deactivate Reason Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPa.DO1145"
          },
          {
            "name": "$ref:COMMENT_TEXT",
            "display": "Comment Text",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPa.DO1135"
          },
          {
            "name": "$ref:REACTIVATE_DATE",
            "display": "Reactivate Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPa.DO1133"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::fixSqlFormatting sql is not valid",
      "entityId": "FslvNQCkpAwAw9UaAACn7nwAACJIAGE1",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[0] requires property \"dataset\"",
      "entityId": "FslvNQCkpAwAw9UaAACn7nwAACJIAGE1",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[1] requires property \"dataset\"",
      "entityId": "FslvNQCkpAwAw9UaAACn7nwAACJIAGE1",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Report Variant 166087.RS does not have corresponding dataset undefined",
      "entityId": "166087.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report Variant 167918.RS does not have corresponding dataset undefined",
      "entityId": "167918.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO44 does not have corresponding dataset schema field",
      "entityId": "167192.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO45 does not have corresponding dataset schema field",
      "entityId": "167192.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO46 does not have corresponding dataset schema field",
      "entityId": "167192.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DOA15 does not have corresponding dataset schema field",
      "entityId": "167192.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_LOCATION_ACTIVE_OUT does not have corresponding dataset schema field",
      "entityId": "167192.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO1096 does not have corresponding dataset schema field",
      "entityId": "167192.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DOFFC does not have corresponding dataset schema field",
      "entityId": "167192.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_AVAILABLE_CELLS does not have corresponding dataset schema field",
      "entityId": "167192.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO715 does not have corresponding dataset schema field",
      "entityId": "167192.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CSRA_CALC does not have corresponding dataset schema field",
      "entityId": "167192.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CSRA_APP does not have corresponding dataset schema field",
      "entityId": "167192.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DOCDE does not have corresponding dataset schema field",
      "entityId": "167192.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CURRENTRELEASEDATE does not have corresponding dataset schema field",
      "entityId": "167192.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO44 does not have corresponding dataset schema field",
      "entityId": "165584.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO45 does not have corresponding dataset schema field",
      "entityId": "165584.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO46 does not have corresponding dataset schema field",
      "entityId": "165584.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DOA15 does not have corresponding dataset schema field",
      "entityId": "165584.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO427 does not have corresponding dataset schema field",
      "entityId": "165584.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO1096 does not have corresponding dataset schema field",
      "entityId": "165584.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DOFFC does not have corresponding dataset schema field",
      "entityId": "165584.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_AVAILABLE_CELLS does not have corresponding dataset schema field",
      "entityId": "165584.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO715 does not have corresponding dataset schema field",
      "entityId": "165584.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CSRA_CALC does not have corresponding dataset schema field",
      "entityId": "165584.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CSRA_APP does not have corresponding dataset schema field",
      "entityId": "165584.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DOCDE does not have corresponding dataset schema field",
      "entityId": "165584.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CURRENTRELEASEDATE does not have corresponding dataset schema field",
      "entityId": "165584.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO44 does not have corresponding dataset schema field",
      "entityId": "166160.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO45 does not have corresponding dataset schema field",
      "entityId": "166160.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO46 does not have corresponding dataset schema field",
      "entityId": "166160.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DOA15 does not have corresponding dataset schema field",
      "entityId": "166160.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO427 does not have corresponding dataset schema field",
      "entityId": "166160.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO1096 does not have corresponding dataset schema field",
      "entityId": "166160.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DOFFC does not have corresponding dataset schema field",
      "entityId": "166160.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_AVAILABLE_CELLS does not have corresponding dataset schema field",
      "entityId": "166160.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO715 does not have corresponding dataset schema field",
      "entityId": "166160.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CSRA_CALC does not have corresponding dataset schema field",
      "entityId": "166160.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CSRA_APP does not have corresponding dataset schema field",
      "entityId": "166160.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DOCDE does not have corresponding dataset schema field",
      "entityId": "166160.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CURRENTRELEASEDATE does not have corresponding dataset schema field",
      "entityId": "166160.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO44 does not have corresponding dataset schema field",
      "entityId": "165855.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO45 does not have corresponding dataset schema field",
      "entityId": "165855.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO46 does not have corresponding dataset schema field",
      "entityId": "165855.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO427 does not have corresponding dataset schema field",
      "entityId": "165855.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DO715 does not have corresponding dataset schema field",
      "entityId": "165855.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CSRA_CALC does not have corresponding dataset schema field",
      "entityId": "165855.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CSRA_APP does not have corresponding dataset schema field",
      "entityId": "165855.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP0_DOCDE does not have corresponding dataset schema field",
      "entityId": "165855.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CURRENTRELEASEDATE does not have corresponding dataset schema field",
      "entityId": "165855.RS",
      "entityType": "variant"
    },
    {
      "type": "sqlQuery",
      "error": "Error: NJS-005: invalid value for parameter 1",
      "entityId": "3377299/DP0",
      "entityType": "dataset"
    }
  ]
}