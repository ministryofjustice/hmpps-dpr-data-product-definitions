{
  "id": "okR1jT8ABORHOiYATBOD8K7B_Qc",
  "name": "MIS Security and Previous Convictions",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "PDD0012  v00.00.08 drop10.3"
    ]
  },
  "description": "Is used as part of an assessment for allocation or home leave for a specified prisoner. The report shows prisoner personal details, key dates, summary case information, check hold markers, allocation/reallocation details and activity comments.<br/>PDD0012 - v00.00.08",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3375368/DP2",
      "name": "Main Query",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.FIRST_NAME, AT_OFFENDER_BOOKING.MIDDLE_NAME_1, CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END AS DATE_OF_BIRTH, AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_DESCRIPTION, AT_OFFENDER_BOOKING.NATIONALITY_CODE, AT_OFFENDER_BOOKING.NATIONALITY_DESCRIPTION, AT_OFFENDER_BOOKING.BIRTH_COUNTRY, AT_OFFENDER_BOOKING.BIRTH_PLACE, AT_OFFENDER_BOOKING.MARITAL_STATUS_CODE, AT_OFFENDER_BOOKING.MARITAL_STATUS_DESCRIPTION, AT_OFFENDER_BOOKING.PNC_ID, CASE WHEN AT_DIM_ETHNICITY_CODES.CODE = 'MERGE' THEN 'Code Missing' WHEN AT_DIM_ETHNICITY_CODES.CODE IS NULL THEN 'Code Missing' WHEN AT_DIM_ETHNICITY_CODES.CODE = 'W8' THEN 'W3' WHEN AT_DIM_ETHNICITY_CODES.CODE = 'O1' THEN 'A4' ELSE AT_DIM_ETHNICITY_CODES.CODE END AS ETHNIC_CODE, CASE WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'Chinese' THEN 'Asian/Asian British: Chinese' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'White : Irish Traveller/Gypsy' THEN 'White: Gypsy or Irish Traveller' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION IS NULL THEN 'Code Missing' ELSE AT_DIM_ETHNICITY_CODES.DESCRIPTION END AS ETHNIC_GROUP, AT_OFFENDER_BOOKING.DIET_DESCRIPTION, COALESCE(AT_OFFENDER_BOOKING.RELIGION_CODE, 'Not Specified') AS RELIGION_CODE, COALESCE(AT_OFFENDER_BOOKING.RELIGION_DESCRIPTION, 'Not Specified') AS RELIGION_DESCRIPTION, AT_FACT_OFF_PPTY_CNTNR_USAGE.PROPERTY_BOX_LOCATION, CASE WHEN AT_FACT_OFF_PPTY_CNTNR_USAGE.CONTAINER_CODE = 'BRA' THEN 'Branston Storage' WHEN AT_FACT_OFF_PPTY_CNTNR_USAGE.CONTAINER_CODE = 'BULK' THEN 'Bulk' WHEN AT_FACT_OFF_PPTY_CNTNR_USAGE.CONTAINER_CODE = 'VALU' THEN 'Valuables' WHEN AT_FACT_OFF_PPTY_CNTNR_USAGE.CONTAINER_CODE = 'DES' THEN 'For Destruction' WHEN AT_FACT_OFF_PPTY_CNTNR_USAGE.CONTAINER_CODE = 'CO' THEN 'Confiscated' ELSE AT_FACT_OFF_PPTY_CNTNR_USAGE.CONTAINER_CODE END AS PROPERTY_BOX_TYPE, AT_OFFENDER_ACTIVITY_COMMENT.COURSE_ACTIVITY_ID, AT_OFFENDER_ACTIVITY_COMMENT.COURSE_ACTIVITY_DESCRIPTION, AT_OFFENDER_ACTIVITY_COMMENT.OFFENDER_END_COMMENT_TEXT, CASE WHEN AT_ACTIVITY_DATE.DAY_DATE < '31/12/9000' THEN AT_ACTIVITY_DATE.DAY_DATE ELSE NULL END AS ACTIVITY_DATE, AT_OFFENDER_BOOKING.NO_OF_PREV_CONVICTIONS, AT_OFFENDER_BOOKING.NO_OF_PREV_CUSTODIAL_SENTENCES, CASE WHEN AT_DIM_COURT_EVENT_TYPE.COURT_EVENT_TYPE_CODE_NK = 'APPEAL' THEN 'Y' ELSE 'N' END AS APPELLANT, MIN(DT_SPECIAL_COURT_EVENTS.first_convicted_date) AS FIRST_CONVICTED_DATE, MIN(DT_SPECIAL_COURT_EVENTS.first_sentenced_date) AS FIRST_SENTENCED_DATE, MIN(DT_SPECIAL_COURT_EVENTS.first_remand_date) AS FIRST_REMAND_DATE, MIN(DT_SPECIAL_COURT_EVENTS.first_remand_court) AS FIRST_REMAND_COURT, MIN(DT_SPECIAL_COURT_EVENTS.first_convicted_court) AS FIRST_CONVICTED_COURT FROM (SELECT f.offender_booking_sk, f.court_case_sk, MIN(CASE WHEN f.outcome_key = 1 THEN f.event_date END) AS first_remand_date, MIN(CASE WHEN f.outcome_key = 1 THEN f.court_description END) AS first_remand_court, MIN(CASE WHEN f.outcome_key = 1 THEN f.outcome_reason_description END) AS first_remand_result, MIN(CASE WHEN f.outcome_key = 11 THEN f.event_date END) AS second_remand_date, MIN(CASE WHEN f.outcome_key = 11 THEN f.court_description END) AS second_remand_court, MIN(CASE WHEN f.outcome_key = 11 THEN f.outcome_reason_description END) AS second_remand_result, MIN(CASE WHEN f.outcome_key = 2 THEN f.event_date END) AS first_convicted_date, MIN(CASE WHEN f.outcome_key = 2 THEN f.court_description END) AS first_convicted_court, MIN(CASE WHEN f.outcome_key = 2 THEN f.outcome_reason_description END) AS first_convicted_result, MIN(CASE WHEN f.outcome_key = 3 THEN f.event_date END) AS first_sentenced_date, MIN(CASE WHEN f.outcome_key = 3 THEN f.court_description END) AS first_sentenced_court, MIN(CASE WHEN f.outcome_key = 3 THEN f.outcome_reason_description END) AS first_sentenced_result, MIN(CASE WHEN f.outcome_key = 4 THEN f.event_date END) AS first_committed_date, MIN(CASE WHEN f.outcome_key = 4 THEN f.court_description END) AS first_committed_court, MIN(CASE WHEN f.outcome_key = 4 THEN f.outcome_reason_description END) AS first_committed_result, MIN(CASE WHEN f.outcome_key = 4 THEN f.next_date END) AS committed_to_date, MIN(CASE WHEN f.outcome_key = 4 THEN f.next_court END) AS committed_to_court, MIN(CASE WHEN f.outcome_key = 4 THEN f.next_outcome END) AS committed_to_result, MIN(CASE WHEN f.outcome_key = 5 THEN f.event_date END) AS first_appeal_date, MIN(CASE WHEN f.outcome_key = 5 THEN f.court_description END) AS first_appeal_court, MIN(CASE WHEN f.outcome_key = 5 THEN f.outcome_reason_description END) AS first_appeal_result, MIN(CASE WHEN f.outcome_key = 6 THEN f.event_date END) AS first_bailed_date, MIN(CASE WHEN f.outcome_key = 6 THEN f.court_description END) AS first_bailed_court, MIN(CASE WHEN f.outcome_key = 6 THEN f.outcome_reason_description END) AS first_bailed_result FROM (SELECT row_seq, offender_booking_sk, court_case_sk, event_dt AS event_date, court_description, outcome_reason_description, next_date, next_court, next_outcome, CASE WHEN outcome_key = 1 AND row_seq = 2 THEN 11 ELSE outcome_key END AS outcome_key FROM (SELECT oc.*, fce.*, ROW_NUMBER() OVER (PARTITION BY fce.offender_booking_sk, oc.outcome_key, fce.court_case_sk ORDER BY fce.event_time, fce.court_event_nk) AS row_seq FROM (SELECT 1 AS outcome_key, 'Remand Outcome' AS outcome_type, outcome_code FROM ((SELECT '4011', '4012', '4013', '4014', '4015', '4016', '4017', '4020', '4021', '4506', '4529', '4530', '4531', '4532', '4533', '4534', '4535', '4536', '4537', '4538', '4539', '4541', '4542', '4543', '4548', '4549', '4550', '4551', '4552', '4558', '4559', '4560', '4561', '4562', '4563', '4564', '4565', '4587', '4588', '4589', '4504', '4511', '4512', '4513', '4514', '4515', '4516', '4519', '4520', '4521', '4522', '4523', '4524', '4540', '4578', '4579', '4580', '4581' FROM dual) UNPIVOT(outcome_code FOR value_type IN (\"'4011'\", \"'4012'\", \"'4013'\", \"'4014'\", \"'4015'\", \"'4016'\", \"'4017'\", \"'4020'\", \"'4021'\", \"'4506'\", \"'4529'\", \"'4530'\", \"'4531'\", \"'4532'\", \"'4533'\", \"'4534'\", \"'4535'\", \"'4536'\", \"'4537'\", \"'4538'\", \"'4539'\", \"'4541'\", \"'4542'\", \"'4543'\", \"'4548'\", \"'4549'\", \"'4550'\", \"'4551'\", \"'4552'\", \"'4558'\", \"'4559'\", \"'4560'\", \"'4561'\", \"'4562'\", \"'4563'\", \"'4564'\", \"'4565'\", \"'4587'\", \"'4588'\", \"'4589'\", \"'4504'\", \"'4511'\", \"'4512'\", \"'4513'\", \"'4514'\", \"'4515'\", \"'4516'\", \"'4519'\", \"'4520'\", \"'4521'\", \"'4522'\", \"'4523'\", \"'4524'\", \"'4540'\", \"'4578'\", \"'4579'\", \"'4580'\", \"'4581'\"))) UNION ALL SELECT 2 AS outcome_key, 'Convicted Outcome' AS outcome_type, outcome_code FROM ((SELECT '1002', '1003', '1004', '1005', '1006', '1007', '1008', '1009', '1010', '1011', '1012', '1013', '1014', '1015', '1016', '1017', '1022', '1024', '1025', '1027', '1028', '1029', '1030', '1031', '1032', '1034', '1035', '1036', '1037', '1038', '1039', '1040', '1046', '1049', '1051', '1052', '1054', '1055', '1056', '1057', '1058', '1062', '1063', '1064', '1065', '1066', '1067', '1068', '1070', '1071', '1073', '1074', '1075', '1076', '1077', '1078', '1079', '1080', '1081', '1082', '1083', '1084', '1085', '1086', '1087', '1088', '1089', '1090', '1091', '1092', '1093', '1094', '1096', '1097', '1098', '1099', '1100', '1101', '1102', '1103', '1104', '1105', '1106', '1107', '1108', '1109', '1110', '1111', '1112', '1114', '1115', '1116', '1117', '1118', '1119', '1121', '1501', '1505', '1507', '1508', '1509', '1510', '1511', '1512', '1513', '1514', '2007', '2012', '2015', '2017', '2018', '2023', '2062', '2067', '2505', '3002', '3006', '3007', '3008', '3010', '3011', '3012', '3013', '3014', '3016', '3019', '3020', '3021', '3022', '3025', '3027', '3028', '3029', '3030', '3033', '3034', '3035', '3041', '3042', '3044', '3045', '3047', '3049', '3050', '3051', '3052', '3053', '3054', '3055', '3056', '3058', '3061', '3062', '3063', '3064', '3065', '3066', '3067', '3068', '3069', '3070', '3071', '3072', '3073', '3074', '3075', '3076', '3077', '3079', '3080', '3081', '3082', '3083', '3084', '3085', '3086', '3087', '3088', '3089', '3090', '3091', '3092', '3094', '3095', '3096', '3097', '3098', '3099', '3101', '3102', '3103', '3104', '3105', '3106', '3107', '3108', '3109', '3110', '3111', '3112', '3501', '3502', '3503', '3504', '3508', '3509', '3510', '3512', '4001', '4004', '4005', '4011', '4012', '4013', '4014', '4015', '4016', '4017', '4020', '4021', '4022', '4551', '4552', '4586', '4587', '4588', 'AC', 'FPR', 'G', '1001', '1026', '1043', '1044', '1047', '1050', '1059', '1060', '1061', '1069', '1072', '1503', '1506', '2021', '3001', '3003', '3004', '3005', '3009', '3015', '3017', '3031', '3032', '3036', '3037', '3038', '3039', '3040', '3043', '3046', '3048', '3057', '3059', '3060', '3078', '3093', '3513', '4019', '4511', '4512', '4519', '4520', '4521', '4525', '4527', '4578', '4579', '4580', '4581', '4591', '5001', '5002', '5003', '5004', '5005', '5006', '5008', '5009', '5010', '5012', '5013', '5014', '5015', '5016', '5017', '5018', '5019', '5020' FROM dual) UNPIVOT(outcome_code FOR value_type IN (\"'1002'\", \"'1003'\", \"'1004'\", \"'1005'\", \"'1006'\", \"'1007'\", \"'1008'\", \"'1009'\", \"'1010'\", \"'1011'\", \"'1012'\", \"'1013'\", \"'1014'\", \"'1015'\", \"'1016'\", \"'1017'\", \"'1022'\", \"'1024'\", \"'1025'\", \"'1027'\", \"'1028'\", \"'1029'\", \"'1030'\", \"'1031'\", \"'1032'\", \"'1034'\", \"'1035'\", \"'1036'\", \"'1037'\", \"'1038'\", \"'1039'\", \"'1040'\", \"'1046'\", \"'1049'\", \"'1051'\", \"'1052'\", \"'1054'\", \"'1055'\", \"'1056'\", \"'1057'\", \"'1058'\", \"'1062'\", \"'1063'\", \"'1064'\", \"'1065'\", \"'1066'\", \"'1067'\", \"'1068'\", \"'1070'\", \"'1071'\", \"'1073'\", \"'1074'\", \"'1075'\", \"'1076'\", \"'1077'\", \"'1078'\", \"'1079'\", \"'1080'\", \"'1081'\", \"'1082'\", \"'1083'\", \"'1084'\", \"'1085'\", \"'1086'\", \"'1087'\", \"'1088'\", \"'1089'\", \"'1090'\", \"'1091'\", \"'1092'\", \"'1093'\", \"'1094'\", \"'1096'\", \"'1097'\", \"'1098'\", \"'1099'\", \"'1100'\", \"'1101'\", \"'1102'\", \"'1103'\", \"'1104'\", \"'1105'\", \"'1106'\", \"'1107'\", \"'1108'\", \"'1109'\", \"'1110'\", \"'1111'\", \"'1112'\", \"'1114'\", \"'1115'\", \"'1116'\", \"'1117'\", \"'1118'\", \"'1119'\", \"'1121'\", \"'1501'\", \"'1505'\", \"'1507'\", \"'1508'\", \"'1509'\", \"'1510'\", \"'1511'\", \"'1512'\", \"'1513'\", \"'1514'\", \"'2007'\", \"'2012'\", \"'2015'\", \"'2017'\", \"'2018'\", \"'2023'\", \"'2062'\", \"'2067'\", \"'2505'\", \"'3002'\", \"'3006'\", \"'3007'\", \"'3008'\", \"'3010'\", \"'3011'\", \"'3012'\", \"'3013'\", \"'3014'\", \"'3016'\", \"'3019'\", \"'3020'\", \"'3021'\", \"'3022'\", \"'3025'\", \"'3027'\", \"'3028'\", \"'3029'\", \"'3030'\", \"'3033'\", \"'3034'\", \"'3035'\", \"'3041'\", \"'3042'\", \"'3044'\", \"'3045'\", \"'3047'\", \"'3049'\", \"'3050'\", \"'3051'\", \"'3052'\", \"'3053'\", \"'3054'\", \"'3055'\", \"'3056'\", \"'3058'\", \"'3061'\", \"'3062'\", \"'3063'\", \"'3064'\", \"'3065'\", \"'3066'\", \"'3067'\", \"'3068'\", \"'3069'\", \"'3070'\", \"'3071'\", \"'3072'\", \"'3073'\", \"'3074'\", \"'3075'\", \"'3076'\", \"'3077'\", \"'3079'\", \"'3080'\", \"'3081'\", \"'3082'\", \"'3083'\", \"'3084'\", \"'3085'\", \"'3086'\", \"'3087'\", \"'3088'\", \"'3089'\", \"'3090'\", \"'3091'\", \"'3092'\", \"'3094'\", \"'3095'\", \"'3096'\", \"'3097'\", \"'3098'\", \"'3099'\", \"'3101'\", \"'3102'\", \"'3103'\", \"'3104'\", \"'3105'\", \"'3106'\", \"'3107'\", \"'3108'\", \"'3109'\", \"'3110'\", \"'3111'\", \"'3112'\", \"'3501'\", \"'3502'\", \"'3503'\", \"'3504'\", \"'3508'\", \"'3509'\", \"'3510'\", \"'3512'\", \"'4001'\", \"'4004'\", \"'4005'\", \"'4011'\", \"'4012'\", \"'4013'\", \"'4014'\", \"'4015'\", \"'4016'\", \"'4017'\", \"'4020'\", \"'4021'\", \"'4022'\", \"'4551'\", \"'4552'\", \"'4586'\", \"'4587'\", \"'4588'\", \"'AC'\", \"'FPR'\", \"'G'\", \"'1001'\", \"'1026'\", \"'1043'\", \"'1044'\", \"'1047'\", \"'1050'\", \"'1059'\", \"'1060'\", \"'1061'\", \"'1069'\", \"'1072'\", \"'1503'\", \"'1506'\", \"'2021'\", \"'3001'\", \"'3003'\", \"'3004'\", \"'3005'\", \"'3009'\", \"'3015'\", \"'3017'\", \"'3031'\", \"'3032'\", \"'3036'\", \"'3037'\", \"'3038'\", \"'3039'\", \"'3040'\", \"'3043'\", \"'3046'\", \"'3048'\", \"'3057'\", \"'3059'\", \"'3060'\", \"'3078'\", \"'3093'\", \"'3513'\", \"'4019'\", \"'4511'\", \"'4512'\", \"'4519'\", \"'4520'\", \"'4521'\", \"'4525'\", \"'4527'\", \"'4578'\", \"'4579'\", \"'4580'\", \"'4581'\", \"'4591'\", \"'5001'\", \"'5002'\", \"'5003'\", \"'5004'\", \"'5005'\", \"'5006'\", \"'5008'\", \"'5009'\", \"'5010'\", \"'5012'\", \"'5013'\", \"'5014'\", \"'5015'\", \"'5016'\", \"'5017'\", \"'5018'\", \"'5019'\", \"'5020'\"))) UNION ALL SELECT 3 AS outcome_key, 'Sentenced Outcome' AS outcome_type, outcome_code FROM ((SELECT '1002', '1003', '1022', '1024', '1073', '1081', '1105', '1106', '1107', '1110', '1111', '1112', '1114', '1121', '1509', '1510', '3006', '1001', '4503' FROM dual) UNPIVOT(outcome_code FOR value_type IN (\"'1002'\", \"'1003'\", \"'1022'\", \"'1024'\", \"'1073'\", \"'1081'\", \"'1105'\", \"'1106'\", \"'1107'\", \"'1110'\", \"'1111'\", \"'1112'\", \"'1114'\", \"'1121'\", \"'1509'\", \"'1510'\", \"'3006'\", \"'1001'\", \"'4503'\"))) UNION ALL SELECT 4 AS outcome_key, 'Committed Outcome' AS outcome_type, outcome_code FROM ((SELECT '4001', '4014', '4015', '4016', '4017', '4020', '4021', '4558', '4559', '4560', '4561', '4562', '4563', '4564', '4565' FROM dual) UNPIVOT(outcome_code FOR value_type IN (\"'4001'\", \"'4014'\", \"'4015'\", \"'4016'\", \"'4017'\", \"'4020'\", \"'4021'\", \"'4558'\", \"'4559'\", \"'4560'\", \"'4561'\", \"'4562'\", \"'4563'\", \"'4564'\", \"'4565'\"))) UNION ALL SELECT 5 AS outcome_key, 'Appeal Outcome' AS outcome_type, outcome_code FROM ((SELECT '1046', '3044', '3045', '4534', '3093', '3513' FROM dual) UNPIVOT(outcome_code FOR value_type IN (\"'1046'\", \"'3044'\", \"'3045'\", \"'4534'\", \"'3093'\", \"'3513'\"))) UNION ALL SELECT 6 AS outcome_key, 'Bailed Outcome' AS outcome_type, outcome_code FROM ((SELECT '4011', '4013', '4014', '4015', '4017', '4529', '4530', '4533', '4552', '4558', '4559', '4561', '4587', '4589' FROM dual) UNPIVOT(outcome_code FOR value_type IN (\"'4011'\", \"'4013'\", \"'4014'\", \"'4015'\", \"'4017'\", \"'4529'\", \"'4530'\", \"'4533'\", \"'4552'\", \"'4558'\", \"'4559'\", \"'4561'\", \"'4587'\", \"'4589'\")))) oc RIGHT OUTER JOIN (SELECT f.*, d.day_date AS event_dt, dc.court_description, dor.outcome_reason_description, LEAD(d.day_date) OVER (PARTITION BY f.offender_booking_sk, f.court_case_sk ORDER BY f.event_time, f.court_event_nk) AS next_date, LEAD(dc.court_description) OVER (PARTITION BY f.offender_booking_sk, f.court_case_sk ORDER BY f.event_time, f.court_event_nk) AS next_court, LEAD(dor.outcome_reason_description) OVER (PARTITION BY f.offender_booking_sk, f.court_case_sk ORDER BY f.event_time, f.court_event_nk) AS next_outcome FROM bodimis.fact_court_event f INNER JOIN bodimis.dim_date d ON f.event_date_sk = d.date_sk INNER JOIN bodimis.dim_court dc ON f.court_sk = dc.court_sk LEFT OUTER JOIN bodimis.dim_outcome_reason dor ON f.outcome = dor.outcome_reason_nk WHERE f.court_case_sk > 0) fce ON fce.outcome = oc.outcome_code) WHERE (row_seq = 1 OR (row_seq = 2 AND outcome_key = 1))) f GROUP BY f.offender_booking_sk, f.court_case_sk) DT_SPECIAL_COURT_EVENTS, BODIMIS.DIM_COURT_EVENT_TYPE AT_DIM_COURT_EVENT_TYPE, BODIMIS.FACT_COURT_EVENT AT_FACT_COURT_EVENT, BODIMIS.DIM_ETHNICITY_CODES AT_DIM_ETHNICITY_CODES, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_DOB, BODIMIS.FACT_OFF_PPTY_CONTAINER_USAGE AT_FACT_OFF_PPTY_CNTNR_USAGE, BODIMIS.FACT_OFFENDER_ACTIVITY_COMMENT AT_OFFENDER_ACTIVITY_COMMENT, BODIMIS.DIM_DATE AT_ACTIVITY_DATE, BODIMIS.DIM_COURT_CASE AT_COURT_CASE WHERE (AT_FACT_COURT_EVENT.COURT_EVENT_TYPE_SK = AT_DIM_COURT_EVENT_TYPE.COURT_EVENT_TYPE_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_COURT_EVENT.COURT_CASE_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = DT_SPECIAL_COURT_EVENTS.COURT_CASE_SK (+) AND AT_COURT_CASE.OFFENDER_BOOKING_SK = DT_SPECIAL_COURT_EVENTS.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_OFFENDER_ACTIVITY_COMMENT.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_ACTIVITY_COMMENT.COURSE_ACTIVITY_START_DATE_SK = AT_ACTIVITY_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFF_PPTY_CNTNR_USAGE.OFFENDER_BOOKING_SK (+)) AND (AT_DIM_ETHNICITY_CODES.CODE (+) = AT_OFFENDER_BOOKING.ETHNICITY_CODE) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_ACTIVITY_COMMENT.OFFENDER_BOOKING_SK IS NULL OR AT_OFFENDER_ACTIVITY_COMMENT.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = (SELECT PRISONER_NUMBER FROM prompt_ /* = #Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1) */)) AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y')) GROUP BY AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.FIRST_NAME, AT_OFFENDER_BOOKING.MIDDLE_NAME_1, CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END, AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_DESCRIPTION, AT_OFFENDER_BOOKING.NATIONALITY_CODE, AT_OFFENDER_BOOKING.NATIONALITY_DESCRIPTION, AT_OFFENDER_BOOKING.BIRTH_COUNTRY, AT_OFFENDER_BOOKING.BIRTH_PLACE, AT_OFFENDER_BOOKING.MARITAL_STATUS_CODE, AT_OFFENDER_BOOKING.MARITAL_STATUS_DESCRIPTION, AT_OFFENDER_BOOKING.PNC_ID, CASE WHEN AT_DIM_ETHNICITY_CODES.CODE = 'MERGE' THEN 'Code Missing' WHEN AT_DIM_ETHNICITY_CODES.CODE IS NULL THEN 'Code Missing' WHEN AT_DIM_ETHNICITY_CODES.CODE = 'W8' THEN 'W3' WHEN AT_DIM_ETHNICITY_CODES.CODE = 'O1' THEN 'A4' ELSE AT_DIM_ETHNICITY_CODES.CODE END, CASE WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'Chinese' THEN 'Asian/Asian British: Chinese' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'White : Irish Traveller/Gypsy' THEN 'White: Gypsy or Irish Traveller' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION IS NULL THEN 'Code Missing' ELSE AT_DIM_ETHNICITY_CODES.DESCRIPTION END, AT_OFFENDER_BOOKING.DIET_DESCRIPTION, COALESCE(AT_OFFENDER_BOOKING.RELIGION_CODE, 'Not Specified'), COALESCE(AT_OFFENDER_BOOKING.RELIGION_DESCRIPTION, 'Not Specified'), AT_FACT_OFF_PPTY_CNTNR_USAGE.PROPERTY_BOX_LOCATION, CASE WHEN AT_FACT_OFF_PPTY_CNTNR_USAGE.CONTAINER_CODE = 'BRA' THEN 'Branston Storage' WHEN AT_FACT_OFF_PPTY_CNTNR_USAGE.CONTAINER_CODE = 'BULK' THEN 'Bulk' WHEN AT_FACT_OFF_PPTY_CNTNR_USAGE.CONTAINER_CODE = 'VALU' THEN 'Valuables' WHEN AT_FACT_OFF_PPTY_CNTNR_USAGE.CONTAINER_CODE = 'DES' THEN 'For Destruction' WHEN AT_FACT_OFF_PPTY_CNTNR_USAGE.CONTAINER_CODE = 'CO' THEN 'Confiscated' ELSE AT_FACT_OFF_PPTY_CNTNR_USAGE.CONTAINER_CODE END, AT_OFFENDER_ACTIVITY_COMMENT.COURSE_ACTIVITY_ID, AT_OFFENDER_ACTIVITY_COMMENT.COURSE_ACTIVITY_DESCRIPTION, AT_OFFENDER_ACTIVITY_COMMENT.OFFENDER_END_COMMENT_TEXT, CASE WHEN AT_ACTIVITY_DATE.DAY_DATE < '31/12/9000' THEN AT_ACTIVITY_DATE.DAY_DATE ELSE NULL END, AT_OFFENDER_BOOKING.NO_OF_PREV_CONVICTIONS, AT_OFFENDER_BOOKING.NO_OF_PREV_CUSTODIAL_SENTENCES, CASE WHEN AT_DIM_COURT_EVENT_TYPE.COURT_EVENT_TYPE_CODE_NK = 'APPEAL' THEN 'Y' ELSE 'N' END), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, SURNAME, FIRST_NAME, MIDDLE_NAME_1, DATE_OF_BIRTH, MAIN_LEGAL_STATUS_DESCRIPTION, NATIONALITY_CODE, NATIONALITY_DESCRIPTION, BIRTH_COUNTRY, BIRTH_PLACE, MARITAL_STATUS_CODE, MARITAL_STATUS_DESCRIPTION, PNC_ID, ETHNIC_CODE, ETHNIC_GROUP, DIET_DESCRIPTION, RELIGION_CODE, RELIGION_DESCRIPTION, PROPERTY_BOX_LOCATION, PROPERTY_BOX_TYPE, COURSE_ACTIVITY_ID, COURSE_ACTIVITY_DESCRIPTION, OFFENDER_END_COMMENT_TEXT, ACTIVITY_DATE, NO_OF_PREV_CONVICTIONS, NO_OF_PREV_CUSTODIAL_SENTENCES, APPELLANT, FIRST_CONVICTED_DATE, FIRST_SENTENCED_DATE, FIRST_REMAND_DATE, FIRST_REMAND_COURT, FIRST_CONVICTED_COURT, ESTABLISHMENT_DESCRIPTION AS V_REALLOCATED_FROM, REASON AS V_TRANSFER_REASON FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "prisoner_number",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter NOMS Number",
          "description": "@Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP2.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP2.DO1007b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "Offender Given Name 1",
            "legacyId": "DP2.DO10080",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "MIDDLE_NAME_1",
            "type": "string",
            "display": "Offender Given Name 2",
            "legacyId": "DP2.DO10081",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "DATE_OF_BIRTH",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DP2.DO10085",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "MAIN_LEGAL_STATUS_DESCRIPTION",
            "type": "string",
            "display": "Main Legal Status Description",
            "legacyId": "DP2.DO100df",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "NATIONALITY_CODE",
            "type": "string",
            "display": "Nationality Code",
            "legacyId": "DP2.DO100b4",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "NATIONALITY_DESCRIPTION",
            "type": "string",
            "display": "Nationality Description",
            "legacyId": "DP2.DO100b5",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "BIRTH_COUNTRY",
            "type": "string",
            "display": "Birth Country",
            "legacyId": "DP2.DO10088",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "BIRTH_PLACE",
            "type": "string",
            "display": "Birth Place",
            "legacyId": "DP2.DO10086",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "MARITAL_STATUS_CODE",
            "type": "string",
            "display": "Marital Status Code",
            "legacyId": "DP2.DO100ae",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "MARITAL_STATUS_DESCRIPTION",
            "type": "string",
            "display": "Marital Status Description",
            "legacyId": "DP2.DO100af",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "PNC_ID",
            "type": "string",
            "display": "PNC ID",
            "legacyId": "DP2.DO100db",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "ETHNIC_CODE",
            "type": "string",
            "display": "Ethnic Code",
            "legacyId": "DP2.DO1009b",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "ETHNIC_GROUP",
            "type": "string",
            "display": "Ethnic Group",
            "legacyId": "DP2.DO1009c",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "DIET_DESCRIPTION",
            "type": "string",
            "display": "Type of Diet",
            "legacyId": "DP2.DO100b1",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "RELIGION_CODE",
            "type": "string",
            "display": "Religion Code",
            "legacyId": "DP2.DO100b2",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "RELIGION_DESCRIPTION",
            "type": "string",
            "display": "Religion Description",
            "legacyId": "DP2.DO100b3",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "PROPERTY_BOX_LOCATION",
            "type": "string",
            "display": "Property Box Location",
            "legacyId": "DP2.DO104e8",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "PROPERTY_BOX_TYPE",
            "type": "string",
            "display": "Property Box Type",
            "legacyId": "DP2.DO104e1",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "COURSE_ACTIVITY_ID",
            "type": "string",
            "display": "Course Activity ID",
            "legacyId": "DP2.DO103b0",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "COURSE_ACTIVITY_DESCRIPTION",
            "type": "string",
            "display": "Course Activity Description",
            "legacyId": "DP2.DO103b1",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "OFFENDER_END_COMMENT_TEXT",
            "type": "string",
            "display": "Activity Comments",
            "legacyId": "DP2.DO103b2",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "ACTIVITY_DATE",
            "type": "date",
            "display": "Activity Date",
            "legacyId": "DP2.DO103b7",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "NO_OF_PREV_CONVICTIONS",
            "type": "double",
            "display": "Number of Previous Convictions",
            "legacyId": "DP2.DO1016b",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "NO_OF_PREV_CUSTODIAL_SENTENCES",
            "type": "double",
            "display": "Number of Previous Custodial Sentences",
            "legacyId": "DP2.DO1016a",
            "legacySqlClass": "column"
          },
          {
            "index": 26,
            "name": "APPELLANT",
            "type": "string",
            "display": "Appellant",
            "legacyId": "DP2.DO9c",
            "legacySqlClass": "column"
          },
          {
            "index": 27,
            "name": "FIRST_CONVICTED_DATE",
            "type": "date",
            "display": "First Convicted Date",
            "legacyId": "DP2.DO224",
            "legacySqlClass": "column"
          },
          {
            "index": 28,
            "name": "FIRST_SENTENCED_DATE",
            "type": "date",
            "display": "First Sentenced Date",
            "legacyId": "DP2.DO225",
            "legacySqlClass": "column"
          },
          {
            "index": 29,
            "name": "FIRST_REMAND_DATE",
            "type": "date",
            "display": "First Remand Date",
            "legacyId": "DP2.DO222",
            "legacySqlClass": "column"
          },
          {
            "index": 30,
            "name": "FIRST_REMAND_COURT",
            "type": "string",
            "display": "First Remand Court",
            "legacyId": "DP2.DO253",
            "legacySqlClass": "column"
          },
          {
            "index": 31,
            "name": "FIRST_CONVICTED_COURT",
            "type": "string",
            "display": "First Convicted Court",
            "legacyId": "DP2.DO254",
            "legacySqlClass": "column"
          },
          {
            "index": 32,
            "name": "V_REALLOCATED_FROM",
            "type": "string",
            "display": "V_REALLOCATED_FROM",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 33,
            "name": "V_TRANSFER_REASON",
            "type": "string",
            "display": "V_TRANSFER_REASON",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375368/DP15",
      "name": "Security Category",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, CASE WHEN AT_SEC_CAT_LAST_CHANGE_DATE.DAY_DATE < '31/12/9000' THEN AT_SEC_CAT_LAST_CHANGE_DATE.DAY_DATE ELSE NULL END AS DATE_SECURITY_CATEGORY_LAST_35, ADD_MONTHS(AT_DOB.DAY_DATE, 252) AS DATE_RE_CLASSIFIED, CASE WHEN AT_DATE_NEX_REVIEW.DAY_DATE < '31/12/9000' THEN AT_DATE_NEX_REVIEW.DAY_DATE ELSE NULL END AS DATE_OF_NEXT_REVIEW_, AT_OFFENDER_BOOKING.SUP_LEVEL_TYPE_CHANGE_REASON, CASE WHEN AT_CURRENT_SECURITY_CATEGORY.CURRENT_SEC_CAT_LEVEL IS NULL THEN 'Unclassified' ELSE AT_CURRENT_SECURITY_CATEGORY.CURRENT_SEC_CAT_LEVEL END AS CURRENT_SECURITY_CATEGORY, AT_OFFENDER_BOOKING.PREVIOUS_SUP_LEVEL_TYPE FROM BODIMIS.DIM_DATE AT_DATE_NEX_REVIEW, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_SEC_CAT_LAST_CHANGE_DATE, BODIMIS.DIM_DATE AT_DOB, BODIMIS.DIM_OFFENDER_ASSESSMENT AT_CURRENT_SECURITY_CATEGORY WHERE (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_OFFENDER_BOOKING.LAST_SUP_LEVEL_TYPE_DATE_SK = AT_SEC_CAT_LAST_CHANGE_DATE.DATE_SK) AND (AT_DATE_NEX_REVIEW.DATE_SK (+) = AT_OFFENDER_BOOKING.NEXT_SUP_LEVEL_REVIEW_DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_CURRENT_SECURITY_CATEGORY.CURRENT_SEC_CAT_FLAG (+) = 'Y') AND (AT_CURRENT_SECURITY_CATEGORY.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND ((AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = (SELECT PRISONER_NUMBER FROM prompt_ /* = #Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1) */)) AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DATE_SECURITY_CATEGORY_LAST_35, DATE_RE_CLASSIFIED, DATE_OF_NEXT_REVIEW_, SUP_LEVEL_TYPE_CHANGE_REASON, CURRENT_SECURITY_CATEGORY, PREVIOUS_SUP_LEVEL_TYPE, ESTABLISHMENT_DESCRIPTION AS V_REALLOCATED_FROM, REASON AS V_TRANSFER_REASON FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "prisoner_number",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter NOMS Number",
          "description": "@Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP15.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DATE_SECURITY_CATEGORY_LAST_35",
            "type": "date",
            "display": "Date Security Category Last Changed",
            "legacyId": "DP15.DO100e2",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "DATE_RE_CLASSIFIED",
            "type": "date",
            "display": "Date Re-Classified",
            "legacyId": "DP15.DO1010a",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "DATE_OF_NEXT_REVIEW_",
            "type": "date",
            "display": "Date Of Next Review (Security category)",
            "legacyId": "DP15.DO10103",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "SUP_LEVEL_TYPE_CHANGE_REASON",
            "type": "string",
            "display": "Reason for Change of Security Category",
            "legacyId": "DP15.DO100e3",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "CURRENT_SECURITY_CATEGORY",
            "type": "string",
            "display": "Current Security Category",
            "legacyId": "DP15.DO100e1",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "PREVIOUS_SUP_LEVEL_TYPE",
            "type": "string",
            "display": "Previous (Security) Category",
            "legacyId": "DP15.DO100e0",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "V_REALLOCATED_FROM",
            "type": "string",
            "display": "V_REALLOCATED_FROM",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 8,
            "name": "V_TRANSFER_REASON",
            "type": "string",
            "display": "V_TRANSFER_REASON",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375368/DP12",
      "name": "Scheduled Transfers",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_SCHED_EXT_MOVE_FROM.ESTABLISHMENT_DESCRIPTION, AT_SCHED_EXT_MOVE_TO.ESTABLISHMENT_DESCRIPTION AS ESTABLISHMENT_NAME_DESTINATION, AT_OFFENDER_SCHEDULE.REASON FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_ESTABLISHMENT AT_SCHED_EXT_MOVE_FROM, BODIMIS.DIM_ESTABLISHMENT AT_SCHED_EXT_MOVE_TO, BODIMIS.FACT_OFFENDER_SCHEDULE AT_OFFENDER_SCHEDULE WHERE (AT_OFFENDER_SCHEDULE.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_OFFENDER_SCHEDULE.TO_LOCATION_SK = AT_SCHED_EXT_MOVE_TO.ESTABLISHMENT_SK (+)) AND (AT_OFFENDER_SCHEDULE.FROM_LOCATION_SK = AT_SCHED_EXT_MOVE_FROM.ESTABLISHMENT_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND ((AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = (SELECT PRISONER_NUMBER FROM prompt_ /* = #Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1) */)) AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_OFFENDER_SCHEDULE.FROM_LOCATION_TYPE = 'Establishment' AND AT_OFFENDER_SCHEDULE.TO_LOCATION_TYPE = 'Establishment' AND AT_OFFENDER_SCHEDULE.TYPE = 'Transfers' AND AT_OFFENDER_SCHEDULE.OUTCOME = 'Scheduled (Approved)')), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, ESTABLISHMENT_DESCRIPTION, ESTABLISHMENT_NAME_DESTINATION, REASON, ESTABLISHMENT_DESCRIPTION AS V_REALLOCATED_FROM, REASON AS V_TRANSFER_REASON FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "prisoner_number",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter NOMS Number",
          "description": "@Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP12.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Establishment Name - Departure From",
            "legacyId": "DP12.DO104eb",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "ESTABLISHMENT_NAME_DESTINATION",
            "type": "string",
            "display": "Establishment Name - Destination",
            "legacyId": "DP12.DO104ec",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "REASON",
            "type": "string",
            "display": "Reason",
            "legacyId": "DP12.DO10694",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "V_REALLOCATED_FROM",
            "type": "string",
            "display": "V_REALLOCATED_FROM",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 5,
            "name": "V_TRANSFER_REASON",
            "type": "string",
            "display": "V_TRANSFER_REASON",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375368/DP17",
      "name": "Alerts",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, CASE WHEN AT_ALERT_EFFECT_DATE.DAY_DATE < '31/12/9000' THEN AT_ALERT_EFFECT_DATE.DAY_DATE ELSE NULL END AS ALERT_EFFECTIVE_DATE, CASE WHEN AT_ALERT_EXPIRY_DATE.DAY_DATE < '31/12/9000' THEN AT_ALERT_EXPIRY_DATE.DAY_DATE ELSE NULL END AS ALERT_EXPIRY_DATE, AT_ALERT.ALERT_CODE_NK, AT_ALERT.ALERT_DESCRIPTION, CASE WHEN AT_ALERT.ALERT_ACTIVE_FLAG = 'Y' THEN AT_ALERT.ALERT_TYPE_NK END AS ALERT_CATEGORY_CODE FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_ALERT_EFFECT_DATE, BODIMIS.DIM_DATE AT_ALERT_EXPIRY_DATE, BODIMIS.DIM_ALERT AT_ALERT, BODIMIS.FACT_OFFENDER_ALERT AT_OFFENDER_ALERT WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_OFFENDER_ALERT.OFFENDER_BOOKING_SK (+)) AND (AT_ALERT.ALERT_SK (+) = AT_OFFENDER_ALERT.ALERT_SK) AND (AT_OFFENDER_ALERT.ALERT_DATE_SK = AT_ALERT_EFFECT_DATE.DATE_SK (+)) AND (AT_OFFENDER_ALERT.ALERT_EXPIRY_DATE_SK = AT_ALERT_EXPIRY_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND ((AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = (SELECT PRISONER_NUMBER FROM prompt_ /* = #Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1) */)) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, ALERT_EFFECTIVE_DATE, ALERT_EXPIRY_DATE, ALERT_CODE_NK, ALERT_DESCRIPTION, ALERT_CATEGORY_CODE, ESTABLISHMENT_DESCRIPTION AS V_REALLOCATED_FROM, REASON AS V_TRANSFER_REASON FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "prisoner_number",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter NOMS Number",
          "description": "@Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP17.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "ALERT_EFFECTIVE_DATE",
            "type": "date",
            "display": "Alert Effective Date",
            "legacyId": "DP17.DO10095",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "ALERT_EXPIRY_DATE",
            "type": "date",
            "display": "Alert Expiry Date",
            "legacyId": "DP17.DO10096",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "ALERT_CODE_NK",
            "type": "string",
            "display": "Alert Code",
            "legacyId": "DP17.DO1008e",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "ALERT_DESCRIPTION",
            "type": "string",
            "display": "Alert Description",
            "legacyId": "DP17.DO10090",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "ALERT_CATEGORY_CODE",
            "type": "string",
            "display": "Alert Category Code",
            "legacyId": "DP17.DO10092",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "V_REALLOCATED_FROM",
            "type": "string",
            "display": "V_REALLOCATED_FROM",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 7,
            "name": "V_TRANSFER_REASON",
            "type": "string",
            "display": "V_TRANSFER_REASON",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375368/DP1b",
      "name": "MIS Load",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT BODIMIS.ETL_LOAD_LOG.BUSINESS_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT BUSINESS_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BUSINESS_DATE",
            "type": "date",
            "display": "Latest Business Date Available",
            "legacyId": "DP1b.DO104dd",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP1d",
      "name": "Key Dates",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, DT_CURR_RELEASE_NAME.CURR_RELEASE_NAME, CASE WHEN AT_HDCED_DATE.DAY_DATE < '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END AS HDC_ELIGIBILITY_DATE_, CASE WHEN AT_HDCAD_DATE.DAY_DATE < '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END AS HDC_AD_, CASE WHEN AT_SED_DATE.DAY_DATE < '31/12/9000' THEN AT_SED_DATE.DAY_DATE END AS SED_, CASE WHEN AT_LED_DATE.DAY_DATE < '31/12/9000' THEN AT_LED_DATE.DAY_DATE END AS LED_, CASE WHEN AT_NPD_DATE.DAY_DATE < '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END AS NPD_, CASE WHEN AT_PED_DATE.DAY_DATE < '31/12/9000' THEN AT_PED_DATE.DAY_DATE END AS PED_, CASE WHEN AT_APD_DATE.DAY_DATE < '31/12/9000' THEN AT_APD_DATE.DAY_DATE END AS APD_, CASE WHEN AT_PRRD_DATE.DAY_DATE < '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END AS PRRD_, CASE WHEN AT_RELEASE_DATE.DAY_DATE < '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS RELEASE_DATE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH END AS CURRENT_EFFECTIVE_SENTENCE_L33 FROM (SELECT AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK, CASE WHEN AT_OFFENDER_BOOKING.YOUNG_PERSON_INDICATOR = 'Adult' AND AT_FACT_OFFENDER_SENTENCE.APD_DATE_SK > 0 THEN 'APD' WHEN AT_OFFENDER_BOOKING.YOUNG_PERSON_INDICATOR = 'Adult' AND AT_FACT_OFFENDER_SENTENCE.NPD_DATE_SK > 0 THEN 'NPD' WHEN AT_OFFENDER_BOOKING.YOUNG_PERSON_INDICATOR = 'Adult' AND AT_FACT_OFFENDER_SENTENCE.HDCAD_DATE_SK > 0 THEN 'HDCAD' WHEN AT_OFFENDER_BOOKING.YOUNG_PERSON_INDICATOR = 'Adult' AND AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK > 0 THEN 'ARD' WHEN AT_OFFENDER_BOOKING.YOUNG_PERSON_INDICATOR = 'Adult' AND AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK > 0 THEN 'CRD' WHEN AT_OFFENDER_BOOKING.YOUNG_PERSON_INDICATOR = 'Adult' AND AT_FACT_OFFENDER_SENTENCE.PRRD_DATE_SK > 0 THEN 'PRRD' WHEN AT_OFFENDER_BOOKING.YOUNG_PERSON_INDICATOR IN ('Juvenile', 'Young Offender') AND AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT AT_OFFENDER_BOOKING_LTD.offender_booking_sk FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING_LTD, BODIMIS.DIM_SENTENCE_TYPE AT_DIM_SENTENCE_TYPE_LTD, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE_LTD, BODIMIS.DIM_COURT_CASE AT_COURT_CASE_LTD, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE_LTD WHERE AT_OFFENDER_BOOKING_LTD.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE_LTD.OFFENDER_BOOKING_SK AND AT_FACT_OFFENDER_SENTENCE_LTD.SENTENCE_CURRENT_FLAG = 'Y' AND AT_OFFENDER_BOOKING_LTD.mis_current_record_ind = 'Y' AND AT_OFFENDER_BOOKING_LTD.OFFENDER_BOOKING_SK = AT_COURT_CASE_LTD.OFFENDER_BOOKING_SK AND AT_COURT_CASE_LTD.COURT_CASE_SK = AT_FACT_SENTENCE_LTD.COURT_CASE_SK AND AT_FACT_SENTENCE_LTD.SENTENCE_TYPE_SK = AT_DIM_SENTENCE_TYPE_LTD.SENTENCE_TYPE_SK AND AT_DIM_SENTENCE_TYPE_LTD.SENTENCE_CODE_NK = 'DTO') AND AT_FACT_OFFENDER_SENTENCE.LTD_DATE_SK > 0 THEN 'LTD' WHEN AT_OFFENDER_BOOKING.YOUNG_PERSON_INDICATOR IN ('Juvenile', 'Young Offender') AND AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT AT_OFFENDER_BOOKING_ETD.offender_booking_sk FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING_ETD, BODIMIS.DIM_SENTENCE_TYPE AT_DIM_SENTENCE_TYPE_ETD, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE_ETD, BODIMIS.DIM_COURT_CASE AT_COURT_CASE_ETD, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE_ETD WHERE AT_OFFENDER_BOOKING_ETD.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE_ETD.OFFENDER_BOOKING_SK AND AT_FACT_OFFENDER_SENTENCE_ETD.SENTENCE_CURRENT_FLAG = 'Y' AND AT_OFFENDER_BOOKING_ETD.mis_current_record_ind = 'Y' AND AT_OFFENDER_BOOKING_ETD.OFFENDER_BOOKING_SK = AT_COURT_CASE_ETD.OFFENDER_BOOKING_SK AND AT_COURT_CASE_ETD.COURT_CASE_SK = AT_FACT_SENTENCE_ETD.COURT_CASE_SK AND AT_FACT_SENTENCE_ETD.SENTENCE_TYPE_SK = AT_DIM_SENTENCE_TYPE_ETD.SENTENCE_TYPE_SK AND AT_DIM_SENTENCE_TYPE_ETD.SENTENCE_CODE_NK = 'DTO') AND AT_FACT_OFFENDER_SENTENCE.ETD_DATE_SK > 0 THEN 'ETD' WHEN AT_OFFENDER_BOOKING.YOUNG_PERSON_INDICATOR IN ('Juvenile', 'Young Offender') AND AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT AT_OFFENDER_BOOKING_MTD.offender_booking_sk FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING_MTD, BODIMIS.DIM_SENTENCE_TYPE AT_DIM_SENTENCE_TYPE_MTD, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE_MTD, BODIMIS.DIM_COURT_CASE AT_COURT_CASE_MTD, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE_MTD WHERE AT_OFFENDER_BOOKING_MTD.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE_MTD.OFFENDER_BOOKING_SK AND AT_FACT_OFFENDER_SENTENCE_MTD.SENTENCE_CURRENT_FLAG = 'Y' AND AT_OFFENDER_BOOKING_MTD.mis_current_record_ind = 'Y' AND AT_OFFENDER_BOOKING_MTD.OFFENDER_BOOKING_SK = AT_COURT_CASE_MTD.OFFENDER_BOOKING_SK AND AT_COURT_CASE_MTD.COURT_CASE_SK = AT_FACT_SENTENCE_MTD.COURT_CASE_SK AND AT_FACT_SENTENCE_MTD.SENTENCE_TYPE_SK = AT_DIM_SENTENCE_TYPE_MTD.SENTENCE_TYPE_SK AND AT_DIM_SENTENCE_TYPE_MTD.SENTENCE_CODE_NK = 'DTO') AND AT_FACT_OFFENDER_SENTENCE.MTD_DATE_SK > 0 THEN 'MTD' END AS CURR_RELEASE_NAME FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE WHERE AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK AND AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y' AND AT_OFFENDER_BOOKING.mis_current_record_ind = 'Y') DT_CURR_RELEASE_NAME, BODIMIS.DIM_DATE AT_HDCED_DATE, BODIMIS.DIM_DATE AT_HDCAD_DATE, BODIMIS.DIM_DATE AT_SED_DATE, BODIMIS.DIM_DATE AT_LED_DATE, BODIMIS.DIM_DATE AT_NPD_DATE, BODIMIS.DIM_DATE AT_PED_DATE, BODIMIS.DIM_DATE AT_APD_DATE, BODIMIS.DIM_DATE AT_PRRD_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, FACT_CURR_KEY_DATES_SENT, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE WHERE (AT_FACT_OFFENDER_SENTENCE.APD_DATE_SK = AT_APD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.NPD_DATE_SK = AT_NPD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.LED_DATE_SK = AT_LED_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.SED_DATE_SK = AT_SED_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.PRRD_DATE_SK = AT_PRRD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.HDCAD_DATE_SK = AT_HDCAD_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.HDCED_DATE_SK = AT_HDCED_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK (+) = DT_CURR_RELEASE_NAME.OFFENDER_BOOKING_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = FACT_CURR_KEY_DATES_SENT.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND ((AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = (SELECT PRISONER_NUMBER FROM prompt_ /* = #Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1) */)) AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, CURR_RELEASE_NAME, HDC_ELIGIBILITY_DATE_, HDC_AD_, SED_, LED_, NPD_, PED_, APD_, PRRD_, RELEASE_DATE, CURRENT_EFFECTIVE_SENTENCE_L33, ESTABLISHMENT_DESCRIPTION AS V_REALLOCATED_FROM, REASON AS V_TRANSFER_REASON FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "prisoner_number",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter NOMS Number",
          "description": "@Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP1d.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "CURR_RELEASE_NAME",
            "type": "string",
            "display": "Current Scheduled Release Name",
            "legacyId": "DP1d.DO31d",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "HDC_ELIGIBILITY_DATE_",
            "type": "date",
            "display": "HDC Eligibility Date (Historic)",
            "legacyId": "DP1d.DO2f6",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "HDC_AD_",
            "type": "date",
            "display": "HDC AD (Approved Date) (Historical)",
            "legacyId": "DP1d.DO2f8",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "SED_",
            "type": "date",
            "display": "SED (Sentence End Date) (Historical)",
            "legacyId": "DP1d.DO302",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "LED_",
            "type": "date",
            "display": "LED (Licence Expiry Date ) (Historical)",
            "legacyId": "DP1d.DO316",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "NPD_",
            "type": "date",
            "display": "NPD (Non Parole Date) (HIstorical)",
            "legacyId": "DP1d.DO300",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "PED_",
            "type": "date",
            "display": "PED (Parole Eligibility Date) (Historical)",
            "legacyId": "DP1d.DO2fc",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "APD_",
            "type": "date",
            "display": "APD (Actual Parole Date) (Historical)",
            "legacyId": "DP1d.DO2fe",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "PRRD_",
            "type": "date",
            "display": "PRRD (Post Recall Release Date) (Historic)",
            "legacyId": "DP1d.DO89",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "RELEASE_DATE",
            "type": "date",
            "display": "Release Date",
            "legacyId": "DP1d.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "CURRENT_EFFECTIVE_SENTENCE_L33",
            "type": "string",
            "display": "Current Effective Sentence Length",
            "legacyId": "DP1d.DO2ef",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "V_REALLOCATED_FROM",
            "type": "string",
            "display": "V_REALLOCATED_FROM",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 13,
            "name": "V_TRANSFER_REASON",
            "type": "string",
            "display": "V_TRANSFER_REASON",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375368/DP1f",
      "name": "Hold Markers",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, CASE WHEN AT_ALERT.ALERT_ACTIVE_FLAG = 'Y' THEN (CASE WHEN AT_ALERT.ALERT_TYPE_NK = 'T' AND AT_ALERT.ALERT_CODE_NK IN ('TG', 'G') AND AT_OFFENDER_ALERT.ALERT_STATUS = 'ACTIVE' THEN 'Y' END) END AS GOVERNOR_CHECK_HOLD_MARKER, CASE WHEN AT_ALERT.ALERT_ACTIVE_FLAG = 'Y' THEN (CASE WHEN AT_ALERT.ALERT_TYPE_NK = 'T' AND AT_ALERT.ALERT_CODE_NK IN ('TAH') AND AT_OFFENDER_ALERT.ALERT_STATUS = 'ACTIVE' THEN 'Y' END) END AS ALLOCATION_CHECK_HOLD_MARKER, CASE WHEN AT_ALERT.ALERT_ACTIVE_FLAG = 'Y' THEN (CASE WHEN AT_ALERT.ALERT_TYPE_NK = 'T' AND AT_ALERT.ALERT_CODE_NK IN ('SE', 'TSE') AND AT_OFFENDER_ALERT.ALERT_STATUS = 'ACTIVE' THEN 'Y' END) END AS SECURITY_CHECK_HOLD_MARKER, CASE WHEN AT_ALERT.ALERT_ACTIVE_FLAG = 'Y' THEN (CASE WHEN AT_ALERT.ALERT_TYPE_NK = 'T' AND AT_ALERT.ALERT_CODE_NK IN ('TN', 'TM') AND AT_OFFENDER_ALERT.ALERT_STATUS = 'ACTIVE' THEN 'Y' END) END AS MEDICAL_CHECK_HOLD_MARKER, CASE WHEN AT_ALERT.ALERT_ACTIVE_FLAG = 'Y' THEN (CASE WHEN AT_ALERT.ALERT_TYPE_NK = 'T' AND AT_ALERT.ALERT_CODE_NK IN ('TPR') AND AT_OFFENDER_ALERT.ALERT_STATUS = 'ACTIVE' THEN 'Y' END) END AS PAROLE_CHECK_HOLD_MARKER, CASE WHEN AT_ALERT.ALERT_ACTIVE_FLAG = 'Y' THEN (CASE WHEN AT_ALERT.ALERT_TYPE_NK = 'T' AND AT_ALERT.ALERT_CODE_NK IN ('AP', 'TAP') AND AT_OFFENDER_ALERT.ALERT_STATUS = 'ACTIVE' THEN 'Y' END) END AS PROGRAM_CHECK_HOLD_MARKER FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.FACT_OFFENDER_ALERT AT_OFFENDER_ALERT, BODIMIS.DIM_ALERT AT_ALERT WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_OFFENDER_ALERT.OFFENDER_BOOKING_SK (+)) AND (AT_ALERT.ALERT_SK (+) = AT_OFFENDER_ALERT.ALERT_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND ((AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = (SELECT PRISONER_NUMBER FROM prompt_ /* = #Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1) */)) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, GOVERNOR_CHECK_HOLD_MARKER, ALLOCATION_CHECK_HOLD_MARKER, SECURITY_CHECK_HOLD_MARKER, MEDICAL_CHECK_HOLD_MARKER, PAROLE_CHECK_HOLD_MARKER, PROGRAM_CHECK_HOLD_MARKER FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "prisoner_number",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter NOMS Number",
          "description": "@Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP1f.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "GOVERNOR_CHECK_HOLD_MARKER",
            "type": "string",
            "display": "Governor Check Hold Marker",
            "legacyId": "DP1f.DO102fc",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "ALLOCATION_CHECK_HOLD_MARKER",
            "type": "string",
            "display": "Allocation Check Hold Marker",
            "legacyId": "DP1f.DO102fd",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "SECURITY_CHECK_HOLD_MARKER",
            "type": "string",
            "display": "Security Check Hold Marker",
            "legacyId": "DP1f.DO102fe",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "MEDICAL_CHECK_HOLD_MARKER",
            "type": "string",
            "display": "Medical Check Hold Marker",
            "legacyId": "DP1f.DO102ff",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "PAROLE_CHECK_HOLD_MARKER",
            "type": "string",
            "display": "Parole Check Hold Marker",
            "legacyId": "DP1f.DO10300",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "PROGRAM_CHECK_HOLD_MARKER",
            "type": "string",
            "display": "Program Check Hold Marker",
            "legacyId": "DP1f.DO10302",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP20",
      "name": "No of Cases Count",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, COUNT(DISTINCT AT_COURT_CASE.COURT_CASE_ID_NK) AS NUMBER_OF_CASES FROM BODIMIS.DIM_COURT_CASE_STATUS AT_DIM_COURT_CASE_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_COURT_CASE AT_COURT_CASE WHERE (AT_COURT_CASE.COURT_CASE_STATUS_SK = AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = (SELECT PRISONER_NUMBER FROM prompt_ /* = #Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1) */)) AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS = 'Active')) GROUP BY AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, NUMBER_OF_CASES, ESTABLISHMENT_DESCRIPTION AS V_REALLOCATED_FROM, REASON AS V_TRANSFER_REASON FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "prisoner_number",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter NOMS Number",
          "description": "@Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP20.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "NUMBER_OF_CASES",
            "type": "double",
            "display": "Number of Cases",
            "legacyId": "DP20.DO9a",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "V_REALLOCATED_FROM",
            "type": "string",
            "display": "V_REALLOCATED_FROM",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 3,
            "name": "V_TRANSFER_REASON",
            "type": "string",
            "display": "V_TRANSFER_REASON",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375368/DP21",
      "name": "First Reception Date",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, MIN(DT_FIRST_RECEPTION.DAY_DATE) AS DATE_OF_FIRST_RECEPTION FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT * FROM (SELECT m.offender_booking_sk, d.day_date, m.movement_seq, m.movement_time, ROW_NUMBER() OVER (PARTITION BY m.offender_booking_sk ORDER BY m.movement_seq) AS row_seq_filter FROM bodimis.fact_movement_external m INNER JOIN bodimis.dim_date d ON m.date_sk = d.date_sk WHERE m.direction_code = 'IN') WHERE row_seq_filter = 1) DT_FIRST_RECEPTION WHERE (DT_FIRST_RECEPTION.OFFENDER_BOOKING_SK = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = (SELECT PRISONER_NUMBER FROM prompt_ /* = #Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1) */)) AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y')) GROUP BY AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DATE_OF_FIRST_RECEPTION, ESTABLISHMENT_DESCRIPTION AS V_REALLOCATED_FROM, REASON AS V_TRANSFER_REASON FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "prisoner_number",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter NOMS Number",
          "description": "@Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP21.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DATE_OF_FIRST_RECEPTION",
            "type": "date",
            "display": "Date of First Reception",
            "legacyId": "DP21.DO25d",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "V_REALLOCATED_FROM",
            "type": "string",
            "display": "V_REALLOCATED_FROM",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 3,
            "name": "V_TRANSFER_REASON",
            "type": "string",
            "display": "V_TRANSFER_REASON",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375368/DP22",
      "name": "Appeals",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, CASE WHEN AT_DIM_COURT_EVENT_TYPE.COURT_EVENT_TYPE_CODE_NK = 'APPEAL' THEN 'Y' ELSE 'N' END AS APPELLANT FROM BODIMIS.DIM_COURT_EVENT_TYPE AT_DIM_COURT_EVENT_TYPE, BODIMIS.FACT_COURT_EVENT AT_FACT_COURT_EVENT, BODIMIS.DIM_COURT_CASE_STATUS AT_DIM_COURT_CASE_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_COURT_CASE AT_COURT_CASE WHERE (AT_FACT_COURT_EVENT.COURT_EVENT_TYPE_SK = AT_DIM_COURT_EVENT_TYPE.COURT_EVENT_TYPE_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_COURT_EVENT.COURT_CASE_SK (+)) AND (AT_COURT_CASE.COURT_CASE_STATUS_SK = AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = (SELECT PRISONER_NUMBER FROM prompt_ /* = #Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1) */)) AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS = 'Active'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, APPELLANT FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "prisoner_number",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter NOMS Number",
          "description": "@Prompt('Enter NOMS Number',,,mono,free,Not_Persistent,User:1)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP22.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "APPELLANT",
            "type": "string",
            "display": "Appellant",
            "legacyId": "DP22.DO9c",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP23",
      "name": "Adjudications",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFF_BOOK_NO_CLOAD.OFFENDER_ID_DISPLAY, COUNT(DISTINCT (AT_OFFENDER_ADJ_NO_CASELOAD.OIC_HEARING_ID_NK)) AS NUMBER_OF_ADJUDICATIONS_ FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFF_BOOK_NO_CLOAD, BODIMIS.FACT_OFFENDER_ADJUDICATION AT_OFFENDER_ADJ_NO_CASELOAD, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING WHERE (AT_OFFENDER_ADJ_NO_CASELOAD.OFFENDER_BOOKING_SK = AT_OFF_BOOK_NO_CLOAD.OFFENDER_BOOKING_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFF_BOOK_NO_CLOAD.OFFENDER_ID_DISPLAY = (SELECT PRISONER_NUMBER FROM prompt_ /* = #prompt('Enter NOMS Number','A',,Mono,Free,Not_Persistent,,User:0) */) AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_OFF_BOOK_NO_CLOAD.ACTIVE_FLAG = 'Y')) GROUP BY AT_OFF_BOOK_NO_CLOAD.OFFENDER_ID_DISPLAY), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, NUMBER_OF_ADJUDICATIONS_, ESTABLISHMENT_DESCRIPTION AS V_REALLOCATED_FROM, REASON AS V_TRANSFER_REASON FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "prisoner_number",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter NOMS Number",
          "description": "@prompt('Enter NOMS Number','A',,Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number (No Caseload)",
            "legacyId": "DP23.DO585",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "NUMBER_OF_ADJUDICATIONS_",
            "type": "double",
            "display": "Number of Adjudications (No Caseload)",
            "legacyId": "DP23.DO584",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "V_REALLOCATED_FROM",
            "type": "string",
            "display": "V_REALLOCATED_FROM",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 3,
            "name": "V_TRANSFER_REASON",
            "type": "string",
            "display": "V_TRANSFER_REASON",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "126729.RS",
      "name": "Security and Previous Convictions",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DP2",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-tab",
        "field": [
          {
            "name": "$ref:V_REALLOCATED_FROM",
            "display": "Allocation Details",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Establishment Name - Departure From]"
          },
          {
            "name": "$ref:ESTABLISHMENT_NAME_DESTINATION",
            "display": "Establishment Name - Destination",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP12.DO104ec"
          },
          {
            "name": "$ref:V_TRANSFER_REASON",
            "display": "Reallocated To",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Reason]"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_TRANSFER_REASON :: ReferenceError: error is not defined",
      "entityId": "okR1jT8ABORHOiYATBOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Report field ESTABLISHMENT_NAME_DESTINATION does not have corresponding dataset schema field",
      "entityId": "126729.RS",
      "entityType": "variant"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DP2",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DP15",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DP17",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DP1d",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DP20",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DP21",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DP23",
      "entityType": "dataset"
    }
  ]
}