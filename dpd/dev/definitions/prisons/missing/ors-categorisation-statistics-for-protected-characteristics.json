{
  "id": "FgrT_mBl8AYAdwoAAHArfV9OACJIABRd",
  "name": "ORS Categorisation Statistics for Protected Characteristics",
  "description": "This report has been created to help users monitor Categorisation Statistics for the Protected Characteristics Age, Religion and Ethnicity. It will also help the team responsible for creating the new Categorisation Tool in trends analysis.<br/>Report Code: PDD0117 Date Modified: 17/01/2020<br/><br/>PDD0117 v1.0",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "PDD0117 Categorisation Protected Characteristics"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3377299/DP0",
      "name": "Query 1",
      "description": "OR - Demographics",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, DT_CATEGORISATION.ASSESSMENT_DATE, DT_CATEGORISATION.ASSESS_STATUS, DT_APPROVED_LEVEL.DESCRIPTION, AT_OFFENDER_RELIGION.PROFILE_CODE, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END || '-' || CASE WHEN AT_ETHNICITY_DESC.CODE = 'W8' THEN 'White: Gypsy or Irish Traveller' WHEN AT_ETHNICITY_DESC.CODE = 'O1' THEN 'Asian/Asian British: Chinese' ELSE AT_ETHNICITY_DESC.DESCRIPTION END AS ETHNIC_DESCRIPTION, CASE WHEN AT_OFFENDER.SEX_CODE = 'M' THEN 'Male' WHEN AT_OFFENDER.SEX_CODE = 'F' THEN 'Female' ELSE 'Unknown' END AS GENDER_DESCRIPTION, AT_RELIGION.DESCRIPTION AS RELIGION_DESCRIPTION, DT_CATEGORISATION.PREV_REVIEW, DT_CATEGORISATION.PREV_REVIEW_DESC, DT_CATEGORISATION.assessment_create_location, AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID, DT_CATEGORISATION.create_datetime, TRUNC(MONTHS_BETWEEN(CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12) AS AGE, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END AS ETHNIC_CODE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES DT_APPROVED_LEVEL, OMS_OWNER.REFERENCE_CODES AT_ETHNICITY_DESC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_PROFILE_DETAILS AT_OFFENDER_RELIGION, (SELECT OA.*, RC.DESCRIPTION AS PREV_REVIEW_DESC FROM (SELECT oa.offender_book_id, oa.assessment_seq, oa.assess_status, oa.review_place_agy_loc_id, oa.assessment_date, oa.calc_sup_level_type, oa.overrided_sup_level_type, oa.review_sup_level_type, oa.next_review_date, rc.description AS review_sup_level_description, oa.evaluation_result_code, ROW_NUMBER() OVER (PARTITION BY oa.offender_book_id ORDER BY CASE WHEN oa.assess_status <> 'I' THEN 1 ELSE 2 END, oa.assessment_date DESC, oa.assessment_seq DESC) AS row_seq_filter, LAG(OA.REVIEW_SUP_LEVEL_TYPE) OVER (PARTITION BY OA.OFFENDER_BOOK_ID ORDER BY oa.assessment_date ASC) AS PREV_REVIEW, assessment_create_location, oa.create_datetime FROM offender_assessments oa INNER JOIN assessments a ON a.assessment_id = oa.assessment_type_id AND a.assessment_class = 'TYPE' AND a.assessment_code = 'CATEGORY' AND a.determine_sup_level_flag = 'Y' LEFT OUTER JOIN reference_codes rc ON rc.code = oa.review_sup_level_type AND rc.domain = 'SUP_LVL_TYPE') OA LEFT OUTER JOIN reference_codes rc ON rc.code = oa.PREV_REVIEW AND rc.domain = 'SUP_LVL_TYPE') DT_CATEGORISATION, OMS_OWNER.PROFILE_CODES AT_RELIGION WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_ETHNICITY_DESC.DOMAIN (+) = 'ETHNICITY') AND (AT_ETHNICITY_DESC.CODE (+) = AT_OFFENDER.RACE_CODE) AND (AT_OFFENDER_RELIGION.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_RELIGION.PROFILE_TYPE (+) = 'RELF') AND (AT_RELIGION.PROFILE_CODE (+) = AT_OFFENDER_RELIGION.PROFILE_CODE) AND (AT_RELIGION.PROFILE_TYPE (+) = AT_OFFENDER_RELIGION.PROFILE_TYPE) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_CATEGORISATION.OFFENDER_BOOK_ID (+)) AND (DT_CATEGORISATION.REVIEW_SUP_LEVEL_TYPE = DT_APPROVED_LEVEL.CODE (+)) AND (DT_APPROVED_LEVEL.DOMAIN (+) = 'SUP_LVL_TYPE') AND (NOT DT_APPROVED_LEVEL.DESCRIPTION IS NULL AND DT_CATEGORISATION.ASSESSMENT_DATE BETWEEN TO_DATE('19-07-2021 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND TO_DATE('23-07-2021 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND DT_CATEGORISATION.ASSESSMENT_CREATE_LOCATION IN ((SELECT establishment_code FROM prompt_)))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, ASSESSMENT_DATE, ASSESS_STATUS, DESCRIPTION, PROFILE_CODE, ETHNIC_DESCRIPTION, GENDER_DESCRIPTION, RELIGION_DESCRIPTION, PREV_REVIEW, PREV_REVIEW_DESC, ASSESSMENT_CREATE_LOCATION, OFFENDER_BOOK_ID, CREATE_DATETIME, AGE, ETHNIC_CODE, COUNT(OFFENDER_ID_DISPLAY) AS V_COUNT_NOMS_ALL FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP0.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "ASSESSMENT_DATE",
            "type": "date",
            "display": "Assessment Date",
            "legacyId": "DP0.DO100a",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "ASSESS_STATUS",
            "type": "string",
            "display": "Assessment Status",
            "legacyId": "DP0.DO10e5",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Approved Result",
            "legacyId": "DP0.DO1012",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "PROFILE_CODE",
            "type": "string",
            "display": "Religion",
            "legacyId": "DP0.DOb0",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "ETHNIC_DESCRIPTION",
            "type": "string",
            "display": "Ethnic Description",
            "legacyId": "DP0.DO9d",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "GENDER_DESCRIPTION",
            "type": "string",
            "display": "Gender Description",
            "legacyId": "DP0.DOae",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "RELIGION_DESCRIPTION",
            "type": "string",
            "display": "Religion Description",
            "legacyId": "DP0.DOc29",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "PREV_REVIEW",
            "type": "string",
            "display": "Dummy 1",
            "legacyId": "DP0.DO1052",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "PREV_REVIEW_DESC",
            "type": "string",
            "display": "Dummy 2",
            "legacyId": "DP0.DO1053",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "ASSESSMENT_CREATE_LOCATION",
            "type": "string",
            "display": "Dummy 3",
            "legacyId": "DP0.DO1054",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "OFFENDER_BOOK_ID",
            "type": "double",
            "display": "Offender Book Id (all bookings)",
            "legacyId": "DP0.DOb95",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "CREATE_DATETIME",
            "type": "date",
            "display": "Dummy 9 - Date",
            "legacyId": "DP0.DO105a",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "AGE",
            "type": "double",
            "display": "Age",
            "legacyId": "DP0.DO72",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "ETHNIC_CODE",
            "type": "string",
            "display": "Ethnic Code",
            "legacyId": "DP0.DO88",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "V_COUNT_NOMS_ALL",
            "type": "string",
            "display": "V_COUNT_NOMS_ALL",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "175341.RS",
      "name": "Summary - ReCats",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP0",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE DUMMY_2 IS NOT NULL)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-tab",
        "field": [
          {
            "name": "$ref:V_COUNT_NOMS_ALL",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([NOMS Number];All)"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Approved Result",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO1012"
          },
          {
            "name": "$ref:V_RELIGION",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([Religion] InList(\"ADV\";\"APO\";\"BAPT\";\"CALV\";\"CCOG\";\"CE\";\"CHRST\";\"CHSC\";\"CINW\";\"COFE\";\"COFI\";\"COFN\";\"COFS\";\"CONG\";\"COPT\";\"CSW\";\"EODX\";\"EORTH\";\"EPIS\";\"ETHO\";\n\"EVAN\";\"GOSP\";\"GROX\";\"JEHV\";\"LUTH\";\"METH\";\"MORM\";\"NONC\";\"OORTH\";\"PENT\";\"PRES\";\"PROT\";\"QUAK\";\"RC\";\"RUSS\";\"SALV\";\"SDAY\";\n\"UNIF\";\"UNIT\";\"UR\";\"WELS\");\"Christian\";\nIf([Religion] InList (\"BLAC\";\"MOS\";\"SHIA\";\"SUNI\");\"Muslim\";\nIf([Religion] InList (\"AGNO\";\"ATHE\";\"NIL\");\"No Religion\";\nIf([Religion] InList (\"BUDD\");\"Buddhist\";\nIf([Religion] InList(\"HARE\";\"HIND\");\"HINDU\";\nIf([Religion] InList(\"JEW\"); \"Jewish\";\nIf([Religion] InList(\"SIKH\");\"Sikh\";\nIf(([Religion] InList(\"SCIE\";\"BAHA\";\"DRU\";\"HUM\";\"JAIN\";\"NONP\";\"OTH\";\"PAG\";\"RAST\";\"SHIN\";\"SPIR\";\"TAO\";\"UNKN\";\"ZORO\") Or IsNull([Religion])) ; \"Other\";\n\"unaccounted\"))))))))\n"
          }
        ]
      }
    },
    {
      "id": "182105.RS",
      "name": "Summary - Initial Cats",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP0",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE DUMMY_2 IS NULL)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-tab",
        "field": [
          {
            "name": "$ref:V_COUNT_NOMS_ALL",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([NOMS Number];All)"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Approved Result",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO1012"
          },
          {
            "name": "$ref:V_RELIGION",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([Religion] InList(\"ADV\";\"APO\";\"BAPT\";\"CALV\";\"CCOG\";\"CE\";\"CHRST\";\"CHSC\";\"CINW\";\"COFE\";\"COFI\";\"COFN\";\"COFS\";\"CONG\";\"COPT\";\"CSW\";\"EODX\";\"EORTH\";\"EPIS\";\"ETHO\";\n\"EVAN\";\"GOSP\";\"GROX\";\"JEHV\";\"LUTH\";\"METH\";\"MORM\";\"NONC\";\"OORTH\";\"PENT\";\"PRES\";\"PROT\";\"QUAK\";\"RC\";\"RUSS\";\"SALV\";\"SDAY\";\n\"UNIF\";\"UNIT\";\"UR\";\"WELS\");\"Christian\";\nIf([Religion] InList (\"BLAC\";\"MOS\";\"SHIA\";\"SUNI\");\"Muslim\";\nIf([Religion] InList (\"AGNO\";\"ATHE\";\"NIL\");\"No Religion\";\nIf([Religion] InList (\"BUDD\");\"Buddhist\";\nIf([Religion] InList(\"HARE\";\"HIND\");\"HINDU\";\nIf([Religion] InList(\"JEW\"); \"Jewish\";\nIf([Religion] InList(\"SIKH\");\"Sikh\";\nIf(([Religion] InList(\"SCIE\";\"BAHA\";\"DRU\";\"HUM\";\"JAIN\";\"NONP\";\"OTH\";\"PAG\";\"RAST\";\"SHIN\";\"SPIR\";\"TAO\";\"UNKN\";\"ZORO\") Or IsNull([Religion])) ; \"Other\";\n\"unaccounted\"))))))))\n"
          }
        ]
      }
    },
    {
      "id": "181131.RS",
      "name": "Religion - ReCats",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE DUMMY_2 IS NOT NULL)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      }
    },
    {
      "id": "172204.RS",
      "name": "Religion - Initial Cats",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE DUMMY_2 IS NULL)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      }
    },
    {
      "id": "172250.RS",
      "name": "Ethnicity - ReCats",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE DUMMY_2 IS NOT NULL)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      }
    },
    {
      "id": "172291.RS",
      "name": "Ethnicity - Initial Cats",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE DUMMY_2 IS NULL)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      }
    },
    {
      "id": "172368.RS",
      "name": "Age Bands - ReCats",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE DUMMY_2 IS NOT NULL)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      }
    },
    {
      "id": "172508.RS",
      "name": "Age Band - Initial Cats",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE DUMMY_2 IS NULL)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : V_RELIGION :: Error: argument 'sql': 'NoneType' object cannot be converted to 'PyString'",
      "entityId": "FgrT_mBl8AYAdwoAAHArfV9OACJIABRd",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[2] requires property \"dataset\"",
      "entityId": "FgrT_mBl8AYAdwoAAHArfV9OACJIABRd",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[3] requires property \"dataset\"",
      "entityId": "FgrT_mBl8AYAdwoAAHArfV9OACJIABRd",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[4] requires property \"dataset\"",
      "entityId": "FgrT_mBl8AYAdwoAAHArfV9OACJIABRd",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[5] requires property \"dataset\"",
      "entityId": "FgrT_mBl8AYAdwoAAHArfV9OACJIABRd",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[6] requires property \"dataset\"",
      "entityId": "FgrT_mBl8AYAdwoAAHArfV9OACJIABRd",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[7] requires property \"dataset\"",
      "entityId": "FgrT_mBl8AYAdwoAAHArfV9OACJIABRd",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Report field V_RELIGION does not have corresponding dataset schema field",
      "entityId": "175341.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_RELIGION does not have corresponding dataset schema field",
      "entityId": "182105.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report Variant 181131.RS does not have corresponding dataset undefined",
      "entityId": "181131.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report Variant 172204.RS does not have corresponding dataset undefined",
      "entityId": "172204.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report Variant 172250.RS does not have corresponding dataset undefined",
      "entityId": "172250.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report Variant 172291.RS does not have corresponding dataset undefined",
      "entityId": "172291.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report Variant 172368.RS does not have corresponding dataset undefined",
      "entityId": "172368.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report Variant 172508.RS does not have corresponding dataset undefined",
      "entityId": "172508.RS",
      "entityType": "variant"
    }
  ]
}