{
  "id": "okR1aKsABwZuOiYALhOD8K7B_Qc",
  "name": "MIS Incidents by Incident Type and Month",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "INC0006 v00.00.05 drop9.1_9.2"
    ]
  },
  "description": "Outputs in the form of a matrix the total number of reportable incidents for a period of twelve months starting from a user specified date.  Please note that if the current date was 15 December 2008 and the user chose the start date of 15 November 2008 it would only return one month because there is no future data.<br/>INC0006 v00.00.05 Last Modified: 20/01/09                   ",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3375377/DP2",
      "name": "Incidents by Incident Type and Month",
      "description": "MIS Incidents",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT COUNT(DISTINCT (AT_INCIDENT.INCIDENT_CASE_ID)) AS NUMBER_OF_INCIDENTS, TO_DATE('01/' || TO_CHAR(AT_INCIDENT_DATE.DAY_DATE, 'MM/YYYY'), 'DD/MM/YYYY') AS 1ST_OF_THE_MONTH, INITCAP(AT_INCIDENT_TYPE.INCIDENT_TYPE_DESC) AS INCIDENT_TYPE FROM BODIMIS.FACT_INCIDENT AT_INCIDENT, BODIMIS.DIM_INCIDENT_STATUS AT_INCIDENT_STATUS, BODIMIS.DIM_DATE AT_INCIDENT_DATE, BODIMIS.DIM_INCIDENT_TYPE AT_INCIDENT_TYPE WHERE (AT_INCIDENT.INCIDENT_STATUS_SK = AT_INCIDENT_STATUS.INCIDENT_STATUS_SK) AND (AT_INCIDENT_DATE.DATE_SK = AT_INCIDENT.INCIDENT_DATE_SK) AND (AT_INCIDENT_STATUS.INCIDENT_STATUS_ID_NK <> 'DUP') AND (AT_INCIDENT_TYPE.INCIDENT_TYPE_SK = AT_INCIDENT.INCIDENT_TYPE_SK) AND (AT_INCIDENT_STATUS.INCIDENT_STATUS_ID_NK <> 'DUP') AND (TO_DATE(TO_CHAR(AT_INCIDENT_DATE.DAY_DATE, 'DD/MM/YYYY'), 'DD/MM/YYYY') >= TO_DATE('01/' || TO_CHAR(TO_DATE(SUBSTR(TO_DATE('20-06-2006 00:00:00', 'DD-MM-YYYY HH24:MI:SS'), 4, 7), 'MM/YYYY'), 'MM/YYYY'), 'DD/MM/YYYY') AND TO_DATE(TO_CHAR(AT_INCIDENT_DATE.DAY_DATE, 'DD/MM/YYYY'), 'DD/MM/YYYY') <= (TO_DATE('01/' || TO_CHAR(ADD_MONTHS(TO_DATE('20-06-2006 00:00:00', 'DD-MM-YYYY HH24:MI:SS'), 12), 'MM/YYYY'), 'DD/MM/YYYY') - 1)) GROUP BY TO_DATE('01/' || TO_CHAR(AT_INCIDENT_DATE.DAY_DATE, 'MM/YYYY'), 'DD/MM/YYYY'), INITCAP(AT_INCIDENT_TYPE.INCIDENT_TYPE_DESC)), dataset_ AS (SELECT FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": []
      }
    },
    {
      "id": "3375377/DP4",
      "name": "MIS Load",
      "description": "MIS Incidents",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT TRUNC(BODIMIS.ETL_LOAD_LOG.LOAD_END_DATETIME) AS LOAD_END_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT LOAD_END_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "LOAD_END_DATE",
            "type": "date",
            "display": "Load End Date",
            "legacyId": "DP4.DO104dd",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375377/DP5",
      "name": "First day of Month (Prompt)",
      "description": "MIS Incidents",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT TO_DATE('01/' || TO_CHAR(TO_DATE(SUBSTR(TO_DATE('20-06-2006 00:00:00', 'DD-MM-YYYY HH24:MI:SS'), 4, 7), 'MM/YYYY'), 'MM/YYYY'), 'DD/MM/YYYY') AS LOWER_NEXT_12_MONTHS_ FROM BODIMIS.DIM_DATE AT_INCIDENT_DATE), dataset_ AS (SELECT LOWER_NEXT_12_MONTHS_ FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "LOWER_NEXT_12_MONTHS_",
            "type": "date",
            "display": "lower (from 1st) next 12 months (Prompt date)",
            "legacyId": "DP5.DO73d",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375377/DP6",
      "name": "All Incidents",
      "description": "MIS Incidents",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT InitCap(DT_ALL_INCIDENTS.INCIDENT_TYPE_DESC) FROM ( -- THIS TABLE RETURNS A CARTESIAN PRODUCT THAT SHOWS ALL INCIDENTS MAPPED TO ALL ESTABLISHMENTS. -- ITS PURPOSE IS TO FACILITATE A CROSS TAB FORMAT IN INC0001 (I.E. DISPLAY A COUNT OF ZERO AGAINST AN INCIDENT THAT HAS NO OCCOURED IN A PARTICULAR ESTABLISHMENT SELECT DISTINCT a.INCIDENT_TYPE_CODE_NK, a.INCIDENT_TYPE_DESC, b.ESTABLISHMENT_CODE_NK, b.ESTABLISHMENT_DESCRIPTION, b.AREA_DESCRIPTION FROM BODIMIS.DIM_INCIDENT_TYPE a, BODIMIS.DIM_ESTABLISHMENT b WHERE b.ESTABLISHMENT_SK > 0 AND b.AREA_DESCRIPTION != ('Unknown') AND b.ACTIVE_FLAG = 'Y' AND a.INCIDENT_TYPE_SK > 0 ) DT_ALL_INCIDENTS), dataset_ AS (SELECT FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": []
      }
    },
    {
      "id": "3375377/DP7",
      "name": "All Dates",
      "description": "MIS Incidents",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT TO_DATE('01/' || TO_CHAR(AT_INCIDENT_DATE.DAY_DATE, 'MM/YYYY'), 'DD/MM/YYYY') AS 1ST_OF_THE_MONTH FROM BODIMIS.DIM_DATE AT_INCIDENT_DATE WHERE (TO_DATE(TO_CHAR(AT_INCIDENT_DATE.DAY_DATE, 'DD/MM/YYYY'), 'DD/MM/YYYY') >= TO_DATE('01/' || TO_CHAR(TO_DATE(SUBSTR(TO_DATE('20-06-2006 00:00:00', 'DD-MM-YYYY HH24:MI:SS'), 4, 7), 'MM/YYYY'), 'MM/YYYY'), 'DD/MM/YYYY') AND TO_DATE(TO_CHAR(AT_INCIDENT_DATE.DAY_DATE, 'DD/MM/YYYY'), 'DD/MM/YYYY') <= (TO_DATE('01/' || TO_CHAR(ADD_MONTHS(TO_DATE('20-06-2006 00:00:00', 'DD-MM-YYYY HH24:MI:SS'), 12), 'MM/YYYY'), 'DD/MM/YYYY') - 1))), dataset_ AS (SELECT FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": []
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "134553.RS",
      "name": "Incidents by Incident Type and Month",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375377/DP2",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "crosstab",
        "field": [
          {
            "name": "$ref:DP2_DOC9",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::fixSqlFormatting sql is not valid [Expected table name but got None. Line 1, Col: 67.\n  SELECT DISTINCT InitCap(DT_ALL_INCIDENTS.INCIDENT_TYPE_DESC) FROM \u001b[4m(\u001b[0m -- THIS TABLE RETURNS A CARTESIAN PRODUCT THAT SHOWS ALL INCIDENTS MAPPED TO ALL ESTABLISHMENTS. --]",
      "entityId": "okR1aKsABwZuOiYALhOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[0].specification.template is not one of enum values: list,list-section,list-tab,summary,summary-section,parent-child,parent-child-section",
      "entityId": "okR1aKsABwZuOiYALhOD8K7B_Qc",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Report field DP2_DOC9 does not have corresponding dataset schema field",
      "entityId": "134553.RS",
      "entityType": "variant"
    },
    {
      "type": "athenQuery",
      "error": "unable to generate test sql",
      "entityId": "3375377/DP2",
      "entityType": "dataset"
    }
  ]
}