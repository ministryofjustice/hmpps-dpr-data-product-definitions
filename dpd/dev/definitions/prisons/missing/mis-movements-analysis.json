{
  "id": "klICWZ0AA9vBZ04A9v8AFE.rcVQ",
  "name": "MIS Movements Analysis",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "HQ9017"
    ]
  },
  "description": "HQ9017 v1.0 This report returns the number of movements by type of movement and the legal status or sentence band of the prisoners. Can be run for one, multiple or All establishments.",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3375368/DP2",
      "name": "Receptions and Discharges",
      "description": "MIS Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_ESTABLISHMENT_EXT_MOV_TO.ESTABLISHMENT_DESCRIPTION, AT_FACT_MOV_EXT.MOVEMENT_TIME, AT_DIM_DATE_EXT_MOV.DAY_DATE, AT_FACT_MOV_EXT.REASON_CODE, AT_FACT_MOV_EXT.TYPE, AT_FACT_MOV_EXT.DIRECTION_CODE, AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Lifer' WHEN SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) = '99' THEN 'Lifer' WHEN DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH = '00/00/00' THEN 'No sentence' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) = '00' AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 4, 2)) < 6 THEN 'Less than 6 Months' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) = '00' AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 4, 2)) < 12 THEN '6 Months to less than 1 Year' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) <> '00' AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) < 2 THEN '1 Year to less than 2 Years' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND NOT SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) IN ('00', '01') AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) < 3 THEN '2 Years to less than 3 Years' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND NOT SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) IN ('00', '01', '02') AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) < 4 THEN '3 Years to less than 4 Years' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND NOT SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) IN ('00', '01', '02', '03') AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) < 10 THEN '4 Years to less than 10 Years' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) >= 10 THEN '10 Years or more and Less than Life' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH IS NULL THEN 'No sentence' ELSE 'Not Categorised' END AS CURRENT_SENTENCE_LENGTH_BAND, CASE WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('LR_HDC', 'LR_ES', 'LR_YOI', 'LR_LIFE', 'LR_S53', 'LR_S53_2', 'LR_DPP', 'LR_EPP', 'LR_IPP') THEN 'Recall' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'LR' THEN 'Recall' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'DLF' THEN 'Sentenced' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('A_CFINE', 'CIV_RMD', 'CIVIL', 'CIVIL_CON', 'CIVIL_DT', 'YO_CFINE', 'YOC_CONT') THEN 'Civil prisoners' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('RX', 'S35MHA', 'S36MHA', 'S37MHA', 'S48MHA', 'SEC43', 'TRL', 'BOBC', 'UNFIT', 'SINE_DIE') THEN 'Remand' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('DET', 'DEPORT', 'EXTRAD', 'REC_DEP') THEN 'Detainee' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('BOAR', 'BOBC', 'JR', 'LR', 'REFER', 'S38MHA', 'S41MHA', 'S43MHA', 'S45MHA', 'SEC10_3', 'SEC17_3', 'SEC18_2', 'SEC19_3B', 'SEC2_1', 'SEC24_2A', 'SEC30', 'SEC37', 'SEC38', 'SEC39', 'SEC42', 'SEC45', 'SEC5', 'SEC56', 'SEC6', 'SEC6_4', 'SEC6B', 'SEC8_6', 'UNK_CONV') THEN 'Convicted unsentenced' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('A_FINE', 'A_FINE1', 'A_FINE2', 'AFIXED', 'CFLIFE', 'CJCON08', 'CUSTPLUS', 'DEATH', 'DIED', 'DTO', 'DTTO', 'DTO_YOI', 'DTOR_104', 'DTOR_105', 'EXSENT', 'EXSENT03', 'EXSENT08', 'FTR/08', 'HMP', 'INT_CUST', 'IPP', 'L_W', 'LIFE', 'PPEXT_SENT', 'S47MHA', 'SEC53', 'SEC53_2', 'SEC90', 'SEC90_03', 'SEC91', 'SEC91_03', 'SEC93', 'SEC93_03', 'SEC94', 'SENT', 'SENT_EXL', 'SENT03', 'SENTCJ03', 'YOFINE', 'YOFINE1', 'YOFINE2', 'YOFIXED', (SELECT establishment_code FROM prompt_), 'UNK_SENT', 'MLP', 'ALP', 'DLP', 'DPP', 'HMPL') THEN 'Sentenced' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE FROM BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_TO, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT BODIMIS.FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, BODIMIS.FACT_OFFENDER_SENTENCE.EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.FACT_OFFENDER_SENTENCE WHERE (BODIMIS.FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y')) DT_CURREFFSENLEN, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURREFFSENLEN.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (AT_ESTABLISHMENT_EXT_MOV_TO.ESTABLISHMENT_SK (+) = AT_FACT_MOV_EXT.TO_LOCATION_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND (CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6 OR CSL.ENDYEAR = '2999'))) AND (AT_DIM_DATE_EXT_MOV.DAY_DATE >= (SELECT START_DATE FROM prompt_ /* = #prompt('Enter Movement Start Date','D',,Mono,Free,Not_Persistent,,User:0) */) AND AT_DIM_DATE_EXT_MOV.DAY_DATE <= (SELECT END_DATE FROM prompt_ /* = #prompt('Enter Movement End Date','D',,Mono,Free,Not_Persistent,,User:1) */) AND (1 = 1) AND AT_FACT_MOV_EXT.DIRECTION_CODE = 'IN' AND AT_ESTABLISHMENT_EXT_MOV_TO.ESTABLISHMENT_CODE_NK IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #prompt('Enter Establishment Code(s)','A','External Movements\\Movement Location To Code (External)',Multi,Free,Persistent,,User:2) */)) UNION SELECT AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION, AT_FACT_MOV_EXT.MOVEMENT_TIME, AT_DIM_DATE_EXT_MOV.DAY_DATE, AT_FACT_MOV_EXT.REASON_CODE, AT_FACT_MOV_EXT.TYPE, AT_FACT_MOV_EXT.DIRECTION_CODE, AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Lifer' WHEN SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) = '99' THEN 'Lifer' WHEN DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH = '00/00/00' THEN 'No sentence' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) = '00' AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 4, 2)) < 6 THEN 'Less than 6 Months' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) = '00' AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 4, 2)) < 12 THEN '6 Months to less than 1 Year' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) <> '00' AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) < 2 THEN '1 Year to less than 2 Years' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND NOT SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) IN ('00', '01') AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) < 3 THEN '2 Years to less than 3 Years' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND NOT SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) IN ('00', '01', '02') AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) < 4 THEN '3 Years to less than 4 Years' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND NOT SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2) IN ('00', '01', '02', '03') AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) < 10 THEN '4 Years to less than 10 Years' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND TO_NUMBER(SUBSTR(DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) >= 10 THEN '10 Years or more and Less than Life' WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG IS NULL AND DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH IS NULL THEN 'No sentence' ELSE 'Not Categorised' END AS CURRENT_SENTENCE_LENGTH_BAND, CASE WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('LR_HDC', 'LR_ES', 'LR_YOI', 'LR_LIFE', 'LR_S53', 'LR_S53_2', 'LR_DPP', 'LR_EPP', 'LR_IPP') THEN 'Recall' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'LR' THEN 'Recall' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'DLF' THEN 'Sentenced' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('A_CFINE', 'CIV_RMD', 'CIVIL', 'CIVIL_CON', 'CIVIL_DT', 'YO_CFINE', 'YOC_CONT') THEN 'Civil prisoners' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('RX', 'S35MHA', 'S36MHA', 'S37MHA', 'S48MHA', 'SEC43', 'TRL', 'BOBC', 'UNFIT', 'SINE_DIE') THEN 'Remand' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('DET', 'DEPORT', 'EXTRAD', 'REC_DEP') THEN 'Detainee' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('BOAR', 'BOBC', 'JR', 'LR', 'REFER', 'S38MHA', 'S41MHA', 'S43MHA', 'S45MHA', 'SEC10_3', 'SEC17_3', 'SEC18_2', 'SEC19_3B', 'SEC2_1', 'SEC24_2A', 'SEC30', 'SEC37', 'SEC38', 'SEC39', 'SEC42', 'SEC45', 'SEC5', 'SEC56', 'SEC6', 'SEC6_4', 'SEC6B', 'SEC8_6', 'UNK_CONV') THEN 'Convicted unsentenced' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('A_FINE', 'A_FINE1', 'A_FINE2', 'AFIXED', 'CFLIFE', 'CJCON08', 'CUSTPLUS', 'DEATH', 'DIED', 'DTO', 'DTTO', 'DTO_YOI', 'DTOR_104', 'DTOR_105', 'EXSENT', 'EXSENT03', 'EXSENT08', 'FTR/08', 'HMP', 'INT_CUST', 'IPP', 'L_W', 'LIFE', 'PPEXT_SENT', 'S47MHA', 'SEC53', 'SEC53_2', 'SEC90', 'SEC90_03', 'SEC91', 'SEC91_03', 'SEC93', 'SEC93_03', 'SEC94', 'SENT', 'SENT_EXL', 'SENT03', 'SENTCJ03', 'YOFINE', 'YOFINE1', 'YOFINE2', 'YOFIXED', (SELECT establishment_code FROM prompt_), 'UNK_SENT', 'MLP', 'ALP', 'DLP', 'DPP', 'HMPL') THEN 'Sentenced' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE FROM BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT BODIMIS.FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, BODIMIS.FACT_OFFENDER_SENTENCE.EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.FACT_OFFENDER_SENTENCE WHERE (BODIMIS.FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y')) DT_CURREFFSENLEN, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURREFFSENLEN.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK (+) = AT_FACT_MOV_EXT.FROM_LOCATION_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND (CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6 OR CSL.ENDYEAR = '2999'))) AND (AT_DIM_DATE_EXT_MOV.DAY_DATE >= (SELECT START_DATE FROM prompt_ /* = #prompt('Enter Movement Start Date','D',,Mono,Free,Not_Persistent,,User:0) */) AND AT_DIM_DATE_EXT_MOV.DAY_DATE <= (SELECT END_DATE FROM prompt_ /* = #prompt('Enter Movement End Date','D',,Mono,Free,Not_Persistent,,User:1) */) AND (1 = 1) AND AT_FACT_MOV_EXT.DIRECTION_CODE = 'OUT' AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_CODE_NK IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #prompt('Enter Establishment Code(s)','A','External Movements\\Movement Location From Code (External)',Multi,Free,Persistent,,User:3) */))), dataset_ AS (SELECT ESTABLISHMENT_DESCRIPTION, MOVEMENT_TIME, DAY_DATE, REASON_CODE, TYPE, DIRECTION_CODE, OFFENDER_ID_DISPLAY, EFFECTIVE_SENTENCE_LENGTH, CURRENT_SENTENCE_LENGTH_BAND, LEGAL_STATUS_GROUPING, MAIN_LEGAL_STATUS_CODE, COUNT(MOVEMENT_TIME) AS VMOVEMENTCOUNT FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Movement Start Date",
          "description": "@prompt('Enter Movement Start Date','D',,Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Movement End Date",
          "description": "@prompt('Enter Movement End Date','D',,Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@prompt('Enter Establishment Code(s)','A','External Movements\\Movement Location To Code (External)',Multi,Free,Persistent,,User:2)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Movement Location To Description (External)",
            "legacyId": "DP2.DO1015e",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Movement Date and Time (External)",
            "legacyId": "DP2.DO103eb",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date Only (External)",
            "legacyId": "DP2.DO1015c",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "REASON_CODE",
            "type": "string",
            "display": "Movement Reason Code (External)",
            "legacyId": "DP2.DO103fc",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "TYPE",
            "type": "string",
            "display": "Movement Type (External)",
            "legacyId": "DP2.DO103ec",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "DIRECTION_CODE",
            "type": "string",
            "display": "Movement Direction Code (External)",
            "legacyId": "DP2.DO103fd",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP2.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DP2.DO2d0",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "CURRENT_SENTENCE_LENGTH_BAND",
            "type": "string",
            "display": "Current Sentence Length Band",
            "legacyId": "DP2.DO1ef",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DP2.DO107cb",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "MAIN_LEGAL_STATUS_CODE",
            "type": "string",
            "display": "Main Legal Status Code",
            "legacyId": "DP2.DO100de",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "VMOVEMENTCOUNT",
            "type": "string",
            "display": "VMOVEMENTCOUNT",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375368/DP3",
      "name": "Load End Date",
      "description": "MIS Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT TRUNC(BODIMIS.ETL_LOAD_LOG.LOAD_END_DATETIME) AS MIS_LOAD_LOG_LOAD_END_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT MIS_LOAD_LOG_LOAD_END_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "MIS_LOAD_LOG_LOAD_END_DATE",
            "type": "date",
            "display": "MIS Load Log.Load End Date",
            "legacyId": "DP3.DO104dd",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "138029.RS",
      "name": "By Legal Status",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DP2",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:VMOVEMENTCOUNT",
            "display": "=If([Movement Type (External)]=\"Temporary Absence / Home Leave\";\"TAP\";If([Movement Type (External)]=\"Transfers\";\"TRN\";If([Movement Type (External)]=\"Admission\";\"ADM\";[Movement Type (External)])))",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([Movement Date and Time (External)];All)"
          },
          {
            "name": "$ref:DIRECTION_CODE",
            "display": "Movement Direction Code (External)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO103fd"
          },
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Movement Location To Description (External)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO1015e"
          },
          {
            "name": "$ref:DAY_DATE",
            "display": "Movement Date Only (External)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO1015c"
          },
          {
            "name": "$ref:LEGAL_STATUS_GROUPING",
            "display": "Legal Status Grouping",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO107cb"
          }
        ]
      }
    },
    {
      "id": "138502.RS",
      "name": "By Sentence Band",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DP2",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:VMOVEMENTCOUNT",
            "display": "=If([Movement Type (External)]=\"Temporary Absence / Home Leave\";\"TAP\";If([Movement Type (External)]=\"Transfers\";\"TRN\";If([Movement Type (External)]=\"Admission\";\"ADM\";[Movement Type (External)])))",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([Movement Date and Time (External)];All)"
          },
          {
            "name": "$ref:DIRECTION_CODE",
            "display": "Movement Direction Code (External)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO103fd"
          },
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Movement Location To Description (External)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO1015e"
          },
          {
            "name": "$ref:DAY_DATE",
            "display": "Movement Date Only (External)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO1015c"
          },
          {
            "name": "$ref:CURRENT_SENTENCE_LENGTH_BAND",
            "display": "Current Sentence Length Band",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO1ef"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "schema",
      "error": "instance.report[0].specification.template is not one of enum values: list,list-section,list-tab,summary,summary-section,parent-child,parent-child-section",
      "entityId": "klICWZ0AA9vBZ04A9v8AFE.rcVQ",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[1].specification.template is not one of enum values: list,list-section,list-tab,summary,summary-section,parent-child,parent-child-section",
      "entityId": "klICWZ0AA9vBZ04A9v8AFE.rcVQ",
      "entityType": "dpd"
    }
  ]
}