{
  "id": "Fiqxb13CcAkAy.MAAHBr3F4KACJIAFe4",
  "name": "MIS Visits Intelligence Report",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "VIS0023 v00.01.00"
    ]
  },
  "description": "Allows you to search by Visitor, using optional prompts on Person ID, First Name, Surname and Street Name.  Please note different results may apear when using capitals and lower case so please try both.  Please note, as Caseload Security is applied, visitors will not appear here if the Prisoner has been released.<br/><br/>VIS0023- v00.00.01 Last Modified: 04/09/19",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3375956/DP4",
      "name": "All Associations",
      "description": "MIS - Visits",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DT_OFFENDER_CONTACT_ADDRESS.PERSON_ID, DT_OFFENDER_CONTACT_ADDRESS.LAST_NAME, DT_OFFENDER_CONTACT_ADDRESS.FIRST_NAME, AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.INITIALS, DT_OFFENDER_CONTACT_ADDRESS.RELATIONSHIP, AT_OFFENDER_BOOKING.ACTIVE_STATUS, DT_OFFENDER_CONTACT_ADDRESS.STREET, DT_OFFENDER_CONTACT_ADDRESS.locality || (CASE WHEN DT_OFFENDER_CONTACT_ADDRESS.locality IS NULL THEN DT_OFFENDER_CONTACT_ADDRESS.city WHEN NOT DT_OFFENDER_CONTACT_ADDRESS.locality IS NULL AND DT_OFFENDER_CONTACT_ADDRESS.city IS NULL THEN NULL WHEN DT_OFFENDER_CONTACT_ADDRESS.locality IS NULL AND DT_OFFENDER_CONTACT_ADDRESS.city IS NULL THEN NULL WHEN NOT DT_OFFENDER_CONTACT_ADDRESS.locality IS NULL THEN ', ' || DT_OFFENDER_CONTACT_ADDRESS.city ELSE ', ' || DT_OFFENDER_CONTACT_ADDRESS.city END) || (CASE WHEN NOT DT_OFFENDER_CONTACT_ADDRESS.county IS NULL AND NOT DT_OFFENDER_CONTACT_ADDRESS.city IS NULL THEN ', ' || DT_OFFENDER_CONTACT_ADDRESS.county WHEN NOT DT_OFFENDER_CONTACT_ADDRESS.county IS NULL AND DT_OFFENDER_CONTACT_ADDRESS.city IS NULL AND NOT DT_OFFENDER_CONTACT_ADDRESS.locality IS NULL THEN ', ' || DT_OFFENDER_CONTACT_ADDRESS.county WHEN NOT DT_OFFENDER_CONTACT_ADDRESS.county IS NULL AND NOT DT_OFFENDER_CONTACT_ADDRESS.city IS NULL THEN ', ' || DT_OFFENDER_CONTACT_ADDRESS.county WHEN NOT DT_OFFENDER_CONTACT_ADDRESS.county IS NULL AND DT_OFFENDER_CONTACT_ADDRESS.city IS NULL AND DT_OFFENDER_CONTACT_ADDRESS.locality IS NULL THEN DT_OFFENDER_CONTACT_ADDRESS.county ELSE NULL END) AS OTHER_CONTACT_AREA, DT_OFFENDER_CONTACT_ADDRESS.POST_CODE, DT_OFFENDER_CONTACT_ADDRESS.BIRTH_DATE, AT_ESTABLISHMENT_TAP.ESTABLISHMENT_DESCRIPTION, DT_OFFENDER_CONTACT_ADDRESS.MIDDLE_NAME, DT_OFFENDER_CONTACT_ADDRESS.FLAT || ' ' || DT_OFFENDER_CONTACT_ADDRESS.PREMISE AS OTHER_CONTACT_HOUSE_INFORMAT31 FROM BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, (SELECT ROW_NUMBER() OVER (PARTITION BY dooc.offender_booking_sk, dooc.relationship ORDER BY dooc.active_flag DESC, dooc.address_flag DESC, dooc.mis_load_id DESC) AS row_seq_filter, dooc.*, CASE WHEN dooc.next_of_kin_flag = 'Y' THEN 'NEXTOFKIN' ELSE 'CONTACT' END AS Con_Addr_Type, CASE WHEN dooc.next_of_kin_flag = 'Y' THEN 'Next of Kin' ELSE 'Contact' END AS ConAddrTypeDesc FROM bodimis.dim_offender_other_contacts dooc) DT_OFFENDER_CONTACT_ADDRESS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER('DPRWS') AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_OFFENDER_CONTACT_ADDRESS.OFFENDER_BOOKING_SK (+)) AND (DT_OFFENDER_CONTACT_ADDRESS.OFFENDER_BOOKING_SK IS NULL OR DT_OFFENDER_CONTACT_ADDRESS.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER('DPRWS') AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (((AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK IN (SELECT SAC.CASELOAD_ID FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC WHERE SAC.USERNAME = UPPER('DPRWS'))) AND AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK <> 'ZZGHI') AND NOT DT_OFFENDER_CONTACT_ADDRESS.RELATIONSHIP IN ('Case Administrator', 'Community Offender Manager', 'Local Authority Contact', 'Offender Supervisor', 'Police Officer', 'Prison Offender Manager', 'Probation Officer', 'Social Worker', 'Solicitor', 'YOT Offender Supervisor/ Manager', 'Doctor', 'Other - Official'))), dataset_ AS (SELECT PERSON_ID, LAST_NAME, FIRST_NAME, OFFENDER_ID_DISPLAY, SURNAME, INITIALS, RELATIONSHIP, ACTIVE_STATUS, STREET, OTHER_CONTACT_AREA, POST_CODE, BIRTH_DATE, ESTABLISHMENT_DESCRIPTION, MIDDLE_NAME, OTHER_CONTACT_HOUSE_INFORMAT31, 'TBD' AS V_MAX_CONCAT_VISIT_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "PERSON_ID",
            "type": "double",
            "display": "Other Contact Person Id",
            "legacyId": "DP4.DO10b00",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Other Contact Last Name",
            "legacyId": "DP4.DO10ad8",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "Other Contact First Name",
            "legacyId": "DP4.DO10ad6",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP4.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP4.DO1007b",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "INITIALS",
            "type": "string",
            "display": "Offender Initials",
            "legacyId": "DP4.DO1012d",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "RELATIONSHIP",
            "type": "string",
            "display": "Other Contact Relationship",
            "legacyId": "DP4.DO10a1c",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "ACTIVE_STATUS",
            "type": "string",
            "display": "Active Status",
            "legacyId": "DP4.DO104d5",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "STREET",
            "type": "string",
            "display": "Other Contact Street",
            "legacyId": "DP4.DO10a1e",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "OTHER_CONTACT_AREA",
            "type": "string",
            "display": "Other Contact Area",
            "legacyId": "DP4.DO10a1f",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "POST_CODE",
            "type": "string",
            "display": "Other Contact Post Code",
            "legacyId": "DP4.DO10a20",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "BIRTH_DATE",
            "type": "date",
            "display": "Other Contact Birth Date",
            "legacyId": "DP4.DO10571",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Associated Establishment Name",
            "legacyId": "DP4.DO107b1",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "MIDDLE_NAME",
            "type": "string",
            "display": "Other Contact Middle Name",
            "legacyId": "DP4.DO10ad7",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "OTHER_CONTACT_HOUSE_INFORMAT31",
            "type": "string",
            "display": "Other Contact House Information",
            "legacyId": "DP4.DO10a1d",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "V_MAX_CONCAT_VISIT_DATE",
            "type": "string",
            "display": "V_MAX_CONCAT_VISIT_DATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375956/DP5",
      "name": "Visits",
      "description": "MIS - Visits",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_VISIT_DATE.DAY_DATE, AT_DIM_OFFENDER_VISITOR.VISITOR_PERSON_ID, AT_OFFENDER_BOOKING2.SURNAME, AT_OFFENDER_BOOKING2.FIRST_NAME FROM BODIMIS.DIM_DATE AT_VISIT_DATE, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_OFFENDER_VISITOR AT_DIM_OFFENDER_VISITOR, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING2, (SELECT ROW_NUMBER() OVER (PARTITION BY dooc.offender_booking_sk, dooc.relationship ORDER BY dooc.active_flag DESC, dooc.address_flag DESC, dooc.mis_load_id DESC) AS row_seq_filter, dooc.*, CASE WHEN dooc.next_of_kin_flag = 'Y' THEN 'NEXTOFKIN' ELSE 'CONTACT' END AS Con_Addr_Type, CASE WHEN dooc.next_of_kin_flag = 'Y' THEN 'Next of Kin' ELSE 'Contact' END AS ConAddrTypeDesc FROM bodimis.dim_offender_other_contacts dooc) DT_OFFENDER_CONTACT_ADDRESS, (SELECT * FROM dual) DT_DUAL, BODIMIS.FACT_OFFENDER_VISIT, BODIMIS.DIM_OFFENDER_OTHER_CONTACTS AT_VISIT_OFFENDER_CONTACTS2, BODIMIS.DIM_VISITOR_LOCAL_RESTRICTION AT_DIM_VISITOR_LOC_RESTRIC2 WHERE (AT_DIM_OFFENDER_VISITOR.DIM_OFFENDER_VISITOR_SK = AT_DIM_VISITOR_LOC_RESTRIC2.DIM_OFFENDER_VISITOR_SK) AND (AT_DIM_VISITOR_LOC_RESTRIC2.OFFENDER_BOOKING_SK = AT_OFFENDER_BOOKING2.OFFENDER_BOOKING_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = BODIMIS.FACT_OFFENDER_VISIT.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_OFFENDER_VISIT.VISIT_DATE_SK = AT_VISIT_DATE.DATE_SK) AND (AT_VISIT_OFFENDER_CONTACTS2.PERSON_ID = AT_DIM_OFFENDER_VISITOR.VISITOR_PERSON_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_VISIT_OFFENDER_CONTACTS2.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_OFFENDER_CONTACT_ADDRESS.OFFENDER_BOOKING_SK (+)) AND (DT_OFFENDER_CONTACT_ADDRESS.OFFENDER_BOOKING_SK IS NULL OR DT_OFFENDER_CONTACT_ADDRESS.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (DT_OFFENDER_CONTACT_ADDRESS.PERSON_ID = (SELECT UNKNOWN_PARAMETER FROM prompt_ /* = #prompt('Enter Contact Id:','N',,Mono,Free,Not_Persistent,,User:0,optional) */) AND ((AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK IN (SELECT SAC.CASELOAD_ID FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC WHERE SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)))) AND AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK <> 'ZZGHI') AND DT_OFFENDER_CONTACT_ADDRESS.STREET IN (SELECT UNKNOWN_PARAMETER FROM prompt_ /* = #prompt('Contact Street:','A',,Multi,Free,Not_Persistent,,User:1,optional) */) AND NOT DT_OFFENDER_CONTACT_ADDRESS.RELATIONSHIP IN ('Case Administrator', 'Community Offender Manager', 'Local Authority Contact', 'Offender Supervisor', 'Police Officer', 'Prison Offender Manager', 'Probation Officer', 'Social Worker', 'Solicitor', 'YOT Offender Supervisor/ Manager', 'Doctor', 'Other - Official') AND AT_VISIT_DATE.DAY_DATE >= TO_CHAR(TRUNC(CURRENT_TIMESTAMP), 'DD-MON-YYYY') AND DT_OFFENDER_CONTACT_ADDRESS.FIRST_NAME IN (SELECT UNKNOWN_PARAMETER FROM prompt_ /* = #prompt('Contact First Name:','A',,Multi,Free,Not_Persistent,,User:2,optional) */) AND DT_OFFENDER_CONTACT_ADDRESS.LAST_NAME IN (SELECT UNKNOWN_PARAMETER FROM prompt_ /* = #prompt('Contact Last Name:','A',,Multi,Free,Not_Persistent,,User:3,optional) */))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DAY_DATE, VISITOR_PERSON_ID, SURNAME, FIRST_NAME FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "unknown_parameter",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Enter Contact Id:",
          "description": "@prompt('Enter Contact Id:','N',,Mono,Free,Not_Persistent,,User:0,optional)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP5.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Visit Date",
            "legacyId": "DP5.DO55d",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "VISITOR_PERSON_ID",
            "type": "double",
            "display": "Visitor Person Id",
            "legacyId": "DP5.DO4a0",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "SURNAME",
            "type": "string",
            "display": "Visitor Contact Last Name",
            "legacyId": "DP5.DO4fe",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "Visitor Contact First Name",
            "legacyId": "DP5.DO4ff",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP1",
      "name": "MIS Load Date",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT BODIMIS.ETL_LOAD_LOG.BUSINESS_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT BUSINESS_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BUSINESS_DATE",
            "type": "date",
            "display": "Latest Business Date Available",
            "legacyId": "DP1.DO4dd",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "139174.RS",
      "name": "By Prisoner",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375956/DP4",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Associated Establishment Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO107b1"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP4.DO10076"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO1007b"
          },
          {
            "name": "$ref:INITIALS",
            "display": "Offender Initials",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO1012d"
          },
          {
            "name": "$ref:V_MAX_CONCAT_VISIT_DATE",
            "display": "Visit Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[v_concat_visit_date] Where ([v_visit_date]= [v_max_Visit_date]) In ([NOMS Number])"
          },
          {
            "name": "$ref:PERSON_ID",
            "display": "Other Contact Person Id",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10b00"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Other Contact Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10ad8"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Other Contact First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10ad6"
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Other Contact Birth Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10571"
          },
          {
            "name": "$ref:RELATIONSHIP",
            "display": "Other Contact Relationship",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1c"
          },
          {
            "name": "$ref:OTHER_CONTACT_HOUSE_INFORMAT31",
            "display": "Other Contact House Information",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1d"
          },
          {
            "name": "$ref:STREET",
            "display": "Other Contact Street",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1e"
          },
          {
            "name": "$ref:OTHER_CONTACT_AREA",
            "display": "Other Contact Area",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1f"
          },
          {
            "name": "$ref:POST_CODE",
            "display": "Other Contact Post Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a20"
          }
        ]
      }
    },
    {
      "id": "139929.RS",
      "name": "By Person ID",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375956/DP4",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Associated Establishment Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO107b1"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP4.DO10076"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO1007b"
          },
          {
            "name": "$ref:INITIALS",
            "display": "Offender Initials",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO1012d"
          },
          {
            "name": "$ref:V_MAX_CONCAT_VISIT_DATE",
            "display": "Visit Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[v_concat_visit_date] Where ([v_visit_date]= [v_max_Visit_date]) In ([NOMS Number])"
          },
          {
            "name": "$ref:PERSON_ID",
            "display": "Other Contact Person Id",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10b00"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Other Contact Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10ad8"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Other Contact First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10ad6"
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Other Contact Birth Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10571"
          },
          {
            "name": "$ref:RELATIONSHIP",
            "display": "Other Contact Relationship",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1c"
          },
          {
            "name": "$ref:OTHER_CONTACT_HOUSE_INFORMAT31",
            "display": "Other Contact House Information",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1d"
          },
          {
            "name": "$ref:STREET",
            "display": "Other Contact Street",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1e"
          },
          {
            "name": "$ref:OTHER_CONTACT_AREA",
            "display": "Other Contact Area",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1f"
          },
          {
            "name": "$ref:POST_CODE",
            "display": "Other Contact Post Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a20"
          }
        ]
      }
    },
    {
      "id": "140292.RS",
      "name": "By Contacts Surname",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375956/DP4",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Associated Establishment Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO107b1"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP4.DO10076"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO1007b"
          },
          {
            "name": "$ref:INITIALS",
            "display": "Offender Initials",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO1012d"
          },
          {
            "name": "$ref:V_MAX_CONCAT_VISIT_DATE",
            "display": "Visit Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[v_concat_visit_date] Where ([v_visit_date]= [v_max_Visit_date]) In ([NOMS Number])"
          },
          {
            "name": "$ref:PERSON_ID",
            "display": "Other Contact Person Id",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10b00"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Other Contact Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10ad8"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Other Contact First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10ad6"
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Other Contact Birth Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10571"
          },
          {
            "name": "$ref:RELATIONSHIP",
            "display": "Other Contact Relationship",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1c"
          },
          {
            "name": "$ref:OTHER_CONTACT_HOUSE_INFORMAT31",
            "display": "Other Contact House Information",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1d"
          },
          {
            "name": "$ref:STREET",
            "display": "Other Contact Street",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1e"
          },
          {
            "name": "$ref:OTHER_CONTACT_AREA",
            "display": "Other Contact Area",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1f"
          },
          {
            "name": "$ref:POST_CODE",
            "display": "Other Contact Post Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a20"
          }
        ]
      }
    },
    {
      "id": "139788.RS",
      "name": "Booked Visits",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375956/DP4",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_VISIT_DATE IS NOT NULL)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Associated Establishment Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO107b1"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP4.DO10076"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO1007b"
          },
          {
            "name": "$ref:INITIALS",
            "display": "Offender Initials",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO1012d"
          },
          {
            "name": "$ref:V_MAX_CONCAT_VISIT_DATE",
            "display": "Visit Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[v_concat_visit_date] Where ([v_visit_date]= [v_max_Visit_date]) In ([NOMS Number])"
          },
          {
            "name": "$ref:PERSON_ID",
            "display": "Other Contact Person Id",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10b00"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Other Contact Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10ad8"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Other Contact First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10ad6"
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Other Contact Birth Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10571"
          },
          {
            "name": "$ref:RELATIONSHIP",
            "display": "Other Contact Relationship",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1c"
          },
          {
            "name": "$ref:OTHER_CONTACT_HOUSE_INFORMAT31",
            "display": "Other Contact House Information",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1d"
          },
          {
            "name": "$ref:STREET",
            "display": "Other Contact Street",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1e"
          },
          {
            "name": "$ref:OTHER_CONTACT_AREA",
            "display": "Other Contact Area",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a1f"
          },
          {
            "name": "$ref:POST_CODE",
            "display": "Other Contact Post Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO10a20"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_MAX_CONCAT_VISIT_DATE :: Error: =[v_concat_visit_date] Where ([v_visit_date]= [v_max_Visit_date]) In ([NOMS Number]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:67",
      "entityId": "Fiqxb13CcAkAy.MAAHBr3F4KACJIAFe4",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_MAX_CONCAT_VISIT_DATE :: Error: =[v_concat_visit_date] Where ([v_visit_date]= [v_max_Visit_date]) In ([NOMS Number]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:67",
      "entityId": "Fiqxb13CcAkAy.MAAHBr3F4KACJIAFe4",
      "entityType": "dpd"
    }
  ]
}