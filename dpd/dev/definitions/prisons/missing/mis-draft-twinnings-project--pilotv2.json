{
  "id": "Ftc9KwCmDQAArzMBAAAXPRQAACJIAGc1",
  "name": "MIS Draft Twinnings Project - Pilotv2",
  "metadata": {
    "version": "1.0.0",
    "tags": []
  },
  "description": "Landscape template",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3375368/DP2",
      "name": "All Prisoners (inc Released)",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_ST_DT.DAY_DATE, COUNT(DISTINCT (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY)) AS COUNT_OF_OFFENDERS, CASE WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'Chinese' THEN 'Asian/Asian British: Chinese' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'White : Irish Traveller/Gypsy' THEN 'White: Gypsy or Irish Traveller' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION IS NULL THEN 'Code Missing' ELSE AT_DIM_ETHNICITY_CODES.DESCRIPTION END AS ETHNIC_GROUP, FLOOR((MONTHS_BETWEEN((TRUNC(CURRENT_TIMESTAMP)), (CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END))) / 12) AS OFFENDER_AGE, AT_OFFENDER_BOOKING.SURNAME, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.DIM_ETHNICITY_CODES AT_DIM_ETHNICITY_CODES, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_ST_DT, BODIMIS.DIM_DATE AT_DOB, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, FACT_CURR_KEY_DATES_SENT, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING_BAH, BODIMIS.FACT_BED_ASSIGNMENT_HISTORY AT_BED_ASSIGNMENT_HISTORY WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = FACT_CURR_KEY_DATES_SENT.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_BED_ASSIGNMENT_HISTORY.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_ETHNICITY_CODES.CODE (+) = AT_OFFENDER_BOOKING.ETHNICITY_CODE) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER('DPRWS') AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING_BAH.OFFENDER_BOOKING_SK = AT_BED_ASSIGNMENT_HISTORY.OFFENDER_BOOKING_SK) AND (AT_ST_DT.DATE_SK = AT_OFFENDER_BOOKING_BAH.BOOKING_BEGIN_DATE_SK) AND AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A6877DD', 'A6844EG', 'A7844EE', 'A3523EH', 'A9584EJ', 'A8091EE', 'A6644AM', 'A1386CN', 'A8246CF', 'A0453AK', 'A5356AJ', 'A3706AJ', 'A7490CV', 'A1484AG', 'A6813AF', 'A9118AM', 'A0117CD', 'A6387CN', 'A5087EC', 'A9373CP', 'A4580DL', 'A2900EG', 'A7830CD', 'A5431DD', 'A7827AC', 'A4936DT', 'A8066DT', 'A6728DY', 'A2089EF', 'A3416EH', 'A6957EK', 'A6380EH', 'A7373EF', 'A4164EJ', 'A5644AY', 'A3923ED', 'A4205EF', 'A0831EJ', 'A4880CC', 'A9445CT', 'A4262DT', 'A5912DV', 'A4375EH', 'A5468AN', 'A1260ED', 'A5046EK', 'A6742EK', 'A2503DA', 'A9184CD', 'A2280AE', 'A1644EL', 'A2603EF') GROUP BY AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_ST_DT.DAY_DATE, CASE WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'Chinese' THEN 'Asian/Asian British: Chinese' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'White : Irish Traveller/Gypsy' THEN 'White: Gypsy or Irish Traveller' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION IS NULL THEN 'Code Missing' ELSE AT_DIM_ETHNICITY_CODES.DESCRIPTION END, FLOOR((MONTHS_BETWEEN((TRUNC(CURRENT_TIMESTAMP)), (CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END))) / 12), AT_OFFENDER_BOOKING.SURNAME, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH END), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DAY_DATE, COUNT_OF_OFFENDERS, ETHNIC_GROUP, OFFENDER_AGE, SURNAME, EFFECTIVE_SENTENCE_LENGTH FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP2.DO76",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Booking Start Date",
            "legacyId": "DP2.DO10b0b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "COUNT_OF_OFFENDERS",
            "type": "double",
            "display": "Count of Offenders",
            "legacyId": "DP2.DO10655",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "ETHNIC_GROUP",
            "type": "string",
            "display": "Ethnic Group",
            "legacyId": "DP2.DO9c",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "OFFENDER_AGE",
            "type": "double",
            "display": "Offender Age",
            "legacyId": "DP2.DO82",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP2.DO7b",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DP2.DO2d0",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP3",
      "name": "MIS Load Date",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT BODIMIS.ETL_LOAD_LOG.BUSINESS_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT BUSINESS_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BUSINESS_DATE",
            "type": "date",
            "display": "Latest Business Date Available",
            "legacyId": "DP3.DO4dd",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP5",
      "name": "All Prisoner with Estab",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_ST_DT.DAY_DATE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, COUNT(DISTINCT (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY)) AS COUNT_OF_OFFENDERS, CASE WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'Chinese' THEN 'Asian/Asian British: Chinese' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'White : Irish Traveller/Gypsy' THEN 'White: Gypsy or Irish Traveller' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION IS NULL THEN 'Code Missing' ELSE AT_DIM_ETHNICITY_CODES.DESCRIPTION END AS ETHNIC_GROUP, FLOOR((MONTHS_BETWEEN((TRUNC(CURRENT_TIMESTAMP)), (CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END))) / 12) AS OFFENDER_AGE, AT_OFFENDER_BOOKING.SURNAME, AT_ESTABLISHMENT_TAP.ESTABLISHMENT_DESCRIPTION, AT_ACTIVITY_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS ACTIVITY_ESTABLISHMENT_NAME FROM BODIMIS.FACT_OFFENDER_ACTIVITY AT_FACT_OFFENDER_ACTIVITY, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_ESTABLISHMENT AT_ACTIVITY_ESTABLISHMENT, BODIMIS.DIM_ETHNICITY_CODES AT_DIM_ETHNICITY_CODES, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_ST_DT, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, FACT_CURR_KEY_DATES_SENT, BODIMIS.DIM_DATE AT_DOB, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING_BAH, BODIMIS.FACT_BED_ASSIGNMENT_HISTORY AT_BED_ASSIGNMENT_HISTORY WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = FACT_CURR_KEY_DATES_SENT.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_BED_ASSIGNMENT_HISTORY.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_ETHNICITY_CODES.CODE (+) = AT_OFFENDER_BOOKING.ETHNICITY_CODE) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER('DPRWS') AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_ACTIVITY.OFFENDER_BOOKING_SK) AND (AT_ACTIVITY_ESTABLISHMENT.ESTABLISHMENT_SK = AT_FACT_OFFENDER_ACTIVITY.ESTABLISHMENT_SK) AND (AT_OFFENDER_BOOKING_BAH.OFFENDER_BOOKING_SK = AT_BED_ASSIGNMENT_HISTORY.OFFENDER_BOOKING_SK) AND (AT_ST_DT.DATE_SK = AT_OFFENDER_BOOKING_BAH.BOOKING_BEGIN_DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A6877DD', 'A6844EG', 'A7844EE', 'A3523EH', 'A9584EJ', 'A8091EE', 'A6644AM', 'A1386CN', 'A8246CF', 'A0453AK', 'A5356AJ', 'A3706AJ', 'A7490CV', 'A1484AG', 'A6813AF', 'A9118AM', 'A0117CD', 'A6387CN', 'A5087EC', 'A9373CP', 'A4580DL', 'A2900EG', 'A7830CD', 'A5431DD', 'A7827AC', 'A4936DT', 'A8066DT', 'A6728DY', 'A2089EF', 'A3416EH', 'A6957EK', 'A6380EH', 'A7373EF', 'A4164EJ', 'A5644AY', 'A3923ED', 'A4205EF', 'A0831EJ', 'A4880CC', 'A9445CT', 'A4262DT', 'A5912DV', 'A4375EH', 'A5468AN', 'A1260ED', 'A5046EK', 'A6742EK', 'A2503DA', 'A9184CD', 'A2280AE', 'A1644EL', 'A2603EF') AND (AT_OFFENDER_BOOKING.BOOKING_SEQ = 1)) GROUP BY AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_ST_DT.DAY_DATE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH END, CASE WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'Chinese' THEN 'Asian/Asian British: Chinese' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'White : Irish Traveller/Gypsy' THEN 'White: Gypsy or Irish Traveller' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION IS NULL THEN 'Code Missing' ELSE AT_DIM_ETHNICITY_CODES.DESCRIPTION END, FLOOR((MONTHS_BETWEEN((TRUNC(CURRENT_TIMESTAMP)), (CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END))) / 12), AT_OFFENDER_BOOKING.SURNAME, AT_ESTABLISHMENT_TAP.ESTABLISHMENT_DESCRIPTION, AT_ACTIVITY_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DAY_DATE, EFFECTIVE_SENTENCE_LENGTH, COUNT_OF_OFFENDERS, ETHNIC_GROUP, OFFENDER_AGE, SURNAME, ESTABLISHMENT_DESCRIPTION, ACTIVITY_ESTABLISHMENT_NAME, COUNT(OFFENDER_ID_DISPLAY) AS V_COUNT_NOMS FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP5.DO76",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Booking Start Date",
            "legacyId": "DP5.DO10b0b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DP5.DO2d0",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "COUNT_OF_OFFENDERS",
            "type": "double",
            "display": "Count of Offenders",
            "legacyId": "DP5.DO10655",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "ETHNIC_GROUP",
            "type": "string",
            "display": "Ethnic Group",
            "legacyId": "DP5.DO9c",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "OFFENDER_AGE",
            "type": "double",
            "display": "Offender Age",
            "legacyId": "DP5.DO82",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP5.DO7b",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Associated Establishment Name",
            "legacyId": "DP5.DO107b1",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "ACTIVITY_ESTABLISHMENT_NAME",
            "type": "string",
            "display": "Activity Establishment Name",
            "legacyId": "DP5.DO106b2",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "V_COUNT_NOMS",
            "type": "string",
            "display": "V_COUNT_NOMS",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375368/DPa",
      "name": "Self Harm Alerts",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, CASE WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'Chinese' THEN 'Asian/Asian British: Chinese' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'White : Irish Traveller/Gypsy' THEN 'White: Gypsy or Irish Traveller' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION IS NULL THEN 'Code Missing' ELSE AT_DIM_ETHNICITY_CODES.DESCRIPTION END AS ETHNIC_GROUP, FLOOR((MONTHS_BETWEEN((TRUNC(CURRENT_TIMESTAMP)), (CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END))) / 12) AS OFFENDER_AGE, AT_OFFENDER_BOOKING.SURNAME, AT_ACTIVITY_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION, AT_ALERT.ALERT_DESCRIPTION, CASE WHEN AT_ALERT_EFFECT_DATE.DAY_DATE < '31/12/9000' THEN AT_ALERT_EFFECT_DATE.DAY_DATE ELSE NULL END AS ALERT_EFFECTIVE_DATE, CASE WHEN AT_ALERT_EXPIRY_DATE.DAY_DATE < '31/12/9000' THEN AT_ALERT_EXPIRY_DATE.DAY_DATE ELSE NULL END AS ALERT_EXPIRY_DATE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.FACT_OFFENDER_ACTIVITY AT_FACT_OFFENDER_ACTIVITY, BODIMIS.DIM_ESTABLISHMENT AT_ACTIVITY_ESTABLISHMENT, BODIMIS.DIM_ETHNICITY_CODES AT_DIM_ETHNICITY_CODES, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_DOB, BODIMIS.DIM_ALERT AT_ALERT, BODIMIS.DIM_DATE AT_ALERT_EFFECT_DATE, BODIMIS.DIM_DATE AT_ALERT_EXPIRY_DATE, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, FACT_CURR_KEY_DATES_SENT, BODIMIS.FACT_OFFENDER_ALERT AT_OFFENDER_ALERT WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = FACT_CURR_KEY_DATES_SENT.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_OFFENDER_ALERT.OFFENDER_BOOKING_SK (+)) AND (AT_ALERT.ALERT_SK (+) = AT_OFFENDER_ALERT.ALERT_SK) AND (AT_OFFENDER_ALERT.ALERT_DATE_SK = AT_ALERT_EFFECT_DATE.DATE_SK (+)) AND (AT_OFFENDER_ALERT.ALERT_EXPIRY_DATE_SK = AT_ALERT_EXPIRY_DATE.DATE_SK (+)) AND (AT_DIM_ETHNICITY_CODES.CODE (+) = AT_OFFENDER_BOOKING.ETHNICITY_CODE) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_ACTIVITY.OFFENDER_BOOKING_SK) AND (AT_ACTIVITY_ESTABLISHMENT.ESTABLISHMENT_SK = AT_FACT_OFFENDER_ACTIVITY.ESTABLISHMENT_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A0117CD', 'A0453AK', 'A0831EJ', 'A1260ED', 'A1386CN', 'A1484AG', 'A1644EL', 'A2089EF', 'A2280AE', 'A2503DA', 'A2603EF', 'A2900EG', 'A3416EH', 'A3523EH', 'A3706AJ', 'A3923ED', 'A4164EJ', 'A4205EF', 'A4262DT', 'A4375EH', 'A4580DL', 'A4880CC', 'A4936DT', 'A5046EK', 'A5087EC', 'A5356AJ', 'A5431DD', 'A5468AN', 'A5644AY', 'A5912DV', 'A6380EH', 'A6387CN', 'A6644AM', 'A6728DY', 'A6742EK', 'A6813AF', 'A6844EG', 'A6877DD', 'A6957EK', 'A7373EF', 'A7490CV', 'A7827AC', 'A7830CD', 'A7844EE', 'A8066DT', 'A8091EE', 'A8246CF', 'A9118AM', 'A9184CD', 'A9373CP', 'A9445CT', 'A9584EJ') AND AT_ALERT.ALERT_CODE_NK IN ('HC', 'HS', 'SH'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, ETHNIC_GROUP, OFFENDER_AGE, SURNAME, ESTABLISHMENT_DESCRIPTION, ALERT_DESCRIPTION, ALERT_EFFECTIVE_DATE, ALERT_EXPIRY_DATE, EFFECTIVE_SENTENCE_LENGTH FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPa.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "ETHNIC_GROUP",
            "type": "string",
            "display": "Ethnic Group",
            "legacyId": "DPa.DO1009c",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "OFFENDER_AGE",
            "type": "double",
            "display": "Offender Age",
            "legacyId": "DPa.DO10082",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DPa.DO1007b",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Activity Establishment Name",
            "legacyId": "DPa.DO106b2",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "ALERT_DESCRIPTION",
            "type": "string",
            "display": "Alert Description",
            "legacyId": "DPa.DO10090",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "ALERT_EFFECTIVE_DATE",
            "type": "date",
            "display": "Alert Effective Date",
            "legacyId": "DPa.DO10095",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "ALERT_EXPIRY_DATE",
            "type": "date",
            "display": "Alert Expiry Date",
            "legacyId": "DPa.DO10096",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DPa.DO2d0",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3377299/DPb",
      "name": "Case Notes",
      "description": "OR - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_OFFENDER_CASE_NOTES.CASE_NOTE_ID, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), Case When AT_OFFENDER.RACE_CODE='W8' then 'W3' when AT_OFFENDER.RACE_CODE='O1' then 'A4' else AT_OFFENDER.RACE_CODE END || '-' || Case when AT_ETHNICITY_DESC.CODE='W8' then 'White: Gypsy or Irish Traveller' when AT_ETHNICITY_DESC.CODE='O1' then 'Asian/Asian British: Chinese' ELSE AT_ETHNICITY_DESC.DESCRIPTION END, AT_OFFENDER_CASE_NOTES.CASE_NOTE_TYPE, AT_OFFENDER_CASE_NOTES.CONTACT_DATE, CURR_EFF_SENT_LEN.CURR_EFF_SENT_LEN, AT_OFFENDER.LAST_NAME FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_ETHNICITY_DESC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_CASE_NOTES AT_OFFENDER_CASE_NOTES, ( SELECT OFF_BOOK.OFFENDER_BOOK_ID, case When LIFE_FLAG.LIFE_SENTENCE_FLAG='Y' Then 'Life' else SENT_CALC.EFFECTIVE_SENTENCE_LENGTH end AS CURR_EFF_SENT_LEN FROM ( select distinct OFFENDER_SENTENCE_TERMS.OFFENDER_BOOK_ID, OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG from OFFENDER_SENTENCE_TERMS where OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y') LIFE_FLAG, OMS_OWNER.OFFENDER_SENT_CALCULATIONS SENT_CALC, OMS_OWNER.OFFENDER_BOOKINGS OFF_BOOK WHERE ( OFF_BOOK.OFFENDER_BOOK_ID=SENT_CALC.OFFENDER_BOOK_ID(+) ) AND ( LIFE_FLAG.OFFENDER_BOOK_ID(+)=SENT_CALC.OFFENDER_BOOK_ID ) AND SENT_CALC.OFFENDER_SENT_CALCULATION_ID=(SELECT max(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE SENT_CALC.OFFENDER_BOOK_ID=A.OFFENDER_BOOK_ID) ) CURR_EFF_SENT_LEN WHERE ( AT_OFFENDER.OFFENDER_ID=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_ETHNICITY_DESC.DOMAIN(+)='ETHNICITY' ) AND ( AT_ETHNICITY_DESC.CODE(+)=AT_OFFENDER.RACE_CODE ) AND ( CURR_EFF_SENT_LEN.OFFENDER_BOOK_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID=AT_OFFENDER_CASE_NOTES.OFFENDER_BOOK_ID ) AND (  AND AT_OFFENDER_CASE_NOTES.CASE_NOTE_TYPE IN ( 'POS','NEG' ) )), dataset_ AS (SELECT FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": []
      }
    },
    {
      "id": "3375377/DPc",
      "name": "Adjudications",
      "description": "MIS - Incidents",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_DIM_OIC_OFFENCE_CHARGE.DESCRIPTION, AT_FACT_INCIDENT_CHARGE_RESULT.FINDING_CODE, AT_INCIDENT_DATE.DAY_DATE, CASE WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'Chinese' THEN 'Asian/Asian British: Chinese' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'White : Irish Traveller/Gypsy' THEN 'White: Gypsy or Irish Traveller' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION IS NULL THEN 'Code Missing' ELSE AT_DIM_ETHNICITY_CODES.DESCRIPTION END AS ETHNIC_GROUP, FLOOR((MONTHS_BETWEEN((TRUNC(CURRENT_TIMESTAMP)), (CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END))) / 12) AS OFFENDER_AGE, AT_INCIDENT.INCIDENT_CASE_ID, AT_FACT_OFFENDER_SENTENCE.EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.FACT_INCIDENT_CHARGE_RESULT AT_FACT_INCIDENT_CHARGE_RESULT, BODIMIS.FACT_INCIDENT AT_INCIDENT, BODIMIS.DIM_OIC_OFFENCE AT_DIM_OIC_OFFENCE_CHARGE, BODIMIS.DIM_ETHNICITY_CODES AT_DIM_ETHNICITY_CODES, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_INCIDENT_DATE, BODIMIS.DIM_DATE AT_DOB, BODIMIS.DIM_INCIDENT_STATUS AT_INCIDENT_STATUS, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE, (SELECT a.oic_incident_id, c.offender_booking_sk, c.agency_incident_id_nk, c.charge_seq_nk, c.oic_offence_sk, a.oic_hearing_id_nk, a.party_seq_nk, a.establishment_sk, c.report_date, a.oic_hearing_type, a.notification_charge_date_sk FROM bodimis.fact_incident_charge c LEFT OUTER JOIN bodimis.fact_offender_adjudication a ON c.agency_incident_id_nk = a.agency_incident_id_nk AND c.offender_booking_sk = a.offender_booking_sk) DT_OFFENDER_ADJUDICATION, BODIMIS.FACT_INCIDENT_PARTICIPATION AT_INCIDENT_PARTICIPATION WHERE (AT_INCIDENT.INCIDENT_STATUS_SK = AT_INCIDENT_STATUS.INCIDENT_STATUS_SK) AND (AT_INCIDENT_DATE.DATE_SK = AT_INCIDENT.INCIDENT_DATE_SK) AND (AT_INCIDENT.INCIDENT_CASE_ID = AT_INCIDENT_PARTICIPATION.INCIDENT_CASE_ID) AND (AT_INCIDENT_PARTICIPATION.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_OIC_OFFENCE_CHARGE.OIC_OFFENCE_SK = DT_OFFENDER_ADJUDICATION.OIC_OFFENCE_SK) AND (AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y' OR AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG IS NULL) AND (AT_INCIDENT_PARTICIPATION.OFFENDER_BOOKING_SK IS NULL OR AT_INCIDENT_PARTICIPATION.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND (CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6 OR CSL.ENDYEAR = '2999'))) AND (DT_OFFENDER_ADJUDICATION.OFFENDER_BOOKING_SK = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_INCIDENT_STATUS.INCIDENT_STATUS_ID_NK <> 'DUP') AND (DT_OFFENDER_ADJUDICATION.AGENCY_INCIDENT_ID_NK = AT_FACT_INCIDENT_CHARGE_RESULT.AGENCY_INCIDENT_ID (+) AND DT_OFFENDER_ADJUDICATION.OIC_HEARING_ID_NK = AT_FACT_INCIDENT_CHARGE_RESULT.OIC_HEARING_ID_NK (+) AND DT_OFFENDER_ADJUDICATION.OFFENDER_BOOKING_SK = AT_FACT_INCIDENT_CHARGE_RESULT.OFFENDER_BOOKING_SK (+) AND DT_OFFENDER_ADJUDICATION.CHARGE_SEQ_NK = AT_FACT_INCIDENT_CHARGE_RESULT.CHARGE_SEQ (+)) AND (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_DIM_ETHNICITY_CODES.CODE (+) = AT_OFFENDER_BOOKING.ETHNICITY_CODE) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_INCIDENT_STATUS.INCIDENT_STATUS_ID_NK <> 'DUP') AND AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A0117CD', 'A0453AK', 'A0831EJ', 'A1260ED', 'A1386CN', 'A1484AG', 'A1644EL', 'A2089EF', 'A2280AE', 'A2503DA', 'A2603EF', 'A2900EG', 'A3416EH', 'A3523EH', 'A3706AJ', 'A3923ED', 'A4164EJ', 'A4205EF', 'A4262DT', 'A4375EH', 'A4580DL', 'A4880CC', 'A4936DT', 'A5046EK', 'A5087EC', 'A5356AJ', 'A5431DD', 'A5468AN', 'A5644AY', 'A5912DV', 'A6380EH', 'A6387CN', 'A6644AM', 'A6728DY', 'A6742EK', 'A6813AF', 'A6844EG', 'A6877DD', 'A6957EK', 'A7373EF', 'A7490CV', 'A7827AC', 'A7830CD', 'A7844EE', 'A8066DT', 'A8091EE', 'A8246CF', 'A9118AM', 'A9184CD', 'A9373CP', 'A9445CT', 'A9584EJ')), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, SURNAME, DESCRIPTION, FINDING_CODE, DAY_DATE, ETHNIC_GROUP, OFFENDER_AGE, INCIDENT_CASE_ID, EFFECTIVE_SENTENCE_LENGTH FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPc.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DPc.DO1007b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Charge Description",
            "legacyId": "DPc.DO26d",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "FINDING_CODE",
            "type": "string",
            "display": "Hearing Finding",
            "legacyId": "DPc.DO26e",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Incident Date (Date Only)",
            "legacyId": "DPc.DO1b",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "ETHNIC_GROUP",
            "type": "string",
            "display": "Ethnic Group",
            "legacyId": "DPc.DO1009c",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "OFFENDER_AGE",
            "type": "double",
            "display": "Offender Age",
            "legacyId": "DPc.DO10082",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "INCIDENT_CASE_ID",
            "type": "double",
            "display": "Incident Case Id",
            "legacyId": "DPc.DO6ba",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DPc.DO293",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DPe",
      "name": "IEP",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, AT_OFFENDER_BOOKING.SURNAME, FLOOR((MONTHS_BETWEEN((TRUNC(CURRENT_TIMESTAMP)), (CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END))) / 12) AS OFFENDER_AGE, AT_DIM_OFFENDER_IEP_LEVEL.IEP_LEVEL, TRUNC(AT_DIM_OFFENDER_IEP_LEVEL.IEP_DATE_TIME) AS IEP_CHANGE_DATE_ONLY, CASE WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'Chinese' THEN 'Asian/Asian British: Chinese' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'White : Irish Traveller/Gypsy' THEN 'White: Gypsy or Irish Traveller' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION IS NULL THEN 'Code Missing' ELSE AT_DIM_ETHNICITY_CODES.DESCRIPTION END AS ETHNIC_GROUP, AT_ACTIVITY_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION FROM BODIMIS.FACT_OFFENDER_ACTIVITY AT_FACT_OFFENDER_ACTIVITY, BODIMIS.DIM_ESTABLISHMENT AT_ACTIVITY_ESTABLISHMENT, BODIMIS.DIM_ETHNICITY_CODES AT_DIM_ETHNICITY_CODES, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, FACT_CURR_KEY_DATES_SENT, BODIMIS.DIM_DATE AT_DOB, BODIMIS.DIM_OFFENDER_IEP_LEVEL AT_DIM_OFFENDER_IEP_LEVEL WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = FACT_CURR_KEY_DATES_SENT.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_DIM_ETHNICITY_CODES.CODE (+) = AT_OFFENDER_BOOKING.ETHNICITY_CODE) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_ACTIVITY.OFFENDER_BOOKING_SK) AND (AT_ACTIVITY_ESTABLISHMENT.ESTABLISHMENT_SK = AT_FACT_OFFENDER_ACTIVITY.ESTABLISHMENT_SK) AND (AT_DIM_OFFENDER_IEP_LEVEL.OFFENDER_BOOK_ID_NK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_ID_NK) AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A0117CD', 'A0453AK', 'A0831EJ', 'A1260ED', 'A1386CN', 'A1484AG', 'A1644EL', 'A2089EF', 'A2280AE', 'A2503DA', 'A2603EF', 'A2900EG', 'A3416EH', 'A3523EH', 'A3706AJ', 'A3923ED', 'A4164EJ', 'A4205EF', 'A4262DT', 'A4375EH', 'A4580DL', 'A4880CC', 'A4936DT', 'A5046EK', 'A5087EC', 'A5356AJ', 'A5431DD', 'A5468AN', 'A5644AY', 'A5912DV', 'A6380EH', 'A6387CN', 'A6644AM', 'A6728DY', 'A6742EK', 'A6813AF', 'A6844EG', 'A6877DD', 'A6957EK', 'A7373EF', 'A7490CV', 'A7827AC', 'A7830CD', 'A7844EE', 'A8066DT', 'A8091EE', 'A8246CF', 'A9118AM', 'A9184CD', 'A9373CP', 'A9445CT', 'A9584EJ') AND TRUNC(AT_DIM_OFFENDER_IEP_LEVEL.IEP_DATE_TIME) >= TO_DATE('01-11-2019 00:00:00', 'DD-MM-YYYY HH24:MI:SS'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, EFFECTIVE_SENTENCE_LENGTH, SURNAME, OFFENDER_AGE, IEP_LEVEL, IEP_CHANGE_DATE_ONLY, ETHNIC_GROUP, ESTABLISHMENT_DESCRIPTION FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPe.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DPe.DO2d0",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DPe.DO1007b",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "OFFENDER_AGE",
            "type": "double",
            "display": "Offender Age",
            "legacyId": "DPe.DO10082",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "IEP_LEVEL",
            "type": "string",
            "display": "IEP Band",
            "legacyId": "DPe.DO10a26",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "IEP_CHANGE_DATE_ONLY",
            "type": "date",
            "display": "IEP Change Date Only",
            "legacyId": "DPe.DO10ae7",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "ETHNIC_GROUP",
            "type": "string",
            "display": "Ethnic Group",
            "legacyId": "DPe.DO1009c",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Activity Establishment Name",
            "legacyId": "DPe.DO106b2",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376551/DP11",
      "name": "Visits",
      "description": "OR - Visits",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME, Case When AT_OFFENDER.RACE_CODE='W8' then 'W3' when AT_OFFENDER.RACE_CODE='O1' then 'A4' else AT_OFFENDER.RACE_CODE END || '-' || Case when AT_ETHNICITY_DESC.CODE='W8' then 'White: Gypsy or Irish Traveller' when AT_ETHNICITY_DESC.CODE='O1' then 'Asian/Asian British: Chinese' ELSE AT_ETHNICITY_DESC.DESCRIPTION END, AT_VISIT_HIST_ESTAB.DESCRIPTION, trunc(months_between(sysdate,AT_OFFENDER.BIRTH_DATE)/12), AT_OFFENDER_HIST_VISITS.VISIT_DATE, AT_OFFENDER_HIST_VISITS.OFFENDER_VISIT_ID, CASE when AT_OFFENDER_HIST_VISITS.VISIT_TYPE='SCON' Then 'Social' when AT_OFFENDER_HIST_VISITS.VISIT_TYPE='OFFI' then 'Official' Else AT_OFFENDER_HIST_VISITS.VISIT_TYPE End, AT_OFFENDER_VISITS.EVENT_OUTCOME, CASE When AT_OFFENDER_HIST_VISITS.VISIT_STATUS='SCH' then 'Scheduled' When AT_OFFENDER_HIST_VISITS.VISIT_STATUS='NORM' then 'Normal Completion' When AT_OFFENDER_HIST_VISITS.VISIT_STATUS='CANC' then 'Cancelled' When AT_OFFENDER_HIST_VISITS.VISIT_STATUS='EXP' then 'Expired' When AT_OFFENDER_HIST_VISITS.VISIT_STATUS='HMPOP' then 'Terminated by Staff' When AT_OFFENDER_HIST_VISITS.VISIT_STATUS='OFFEND' then 'Prisoner Completed Early' When AT_OFFENDER_HIST_VISITS.VISIT_STATUS='VISITOR' then 'Visitor Completed Early' Else AT_OFFENDER_HIST_VISITS.VISIT_STATUS END, case When DT_OFFENDER_LIFE_FLAG.LIFE_SENTENCE_FLAG='Y' Then 'Life' else AT_OFFENDER_SENT_CALCULATIONS.EFFECTIVE_SENTENCE_LENGTH end FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_ETHNICITY_DESC, OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_VISIT_HIST_ESTAB, OMS_OWNER.OFFENDER_VISITS AT_OFFENDER_HIST_VISITS, OMS_OWNER.OFFENDER_VISITS AT_OFFENDER_VISITS, ( select distinct OFFENDER_SENTENCE_TERMS.OFFENDER_BOOK_ID, OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG from OFFENDER_SENTENCE_TERMS where OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y' ) DT_OFFENDER_LIFE_FLAG WHERE ( AT_OFFENDER.OFFENDER_ID=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_ETHNICITY_DESC.DOMAIN(+)='ETHNICITY' ) AND ( AT_ETHNICITY_DESC.CODE(+)=AT_OFFENDER.RACE_CODE ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID=AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID(+) ) AND ( DT_OFFENDER_LIFE_FLAG.OFFENDER_BOOK_ID(+)=AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID=AT_OFFENDER_VISITS.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_VISITS.VISIT_STATUS='SCH' ) AND ( AT_OFFENDER_HIST_VISITS.OFFENDER_BOOK_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_HIST_VISITS.AGY_LOC_ID=AT_VISIT_HIST_ESTAB.AGY_LOC_ID ) AND (  AND AT_OFFENDER_VISITS.VISIT_DATE > '29-11-2017 00:00:00' AND ( AT_OFFENDER_VISITS.VISIT_STATUS!='CANC' ) )), dataset_ AS (SELECT FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": []
      }
    },
    {
      "id": "3375368/DP12",
      "name": "All Prisoners (inc Released) w/ACt Est",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_ACTIVITY_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION, COUNT(DISTINCT (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY)) AS COUNT_OF_OFFENDERS, CASE WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'Chinese' THEN 'Asian/Asian British: Chinese' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'White : Irish Traveller/Gypsy' THEN 'White: Gypsy or Irish Traveller' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION IS NULL THEN 'Code Missing' ELSE AT_DIM_ETHNICITY_CODES.DESCRIPTION END AS ETHNIC_GROUP, FLOOR((MONTHS_BETWEEN((TRUNC(CURRENT_TIMESTAMP)), (CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END))) / 12) AS OFFENDER_AGE, AT_OFFENDER_BOOKING.SURNAME FROM BODIMIS.FACT_OFFENDER_ACTIVITY AT_FACT_OFFENDER_ACTIVITY, BODIMIS.DIM_ESTABLISHMENT AT_ACTIVITY_ESTABLISHMENT, BODIMIS.DIM_ETHNICITY_CODES AT_DIM_ETHNICITY_CODES, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_DOB WHERE (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_DIM_ETHNICITY_CODES.CODE (+) = AT_OFFENDER_BOOKING.ETHNICITY_CODE) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER('DPRWS') AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_ACTIVITY.OFFENDER_BOOKING_SK) AND (AT_ACTIVITY_ESTABLISHMENT.ESTABLISHMENT_SK = AT_FACT_OFFENDER_ACTIVITY.ESTABLISHMENT_SK) AND AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A6877DD', 'A6844EG', 'A7844EE', 'A3523EH', 'A9584EJ', 'A8091EE', 'A6644AM', 'A1386CN', 'A8246CF', 'A0453AK', 'A5356AJ', 'A3706AJ', 'A7490CV', 'A1484AG', 'A6813AF', 'A9118AM', 'A0117CD', 'A6387CN', 'A5087EC', 'A9373CP', 'A4580DL', 'A2900EG', 'A7830CD', 'A5431DD', 'A7827AC', 'A4936DT', 'A8066DT', 'A6728DY', 'A2089EF', 'A3416EH', 'A6957EK', 'A6380EH', 'A7373EF', 'A4164EJ', 'A5644AY', 'A3923ED', 'A4205EF', 'A0831EJ', 'A4880CC', 'A9445CT', 'A4262DT', 'A5912DV', 'A4375EH', 'A5468AN', 'A1260ED', 'A5046EK', 'A6742EK', 'A2503DA', 'A9184CD', 'A2280AE', 'A1644EL', 'A2603EF') GROUP BY AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_ACTIVITY_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION, CASE WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'Chinese' THEN 'Asian/Asian British: Chinese' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'White : Irish Traveller/Gypsy' THEN 'White: Gypsy or Irish Traveller' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION IS NULL THEN 'Code Missing' ELSE AT_DIM_ETHNICITY_CODES.DESCRIPTION END, FLOOR((MONTHS_BETWEEN((TRUNC(CURRENT_TIMESTAMP)), (CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END))) / 12), AT_OFFENDER_BOOKING.SURNAME), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, ESTABLISHMENT_DESCRIPTION, COUNT_OF_OFFENDERS, ETHNIC_GROUP, OFFENDER_AGE, SURNAME FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP12.DO76",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Activity Establishment Name",
            "legacyId": "DP12.DO106b2",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "COUNT_OF_OFFENDERS",
            "type": "double",
            "display": "Count of Offenders",
            "legacyId": "DP12.DO10655",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "ETHNIC_GROUP",
            "type": "string",
            "display": "Ethnic Group",
            "legacyId": "DP12.DO9c",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "OFFENDER_AGE",
            "type": "double",
            "display": "Offender Age",
            "legacyId": "DP12.DO82",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP12.DO7b",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP13",
      "name": "Activities",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_FACT_OFFENDER_ACTIVITY.START_TIME, AT_OFFENDER_BOOKING.SURNAME, AT_ACTIVITY_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION, AT_DIM_PROGRAMME_TYPE.DESCRIPTION, TRUNC(AT_FACT_OFFENDER_ACTIVITY.START_TIME) AS ACTIVITY_SESSION_DATE, FLOOR((MONTHS_BETWEEN((TRUNC(CURRENT_TIMESTAMP)), (CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END))) / 12) AS OFFENDER_AGE, CASE WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'Chinese' THEN 'Asian/Asian British: Chinese' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION = 'White : Irish Traveller/Gypsy' THEN 'White: Gypsy or Irish Traveller' WHEN AT_DIM_ETHNICITY_CODES.DESCRIPTION IS NULL THEN 'Code Missing' ELSE AT_DIM_ETHNICITY_CODES.DESCRIPTION END AS ETHNIC_GROUP, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH END AS CURRENT_EFFECTIVE_SENTENCE_L33 FROM BODIMIS.FACT_OFFENDER_ACTIVITY AT_FACT_OFFENDER_ACTIVITY, BODIMIS.DIM_ESTABLISHMENT AT_ACTIVITY_ESTABLISHMENT, BODIMIS.DIM_ETHNICITY_CODES AT_DIM_ETHNICITY_CODES, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_PROGRAMME_TYPE AT_DIM_PROGRAMME_TYPE, BODIMIS.DIM_DATE AT_DOB, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, FACT_CURR_KEY_DATES_SENT WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = FACT_CURR_KEY_DATES_SENT.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_DIM_ETHNICITY_CODES.CODE (+) = AT_OFFENDER_BOOKING.ETHNICITY_CODE) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_ACTIVITY.OFFENDER_BOOKING_SK) AND (AT_DIM_PROGRAMME_TYPE.PROGRAMME_TYPE_SK = AT_FACT_OFFENDER_ACTIVITY.PROGRAMME_TYPE_SK) AND (AT_ACTIVITY_ESTABLISHMENT.ESTABLISHMENT_SK = AT_FACT_OFFENDER_ACTIVITY.ESTABLISHMENT_SK) AND AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A0117CD', 'A0453AK', 'A0831EJ', 'A1260ED', 'A1386CN', 'A1484AG', 'A1644EL', 'A2089EF', 'A2280AE', 'A2503DA', 'A2603EF', 'A2900EG', 'A3416EH', 'A3523EH', 'A3706AJ', 'A3923ED', 'A4164EJ', 'A4205EF', 'A4262DT', 'A4375EH', 'A4580DL', 'A4880CC', 'A4936DT', 'A5046EK', 'A5087EC', 'A5356AJ', 'A5431DD', 'A5468AN', 'A5644AY', 'A5912DV', 'A6380EH', 'A6387CN', 'A6644AM', 'A6728DY', 'A6742EK', 'A6813AF', 'A6844EG', 'A6877DD', 'A6957EK', 'A7373EF', 'A7490CV', 'A7827AC', 'A7830CD', 'A7844EE', 'A8066DT', 'A8091EE', 'A8246CF', 'A9118AM', 'A9184CD', 'A9373CP', 'A9445CT', 'A9584EJ')), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, START_TIME, SURNAME, ESTABLISHMENT_DESCRIPTION, DESCRIPTION, ACTIVITY_SESSION_DATE, OFFENDER_AGE, ETHNIC_GROUP, CURRENT_EFFECTIVE_SENTENCE_L33, MONTH(TO_DATE(ACTIVITY_SESSION_DATE, 'DD-MM-YYYY HH24:MI:SS')) AS V_ACTIVITY_MONTH, YEAR(TO_DATE(ACTIVITY_SESSION_DATE, 'DD-MM-YYYY HH24:MI:SS')) AS V_ACTIVITY_YEAR, 'TBD' AS V_COUNT_ACTIVITIES FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP13.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "START_TIME",
            "type": "date",
            "display": "Activity Session Start Date/Time",
            "legacyId": "DP13.DO1064d",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP13.DO1007b",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Activity Establishment Name",
            "legacyId": "DP13.DO106b2",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Activity Description",
            "legacyId": "DP13.DO1064c",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "ACTIVITY_SESSION_DATE",
            "type": "date",
            "display": "Activity Session Date",
            "legacyId": "DP13.DO1070c",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "OFFENDER_AGE",
            "type": "double",
            "display": "Offender Age",
            "legacyId": "DP13.DO10082",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "ETHNIC_GROUP",
            "type": "string",
            "display": "Ethnic Group",
            "legacyId": "DP13.DO1009c",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "CURRENT_EFFECTIVE_SENTENCE_L33",
            "type": "string",
            "display": "Current Effective Sentence Length",
            "legacyId": "DP13.DO2ef",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "V_ACTIVITY_MONTH",
            "type": "string",
            "display": "V_ACTIVITY_MONTH",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 10,
            "name": "V_ACTIVITY_YEAR",
            "type": "string",
            "display": "V_ACTIVITY_YEAR",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 11,
            "name": "V_COUNT_ACTIVITIES",
            "type": "string",
            "display": "V_COUNT_ACTIVITIES",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "214316.RS",
      "name": "Twinning Activity - Summary",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DP5",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Associated Establishment Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP5.DO107b1"
          },
          {
            "name": "$ref:V_COUNT_NOMS",
            "display": "No. Of Prisoners",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([NOMS Number])"
          }
        ]
      }
    },
    {
      "id": "214400.RS",
      "name": "Twinning Activity - All Participants",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      },
      "dataset": "MISSING"
    },
    {
      "id": "214762.RS",
      "name": "Twinning Activity - All Activities",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DP13",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP13.DO10076"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP13.DO1007b"
          },
          {
            "name": "$ref:OFFENDER_AGE",
            "display": "Offender Age",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP13.DO10082"
          },
          {
            "name": "$ref:ETHNIC_GROUP",
            "display": "Ethnic Group",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP13.DO1009c"
          },
          {
            "name": "$ref:CURRENT_EFFECTIVE_SENTENCE_L33",
            "display": "Current Effective Sentence Length",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP13.DO2ef"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Activity Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP13.DO1064c"
          },
          {
            "name": "$ref:V_ACTIVITY_MONTH",
            "display": "Month",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Month([Activity Session Date])"
          },
          {
            "name": "$ref:V_ACTIVITY_YEAR",
            "display": "Year",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Year([Activity Session Date])"
          },
          {
            "name": "$ref:V_COUNT_ACTIVITIES",
            "display": "Total Activity Sessions",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([Activity Session Start Date/Time]) In ([NOMS Number]) ForEach ([Activity Description])"
          }
        ]
      }
    },
    {
      "id": "214407.RS",
      "name": "Twinning Activity - Alerts",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DPa",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPa.DO10076"
          },
          {
            "name": "$ref:ALERT_DESCRIPTION",
            "display": "Alert Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPa.DO10090"
          },
          {
            "name": "$ref:ALERT_EFFECTIVE_DATE",
            "display": "Alert Effective Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPa.DO10095"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPa.DO1007b"
          },
          {
            "name": "$ref:OFFENDER_AGE",
            "display": "Offender Age",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPa.DO10082"
          },
          {
            "name": "$ref:ETHNIC_GROUP",
            "display": "Ethnic Group",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPa.DO1009c"
          },
          {
            "name": "$ref:ALERT_EXPIRY_DATE",
            "display": "Alert Expiry Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPa.DO10096"
          },
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Activity Establishment Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPa.DO106b2"
          }
        ]
      }
    },
    {
      "id": "214417.RS",
      "name": "Twinning Activity - Case Notes",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DPb",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:DPB_DO45",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DPB_DO44",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DPB_DO72",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DPB_DO9C",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DPB_DOBF6",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_CONTACT_MONTH",
            "display": "Month",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Month([Contact Date])"
          },
          {
            "name": "$ref:V_CONTACT_YEAR",
            "display": "Year",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Year([Contact Date])"
          },
          {
            "name": "$ref:V_COUNT",
            "display": "No. of Casenotes",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([Case Note ID])"
          }
        ]
      }
    },
    {
      "id": "214468.RS",
      "name": "Twinning Activity - Adjudications",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375377/DPc",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPc.DO10076"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPc.DO1007b"
          },
          {
            "name": "$ref:OFFENDER_AGE",
            "display": "Offender Age",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPc.DO10082"
          },
          {
            "name": "$ref:DAY_DATE",
            "display": "Incident Date (Date Only)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPc.DO1b"
          },
          {
            "name": "$ref:INCIDENT_CASE_ID",
            "display": "Incident Case Id",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPc.DO6ba"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Charge Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPc.DO26d"
          },
          {
            "name": "$ref:FINDING_CODE",
            "display": "Hearing Finding",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPc.DO26e"
          }
        ]
      }
    },
    {
      "id": "214534.RS",
      "name": "Twinning Activity - IEP",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DPe",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPe.DO10076"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPe.DO1007b"
          },
          {
            "name": "$ref:OFFENDER_AGE",
            "display": "Offender Age",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPe.DO10082"
          },
          {
            "name": "$ref:ETHNIC_GROUP",
            "display": "Ethnic Group",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPe.DO1009c"
          },
          {
            "name": "$ref:IEP_LEVEL",
            "display": "IEP Band",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPe.DO10a26"
          },
          {
            "name": "$ref:IEP_CHANGE_DATE_ONLY",
            "display": "IEP Change Date Only",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPe.DO10ae7"
          }
        ]
      }
    },
    {
      "id": "214565.RS",
      "name": "Twinning Activity - Visits",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376551/DP11",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (STATUS_OF_VISIT IN ('Normal Completion','Prisoner Completed Early','Scheduled','Visitor Completed Early') AND V_VISIT_YEAR IN (2019,2021,2020,2022)))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:DP11_DO10044",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP11_DO10045",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP11_DO10072",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP11_DO1009C",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP11_DO1082F",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP11_DO10DD6",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_VISIT_MONTH",
            "display": "Month",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Month([Date of Visit])"
          },
          {
            "name": "$ref:V_VISIT_YEAR",
            "display": "Year",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Year([Date of Visit])"
          },
          {
            "name": "$ref:V_COUNT",
            "display": "No. Of Visits",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([Visit Id])"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::fixSqlFormatting sql is not valid [Required keyword: 'this' missing for <class 'sqlglot.expressions.And'>. Line 1, Col: 1969.\n  R_CASE_NOTES.OFFENDER_BOOK_ID ) AND (  AND AT_OFFENDER_CASE_NOTES.CASE_NOTE_TYPE IN ( 'POS','NEG' ) \u001b[4m)\u001b[0m]",
      "entityId": "Ftc9KwCmDQAArzMBAAAXPRQAACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::fixSqlFormatting sql is not valid [Required keyword: 'this' missing for <class 'sqlglot.expressions.And'>. Line 1, Col: 2737.\n  D=AT_VISIT_HIST_ESTAB.AGY_LOC_ID ) AND (  AND AT_OFFENDER_VISITS.VISIT_DATE > '29-11-2017 00:00:00' \u001b[4mAND\u001b[0m ( AT_OFFENDER_VISITS.VISIT_STATUS!='CANC' ) )]",
      "entityId": "Ftc9KwCmDQAArzMBAAAXPRQAACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_COUNT_ACTIVITIES :: Error: =Count([Activity Session Start Date/Time]) In ([NOMS Number]) ForEach ([Activity Description]) ==> Error: Expected end of input but \"F\" found.\n at undefined:1:63",
      "entityId": "Ftc9KwCmDQAArzMBAAAXPRQAACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_COUNT_ACTIVITIES :: Error: =Count([Activity Session Start Date/Time]) In ([NOMS Number]) ForEach ([Activity Description]) ==> Error: Expected end of input but \"F\" found.\n at undefined:1:63",
      "entityId": "Ftc9KwCmDQAArzMBAAAXPRQAACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[1] requires property \"dataset\"",
      "entityId": "Ftc9KwCmDQAArzMBAAAXPRQAACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Report Variant 214400.RS does not have corresponding dataset undefined",
      "entityId": "214400.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DPB_DO45 does not have corresponding dataset schema field",
      "entityId": "214417.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DPB_DO44 does not have corresponding dataset schema field",
      "entityId": "214417.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DPB_DO72 does not have corresponding dataset schema field",
      "entityId": "214417.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DPB_DO9C does not have corresponding dataset schema field",
      "entityId": "214417.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DPB_DOBF6 does not have corresponding dataset schema field",
      "entityId": "214417.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CONTACT_MONTH does not have corresponding dataset schema field",
      "entityId": "214417.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CONTACT_YEAR does not have corresponding dataset schema field",
      "entityId": "214417.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_COUNT does not have corresponding dataset schema field",
      "entityId": "214417.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP11_DO10044 does not have corresponding dataset schema field",
      "entityId": "214565.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP11_DO10045 does not have corresponding dataset schema field",
      "entityId": "214565.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP11_DO10072 does not have corresponding dataset schema field",
      "entityId": "214565.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP11_DO1009C does not have corresponding dataset schema field",
      "entityId": "214565.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP11_DO1082F does not have corresponding dataset schema field",
      "entityId": "214565.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP11_DO10DD6 does not have corresponding dataset schema field",
      "entityId": "214565.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_VISIT_MONTH does not have corresponding dataset schema field",
      "entityId": "214565.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_VISIT_YEAR does not have corresponding dataset schema field",
      "entityId": "214565.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_COUNT does not have corresponding dataset schema field",
      "entityId": "214565.RS",
      "entityType": "variant"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DP2",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DP5",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DPa",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "unable to generate test sql",
      "entityId": "3377299/DPb",
      "entityType": "dataset"
    }
  ]
}