{
  "id": "okiYPu8ABEhQUawASxiEcEP6FTY",
  "name": "ORS View Accommodation Details by Area",
  "description": "This report allows the user to view accommodation figures by establishment for one or more area(s).<br/>ACC0011 - v00.00.07",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "ACC0011  v00.00.07 drop10"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3377299/DP6",
      "name": "AccomodationDetails",
      "description": "Demographic",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT * FROM ( SELECT AT_CNA_AREAS.DESCRIPTION, AT_AGENCY_LOC_CNA.DESCRIPTION, DT_CELLS_OUTOFUSE.SpacesOutOfUse, nvl(sum(DT_CERTCELL_CNA.CNA_NO),0) FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, (  SELECT DISTINCT decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) as UnitCode1 , AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.Parent_Internal_Location_ID, AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_code, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_type, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_id, AT_AGENCY_INTERNAL_LOCATION_L4.CNA_NO FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4 WHERE AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_Location_type = 'CELL' and AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY >0 and AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG='Y' ) DT_CERTCELL_CNA, OMS_OWNER.AGENCY_LOCATIONS AT_AGENCY_LOC_CNA, AREAS AT_CNA_AREAS, USER_ACCESSIBLE_CASELOADS CNA_USER_ACCESSIBLE_CASELOADS, ( select decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) as UnitCode1 , AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY as SpacesOutOfUse, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_code, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_type, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_id, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.CNA_NO, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT From OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4 Where AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE='CELL' AND AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY >0 AND AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG='Y' AND AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG='N' ) DT_CELLS_OUTOFUSE WHERE ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_CELLS_OUTOFUSE.INTERNAL_LOCATION_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_CELLS_OUTOFUSE.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_CERTCELL_CNA.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_CERTCELL_CNA.PARENT_INTERNAL_LOCATION_ID(+) ) AND ( AT_AGENCY_LOC_CNA.AREA_CODE=AT_CNA_AREAS.AREA_CODE ) AND ( AT_AGENCY_LOC_CNA.AGY_LOC_ID=AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.USERNAME=UPPER('SSTOW') ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.CASELOAD_ID=AT_AGENCY_LOC_CNA.AGY_LOC_ID ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.USERNAME=UPPER('SSTOW') ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.USERNAME=UPPER('SSTOW') ) AND ( ( AT_CNA_AREAS.DESCRIPTION in ('South Central') or 'All' in ('South Central') ) AND ( decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) != ('RECP') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE is not null ) AND ( decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) NOT IN('COURT','CSWAP','ECL','TAP','CMOV','CELL_MV') ) ) GROUP BY AT_CNA_AREAS.DESCRIPTION, AT_AGENCY_LOC_CNA.DESCRIPTION, DT_CELLS_OUTOFUSE.SpacesOutOfUse ) _query0 FULL OUTER JOIN ( SELECT AT_CNA_AREAS.DESCRIPTION, AT_AGENCY_LOC_CNA.DESCRIPTION, DT_CELLS_OUTOFUSE.SpacesOutOfUse, nvl(sum(DT_WING_CAPACITY.OPERATION_CAPACITY),0) FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_LOCATIONS AT_AGENCY_LOC_CNA, ( /*gives occupancy, baseline and max capacities etc for wings/blocks REGARDLESS of whether or not they are certified or active*/ SELECT DISTINCT decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) as UnitCode1 , AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_code, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_type, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_id FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4 WHERE AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_Location_type IN( 'WING','BLK') and AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY>0 and AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID IN (select agy_loc_id from oms_owner.agency_locations where housing_lev_1_code IN( 'WING','BLK')) ) DT_WING_CAPACITY, AREAS AT_CNA_AREAS, USER_ACCESSIBLE_CASELOADS CNA_USER_ACCESSIBLE_CASELOADS, ( select decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) as UnitCode1 , AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY as SpacesOutOfUse, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_code, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_type, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_id, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.CNA_NO, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT From OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4 Where AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE='CELL' AND AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY >0 AND AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG='Y' AND AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG='N' ) DT_CELLS_OUTOFUSE WHERE ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_WING_CAPACITY.INTERNAL_LOCATION_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_WING_CAPACITY.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_CELLS_OUTOFUSE.INTERNAL_LOCATION_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_CELLS_OUTOFUSE.AGY_LOC_ID(+) ) AND ( AT_AGENCY_LOC_CNA.AREA_CODE=AT_CNA_AREAS.AREA_CODE ) AND ( AT_AGENCY_LOC_CNA.AGY_LOC_ID=AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.USERNAME=UPPER('SSTOW') ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.CASELOAD_ID=AT_AGENCY_LOC_CNA.AGY_LOC_ID ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.USERNAME=UPPER('SSTOW') ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.USERNAME=UPPER('SSTOW') ) AND ( ( AT_CNA_AREAS.DESCRIPTION in ('South Central') or 'All' in ('South Central') ) AND ( decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) != ('RECP') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE is not null ) AND ( decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) NOT IN('COURT','CSWAP','ECL','TAP','CMOV','CELL_MV') ) ) GROUP BY AT_CNA_AREAS.DESCRIPTION, AT_AGENCY_LOC_CNA.DESCRIPTION, DT_CELLS_OUTOFUSE.SpacesOutOfUse ) _query1 ON _query0.OFFENDER_ID_DISPLAY = _query1.OFFENDER_ID_DISPLAY ( SELECT AT_CNA_AREAS.DESCRIPTION, AT_AGENCY_LOC_CNA.DESCRIPTION, DT_CELLS_OUTOFUSE.SpacesOutOfUse, nvl(sum(DT_CERTCELL_CNA.CNA_NO),0) FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, (  SELECT DISTINCT decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) as UnitCode1 , AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.Parent_Internal_Location_ID, AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_code, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_type, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_id, AT_AGENCY_INTERNAL_LOCATION_L4.CNA_NO FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4 WHERE AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_Location_type = 'CELL' and AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY >0 and AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG='Y' ) DT_CERTCELL_CNA, OMS_OWNER.AGENCY_LOCATIONS AT_AGENCY_LOC_CNA, AREAS AT_CNA_AREAS, USER_ACCESSIBLE_CASELOADS CNA_USER_ACCESSIBLE_CASELOADS, ( select decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) as UnitCode1 , AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY as SpacesOutOfUse, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_code, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_type, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_id, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.CNA_NO, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT From OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4 Where AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE='CELL' AND AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY >0 AND AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG='Y' AND AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG='N' ) DT_CELLS_OUTOFUSE WHERE ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_CELLS_OUTOFUSE.INTERNAL_LOCATION_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_CELLS_OUTOFUSE.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_CERTCELL_CNA.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_CERTCELL_CNA.PARENT_INTERNAL_LOCATION_ID(+) ) AND ( AT_AGENCY_LOC_CNA.AREA_CODE=AT_CNA_AREAS.AREA_CODE ) AND ( AT_AGENCY_LOC_CNA.AGY_LOC_ID=AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.USERNAME=UPPER('SSTOW') ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.CASELOAD_ID=AT_AGENCY_LOC_CNA.AGY_LOC_ID ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.USERNAME=UPPER('SSTOW') ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.USERNAME=UPPER('SSTOW') ) AND ( ( AT_CNA_AREAS.DESCRIPTION in ('South Central') or 'All' in ('South Central') ) AND ( decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) != ('RECP') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE is not null ) AND ( decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) NOT IN('COURT','CSWAP','ECL','TAP','CMOV','CELL_MV') ) ) GROUP BY AT_CNA_AREAS.DESCRIPTION, AT_AGENCY_LOC_CNA.DESCRIPTION, DT_CELLS_OUTOFUSE.SpacesOutOfUse ) _query0 FULL OUTER JOIN ( SELECT AT_CNA_AREAS.DESCRIPTION, AT_AGENCY_LOC_CNA.DESCRIPTION, DT_CELLS_OUTOFUSE.SpacesOutOfUse, sum(DT_TAP_BY_LOC.TEMPABS) FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_LOCATIONS AT_AGENCY_LOC_CNA, (  SELECT AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.parent_INTERNAL_LOCATION_ID, COUNT( DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY) as TempAbs FROM OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS WHERE ( AT_OFFENDER.OFFENDER_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID=AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID(+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID=AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=AT_OFFENDERS_LOCATIONS.AGY_LOC_ID(+) ) and AT_OFFENDER_BOOKING.ACTIVE_FLAG='Y' AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE='INST' ) AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE = 'OUT' and AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE='TAP' And AT_OFFENDER_EXTERNAL_MOVEMENTS.ACTIVE_FLAG = 'Y' AND AT_OFFENDER_BOOKING.IN_OUT_STATUS = 'OUT' And (AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID, AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE, AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TIME) in (Select OFFENDER_BOOK_ID, Max(MOVEMENT_DATE), Max(MOVEMENT_TIME) From OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS Group By OFFENDER_BOOK_ID) GROUP BY AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.parent_INTERNAL_LOCATION_ID ) DT_TAP_BY_LOC, AREAS AT_CNA_AREAS, USER_ACCESSIBLE_CASELOADS CNA_USER_ACCESSIBLE_CASELOADS, ( select decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) as UnitCode1 , AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID, AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY as SpacesOutOfUse, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_code, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_type, AT_AGENCY_INTERNAL_LOCATION_L4.internal_location_id, AT_AGENCY_INTERNAL_LOCATION_L4.CAPACITY, AT_AGENCY_INTERNAL_LOCATION_L4.CNA_NO, AT_AGENCY_INTERNAL_LOCATION_L4.NO_OF_OCCUPANT From OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4 Where AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_TYPE='CELL' AND AT_AGENCY_INTERNAL_LOCATION_L4.OPERATION_CAPACITY >0 AND AT_AGENCY_INTERNAL_LOCATION_L4.CERTIFIED_FLAG='Y' AND AT_AGENCY_INTERNAL_LOCATION_L4.ACTIVE_FLAG='N' ) DT_CELLS_OUTOFUSE WHERE ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_TAP_BY_LOC.AGY_LOC_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_TAP_BY_LOC.PARENT_INTERNAL_LOCATION_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID=DT_CELLS_OUTOFUSE.INTERNAL_LOCATION_ID(+) ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID=DT_CELLS_OUTOFUSE.AGY_LOC_ID(+) ) AND ( AT_AGENCY_LOC_CNA.AREA_CODE=AT_CNA_AREAS.AREA_CODE ) AND ( AT_AGENCY_LOC_CNA.AGY_LOC_ID=AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.USERNAME=UPPER('SSTOW') ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.CASELOAD_ID=AT_AGENCY_LOC_CNA.AGY_LOC_ID ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.USERNAME=UPPER('SSTOW') ) AND ( CNA_USER_ACCESSIBLE_CASELOADS.USERNAME=UPPER('SSTOW') ) AND ( ( AT_CNA_AREAS.DESCRIPTION in ('South Central') or 'All' in ('South Central') ) AND ( decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) != ('RECP') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.UNIT_TYPE is not null ) AND ( decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1),0,null,substr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1)+1,decode(instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2),0,length(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION),instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,2)-instr(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION,'-',1,1))-1)) NOT IN('COURT','CSWAP','ECL','TAP','CMOV','CELL_MV') ) ) GROUP BY AT_CNA_AREAS.DESCRIPTION, AT_AGENCY_LOC_CNA.DESCRIPTION, DT_CELLS_OUTOFUSE.SpacesOutOfUse ) _query3 ON _query0.OFFENDER_ID_DISPLAY = _query3.OFFENDER_ID_DISPLAY), dataset_ AS (SELECT FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": []
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "121690.RS",
      "name": "Accommodation Details By Area",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP6",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-section",
        "field": [
          {
            "name": "$ref:DP6_DOBD1",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP6_DO5B8",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP6_DOBD3",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP6_DO5BA",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP6_DO5BC",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP6_DOA28",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_PHYSICAL_VACANCIES",
            "display": "Spaces Out of Use",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Operational Capacity]-[Lock-Up Figure]-[Temporary Absence]"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::fixSqlFormatting sql is not valid",
      "entityId": "okiYPu8ABEhQUawASxiEcEP6FTY",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Dataset does not have any schema fields",
      "entityId": "3377299/DP6",
      "entityType": "dataset"
    },
    {
      "type": "schema",
      "error": "Report field DP6_DOBD1 does not have corresponding dataset schema field",
      "entityId": "121690.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP6_DO5B8 does not have corresponding dataset schema field",
      "entityId": "121690.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP6_DOBD3 does not have corresponding dataset schema field",
      "entityId": "121690.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP6_DO5BA does not have corresponding dataset schema field",
      "entityId": "121690.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP6_DO5BC does not have corresponding dataset schema field",
      "entityId": "121690.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP6_DOA28 does not have corresponding dataset schema field",
      "entityId": "121690.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_PHYSICAL_VACANCIES does not have corresponding dataset schema field",
      "entityId": "121690.RS",
      "entityType": "variant"
    },
    {
      "type": "sqlQuery",
      "error": "Error: NJS-005: invalid value for parameter 1",
      "entityId": "3377299/DP6",
      "entityType": "dataset"
    }
  ]
}