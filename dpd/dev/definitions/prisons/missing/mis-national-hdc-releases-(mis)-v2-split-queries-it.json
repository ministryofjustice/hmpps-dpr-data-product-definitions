{
  "id": "FljEfVpmYgQAmqoAAHDL5F4AACJIAFJ8",
  "name": "MIS National HDC Releases (MIS) v2 split queries IT",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "SEN0002 v00.00.04 drop10"
    ]
  },
  "description": "Landscape template",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3375368/DP2",
      "name": "HDC One (A-C)",
      "description": "MIS Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.BOOKING_NUMBER, CASE WHEN AT_SENT_START_DATE.DAY_DATE < '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END AS SENTENCE_START_DATE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA') THEN 'Recall' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '0' THEN 'Dead' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '1' THEN 'Indeterminate Sentence' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('2', '3') THEN 'Sentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('9', '10') OR AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'CIV_RMD' THEN 'Civil Prisoner' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('8', '11') THEN 'Immigration Detainee' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('12', '13', '14') THEN 'Remand' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, CASE WHEN AT_DIM_ASSESSMENT_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_ASSESSMENT_DATE.DAY_DATE END AS HDC_CHECKS_DONE_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'N' THEN 'NO' END AS HDC_PASSED_FLAG, AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_DESC, CASE WHEN AT_DIM_DECISION_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_DECISION_DATE.DAY_DATE END AS HDC_DECISION_DATE, DT_CURRENT_KEY_DATES.CURR_HDCED_DATE, DT_CURRENT_KEY_DATES.CURR_ARD_DATE, DT_CURRENT_KEY_DATES.CURR_CRD_DATE, AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, AT_FACT_MOV_EXT.REASON_CODE, AT_DIM_DATE_EXT_MOV.DAY_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'N' THEN 'NO' END AS HDC_REVIEW_FLAG, AT_OFFENDER_BOOKING.ACTIVE_STATUS, AT_FACT_MOV_EXT.TYPE, AT_FACT_MOV_EXT.DIRECTION_CODE, DT_EXT_MOVE_TO.LOCATION_TYPE_TO, DT_CURRENT_KEY_DATES.CURR_RELEASE_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE < '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS ARD_, CASE WHEN AT_CRD_DATE.DAY_DATE < '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CRD_, AT_FACT_MOV_EXT.REASON FROM BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_DIM_ASSESSMENT_DATE, BODIMIS.DIM_DATE AT_DIM_DECISION_DATE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, (SELECT AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK AS OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END AS CURR_APD_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS CURR_ARD_DATE, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CURR_CRD_DATE, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END AS CURR_ETD_DATE, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END AS CURR_HDCAD_DATE, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END AS CURR_HDCED_DATE, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END AS CURR_PED_DATE, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END AS CURR_LED_DATE, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END AS CURR_LTD_DATE, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END AS CURR_MTD_DATE, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END AS CURR_NPD_DATE, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END AS CURR_PRRD_DATE, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS CURR_RELEASE_DATE, CASE WHEN AT_SED_DATE.DAY_DATE <> '31/12/9000' THEN AT_SED_DATE.DAY_DATE END AS SED, MIN(CASE WHEN AT_SENT_START_DATE.DAY_DATE <> '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END) AS SSD, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END AS TARIFF, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END AS CURR_ROTL_DATE, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END AS CURR_ERSED_DATE, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END AS CURR_TERSED_DATE, at_fact_offender_sentence.tused_date_sk AS tused_sk, NULLIF(td.day_date, TO_DATE('31/12/9000', 'DD/MM/YYYY')) AS tused FROM BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_APD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, BODIMIS.DIM_DATE AT_ETD_DATE, BODIMIS.DIM_DATE AT_HDCAD_DATE, BODIMIS.DIM_DATE AT_HDCED_DATE, BODIMIS.DIM_DATE AT_PED_DATE, BODIMIS.DIM_DATE AT_LED_DATE, BODIMIS.DIM_DATE AT_LTD_DATE, BODIMIS.DIM_DATE AT_MTD_DATE, BODIMIS.DIM_DATE AT_NPD_DATE, BODIMIS.DIM_DATE AT_PRRD_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_SED_DATE, BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_TARIFF_DATE, BODIMIS.DIM_DATE AT_ROTL_DATE, BODIMIS.DIM_DATE AT_ERSED_DATE, BODIMIS.DIM_DATE AT_TERSED_DATE, bodimis.dim_date td WHERE AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK = AT_FACT_SENTENCE.OFFENDER_BOOKING_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.APD_DATE_SK = AT_APD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ETD_DATE_SK = AT_ETD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCAD_DATE_SK = AT_HDCAD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCED_DATE_SK = AT_HDCED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LED_DATE_SK = AT_LED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LTD_DATE_SK = AT_LTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.MTD_DATE_SK = AT_MTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.NPD_DATE_SK = AT_NPD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PRRD_DATE_SK = AT_PRRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.SED_DATE_SK = AT_SED_DATE.DATE_SK (+) AND AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TARIFF_DATE_SK = AT_TARIFF_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ROTL_DATE_SK = AT_ROTL_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ERSED_DATE_SK = AT_ERSED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TERSED_DATE_SK = AT_TERSED_DATE.DATE_SK (+) AND at_fact_offender_sentence.tused_date_sk = td.date_sk (+) AND AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y' GROUP BY AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END, CASE WHEN at_sed_date.day_date <> '31/12/9000' THEN at_sed_date.day_date END, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END, at_fact_offender_sentence.tused_date_sk, td.day_date) DT_CURRENT_KEY_DATES, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_CURFEW_ASSESSMENT AT_CURFEW_ASSESSMENT, BODIMIS.DIM_HDC_ASSESSMNT_APP_STATUS AT_DIM_HDC_ASST_APP_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT BODIMIS.FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, BODIMIS.FACT_OFFENDER_SENTENCE.EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.FACT_OFFENDER_SENTENCE WHERE (BODIMIS.FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y')) DT_CURREFFSENLEN, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, (SELECT BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_SK AS SK_ID_TO, BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS TYPE_DESCRIPTION_TO, 'Establishment' AS Location_Type_To FROM BODIMIS.DIM_ESTABLISHMENT UNION ALL SELECT BODIMIS.DIM_PROBATION_OFFICE.PROBATION_OFFICE_SK, BODIMIS.DIM_PROBATION_OFFICE.PROB_OFFICE_DESCRIPTION, 'Probation Office' AS Location_Type_To FROM BODIMIS.DIM_PROBATION_OFFICE UNION ALL SELECT BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_SK, BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_DESCRIPTION, 'Outside Location' AS Location_Type_To FROM BODIMIS.DIM_OUTSIDE_LOCATION UNION ALL SELECT BODIMIS.DIM_CITY.CITY_SK, BODIMIS.DIM_CITY.DESCRIPTION, 'City' AS Location_Type_To FROM BODIMIS.DIM_CITY UNION ALL SELECT BODIMIS.DIM_COURT.COURT_SK, BODIMIS.DIM_COURT.COURT_DESCRIPTION, 'Court' AS Location_Type_To FROM BODIMIS.DIM_COURT UNION ALL SELECT address_id_nk, TRIM(CASE WHEN no_fixed_address_flag = 'Y' THEN 'No fixed address' ELSE CASE WHEN NOT flat IS NULL THEN flat || '  ' END || CASE WHEN NOT premise IS NULL THEN premise || '  ' END || CASE WHEN NOT street IS NULL THEN street || '  ' END || CASE WHEN NOT locality IS NULL THEN locality || '  ' END || CASE WHEN NOT city_desc IS NULL THEN city_desc || '  ' END || CASE WHEN NOT county_desc IS NULL THEN county_desc || '  ' END || CASE WHEN NOT postal_code IS NULL THEN postal_code || '  ' END || CASE WHEN NOT country_desc IS NULL THEN country_desc END END), 'Home Leave Address' FROM bodimis.dim_addresses) DT_EXT_MOVE_TO, BODIMIS.DIM_COURT_CASE AT_COURT_CASE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE WHERE (AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+)) AND (AT_CURFEW_ASSESSMENT.HDC_ASSMENT_APP_STATUS_SK = AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_SK (+)) AND (AT_CURFEW_ASSESSMENT.ASSESSMENT_DATE_SK = AT_DIM_ASSESSMENT_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURRENT_KEY_DATES.OFFENDER_BOOKING_SK (+)) AND (AT_CURFEW_ASSESSMENT.DECISION_DATE_SK = AT_DIM_DECISION_DATE.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURREFFSENLEN.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (CASE WHEN AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = 'Establishment' THEN AT_FACT_MOV_EXT.FROM_LOCATION_SK END = AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_SENTENCE.COURT_CASE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_FACT_MOV_EXT.TO_LOCATION_SK = DT_EXT_MOVE_TO.SK_ID_TO (+) AND AT_FACT_MOV_EXT.TO_LOCATION_TYPE = DT_EXT_MOVE_TO.LOCATION_TYPE_TO (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_CURFEW_ASSESSMENT.OFFENDER_BOOKING_SK (+)) AND ((TRUNC(AT_DIM_DATE_EXT_MOV.DAY_DATE) BETWEEN TO_DATE('02-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND TO_DATE('09-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS')) AND AT_FACT_MOV_EXT.TYPE IN ('Release') AND AT_FACT_MOV_EXT.DIRECTION_CODE IN ('OUT') AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION IN ('ACKLINGTON (HMP)', 'ALBANY (HMP)', 'ALDINGTON (HMP)', 'ALTCOURSE (HMP)', 'ASHFIELD (HMP)', 'ASHWELL (HMP)', 'ASKHAM GRANGE (HMP & YOI)', 'AYLESBURY (HMP)', 'BEDFORD (HMP)', 'BELMARSH (HMP)', 'BERWYN (HMP)', 'BIRMINGHAM (HMP)', 'BLAKENHURST (HMP)', 'BLANTYRE HOUSE (HMP)', 'BLUNDESTON (HMP)', 'BRINSFORD (HMP)', 'BRISTOL (HMP)', 'BRIXTON (HMP)', 'BROCKHILL (HMP & YOI)', 'BRONZEFIELD (HMP)', 'BUCKLEY HALL (HMP)', 'BULLINGDON (HMP)', 'BULLWOOD HALL (HMP)', 'BURE (HMP)', 'CAMP HILL (HMP)', 'CAMPSFIELD HOUSE (HMYOI)', 'CANTERBURY (HMP)', 'CARDIFF (HMP)', 'CASTINGTON (HMP & YOI)', 'CHANNINGS WOOD (HMP)', 'CHELMSFORD (HMP)', 'CLELAND (HMP)', 'COLCHESTER (HMYOI)', 'COLDINGLEY (HMP)', 'COOKHAM WOOD (HMP)') AND NOT DT_CURRENT_KEY_DATES.CURR_HDCED_DATE IS NULL)), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, BOOKING_NUMBER, SENTENCE_START_DATE, EFFECTIVE_SENTENCE_LENGTH, LEGAL_STATUS_GROUPING, HDC_CHECKS_DONE_DATE, HDC_PASSED_FLAG, HDC_ASSMENT_APP_STATUS_DESC, HDC_DECISION_DATE, CURR_HDCED_DATE, CURR_ARD_DATE, CURR_CRD_DATE, ESTABLISHMENT_DESCRIPTION, MOVEMENT_TIME, REASON_CODE, DAY_DATE, HDC_REVIEW_FLAG, ACTIVE_STATUS, TYPE, DIRECTION_CODE, LOCATION_TYPE_TO, CURR_RELEASE_DATE, ARD_, CRD_, REASON FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP2.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "BOOKING_NUMBER",
            "type": "string",
            "display": "Booking Number",
            "legacyId": "DP2.DO10077",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SENTENCE_START_DATE",
            "type": "date",
            "display": "Sentence Start Date",
            "legacyId": "DP2.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DP2.DO2d0",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DP2.DO107cb",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "HDC_CHECKS_DONE_DATE",
            "type": "date",
            "display": "HDC Checks Done Date",
            "legacyId": "DP2.DO54a",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "HDC_PASSED_FLAG",
            "type": "string",
            "display": "HDC Passed Flag",
            "legacyId": "DP2.DO3ad",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "HDC_ASSMENT_APP_STATUS_DESC",
            "type": "string",
            "display": "HDC Status",
            "legacyId": "DP2.DO54",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "HDC_DECISION_DATE",
            "type": "date",
            "display": "HDC Decision Date",
            "legacyId": "DP2.DO3b0",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CURR_HDCED_DATE",
            "type": "date",
            "display": "HDC Eligibility Date",
            "legacyId": "DP2.DO70",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "CURR_ARD_DATE",
            "type": "date",
            "display": "ARD (Approved Release Date)",
            "legacyId": "DP2.DO47",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "CURR_CRD_DATE",
            "type": "date",
            "display": "CRD (Conditional Release Date)",
            "legacyId": "DP2.DO48",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Movement Location From Description (External)",
            "legacyId": "DP2.DO1015d",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DP2.DO107ce",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "REASON_CODE",
            "type": "string",
            "display": "Movement Reason Code (External)",
            "legacyId": "DP2.DO103fc",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date Only (External)",
            "legacyId": "DP2.DO1015c",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "HDC_REVIEW_FLAG",
            "type": "string",
            "display": "HDC Review Flag",
            "legacyId": "DP2.DO3ae",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "ACTIVE_STATUS",
            "type": "string",
            "display": "Active Status",
            "legacyId": "DP2.DO104d5",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "TYPE",
            "type": "string",
            "display": "Movement Type (External)",
            "legacyId": "DP2.DO103ec",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "DIRECTION_CODE",
            "type": "string",
            "display": "Movement Direction Code (External)",
            "legacyId": "DP2.DO103fd",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "LOCATION_TYPE_TO",
            "type": "string",
            "display": "Location Type To",
            "legacyId": "DP2.DO10768",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "CURR_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DP2.DO2e6",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "ARD_",
            "type": "date",
            "display": "ARD (Approved Release Date) (Historical)",
            "legacyId": "DP2.DO30d",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "CRD_",
            "type": "date",
            "display": "CRD (Conditional Release Date) (Historical)",
            "legacyId": "DP2.DO30a",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "REASON",
            "type": "string",
            "display": "Movement Description (External)",
            "legacyId": "DP2.DO1015b",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP3",
      "name": "MIS Load Date",
      "description": "MIS Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT BODIMIS.ETL_LOAD_LOG.BUSINESS_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT BUSINESS_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BUSINESS_DATE",
            "type": "date",
            "display": "Latest Business Date Available",
            "legacyId": "DP3.DO104dd",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP7",
      "name": "All Admissions",
      "description": "MIS Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_FACT_MOV_EXT.TYPE, AT_FACT_MOV_EXT.DIRECTION_CODE, DT_EXT_MOVE_TO.LOCATION_TYPE_TO, AT_FACT_MOV_EXT.MOVEMENT_SEQ, AT_DIM_DATE_EXT_MOV.DAY_DATE FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, (SELECT BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_SK AS SK_ID_TO, BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS TYPE_DESCRIPTION_TO, 'Establishment' AS Location_Type_To FROM BODIMIS.DIM_ESTABLISHMENT UNION ALL SELECT BODIMIS.DIM_PROBATION_OFFICE.PROBATION_OFFICE_SK, BODIMIS.DIM_PROBATION_OFFICE.PROB_OFFICE_DESCRIPTION, 'Probation Office' AS Location_Type_To FROM BODIMIS.DIM_PROBATION_OFFICE UNION ALL SELECT BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_SK, BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_DESCRIPTION, 'Outside Location' AS Location_Type_To FROM BODIMIS.DIM_OUTSIDE_LOCATION UNION ALL SELECT BODIMIS.DIM_CITY.CITY_SK, BODIMIS.DIM_CITY.DESCRIPTION, 'City' AS Location_Type_To FROM BODIMIS.DIM_CITY UNION ALL SELECT BODIMIS.DIM_COURT.COURT_SK, BODIMIS.DIM_COURT.COURT_DESCRIPTION, 'Court' AS Location_Type_To FROM BODIMIS.DIM_COURT UNION ALL SELECT address_id_nk, TRIM(CASE WHEN no_fixed_address_flag = 'Y' THEN 'No fixed address' ELSE CASE WHEN NOT flat IS NULL THEN flat || '  ' END || CASE WHEN NOT premise IS NULL THEN premise || '  ' END || CASE WHEN NOT street IS NULL THEN street || '  ' END || CASE WHEN NOT locality IS NULL THEN locality || '  ' END || CASE WHEN NOT city_desc IS NULL THEN city_desc || '  ' END || CASE WHEN NOT county_desc IS NULL THEN county_desc || '  ' END || CASE WHEN NOT postal_code IS NULL THEN postal_code || '  ' END || CASE WHEN NOT country_desc IS NULL THEN country_desc END END), 'Home Leave Address' FROM bodimis.dim_addresses) DT_EXT_MOVE_TO, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV WHERE (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_FACT_MOV_EXT.TO_LOCATION_SK = DT_EXT_MOVE_TO.SK_ID_TO (+) AND AT_FACT_MOV_EXT.TO_LOCATION_TYPE = DT_EXT_MOVE_TO.LOCATION_TYPE_TO (+)) AND (AT_FACT_MOV_EXT.TYPE IN ('Admission') AND AT_FACT_MOV_EXT.DIRECTION_CODE IN ('IN') AND DT_EXT_MOVE_TO.LOCATION_TYPE_TO IN ('Establishment') AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A3752DY', 'A4026AN', 'A9196EC', 'A7238DH', 'A7951EC', 'A5259AL', 'A4106EC', 'A0995DR', 'A0806DV', 'A8258DD', 'A8917DE', 'A9708CZ', 'A7449DW', 'A2904DP', 'A5819AY', 'A2343DX', 'A0200ED', 'A2904DZ', 'A4139CP', 'A5789DZ', 'A0130CY', 'A4816AN', 'A3437AH', 'A6053EA', 'A2322DX', 'A8183CH', 'A8131DY', 'A1264CY', 'A9400DE', 'A3950CZ', 'A0366AD', 'A0700DZ', 'A5262AM', 'A7303DF', 'A7694DX', 'A7504DG', 'A5186EC', 'A0802DM', 'A5015CK', 'A3915EC', 'A1699DK', 'A1959CA', 'A3565DZ', 'A8609AG', 'A1428CM', 'A0027DR', 'A8244DZ', 'A0750DW', 'A9554AV', 'A6640CA', 'A3054DL', 'A9069DC', 'A0369ED', 'A9121DZ', 'A2789DC', 'A1075CX', 'A9947DT', 'A8597AR', 'A3530AF', 'A8940EC', 'A4550AX', 'A2067CR', 'A3816AH', 'A6490CA', 'A8262EC', 'A3985EC', 'A5123AT', 'A6842EC', 'A8518CM', 'A4192EC', 'A3224DQ', 'A3607AN', 'A7422CV', 'A8976DA', 'A8321DX', 'A4678CF', 'A4034AH', 'A5807CQ', 'A0244CL', 'A7118DX', 'A4493EC', 'A4035DW', 'A2947CK', 'A6858AK', 'A9814EC', 'A5440DQ', 'A3024DZ', 'A3778AD', 'A8744CE', 'A5917AD', 'A2214EC', 'A2097DJ', 'A4231DY', 'A5471DA', 'A2212AX', 'A8219AG', 'A1425EC', 'A7328CZ', 'A4139AD', 'A4344EC', 'A0078CJ', 'A0228AQ', 'A7244AY', 'A0937DV', 'A5151AL', 'A5193EC', 'A7885EC', 'A3002AZ', 'A5423DY', 'A1517CY', 'A7949AJ', 'A7201AZ', 'A9738EA', 'A5035AP', 'A6544CG', 'A0050AY', 'A1346DN', 'A5369DZ', 'A8958EC', 'A9603DY', 'A7278CV', 'A9955CP', 'A3916EC', 'A7450EC', 'A3027DQ', 'A6337EC', 'A8685EA', 'A1842CM', 'A1680CK', 'A7697EC', 'A3859DY', 'A7733EC', 'A9192EC', 'A3376CR', 'A7253DD', 'A7743AR', 'A7071EC', 'A1178EC', 'A2714CP', 'A2310CX', 'A5389EC', 'A0998CD', 'A6375DZ', 'A0415CR', 'A9570EA', 'A2489EC', 'A3996EC', 'A1251ED', 'A0655ED', 'A2763DR', 'A8410AG', 'A0564AZ', 'A9873EA', 'A0559ED', 'A3429EC', 'A8669EA', 'A1373CK', 'A0824ED', 'A0586EC', 'A5806DY', 'A9445EC', 'A0984ED', 'A4538EC', 'A0004ED', 'A3331CM', 'A8879DJ', 'A1811DZ', 'A5900DZ', 'A3556CK', 'A9721AG') OR AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A5450DW', 'A4165DA', 'A8863DK', 'A0856ED', 'A2759DF', 'A3497CP', 'A1552DP', 'A1785DJ', 'A6051DT', 'A6661CE', 'A6284DX', 'A7300AH', 'A2003DM', 'A6753AM', 'A0745ED', 'A7723AH', 'A2859CM', 'A3377DZ', 'A7923CR', 'A2113DY', 'A0770DN', 'A2790EC', 'A5505DC', 'A1775DK', 'A8540EC', 'A5579DT', 'A7495DY', 'A7466DY', 'A7852EA', 'A9853AV', 'A4625CE', 'A4238CD', 'A0900DX', 'A0490DX', 'A2415DZ', 'A5503AF', 'A6458AM', 'A2505CY', 'A0141ED', 'A4457DP', 'A3484DJ', 'A1324EC', 'A7928EC', 'A4187DY', 'A4024AL', 'A0562AY', 'A5098AY', 'A1131DG', 'A1928EC', 'A6288CQ', 'A2696DY', 'A4585CG', 'A9493DM', 'A1761AG', 'A2949CT', 'A0742AC', 'A9162CF', 'A2251CH', 'A9758EC', 'A9142AA', 'A1093DM', 'A1610DX', 'A6406EA', 'A2242AD', 'A0003CP', 'A2344DY', 'A0380DX', 'A5056DZ', 'A6914EC', 'A7355DZ', 'A1047AP', 'A8322DW', 'A5593DV', 'A4145DL', 'A5340AN', 'A7729DY', 'A0733EC', 'A8533AW', 'A3102DZ', 'A6834DY', 'A7356DH', 'A3605DY', 'A7999DV', 'A8249CV', 'A6146DZ', 'A6963DE', 'A1942DX', 'A8361CD', 'A0958ED', 'A7171DV', 'A8452DW', 'A0141AR', 'A6112DZ', 'A2290EA', 'A4576DV', 'A2744DD', 'A4547AV', 'A3982EC', 'A5701EA', 'A6657CV', 'A3118EA', 'A6050DZ', 'A3817EC', 'A8274DX', 'A5357EC', 'A7996EC', 'A4411DX', 'A7353AW', 'A9508EA', 'A8151DX', 'A7780EC', 'A7348EA', 'A0924DT', 'A3802CQ', 'A5437DP', 'A3075CY', 'A8747EC', 'A6699AJ', 'A8071DY', 'A8550EA', 'A4191DY', 'A1167DA', 'A1985EA', 'A7673DY', 'A5431DL', 'A5942EC', 'A9799CV') OR AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A3431CY', 'A4071EC', 'A4509DW', 'A9107AX', 'A9635DT', 'A5136DW', 'A3113AK', 'A9717DX', 'A4101CE', 'A9515AW', 'A8415CE', 'A2043CA', 'A5493AN', 'A5368AR', 'A6014AY', 'A9361AD', 'A2960CZ', 'A8269AF', 'A9407AY', 'A2744AN', 'A3434DK', 'A6922AP', 'A3888DV', 'A0738AC', 'A7677EA', 'A5366CY', 'A1440AQ', 'A7760DX', 'A0110AC', 'A1870AC', 'A8814DW', 'A3432CR', 'A2757DL', 'A8401AQ', 'A7836AD', 'A8517AM', 'A9148CA', 'A5002CP', 'A3441DY', 'A6569DZ', 'A2286EA', 'A5126AV', 'A6074DW', 'A6202DJ', 'A1447AE', 'A5392AQ', 'A1172DA', 'A0155DY', 'A9378AX', 'A4131AT', 'A8266AV', 'A1218DH', 'A6101AL', 'A3325AV', 'A5737EA', 'A1990AG', 'A8779AL', 'A4030EC', 'A4881DY', 'A8045CE', 'A9723AP', 'A5066CZ', 'A1846CR', 'A6749DV', 'A0802DZ', 'A3205AN', 'A7800DP', 'A5845AE', 'A6005AE', 'A8547DJ', 'A3976CG', 'A7341AD', 'A7652EA', 'A5213EA', 'A3725CE', 'A4120DX', 'A9694DH', 'A6542DV', 'A2056AW', 'A4331DW', 'A6666CE', 'A9602DK', 'A9791DY', 'A4019DR', 'A7342AM', 'A6114DZ', 'A7895CE', 'A0416CZ', 'A8769DV', 'A1526DZ', 'A7494DZ', 'A4371AF', 'A8677AD', 'A4938CG', 'A5260DY', 'A3683EA', 'A0387AE', 'A6966EA', 'A1907AP', 'A0003EC', 'A6375DW', 'A8383CN', 'A5413DQ', 'A6105EA', 'A6075DY', 'A8880EC', 'A0401ED', 'A7699DZ', 'A8033DZ', 'A3220DZ', 'A4487AX', 'A7357DR', 'A8396EC', 'A2862AE', 'A3211DE', 'A8223AG', 'A1157AD', 'A0641AK', 'A4899EC', 'A2306AV', 'A7643CA', 'A9679AR', 'A0060DZ', 'A1190DY', 'A0184AC', 'A6352DN', 'A3790DY', 'A3273DY', 'A0491AR', 'A8484DR', 'A1575DZ', 'A5123DZ', 'A1115CW', 'A7517EC', 'A8367DW', 'A9256DX', 'A6615EC', 'A3342AN', 'A1236DY', 'A7485DY', 'A6603EC', 'A9009DM', 'A3663DY', 'A0626AC', 'A9275DX', 'A1704DA', 'A2011EA', 'A8639EA', 'A2043EC') OR AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A0254DN', 'A1091AE', 'A6366EA', 'A9502AH', 'A6414AC', 'A5321EC', 'A2409AF', 'A4268EC', 'A3363EC', 'A6010AQ', 'A3533CE', 'A5977AG', 'A6658DW', 'A4326DP', 'A6127DL', 'A5964AX', 'A3440AJ', 'A3774DJ', 'A6935CK', 'A4476CF', 'A6677CW', 'A9695EC', 'A5855DG', 'A4248EC', 'A9377DE', 'A7854AF', 'A6244CG', 'A5267AH', 'A4937AD', 'A1233AQ', 'A0977AQ', 'A9431AE', 'A9076AM', 'A4770AR', 'A1084CR', 'A5735EA', 'A4618DX', 'A1658DX', 'A6308CP', 'A7167AK', 'A7362AC', 'A9807CP', 'A9959DL', 'A3524CD', 'A4251DL', 'A2761DV', 'A3712DZ', 'A4100AV', 'A6859DX', 'A1767CC', 'A9903DZ', 'A4627DX', 'A0341AK', 'A6180AC', 'A7185DL', 'A0462AE', 'A1571AH', 'A0945AK', 'A3315EC', 'A0684EA', 'A1826AQ', 'A2547EC', 'A2960AG', 'A2664AX', 'A5455DW', 'A6034EC', 'A6534DJ', 'A6047CJ', 'A3142DE', 'A2016DM', 'A2281AP', 'A5589DX', 'A3874AR', 'A2234CQ', 'A7165AZ', 'A9003DM', 'A9573CL', 'A9564AH', 'A7770DX', 'A7996DZ', 'A6220DZ', 'A0867ED', 'A4057DY', 'A9230AW', 'A3255CE', 'A4086AP', 'A9348EC', 'A8722EA', 'A9695DE', 'A6552CN', 'A6958CE', 'A0247DM', 'A9567EA', 'A3350DZ', 'A5329AR', 'A5424AV', 'A7608DY', 'A7435DV', 'A7075CY', 'A0114DX', 'A0299AK', 'A6628DW', 'A0048DQ', 'A0983ED', 'A3980CF', 'A6169EC', 'A7328DR', 'A0090DX', 'A2709DK', 'A9849AE', 'A6184DQ', 'A7297EC', 'A2658AH', 'A6668DZ', 'A5355AK', 'A5377DW', 'A1738CF', 'A9222DY', 'A2584AW', 'A2768EA', 'A6283DH', 'A7983DW', 'A3021AC', 'A9774EC', 'A3861EC', 'A5696DZ', 'A4054DY', 'A8973AK', 'A1721DY', 'A9524EC', 'A7696EA', 'A0871ED', 'A8466AY', 'A4730CQ', 'A4246DZ', 'A5097DM', 'A1969AH', 'A4480EC', 'A8999AR', 'A9426EA', 'A5418AE', 'A6190EC', 'A1273ED', 'A9242DY', 'A3420EC', 'A9911DZ', 'A7477DZ', 'A0024DG', 'A9561DR', 'A8353AC', 'A6875DW', 'A1917DW', 'A9855AF', 'A5746AF', 'A5786DY', 'A6004DZ', 'A3813DZ', 'A2817AF', 'A8604AJ', 'A7837DX', 'A9561AH', 'A1218ED', 'A0031EC', 'A2902AC', 'A0877ED', 'A3788EC', 'A9791EC', 'A4841DD', 'A1269DW', 'A6388CN', 'A8016CV') OR AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A1999CT', 'A0232AL', 'A5119DY', 'A6403AN', 'A3231AC', 'A1214AC', 'A5866AE', 'A2042DX', 'A9562DY', 'A1687AA', 'A9845EA', 'A9451EC', 'A6060EA', 'A3863DV', 'A0971CY', 'A7538DR', 'A6494DE', 'A7361AA', 'A8988AA', 'A4527CJ', 'A8370AF', 'A4094AC', 'A1005CV', 'A7240DT', 'A1588DV', 'A5623DQ', 'A1275AW', 'A3784AZ', 'A1436DW', 'A1352EC', 'A6969AE', 'A6594AY', 'A2455DX', 'A5606DX', 'A7974DW', 'A7473EC', 'A9086CN', 'A5539EC', 'A8586DX', 'A8485AG', 'A9768DY', 'A8593CC', 'A4920AZ', 'A5589DX', 'A3998AF', 'A3203DY', 'A7411CJ', 'A2136DQ', 'A9838DV', 'A2546AJ', 'A5846CP', 'A3095AY', 'A1696EC', 'A7397DV', 'A9984CG', 'A8825DN', 'A1059ED', 'A9861AP', 'A4062DC', 'A5537DL', 'A0402AE', 'A3087DF', 'A4313DC', 'A4997DX', 'A9131EC', 'A4127AP', 'A7026DE', 'A8486AD', 'A9469DL', 'A8613DY', 'A1878AE', 'A2690DK', 'A6679AX', 'A5306CV', 'A5769EC', 'A9182EC', 'A4023DZ', 'A0920CJ', 'A1175ED', 'A3751CD', 'A8202DD', 'A2341EA', 'A1581CY', 'A4317EC', 'A5380AJ', 'A1244DQ', 'A0825AG', 'A2768EA', 'A1855AE', 'A8598EC', 'A8256AX', 'A7890EC', 'A0682DA', 'A9524EC', 'A6558AV', 'A7782AY', 'A2400DZ', 'A0274DC', 'A7319AQ', 'A7661EA', 'A0189ED', 'A5148EC', 'A1054EC', 'A8370CV', 'A5746AF', 'A2333CJ', 'A8578EC', 'A8738AT', 'A8749EC', 'A0337EC', 'A6589CZ', 'A6823EC', 'A8733CM', 'A8072DZ', 'A7843DX', 'A9920DD', 'A4977AW', 'A1218ED', 'A9117DV', 'A8126DX', 'A9567EC', 'A7483EC', 'A3702DV', 'A4618EC', 'A5592DZ', 'A3278EA', 'A1200AL') OR AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A0334CW', 'A3562AK', 'A4979DE', 'A2088DZ', 'A2078AK', 'A6839DN', 'A7054AE', 'A9519AM', 'A9157DY', 'A6655DK', 'A5447DY', 'A5409AL', 'A7525AD', 'A0847AV', 'A5291EC', 'A9126DK', 'A1219EC', 'A4242AZ', 'A5985CD', 'A4741DR', 'A8348AF', 'A6566DM', 'A2355EC', 'A2770DF', 'A6831AQ', 'A5854AD', 'A0071ED', 'A6027AJ', 'A1389DE', 'A7569DX', 'A2362EA', 'A9154DA', 'A3846AJ', 'A5607DZ', 'A8483AW', 'A3923DV', 'A2191DV', 'A6469AH', 'A8052DZ', 'A9208EC', 'A3785EC', 'A4826DF', 'A8086DG', 'A7616EC', 'A6175CZ', 'A2895DZ', 'A4481DM', 'A5990DY', 'A1819DT', 'A6952CP', 'A4777AT', 'A4191DW', 'A8040DZ', 'A8818CL', 'A3802DY', 'A1508DT', 'A6568EC', 'A4214DD', 'A7079EC', 'A4752CY', 'A1164ED', 'A6010CN', 'A1328CE', 'A7314EA', 'A2451DX', 'A4880CC', 'A4199DX', 'A4283DV', 'A0808CN', 'A4819AR', 'A7991EA', 'A0529DD', 'A6290DY', 'A0850DC', 'A8590EC', 'A1636EC', 'A7177CN', 'A4075CZ', 'A1824AQ', 'A1086CM', 'A7076EC', 'A9978DL', 'A7434CP', 'A9034CT', 'A8072DZ', 'A6175DZ', 'A3399DZ', 'A6295EC', 'A7869EC', 'A4234CC', 'A0995AM', 'A4292EC', 'A3756EC', 'A3082AP', 'A1465ED', 'A3527CH', 'A1082EC', 'A6652AK', 'A3767EC', 'A1238ED', 'A3593EC', 'A3721EC', 'A8160EA') OR AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A2830DE', 'A5119DY', 'A6871AL', 'A3289DM', 'A4880DW', 'A0880CK', 'A9876EC', 'A0462AQ', 'A8084CZ', 'A0477DR', 'A4366DM', 'A4081CR', 'A1966AR', 'A2872CQ', 'A4885CV', 'A0645AK', 'A1454DT', 'A1029EA', 'A3447CP', 'A3593DZ', 'A5631CW') OR AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A2465CC', 'A5342DY', 'A4548DX', 'A9415DM', 'A5713AE', 'A8803AK', 'A7098DY', 'A1109ED', 'A2793EC', 'A7477CV', 'A6677EA', 'A9766AT', 'A4570AV', 'A9513CC', 'A3328DQ', 'A6099DR', 'A0320CA', 'A9423AX', 'A8354EC', 'A4249AM', 'A8326CX', 'A6612AK', 'A4094CJ', 'A2405DY', 'A6057DM', 'A6535AR', 'A8959DX', 'A2703EC', 'A9924DW', 'A4016DX', 'A9157DW', 'A8907AX', 'A0121DZ', 'A5124DY', 'A2891CT', 'A3551CX', 'A4060EC', 'A6085AX', 'A8598AL', 'A5169AP', 'A4683CA', 'A8998EA', 'A3487DZ', 'A0441DT', 'A3329CG', 'A6417EC', 'A1430DX', 'A1891DC', 'A4575DP', 'A1207CL', 'A9873AX', 'A7001AX', 'A0675EC', 'A6575CK', 'A7671EA', 'A8062DR', 'A4881AL', 'A9071DA', 'A7990AA', 'A7227AT', 'A9518EC', 'A4723EA', 'A6605DD', 'A5403AA', 'A6796CH', 'A4837AX', 'A3784DR', 'A9893EC', 'A5928EC', 'A8595CK', 'A0760AM', 'A8638EA', 'A4440EC', 'A2582EA', 'A9748CX', 'A6614EC', 'A0634CT', 'A3100CT', 'A5148AQ', 'A4112AK', 'A2651CR', 'A4099DZ', 'A3585EC', 'A9369CF')))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, TYPE, DIRECTION_CODE, LOCATION_TYPE_TO, MOVEMENT_SEQ, DAY_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP7.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "TYPE",
            "type": "string",
            "display": "Movement Type (External)",
            "legacyId": "DP7.DO103ec",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "DIRECTION_CODE",
            "type": "string",
            "display": "Movement Direction Code (External)",
            "legacyId": "DP7.DO103fd",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "LOCATION_TYPE_TO",
            "type": "string",
            "display": "Location Type To",
            "legacyId": "DP7.DO10768",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "MOVEMENT_SEQ",
            "type": "double",
            "display": "Movement Sequence",
            "legacyId": "DP7.DO103e5",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date Only (External)",
            "legacyId": "DP7.DO1015c",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP9",
      "name": "HDC One (D- F) ",
      "description": "MIS Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.BOOKING_NUMBER, CASE WHEN AT_SENT_START_DATE.DAY_DATE < '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END AS SENTENCE_START_DATE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA') THEN 'Recall' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '0' THEN 'Dead' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '1' THEN 'Indeterminate Sentence' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('2', '3') THEN 'Sentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('9', '10') OR AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'CIV_RMD' THEN 'Civil Prisoner' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('8', '11') THEN 'Immigration Detainee' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('12', '13', '14') THEN 'Remand' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, CASE WHEN AT_DIM_ASSESSMENT_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_ASSESSMENT_DATE.DAY_DATE END AS HDC_CHECKS_DONE_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'N' THEN 'NO' END AS HDC_PASSED_FLAG, AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_DESC, CASE WHEN AT_DIM_DECISION_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_DECISION_DATE.DAY_DATE END AS HDC_DECISION_DATE, DT_CURRENT_KEY_DATES.CURR_HDCED_DATE, DT_CURRENT_KEY_DATES.CURR_ARD_DATE, DT_CURRENT_KEY_DATES.CURR_CRD_DATE, AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, AT_FACT_MOV_EXT.REASON_CODE, AT_DIM_DATE_EXT_MOV.DAY_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'N' THEN 'NO' END AS HDC_REVIEW_FLAG, AT_OFFENDER_BOOKING.ACTIVE_STATUS, AT_FACT_MOV_EXT.TYPE, AT_FACT_MOV_EXT.DIRECTION_CODE, DT_EXT_MOVE_TO.LOCATION_TYPE_TO, CASE WHEN AT_RELEASE_DATE.DAY_DATE < '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS RELEASE_DATE, DT_CURRENT_KEY_DATES.CURR_RELEASE_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE < '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS ARD_, CASE WHEN AT_CRD_DATE.DAY_DATE < '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CRD_, AT_FACT_MOV_EXT.REASON FROM BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_DIM_ASSESSMENT_DATE, BODIMIS.DIM_DATE AT_DIM_DECISION_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, (SELECT AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK AS OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END AS CURR_APD_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS CURR_ARD_DATE, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CURR_CRD_DATE, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END AS CURR_ETD_DATE, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END AS CURR_HDCAD_DATE, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END AS CURR_HDCED_DATE, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END AS CURR_PED_DATE, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END AS CURR_LED_DATE, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END AS CURR_LTD_DATE, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END AS CURR_MTD_DATE, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END AS CURR_NPD_DATE, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END AS CURR_PRRD_DATE, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS CURR_RELEASE_DATE, CASE WHEN AT_SED_DATE.DAY_DATE <> '31/12/9000' THEN AT_SED_DATE.DAY_DATE END AS SED, MIN(CASE WHEN AT_SENT_START_DATE.DAY_DATE <> '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END) AS SSD, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END AS TARIFF, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END AS CURR_ROTL_DATE, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END AS CURR_ERSED_DATE, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END AS CURR_TERSED_DATE, at_fact_offender_sentence.tused_date_sk AS tused_sk, NULLIF(td.day_date, TO_DATE('31/12/9000', 'DD/MM/YYYY')) AS tused FROM BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_APD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, BODIMIS.DIM_DATE AT_ETD_DATE, BODIMIS.DIM_DATE AT_HDCAD_DATE, BODIMIS.DIM_DATE AT_HDCED_DATE, BODIMIS.DIM_DATE AT_PED_DATE, BODIMIS.DIM_DATE AT_LED_DATE, BODIMIS.DIM_DATE AT_LTD_DATE, BODIMIS.DIM_DATE AT_MTD_DATE, BODIMIS.DIM_DATE AT_NPD_DATE, BODIMIS.DIM_DATE AT_PRRD_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_SED_DATE, BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_TARIFF_DATE, BODIMIS.DIM_DATE AT_ROTL_DATE, BODIMIS.DIM_DATE AT_ERSED_DATE, BODIMIS.DIM_DATE AT_TERSED_DATE, bodimis.dim_date td WHERE AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK = AT_FACT_SENTENCE.OFFENDER_BOOKING_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.APD_DATE_SK = AT_APD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ETD_DATE_SK = AT_ETD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCAD_DATE_SK = AT_HDCAD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCED_DATE_SK = AT_HDCED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LED_DATE_SK = AT_LED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LTD_DATE_SK = AT_LTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.MTD_DATE_SK = AT_MTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.NPD_DATE_SK = AT_NPD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PRRD_DATE_SK = AT_PRRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.SED_DATE_SK = AT_SED_DATE.DATE_SK (+) AND AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TARIFF_DATE_SK = AT_TARIFF_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ROTL_DATE_SK = AT_ROTL_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ERSED_DATE_SK = AT_ERSED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TERSED_DATE_SK = AT_TERSED_DATE.DATE_SK (+) AND at_fact_offender_sentence.tused_date_sk = td.date_sk (+) AND AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y' GROUP BY AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END, CASE WHEN at_sed_date.day_date <> '31/12/9000' THEN at_sed_date.day_date END, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END, at_fact_offender_sentence.tused_date_sk, td.day_date) DT_CURRENT_KEY_DATES, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_CURFEW_ASSESSMENT AT_CURFEW_ASSESSMENT, BODIMIS.DIM_HDC_ASSESSMNT_APP_STATUS AT_DIM_HDC_ASST_APP_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT BODIMIS.FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, BODIMIS.FACT_OFFENDER_SENTENCE.EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.FACT_OFFENDER_SENTENCE WHERE (BODIMIS.FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y')) DT_CURREFFSENLEN, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, (SELECT BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_SK AS SK_ID_TO, BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS TYPE_DESCRIPTION_TO, 'Establishment' AS Location_Type_To FROM BODIMIS.DIM_ESTABLISHMENT UNION ALL SELECT BODIMIS.DIM_PROBATION_OFFICE.PROBATION_OFFICE_SK, BODIMIS.DIM_PROBATION_OFFICE.PROB_OFFICE_DESCRIPTION, 'Probation Office' AS Location_Type_To FROM BODIMIS.DIM_PROBATION_OFFICE UNION ALL SELECT BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_SK, BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_DESCRIPTION, 'Outside Location' AS Location_Type_To FROM BODIMIS.DIM_OUTSIDE_LOCATION UNION ALL SELECT BODIMIS.DIM_CITY.CITY_SK, BODIMIS.DIM_CITY.DESCRIPTION, 'City' AS Location_Type_To FROM BODIMIS.DIM_CITY UNION ALL SELECT BODIMIS.DIM_COURT.COURT_SK, BODIMIS.DIM_COURT.COURT_DESCRIPTION, 'Court' AS Location_Type_To FROM BODIMIS.DIM_COURT UNION ALL SELECT address_id_nk, TRIM(CASE WHEN no_fixed_address_flag = 'Y' THEN 'No fixed address' ELSE CASE WHEN NOT flat IS NULL THEN flat || '  ' END || CASE WHEN NOT premise IS NULL THEN premise || '  ' END || CASE WHEN NOT street IS NULL THEN street || '  ' END || CASE WHEN NOT locality IS NULL THEN locality || '  ' END || CASE WHEN NOT city_desc IS NULL THEN city_desc || '  ' END || CASE WHEN NOT county_desc IS NULL THEN county_desc || '  ' END || CASE WHEN NOT postal_code IS NULL THEN postal_code || '  ' END || CASE WHEN NOT country_desc IS NULL THEN country_desc END END), 'Home Leave Address' FROM bodimis.dim_addresses) DT_EXT_MOVE_TO, BODIMIS.DIM_COURT_CASE AT_COURT_CASE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE WHERE (AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+)) AND (AT_CURFEW_ASSESSMENT.HDC_ASSMENT_APP_STATUS_SK = AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_SK (+)) AND (AT_CURFEW_ASSESSMENT.ASSESSMENT_DATE_SK = AT_DIM_ASSESSMENT_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURRENT_KEY_DATES.OFFENDER_BOOKING_SK (+)) AND (AT_CURFEW_ASSESSMENT.DECISION_DATE_SK = AT_DIM_DECISION_DATE.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURREFFSENLEN.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (CASE WHEN AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = 'Establishment' THEN AT_FACT_MOV_EXT.FROM_LOCATION_SK END = AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_SENTENCE.COURT_CASE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_FACT_MOV_EXT.TO_LOCATION_SK = DT_EXT_MOVE_TO.SK_ID_TO (+) AND AT_FACT_MOV_EXT.TO_LOCATION_TYPE = DT_EXT_MOVE_TO.LOCATION_TYPE_TO (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_CURFEW_ASSESSMENT.OFFENDER_BOOKING_SK (+)) AND ((TRUNC(AT_DIM_DATE_EXT_MOV.DAY_DATE) BETWEEN TO_DATE('02-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND TO_DATE('09-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS')) AND AT_FACT_MOV_EXT.TYPE IN ('Release') AND AT_FACT_MOV_EXT.DIRECTION_CODE IN ('OUT') AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION IN ('DARTMOOR (HMP)', 'DEERBOLT (HMPYOI)', 'DONCASTER (HMP)', 'DORCHESTER (HMP)', 'DOVEGATE (HMP)', 'DOWNVIEW (HMP)', 'DRAKE HALL (HMP & YOI)', 'DURHAM (HMP)', 'Dover Immigration Removal Centre', 'EAST SUTTON PARK (HMP & YOI)', 'EASTWOOD PARK (HMP)', 'EDMUNDS HILL (HMP)', 'ELMLEY (HMP)', 'ERLESTOKE (HMP)', 'EVERTHORPE (HMP)', 'EXETER (HMP)', 'East', 'East Mids/ Yorks and Humber/North East', 'FEATHERSTONE (HMP)', 'FELTHAM (HMP & YOI)', 'FINNAMORE (HMYOI)', 'FORD (HMP)', 'FOREST BANK (HMP & YOI)', 'FOSTON HALL (HMP)', 'FRANKLAND (HMP)', 'FULL SUTTON (HMP)', 'Foreign Prison') AND NOT DT_CURRENT_KEY_DATES.CURR_HDCED_DATE IS NULL AND AT_OFFENDER_BOOKING.ACTIVE_STATUS IN ('Inactive Out'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, BOOKING_NUMBER, SENTENCE_START_DATE, EFFECTIVE_SENTENCE_LENGTH, LEGAL_STATUS_GROUPING, HDC_CHECKS_DONE_DATE, HDC_PASSED_FLAG, HDC_ASSMENT_APP_STATUS_DESC, HDC_DECISION_DATE, CURR_HDCED_DATE, CURR_ARD_DATE, CURR_CRD_DATE, ESTABLISHMENT_DESCRIPTION, MOVEMENT_TIME, REASON_CODE, DAY_DATE, HDC_REVIEW_FLAG, ACTIVE_STATUS, TYPE, DIRECTION_CODE, LOCATION_TYPE_TO, RELEASE_DATE, CURR_RELEASE_DATE, ARD_, CRD_, REASON FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP9.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "BOOKING_NUMBER",
            "type": "string",
            "display": "Booking Number",
            "legacyId": "DP9.DO10077",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SENTENCE_START_DATE",
            "type": "date",
            "display": "Sentence Start Date",
            "legacyId": "DP9.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DP9.DO2d0",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DP9.DO107cb",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "HDC_CHECKS_DONE_DATE",
            "type": "date",
            "display": "HDC Checks Done Date",
            "legacyId": "DP9.DO54a",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "HDC_PASSED_FLAG",
            "type": "string",
            "display": "HDC Passed Flag",
            "legacyId": "DP9.DO3ad",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "HDC_ASSMENT_APP_STATUS_DESC",
            "type": "string",
            "display": "HDC Status",
            "legacyId": "DP9.DO54",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "HDC_DECISION_DATE",
            "type": "date",
            "display": "HDC Decision Date",
            "legacyId": "DP9.DO3b0",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CURR_HDCED_DATE",
            "type": "date",
            "display": "HDC Eligibility Date",
            "legacyId": "DP9.DO70",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "CURR_ARD_DATE",
            "type": "date",
            "display": "ARD (Approved Release Date)",
            "legacyId": "DP9.DO47",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "CURR_CRD_DATE",
            "type": "date",
            "display": "CRD (Conditional Release Date)",
            "legacyId": "DP9.DO48",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Movement Location From Description (External)",
            "legacyId": "DP9.DO1015d",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DP9.DO107ce",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "REASON_CODE",
            "type": "string",
            "display": "Movement Reason Code (External)",
            "legacyId": "DP9.DO103fc",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date Only (External)",
            "legacyId": "DP9.DO1015c",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "HDC_REVIEW_FLAG",
            "type": "string",
            "display": "HDC Review Flag",
            "legacyId": "DP9.DO3ae",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "ACTIVE_STATUS",
            "type": "string",
            "display": "Active Status",
            "legacyId": "DP9.DO104d5",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "TYPE",
            "type": "string",
            "display": "Movement Type (External)",
            "legacyId": "DP9.DO103ec",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "DIRECTION_CODE",
            "type": "string",
            "display": "Movement Direction Code (External)",
            "legacyId": "DP9.DO103fd",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "LOCATION_TYPE_TO",
            "type": "string",
            "display": "Location Type To",
            "legacyId": "DP9.DO10768",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "RELEASE_DATE",
            "type": "date",
            "display": "Release Date",
            "legacyId": "DP9.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CURR_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DP9.DO2e6",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "ARD_",
            "type": "date",
            "display": "ARD (Approved Release Date) (Historical)",
            "legacyId": "DP9.DO30d",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "CRD_",
            "type": "date",
            "display": "CRD (Conditional Release Date) (Historical)",
            "legacyId": "DP9.DO30a",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "REASON",
            "type": "string",
            "display": "Movement Description (External)",
            "legacyId": "DP9.DO1015b",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DPa",
      "name": "HDC One (G - I)",
      "description": "MIS Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.BOOKING_NUMBER, CASE WHEN AT_SENT_START_DATE.DAY_DATE < '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END AS SENTENCE_START_DATE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA') THEN 'Recall' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '0' THEN 'Dead' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '1' THEN 'Indeterminate Sentence' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('2', '3') THEN 'Sentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('9', '10') OR AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'CIV_RMD' THEN 'Civil Prisoner' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('8', '11') THEN 'Immigration Detainee' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('12', '13', '14') THEN 'Remand' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, CASE WHEN AT_DIM_ASSESSMENT_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_ASSESSMENT_DATE.DAY_DATE END AS HDC_CHECKS_DONE_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'N' THEN 'NO' END AS HDC_PASSED_FLAG, AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_DESC, CASE WHEN AT_DIM_DECISION_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_DECISION_DATE.DAY_DATE END AS HDC_DECISION_DATE, DT_CURRENT_KEY_DATES.CURR_HDCED_DATE, DT_CURRENT_KEY_DATES.CURR_ARD_DATE, DT_CURRENT_KEY_DATES.CURR_CRD_DATE, AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, AT_FACT_MOV_EXT.REASON_CODE, AT_DIM_DATE_EXT_MOV.DAY_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'N' THEN 'NO' END AS HDC_REVIEW_FLAG, AT_OFFENDER_BOOKING.ACTIVE_STATUS, AT_FACT_MOV_EXT.TYPE, AT_FACT_MOV_EXT.DIRECTION_CODE, DT_EXT_MOVE_TO.LOCATION_TYPE_TO, CASE WHEN AT_RELEASE_DATE.DAY_DATE < '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS RELEASE_DATE, DT_CURRENT_KEY_DATES.CURR_RELEASE_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE < '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS ARD_, CASE WHEN AT_CRD_DATE.DAY_DATE < '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CRD_, AT_FACT_MOV_EXT.REASON FROM BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_DIM_ASSESSMENT_DATE, BODIMIS.DIM_DATE AT_DIM_DECISION_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, (SELECT AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK AS OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END AS CURR_APD_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS CURR_ARD_DATE, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CURR_CRD_DATE, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END AS CURR_ETD_DATE, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END AS CURR_HDCAD_DATE, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END AS CURR_HDCED_DATE, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END AS CURR_PED_DATE, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END AS CURR_LED_DATE, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END AS CURR_LTD_DATE, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END AS CURR_MTD_DATE, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END AS CURR_NPD_DATE, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END AS CURR_PRRD_DATE, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS CURR_RELEASE_DATE, CASE WHEN AT_SED_DATE.DAY_DATE <> '31/12/9000' THEN AT_SED_DATE.DAY_DATE END AS SED, MIN(CASE WHEN AT_SENT_START_DATE.DAY_DATE <> '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END) AS SSD, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END AS TARIFF, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END AS CURR_ROTL_DATE, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END AS CURR_ERSED_DATE, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END AS CURR_TERSED_DATE, at_fact_offender_sentence.tused_date_sk AS tused_sk, NULLIF(td.day_date, TO_DATE('31/12/9000', 'DD/MM/YYYY')) AS tused FROM BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_APD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, BODIMIS.DIM_DATE AT_ETD_DATE, BODIMIS.DIM_DATE AT_HDCAD_DATE, BODIMIS.DIM_DATE AT_HDCED_DATE, BODIMIS.DIM_DATE AT_PED_DATE, BODIMIS.DIM_DATE AT_LED_DATE, BODIMIS.DIM_DATE AT_LTD_DATE, BODIMIS.DIM_DATE AT_MTD_DATE, BODIMIS.DIM_DATE AT_NPD_DATE, BODIMIS.DIM_DATE AT_PRRD_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_SED_DATE, BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_TARIFF_DATE, BODIMIS.DIM_DATE AT_ROTL_DATE, BODIMIS.DIM_DATE AT_ERSED_DATE, BODIMIS.DIM_DATE AT_TERSED_DATE, bodimis.dim_date td WHERE AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK = AT_FACT_SENTENCE.OFFENDER_BOOKING_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.APD_DATE_SK = AT_APD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ETD_DATE_SK = AT_ETD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCAD_DATE_SK = AT_HDCAD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCED_DATE_SK = AT_HDCED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LED_DATE_SK = AT_LED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LTD_DATE_SK = AT_LTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.MTD_DATE_SK = AT_MTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.NPD_DATE_SK = AT_NPD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PRRD_DATE_SK = AT_PRRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.SED_DATE_SK = AT_SED_DATE.DATE_SK (+) AND AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TARIFF_DATE_SK = AT_TARIFF_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ROTL_DATE_SK = AT_ROTL_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ERSED_DATE_SK = AT_ERSED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TERSED_DATE_SK = AT_TERSED_DATE.DATE_SK (+) AND at_fact_offender_sentence.tused_date_sk = td.date_sk (+) AND AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y' GROUP BY AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END, CASE WHEN at_sed_date.day_date <> '31/12/9000' THEN at_sed_date.day_date END, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END, at_fact_offender_sentence.tused_date_sk, td.day_date) DT_CURRENT_KEY_DATES, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_CURFEW_ASSESSMENT AT_CURFEW_ASSESSMENT, BODIMIS.DIM_HDC_ASSESSMNT_APP_STATUS AT_DIM_HDC_ASST_APP_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT BODIMIS.FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, BODIMIS.FACT_OFFENDER_SENTENCE.EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.FACT_OFFENDER_SENTENCE WHERE (BODIMIS.FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y')) DT_CURREFFSENLEN, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, (SELECT BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_SK AS SK_ID_TO, BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS TYPE_DESCRIPTION_TO, 'Establishment' AS Location_Type_To FROM BODIMIS.DIM_ESTABLISHMENT UNION ALL SELECT BODIMIS.DIM_PROBATION_OFFICE.PROBATION_OFFICE_SK, BODIMIS.DIM_PROBATION_OFFICE.PROB_OFFICE_DESCRIPTION, 'Probation Office' AS Location_Type_To FROM BODIMIS.DIM_PROBATION_OFFICE UNION ALL SELECT BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_SK, BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_DESCRIPTION, 'Outside Location' AS Location_Type_To FROM BODIMIS.DIM_OUTSIDE_LOCATION UNION ALL SELECT BODIMIS.DIM_CITY.CITY_SK, BODIMIS.DIM_CITY.DESCRIPTION, 'City' AS Location_Type_To FROM BODIMIS.DIM_CITY UNION ALL SELECT BODIMIS.DIM_COURT.COURT_SK, BODIMIS.DIM_COURT.COURT_DESCRIPTION, 'Court' AS Location_Type_To FROM BODIMIS.DIM_COURT UNION ALL SELECT address_id_nk, TRIM(CASE WHEN no_fixed_address_flag = 'Y' THEN 'No fixed address' ELSE CASE WHEN NOT flat IS NULL THEN flat || '  ' END || CASE WHEN NOT premise IS NULL THEN premise || '  ' END || CASE WHEN NOT street IS NULL THEN street || '  ' END || CASE WHEN NOT locality IS NULL THEN locality || '  ' END || CASE WHEN NOT city_desc IS NULL THEN city_desc || '  ' END || CASE WHEN NOT county_desc IS NULL THEN county_desc || '  ' END || CASE WHEN NOT postal_code IS NULL THEN postal_code || '  ' END || CASE WHEN NOT country_desc IS NULL THEN country_desc END END), 'Home Leave Address' FROM bodimis.dim_addresses) DT_EXT_MOVE_TO, BODIMIS.DIM_COURT_CASE AT_COURT_CASE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE WHERE (AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+)) AND (AT_CURFEW_ASSESSMENT.HDC_ASSMENT_APP_STATUS_SK = AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_SK (+)) AND (AT_CURFEW_ASSESSMENT.ASSESSMENT_DATE_SK = AT_DIM_ASSESSMENT_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURRENT_KEY_DATES.OFFENDER_BOOKING_SK (+)) AND (AT_CURFEW_ASSESSMENT.DECISION_DATE_SK = AT_DIM_DECISION_DATE.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURREFFSENLEN.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (CASE WHEN AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = 'Establishment' THEN AT_FACT_MOV_EXT.FROM_LOCATION_SK END = AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_SENTENCE.COURT_CASE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_FACT_MOV_EXT.TO_LOCATION_SK = DT_EXT_MOVE_TO.SK_ID_TO (+) AND AT_FACT_MOV_EXT.TO_LOCATION_TYPE = DT_EXT_MOVE_TO.LOCATION_TYPE_TO (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_CURFEW_ASSESSMENT.OFFENDER_BOOKING_SK (+)) AND ((TRUNC(AT_DIM_DATE_EXT_MOV.DAY_DATE) BETWEEN TO_DATE('02-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND TO_DATE('09-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS')) AND AT_FACT_MOV_EXT.TYPE IN ('Release') AND AT_FACT_MOV_EXT.DIRECTION_CODE IN ('OUT') AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION IN ('GARTH (HMP)', 'GARTREE (HMP)', 'GHOST HOLDING ESTABLISHMENT', 'GLEN PARVA (HMPYOI & RC)', 'GLOUCESTER (HMP)', 'GRENDON (HMP)', 'GUYS MARSH (HMP)', 'HATFIELD (HMP & YOI)', 'HAVERIGG (HMP)', 'HEWELL GRANGE (HMP)', 'HIGH DOWN (HMP)', 'HIGHPOINT (HMP)', 'HINDLEY (HMP & YOI)', 'HMP HEWELL', 'HOLLESLEY BAY (HMP)', 'HOLLOWAY (HMP)', 'HOLME HOUSE (HMP)', 'HULL (HMP)', 'HUMBER (HMP)', 'HUNTERCOMBE (HMP)', 'Haslar Immigration Removal Centre', 'ISIS HMP/YOI', 'ISLE OF WIGHT (HMP)', 'Inter Prison Escorts') AND NOT DT_CURRENT_KEY_DATES.CURR_HDCED_DATE IS NULL AND AT_OFFENDER_BOOKING.ACTIVE_STATUS IN ('Inactive Out'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, BOOKING_NUMBER, SENTENCE_START_DATE, EFFECTIVE_SENTENCE_LENGTH, LEGAL_STATUS_GROUPING, HDC_CHECKS_DONE_DATE, HDC_PASSED_FLAG, HDC_ASSMENT_APP_STATUS_DESC, HDC_DECISION_DATE, CURR_HDCED_DATE, CURR_ARD_DATE, CURR_CRD_DATE, ESTABLISHMENT_DESCRIPTION, MOVEMENT_TIME, REASON_CODE, DAY_DATE, HDC_REVIEW_FLAG, ACTIVE_STATUS, TYPE, DIRECTION_CODE, LOCATION_TYPE_TO, RELEASE_DATE, CURR_RELEASE_DATE, ARD_, CRD_, REASON FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPa.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "BOOKING_NUMBER",
            "type": "string",
            "display": "Booking Number",
            "legacyId": "DPa.DO10077",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SENTENCE_START_DATE",
            "type": "date",
            "display": "Sentence Start Date",
            "legacyId": "DPa.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DPa.DO2d0",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DPa.DO107cb",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "HDC_CHECKS_DONE_DATE",
            "type": "date",
            "display": "HDC Checks Done Date",
            "legacyId": "DPa.DO54a",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "HDC_PASSED_FLAG",
            "type": "string",
            "display": "HDC Passed Flag",
            "legacyId": "DPa.DO3ad",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "HDC_ASSMENT_APP_STATUS_DESC",
            "type": "string",
            "display": "HDC Status",
            "legacyId": "DPa.DO54",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "HDC_DECISION_DATE",
            "type": "date",
            "display": "HDC Decision Date",
            "legacyId": "DPa.DO3b0",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CURR_HDCED_DATE",
            "type": "date",
            "display": "HDC Eligibility Date",
            "legacyId": "DPa.DO70",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "CURR_ARD_DATE",
            "type": "date",
            "display": "ARD (Approved Release Date)",
            "legacyId": "DPa.DO47",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "CURR_CRD_DATE",
            "type": "date",
            "display": "CRD (Conditional Release Date)",
            "legacyId": "DPa.DO48",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Movement Location From Description (External)",
            "legacyId": "DPa.DO1015d",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DPa.DO107ce",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "REASON_CODE",
            "type": "string",
            "display": "Movement Reason Code (External)",
            "legacyId": "DPa.DO103fc",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date Only (External)",
            "legacyId": "DPa.DO1015c",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "HDC_REVIEW_FLAG",
            "type": "string",
            "display": "HDC Review Flag",
            "legacyId": "DPa.DO3ae",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "ACTIVE_STATUS",
            "type": "string",
            "display": "Active Status",
            "legacyId": "DPa.DO104d5",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "TYPE",
            "type": "string",
            "display": "Movement Type (External)",
            "legacyId": "DPa.DO103ec",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "DIRECTION_CODE",
            "type": "string",
            "display": "Movement Direction Code (External)",
            "legacyId": "DPa.DO103fd",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "LOCATION_TYPE_TO",
            "type": "string",
            "display": "Location Type To",
            "legacyId": "DPa.DO10768",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "RELEASE_DATE",
            "type": "date",
            "display": "Release Date",
            "legacyId": "DPa.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CURR_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DPa.DO2e6",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "ARD_",
            "type": "date",
            "display": "ARD (Approved Release Date) (Historical)",
            "legacyId": "DPa.DO30d",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "CRD_",
            "type": "date",
            "display": "CRD (Conditional Release Date) (Historical)",
            "legacyId": "DPa.DO30a",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "REASON",
            "type": "string",
            "display": "Movement Description (External)",
            "legacyId": "DPa.DO1015b",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DPb",
      "name": "HDC One (J - M)",
      "description": "MIS Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.BOOKING_NUMBER, CASE WHEN AT_SENT_START_DATE.DAY_DATE < '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END AS SENTENCE_START_DATE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA') THEN 'Recall' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '0' THEN 'Dead' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '1' THEN 'Indeterminate Sentence' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('2', '3') THEN 'Sentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('9', '10') OR AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'CIV_RMD' THEN 'Civil Prisoner' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('8', '11') THEN 'Immigration Detainee' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('12', '13', '14') THEN 'Remand' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, CASE WHEN AT_DIM_ASSESSMENT_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_ASSESSMENT_DATE.DAY_DATE END AS HDC_CHECKS_DONE_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'N' THEN 'NO' END AS HDC_PASSED_FLAG, AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_DESC, CASE WHEN AT_DIM_DECISION_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_DECISION_DATE.DAY_DATE END AS HDC_DECISION_DATE, DT_CURRENT_KEY_DATES.CURR_HDCED_DATE, DT_CURRENT_KEY_DATES.CURR_ARD_DATE, DT_CURRENT_KEY_DATES.CURR_CRD_DATE, AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, AT_FACT_MOV_EXT.REASON_CODE, AT_DIM_DATE_EXT_MOV.DAY_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'N' THEN 'NO' END AS HDC_REVIEW_FLAG, AT_OFFENDER_BOOKING.ACTIVE_STATUS, AT_FACT_MOV_EXT.TYPE, AT_FACT_MOV_EXT.DIRECTION_CODE, DT_EXT_MOVE_TO.LOCATION_TYPE_TO, CASE WHEN AT_RELEASE_DATE.DAY_DATE < '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS RELEASE_DATE, DT_CURRENT_KEY_DATES.CURR_RELEASE_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE < '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS ARD_, CASE WHEN AT_CRD_DATE.DAY_DATE < '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CRD_, AT_FACT_MOV_EXT.REASON FROM BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_DIM_ASSESSMENT_DATE, BODIMIS.DIM_DATE AT_DIM_DECISION_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, (SELECT AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK AS OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END AS CURR_APD_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS CURR_ARD_DATE, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CURR_CRD_DATE, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END AS CURR_ETD_DATE, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END AS CURR_HDCAD_DATE, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END AS CURR_HDCED_DATE, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END AS CURR_PED_DATE, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END AS CURR_LED_DATE, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END AS CURR_LTD_DATE, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END AS CURR_MTD_DATE, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END AS CURR_NPD_DATE, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END AS CURR_PRRD_DATE, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS CURR_RELEASE_DATE, CASE WHEN AT_SED_DATE.DAY_DATE <> '31/12/9000' THEN AT_SED_DATE.DAY_DATE END AS SED, MIN(CASE WHEN AT_SENT_START_DATE.DAY_DATE <> '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END) AS SSD, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END AS TARIFF, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END AS CURR_ROTL_DATE, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END AS CURR_ERSED_DATE, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END AS CURR_TERSED_DATE, at_fact_offender_sentence.tused_date_sk AS tused_sk, NULLIF(td.day_date, TO_DATE('31/12/9000', 'DD/MM/YYYY')) AS tused FROM BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_APD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, BODIMIS.DIM_DATE AT_ETD_DATE, BODIMIS.DIM_DATE AT_HDCAD_DATE, BODIMIS.DIM_DATE AT_HDCED_DATE, BODIMIS.DIM_DATE AT_PED_DATE, BODIMIS.DIM_DATE AT_LED_DATE, BODIMIS.DIM_DATE AT_LTD_DATE, BODIMIS.DIM_DATE AT_MTD_DATE, BODIMIS.DIM_DATE AT_NPD_DATE, BODIMIS.DIM_DATE AT_PRRD_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_SED_DATE, BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_TARIFF_DATE, BODIMIS.DIM_DATE AT_ROTL_DATE, BODIMIS.DIM_DATE AT_ERSED_DATE, BODIMIS.DIM_DATE AT_TERSED_DATE, bodimis.dim_date td WHERE AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK = AT_FACT_SENTENCE.OFFENDER_BOOKING_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.APD_DATE_SK = AT_APD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ETD_DATE_SK = AT_ETD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCAD_DATE_SK = AT_HDCAD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCED_DATE_SK = AT_HDCED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LED_DATE_SK = AT_LED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LTD_DATE_SK = AT_LTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.MTD_DATE_SK = AT_MTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.NPD_DATE_SK = AT_NPD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PRRD_DATE_SK = AT_PRRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.SED_DATE_SK = AT_SED_DATE.DATE_SK (+) AND AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TARIFF_DATE_SK = AT_TARIFF_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ROTL_DATE_SK = AT_ROTL_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ERSED_DATE_SK = AT_ERSED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TERSED_DATE_SK = AT_TERSED_DATE.DATE_SK (+) AND at_fact_offender_sentence.tused_date_sk = td.date_sk (+) AND AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y' GROUP BY AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END, CASE WHEN at_sed_date.day_date <> '31/12/9000' THEN at_sed_date.day_date END, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END, at_fact_offender_sentence.tused_date_sk, td.day_date) DT_CURRENT_KEY_DATES, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_CURFEW_ASSESSMENT AT_CURFEW_ASSESSMENT, BODIMIS.DIM_HDC_ASSESSMNT_APP_STATUS AT_DIM_HDC_ASST_APP_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT BODIMIS.FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, BODIMIS.FACT_OFFENDER_SENTENCE.EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.FACT_OFFENDER_SENTENCE WHERE (BODIMIS.FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y')) DT_CURREFFSENLEN, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, (SELECT BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_SK AS SK_ID_TO, BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS TYPE_DESCRIPTION_TO, 'Establishment' AS Location_Type_To FROM BODIMIS.DIM_ESTABLISHMENT UNION ALL SELECT BODIMIS.DIM_PROBATION_OFFICE.PROBATION_OFFICE_SK, BODIMIS.DIM_PROBATION_OFFICE.PROB_OFFICE_DESCRIPTION, 'Probation Office' AS Location_Type_To FROM BODIMIS.DIM_PROBATION_OFFICE UNION ALL SELECT BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_SK, BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_DESCRIPTION, 'Outside Location' AS Location_Type_To FROM BODIMIS.DIM_OUTSIDE_LOCATION UNION ALL SELECT BODIMIS.DIM_CITY.CITY_SK, BODIMIS.DIM_CITY.DESCRIPTION, 'City' AS Location_Type_To FROM BODIMIS.DIM_CITY UNION ALL SELECT BODIMIS.DIM_COURT.COURT_SK, BODIMIS.DIM_COURT.COURT_DESCRIPTION, 'Court' AS Location_Type_To FROM BODIMIS.DIM_COURT UNION ALL SELECT address_id_nk, TRIM(CASE WHEN no_fixed_address_flag = 'Y' THEN 'No fixed address' ELSE CASE WHEN NOT flat IS NULL THEN flat || '  ' END || CASE WHEN NOT premise IS NULL THEN premise || '  ' END || CASE WHEN NOT street IS NULL THEN street || '  ' END || CASE WHEN NOT locality IS NULL THEN locality || '  ' END || CASE WHEN NOT city_desc IS NULL THEN city_desc || '  ' END || CASE WHEN NOT county_desc IS NULL THEN county_desc || '  ' END || CASE WHEN NOT postal_code IS NULL THEN postal_code || '  ' END || CASE WHEN NOT country_desc IS NULL THEN country_desc END END), 'Home Leave Address' FROM bodimis.dim_addresses) DT_EXT_MOVE_TO, BODIMIS.DIM_COURT_CASE AT_COURT_CASE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE WHERE (AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+)) AND (AT_CURFEW_ASSESSMENT.HDC_ASSMENT_APP_STATUS_SK = AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_SK (+)) AND (AT_CURFEW_ASSESSMENT.ASSESSMENT_DATE_SK = AT_DIM_ASSESSMENT_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURRENT_KEY_DATES.OFFENDER_BOOKING_SK (+)) AND (AT_CURFEW_ASSESSMENT.DECISION_DATE_SK = AT_DIM_DECISION_DATE.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURREFFSENLEN.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (CASE WHEN AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = 'Establishment' THEN AT_FACT_MOV_EXT.FROM_LOCATION_SK END = AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_SENTENCE.COURT_CASE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_FACT_MOV_EXT.TO_LOCATION_SK = DT_EXT_MOVE_TO.SK_ID_TO (+) AND AT_FACT_MOV_EXT.TO_LOCATION_TYPE = DT_EXT_MOVE_TO.LOCATION_TYPE_TO (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_CURFEW_ASSESSMENT.OFFENDER_BOOKING_SK (+)) AND ((TRUNC(AT_DIM_DATE_EXT_MOV.DAY_DATE) BETWEEN TO_DATE('02-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND TO_DATE('09-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS')) AND AT_FACT_MOV_EXT.TYPE IN ('Release') AND AT_FACT_MOV_EXT.DIRECTION_CODE IN ('OUT') AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION IN ('KENNET (HMP)', 'KINGSTON (HMP)', 'KIRKHAM (HMP)', 'KIRKLEVINGTON GRANGE (HMP)', 'LANCASTER CASTLE (HMP)', 'LANCASTER FARMS (HMP)', 'LATCHMERE HOUSE (HMP)', 'LEEDS (HMP)', 'LEICESTER (HMP)', 'LEWES (HMP)', 'LEYHILL (HMP)', 'LINCOLN (HMP)', 'LINDHOLME (HMP)', 'LITTLEHEY (HMP)', 'LIVERPOOL (HMP)', 'LONG LARTIN (HMP)', 'LOW NEWTON (HMP)', 'LOWDHAM GRANGE (HMP)', 'MAIDSTONE (HMP)', 'MANCHESTER (HMP)', 'MOORLAND (HMP & YOI)', 'MORTON HALL IMMIGRATION REMOVAL CENTRE', 'NEW HALL (HMP)', 'MEDWAY (STC)') AND NOT DT_CURRENT_KEY_DATES.CURR_HDCED_DATE IS NULL AND AT_OFFENDER_BOOKING.ACTIVE_STATUS IN ('Inactive Out'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, BOOKING_NUMBER, SENTENCE_START_DATE, EFFECTIVE_SENTENCE_LENGTH, LEGAL_STATUS_GROUPING, HDC_CHECKS_DONE_DATE, HDC_PASSED_FLAG, HDC_ASSMENT_APP_STATUS_DESC, HDC_DECISION_DATE, CURR_HDCED_DATE, CURR_ARD_DATE, CURR_CRD_DATE, ESTABLISHMENT_DESCRIPTION, MOVEMENT_TIME, REASON_CODE, DAY_DATE, HDC_REVIEW_FLAG, ACTIVE_STATUS, TYPE, DIRECTION_CODE, LOCATION_TYPE_TO, RELEASE_DATE, CURR_RELEASE_DATE, ARD_, CRD_, REASON FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPb.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "BOOKING_NUMBER",
            "type": "string",
            "display": "Booking Number",
            "legacyId": "DPb.DO10077",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SENTENCE_START_DATE",
            "type": "date",
            "display": "Sentence Start Date",
            "legacyId": "DPb.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DPb.DO2d0",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DPb.DO107cb",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "HDC_CHECKS_DONE_DATE",
            "type": "date",
            "display": "HDC Checks Done Date",
            "legacyId": "DPb.DO54a",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "HDC_PASSED_FLAG",
            "type": "string",
            "display": "HDC Passed Flag",
            "legacyId": "DPb.DO3ad",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "HDC_ASSMENT_APP_STATUS_DESC",
            "type": "string",
            "display": "HDC Status",
            "legacyId": "DPb.DO54",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "HDC_DECISION_DATE",
            "type": "date",
            "display": "HDC Decision Date",
            "legacyId": "DPb.DO3b0",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CURR_HDCED_DATE",
            "type": "date",
            "display": "HDC Eligibility Date",
            "legacyId": "DPb.DO70",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "CURR_ARD_DATE",
            "type": "date",
            "display": "ARD (Approved Release Date)",
            "legacyId": "DPb.DO47",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "CURR_CRD_DATE",
            "type": "date",
            "display": "CRD (Conditional Release Date)",
            "legacyId": "DPb.DO48",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Movement Location From Description (External)",
            "legacyId": "DPb.DO1015d",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DPb.DO107ce",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "REASON_CODE",
            "type": "string",
            "display": "Movement Reason Code (External)",
            "legacyId": "DPb.DO103fc",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date Only (External)",
            "legacyId": "DPb.DO1015c",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "HDC_REVIEW_FLAG",
            "type": "string",
            "display": "HDC Review Flag",
            "legacyId": "DPb.DO3ae",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "ACTIVE_STATUS",
            "type": "string",
            "display": "Active Status",
            "legacyId": "DPb.DO104d5",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "TYPE",
            "type": "string",
            "display": "Movement Type (External)",
            "legacyId": "DPb.DO103ec",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "DIRECTION_CODE",
            "type": "string",
            "display": "Movement Direction Code (External)",
            "legacyId": "DPb.DO103fd",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "LOCATION_TYPE_TO",
            "type": "string",
            "display": "Location Type To",
            "legacyId": "DPb.DO10768",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "RELEASE_DATE",
            "type": "date",
            "display": "Release Date",
            "legacyId": "DPb.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CURR_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DPb.DO2e6",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "ARD_",
            "type": "date",
            "display": "ARD (Approved Release Date) (Historical)",
            "legacyId": "DPb.DO30d",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "CRD_",
            "type": "date",
            "display": "CRD (Conditional Release Date) (Historical)",
            "legacyId": "DPb.DO30a",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "REASON",
            "type": "string",
            "display": "Movement Description (External)",
            "legacyId": "DPb.DO1015b",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DPc",
      "name": "HDC One (N - P) ",
      "description": "MIS Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.BOOKING_NUMBER, CASE WHEN AT_SENT_START_DATE.DAY_DATE < '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END AS SENTENCE_START_DATE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA') THEN 'Recall' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '0' THEN 'Dead' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '1' THEN 'Indeterminate Sentence' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('2', '3') THEN 'Sentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('9', '10') OR AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'CIV_RMD' THEN 'Civil Prisoner' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('8', '11') THEN 'Immigration Detainee' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('12', '13', '14') THEN 'Remand' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, CASE WHEN AT_DIM_ASSESSMENT_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_ASSESSMENT_DATE.DAY_DATE END AS HDC_CHECKS_DONE_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'N' THEN 'NO' END AS HDC_PASSED_FLAG, AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_DESC, CASE WHEN AT_DIM_DECISION_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_DECISION_DATE.DAY_DATE END AS HDC_DECISION_DATE, DT_CURRENT_KEY_DATES.CURR_HDCED_DATE, DT_CURRENT_KEY_DATES.CURR_ARD_DATE, DT_CURRENT_KEY_DATES.CURR_CRD_DATE, AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, AT_FACT_MOV_EXT.REASON_CODE, AT_DIM_DATE_EXT_MOV.DAY_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'N' THEN 'NO' END AS HDC_REVIEW_FLAG, AT_OFFENDER_BOOKING.ACTIVE_STATUS, AT_FACT_MOV_EXT.TYPE, AT_FACT_MOV_EXT.DIRECTION_CODE, DT_EXT_MOVE_TO.LOCATION_TYPE_TO, CASE WHEN AT_RELEASE_DATE.DAY_DATE < '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS RELEASE_DATE, DT_CURRENT_KEY_DATES.CURR_RELEASE_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE < '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS ARD_, CASE WHEN AT_CRD_DATE.DAY_DATE < '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CRD_, AT_FACT_MOV_EXT.REASON FROM BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_DIM_ASSESSMENT_DATE, BODIMIS.DIM_DATE AT_DIM_DECISION_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, (SELECT AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK AS OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END AS CURR_APD_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS CURR_ARD_DATE, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CURR_CRD_DATE, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END AS CURR_ETD_DATE, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END AS CURR_HDCAD_DATE, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END AS CURR_HDCED_DATE, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END AS CURR_PED_DATE, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END AS CURR_LED_DATE, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END AS CURR_LTD_DATE, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END AS CURR_MTD_DATE, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END AS CURR_NPD_DATE, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END AS CURR_PRRD_DATE, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS CURR_RELEASE_DATE, CASE WHEN AT_SED_DATE.DAY_DATE <> '31/12/9000' THEN AT_SED_DATE.DAY_DATE END AS SED, MIN(CASE WHEN AT_SENT_START_DATE.DAY_DATE <> '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END) AS SSD, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END AS TARIFF, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END AS CURR_ROTL_DATE, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END AS CURR_ERSED_DATE, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END AS CURR_TERSED_DATE, at_fact_offender_sentence.tused_date_sk AS tused_sk, NULLIF(td.day_date, TO_DATE('31/12/9000', 'DD/MM/YYYY')) AS tused FROM BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_APD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, BODIMIS.DIM_DATE AT_ETD_DATE, BODIMIS.DIM_DATE AT_HDCAD_DATE, BODIMIS.DIM_DATE AT_HDCED_DATE, BODIMIS.DIM_DATE AT_PED_DATE, BODIMIS.DIM_DATE AT_LED_DATE, BODIMIS.DIM_DATE AT_LTD_DATE, BODIMIS.DIM_DATE AT_MTD_DATE, BODIMIS.DIM_DATE AT_NPD_DATE, BODIMIS.DIM_DATE AT_PRRD_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_SED_DATE, BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_TARIFF_DATE, BODIMIS.DIM_DATE AT_ROTL_DATE, BODIMIS.DIM_DATE AT_ERSED_DATE, BODIMIS.DIM_DATE AT_TERSED_DATE, bodimis.dim_date td WHERE AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK = AT_FACT_SENTENCE.OFFENDER_BOOKING_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.APD_DATE_SK = AT_APD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ETD_DATE_SK = AT_ETD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCAD_DATE_SK = AT_HDCAD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCED_DATE_SK = AT_HDCED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LED_DATE_SK = AT_LED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LTD_DATE_SK = AT_LTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.MTD_DATE_SK = AT_MTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.NPD_DATE_SK = AT_NPD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PRRD_DATE_SK = AT_PRRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.SED_DATE_SK = AT_SED_DATE.DATE_SK (+) AND AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TARIFF_DATE_SK = AT_TARIFF_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ROTL_DATE_SK = AT_ROTL_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ERSED_DATE_SK = AT_ERSED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TERSED_DATE_SK = AT_TERSED_DATE.DATE_SK (+) AND at_fact_offender_sentence.tused_date_sk = td.date_sk (+) AND AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y' GROUP BY AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END, CASE WHEN at_sed_date.day_date <> '31/12/9000' THEN at_sed_date.day_date END, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END, at_fact_offender_sentence.tused_date_sk, td.day_date) DT_CURRENT_KEY_DATES, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_CURFEW_ASSESSMENT AT_CURFEW_ASSESSMENT, BODIMIS.DIM_HDC_ASSESSMNT_APP_STATUS AT_DIM_HDC_ASST_APP_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT BODIMIS.FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, BODIMIS.FACT_OFFENDER_SENTENCE.EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.FACT_OFFENDER_SENTENCE WHERE (BODIMIS.FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y')) DT_CURREFFSENLEN, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, (SELECT BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_SK AS SK_ID_TO, BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS TYPE_DESCRIPTION_TO, 'Establishment' AS Location_Type_To FROM BODIMIS.DIM_ESTABLISHMENT UNION ALL SELECT BODIMIS.DIM_PROBATION_OFFICE.PROBATION_OFFICE_SK, BODIMIS.DIM_PROBATION_OFFICE.PROB_OFFICE_DESCRIPTION, 'Probation Office' AS Location_Type_To FROM BODIMIS.DIM_PROBATION_OFFICE UNION ALL SELECT BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_SK, BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_DESCRIPTION, 'Outside Location' AS Location_Type_To FROM BODIMIS.DIM_OUTSIDE_LOCATION UNION ALL SELECT BODIMIS.DIM_CITY.CITY_SK, BODIMIS.DIM_CITY.DESCRIPTION, 'City' AS Location_Type_To FROM BODIMIS.DIM_CITY UNION ALL SELECT BODIMIS.DIM_COURT.COURT_SK, BODIMIS.DIM_COURT.COURT_DESCRIPTION, 'Court' AS Location_Type_To FROM BODIMIS.DIM_COURT UNION ALL SELECT address_id_nk, TRIM(CASE WHEN no_fixed_address_flag = 'Y' THEN 'No fixed address' ELSE CASE WHEN NOT flat IS NULL THEN flat || '  ' END || CASE WHEN NOT premise IS NULL THEN premise || '  ' END || CASE WHEN NOT street IS NULL THEN street || '  ' END || CASE WHEN NOT locality IS NULL THEN locality || '  ' END || CASE WHEN NOT city_desc IS NULL THEN city_desc || '  ' END || CASE WHEN NOT county_desc IS NULL THEN county_desc || '  ' END || CASE WHEN NOT postal_code IS NULL THEN postal_code || '  ' END || CASE WHEN NOT country_desc IS NULL THEN country_desc END END), 'Home Leave Address' FROM bodimis.dim_addresses) DT_EXT_MOVE_TO, BODIMIS.DIM_COURT_CASE AT_COURT_CASE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE WHERE (AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+)) AND (AT_CURFEW_ASSESSMENT.HDC_ASSMENT_APP_STATUS_SK = AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_SK (+)) AND (AT_CURFEW_ASSESSMENT.ASSESSMENT_DATE_SK = AT_DIM_ASSESSMENT_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURRENT_KEY_DATES.OFFENDER_BOOKING_SK (+)) AND (AT_CURFEW_ASSESSMENT.DECISION_DATE_SK = AT_DIM_DECISION_DATE.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURREFFSENLEN.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (CASE WHEN AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = 'Establishment' THEN AT_FACT_MOV_EXT.FROM_LOCATION_SK END = AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_SENTENCE.COURT_CASE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_FACT_MOV_EXT.TO_LOCATION_SK = DT_EXT_MOVE_TO.SK_ID_TO (+) AND AT_FACT_MOV_EXT.TO_LOCATION_TYPE = DT_EXT_MOVE_TO.LOCATION_TYPE_TO (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_CURFEW_ASSESSMENT.OFFENDER_BOOKING_SK (+)) AND ((TRUNC(AT_DIM_DATE_EXT_MOV.DAY_DATE) BETWEEN TO_DATE('02-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND TO_DATE('09-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS')) AND AT_FACT_MOV_EXT.TYPE IN ('Release') AND AT_FACT_MOV_EXT.DIRECTION_CODE IN ('OUT') AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION IN ('NEW HALL (HMP)', 'NORTH SEA CAMP (HMP)', 'NORTHALLERTON (HMP)', 'NORTHEYE (HMP)', 'NORTHUMBERLAND (HMP)', 'NORWICH (HMP & YOI)', 'NOTTINGHAM (HMP)', 'OAKWOOD (HMP)', 'ONLEY (HMP)', 'OXFORD (HMP)', 'PARC (HMP)', 'PARKHURST (HMP)', 'PENTONVILLE (HMP)', 'PETERBOROUGH (HMP)', 'PETERBOROUGH FEMALE HMP', 'PORTLAND (HMPYOI)', 'PRESCOED (HMP & YOI)', 'PRESTON (HMP)', 'PUCKLECHURCH (HMRC)') AND NOT DT_CURRENT_KEY_DATES.CURR_HDCED_DATE IS NULL AND AT_OFFENDER_BOOKING.ACTIVE_STATUS IN ('Inactive Out'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, BOOKING_NUMBER, SENTENCE_START_DATE, EFFECTIVE_SENTENCE_LENGTH, LEGAL_STATUS_GROUPING, HDC_CHECKS_DONE_DATE, HDC_PASSED_FLAG, HDC_ASSMENT_APP_STATUS_DESC, HDC_DECISION_DATE, CURR_HDCED_DATE, CURR_ARD_DATE, CURR_CRD_DATE, ESTABLISHMENT_DESCRIPTION, MOVEMENT_TIME, REASON_CODE, DAY_DATE, HDC_REVIEW_FLAG, ACTIVE_STATUS, TYPE, DIRECTION_CODE, LOCATION_TYPE_TO, RELEASE_DATE, CURR_RELEASE_DATE, ARD_, CRD_, REASON FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPc.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "BOOKING_NUMBER",
            "type": "string",
            "display": "Booking Number",
            "legacyId": "DPc.DO10077",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SENTENCE_START_DATE",
            "type": "date",
            "display": "Sentence Start Date",
            "legacyId": "DPc.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DPc.DO2d0",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DPc.DO107cb",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "HDC_CHECKS_DONE_DATE",
            "type": "date",
            "display": "HDC Checks Done Date",
            "legacyId": "DPc.DO54a",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "HDC_PASSED_FLAG",
            "type": "string",
            "display": "HDC Passed Flag",
            "legacyId": "DPc.DO3ad",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "HDC_ASSMENT_APP_STATUS_DESC",
            "type": "string",
            "display": "HDC Status",
            "legacyId": "DPc.DO54",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "HDC_DECISION_DATE",
            "type": "date",
            "display": "HDC Decision Date",
            "legacyId": "DPc.DO3b0",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CURR_HDCED_DATE",
            "type": "date",
            "display": "HDC Eligibility Date",
            "legacyId": "DPc.DO70",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "CURR_ARD_DATE",
            "type": "date",
            "display": "ARD (Approved Release Date)",
            "legacyId": "DPc.DO47",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "CURR_CRD_DATE",
            "type": "date",
            "display": "CRD (Conditional Release Date)",
            "legacyId": "DPc.DO48",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Movement Location From Description (External)",
            "legacyId": "DPc.DO1015d",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DPc.DO107ce",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "REASON_CODE",
            "type": "string",
            "display": "Movement Reason Code (External)",
            "legacyId": "DPc.DO103fc",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date Only (External)",
            "legacyId": "DPc.DO1015c",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "HDC_REVIEW_FLAG",
            "type": "string",
            "display": "HDC Review Flag",
            "legacyId": "DPc.DO3ae",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "ACTIVE_STATUS",
            "type": "string",
            "display": "Active Status",
            "legacyId": "DPc.DO104d5",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "TYPE",
            "type": "string",
            "display": "Movement Type (External)",
            "legacyId": "DPc.DO103ec",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "DIRECTION_CODE",
            "type": "string",
            "display": "Movement Direction Code (External)",
            "legacyId": "DPc.DO103fd",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "LOCATION_TYPE_TO",
            "type": "string",
            "display": "Location Type To",
            "legacyId": "DPc.DO10768",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "RELEASE_DATE",
            "type": "date",
            "display": "Release Date",
            "legacyId": "DPc.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CURR_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DPc.DO2e6",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "ARD_",
            "type": "date",
            "display": "ARD (Approved Release Date) (Historical)",
            "legacyId": "DPc.DO30d",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "CRD_",
            "type": "date",
            "display": "CRD (Conditional Release Date) (Historical)",
            "legacyId": "DPc.DO30a",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "REASON",
            "type": "string",
            "display": "Movement Description (External)",
            "legacyId": "DPc.DO1015b",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DPd",
      "name": "HDC One (Q - S)  (1)",
      "description": "MIS Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.BOOKING_NUMBER, CASE WHEN AT_SENT_START_DATE.DAY_DATE < '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END AS SENTENCE_START_DATE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA') THEN 'Recall' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '0' THEN 'Dead' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '1' THEN 'Indeterminate Sentence' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('2', '3') THEN 'Sentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('9', '10') OR AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'CIV_RMD' THEN 'Civil Prisoner' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('8', '11') THEN 'Immigration Detainee' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('12', '13', '14') THEN 'Remand' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, CASE WHEN AT_DIM_ASSESSMENT_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_ASSESSMENT_DATE.DAY_DATE END AS HDC_CHECKS_DONE_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'N' THEN 'NO' END AS HDC_PASSED_FLAG, AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_DESC, CASE WHEN AT_DIM_DECISION_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_DECISION_DATE.DAY_DATE END AS HDC_DECISION_DATE, DT_CURRENT_KEY_DATES.CURR_HDCED_DATE, DT_CURRENT_KEY_DATES.CURR_ARD_DATE, DT_CURRENT_KEY_DATES.CURR_CRD_DATE, AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, AT_FACT_MOV_EXT.REASON_CODE, AT_DIM_DATE_EXT_MOV.DAY_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'N' THEN 'NO' END AS HDC_REVIEW_FLAG, AT_OFFENDER_BOOKING.ACTIVE_STATUS, AT_FACT_MOV_EXT.TYPE, AT_FACT_MOV_EXT.DIRECTION_CODE, DT_EXT_MOVE_TO.LOCATION_TYPE_TO, CASE WHEN AT_RELEASE_DATE.DAY_DATE < '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS RELEASE_DATE, DT_CURRENT_KEY_DATES.CURR_RELEASE_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE < '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS ARD_, CASE WHEN AT_CRD_DATE.DAY_DATE < '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CRD_, AT_FACT_MOV_EXT.REASON FROM BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_DIM_ASSESSMENT_DATE, BODIMIS.DIM_DATE AT_DIM_DECISION_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, (SELECT AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK AS OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END AS CURR_APD_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS CURR_ARD_DATE, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CURR_CRD_DATE, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END AS CURR_ETD_DATE, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END AS CURR_HDCAD_DATE, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END AS CURR_HDCED_DATE, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END AS CURR_PED_DATE, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END AS CURR_LED_DATE, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END AS CURR_LTD_DATE, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END AS CURR_MTD_DATE, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END AS CURR_NPD_DATE, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END AS CURR_PRRD_DATE, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS CURR_RELEASE_DATE, CASE WHEN AT_SED_DATE.DAY_DATE <> '31/12/9000' THEN AT_SED_DATE.DAY_DATE END AS SED, MIN(CASE WHEN AT_SENT_START_DATE.DAY_DATE <> '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END) AS SSD, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END AS TARIFF, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END AS CURR_ROTL_DATE, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END AS CURR_ERSED_DATE, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END AS CURR_TERSED_DATE, at_fact_offender_sentence.tused_date_sk AS tused_sk, NULLIF(td.day_date, TO_DATE('31/12/9000', 'DD/MM/YYYY')) AS tused FROM BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_APD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, BODIMIS.DIM_DATE AT_ETD_DATE, BODIMIS.DIM_DATE AT_HDCAD_DATE, BODIMIS.DIM_DATE AT_HDCED_DATE, BODIMIS.DIM_DATE AT_PED_DATE, BODIMIS.DIM_DATE AT_LED_DATE, BODIMIS.DIM_DATE AT_LTD_DATE, BODIMIS.DIM_DATE AT_MTD_DATE, BODIMIS.DIM_DATE AT_NPD_DATE, BODIMIS.DIM_DATE AT_PRRD_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_SED_DATE, BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_TARIFF_DATE, BODIMIS.DIM_DATE AT_ROTL_DATE, BODIMIS.DIM_DATE AT_ERSED_DATE, BODIMIS.DIM_DATE AT_TERSED_DATE, bodimis.dim_date td WHERE AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK = AT_FACT_SENTENCE.OFFENDER_BOOKING_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.APD_DATE_SK = AT_APD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ETD_DATE_SK = AT_ETD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCAD_DATE_SK = AT_HDCAD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCED_DATE_SK = AT_HDCED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LED_DATE_SK = AT_LED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LTD_DATE_SK = AT_LTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.MTD_DATE_SK = AT_MTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.NPD_DATE_SK = AT_NPD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PRRD_DATE_SK = AT_PRRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.SED_DATE_SK = AT_SED_DATE.DATE_SK (+) AND AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TARIFF_DATE_SK = AT_TARIFF_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ROTL_DATE_SK = AT_ROTL_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ERSED_DATE_SK = AT_ERSED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TERSED_DATE_SK = AT_TERSED_DATE.DATE_SK (+) AND at_fact_offender_sentence.tused_date_sk = td.date_sk (+) AND AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y' GROUP BY AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END, CASE WHEN at_sed_date.day_date <> '31/12/9000' THEN at_sed_date.day_date END, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END, at_fact_offender_sentence.tused_date_sk, td.day_date) DT_CURRENT_KEY_DATES, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_CURFEW_ASSESSMENT AT_CURFEW_ASSESSMENT, BODIMIS.DIM_HDC_ASSESSMNT_APP_STATUS AT_DIM_HDC_ASST_APP_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT BODIMIS.FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, BODIMIS.FACT_OFFENDER_SENTENCE.EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.FACT_OFFENDER_SENTENCE WHERE (BODIMIS.FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y')) DT_CURREFFSENLEN, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, (SELECT BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_SK AS SK_ID_TO, BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS TYPE_DESCRIPTION_TO, 'Establishment' AS Location_Type_To FROM BODIMIS.DIM_ESTABLISHMENT UNION ALL SELECT BODIMIS.DIM_PROBATION_OFFICE.PROBATION_OFFICE_SK, BODIMIS.DIM_PROBATION_OFFICE.PROB_OFFICE_DESCRIPTION, 'Probation Office' AS Location_Type_To FROM BODIMIS.DIM_PROBATION_OFFICE UNION ALL SELECT BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_SK, BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_DESCRIPTION, 'Outside Location' AS Location_Type_To FROM BODIMIS.DIM_OUTSIDE_LOCATION UNION ALL SELECT BODIMIS.DIM_CITY.CITY_SK, BODIMIS.DIM_CITY.DESCRIPTION, 'City' AS Location_Type_To FROM BODIMIS.DIM_CITY UNION ALL SELECT BODIMIS.DIM_COURT.COURT_SK, BODIMIS.DIM_COURT.COURT_DESCRIPTION, 'Court' AS Location_Type_To FROM BODIMIS.DIM_COURT UNION ALL SELECT address_id_nk, TRIM(CASE WHEN no_fixed_address_flag = 'Y' THEN 'No fixed address' ELSE CASE WHEN NOT flat IS NULL THEN flat || '  ' END || CASE WHEN NOT premise IS NULL THEN premise || '  ' END || CASE WHEN NOT street IS NULL THEN street || '  ' END || CASE WHEN NOT locality IS NULL THEN locality || '  ' END || CASE WHEN NOT city_desc IS NULL THEN city_desc || '  ' END || CASE WHEN NOT county_desc IS NULL THEN county_desc || '  ' END || CASE WHEN NOT postal_code IS NULL THEN postal_code || '  ' END || CASE WHEN NOT country_desc IS NULL THEN country_desc END END), 'Home Leave Address' FROM bodimis.dim_addresses) DT_EXT_MOVE_TO, BODIMIS.DIM_COURT_CASE AT_COURT_CASE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE WHERE (AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+)) AND (AT_CURFEW_ASSESSMENT.HDC_ASSMENT_APP_STATUS_SK = AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_SK (+)) AND (AT_CURFEW_ASSESSMENT.ASSESSMENT_DATE_SK = AT_DIM_ASSESSMENT_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURRENT_KEY_DATES.OFFENDER_BOOKING_SK (+)) AND (AT_CURFEW_ASSESSMENT.DECISION_DATE_SK = AT_DIM_DECISION_DATE.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURREFFSENLEN.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (CASE WHEN AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = 'Establishment' THEN AT_FACT_MOV_EXT.FROM_LOCATION_SK END = AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_SENTENCE.COURT_CASE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_FACT_MOV_EXT.TO_LOCATION_SK = DT_EXT_MOVE_TO.SK_ID_TO (+) AND AT_FACT_MOV_EXT.TO_LOCATION_TYPE = DT_EXT_MOVE_TO.LOCATION_TYPE_TO (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_CURFEW_ASSESSMENT.OFFENDER_BOOKING_SK (+)) AND ((TRUNC(AT_DIM_DATE_EXT_MOV.DAY_DATE) BETWEEN TO_DATE('02-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND TO_DATE('09-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS')) AND AT_FACT_MOV_EXT.TYPE IN ('Release') AND AT_FACT_MOV_EXT.DIRECTION_CODE IN ('OUT') AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION IN ('RANBY (HMP)', 'READING (HMP & YOI)', 'RISLEY (HMP)', 'ROCHESTER (HMP & YOI)', 'ROLLESTONE (HMP)', 'RUDGATE (HMP)', 'RYE HILL (HMP)', 'SEND (HMP)', 'SHEPTON MALLET (HMP)', 'SHREWSBURY (HMP)', 'SPRING HILL (HMP)', 'STAFFORD (HMP)', 'STANDFORD HILL (HMP)', 'STOCKEN (HMP)', 'STOKE HEATH (HMPYOI)', 'STYAL (HMP & YOI)', 'SUDBURY (HMP & YOI)', 'SWALESIDE (HMP)', 'SWANSEA (HMP)', 'SWINFEN HALL (HMP)') AND NOT DT_CURRENT_KEY_DATES.CURR_HDCED_DATE IS NULL AND AT_OFFENDER_BOOKING.ACTIVE_STATUS IN ('Inactive Out'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, BOOKING_NUMBER, SENTENCE_START_DATE, EFFECTIVE_SENTENCE_LENGTH, LEGAL_STATUS_GROUPING, HDC_CHECKS_DONE_DATE, HDC_PASSED_FLAG, HDC_ASSMENT_APP_STATUS_DESC, HDC_DECISION_DATE, CURR_HDCED_DATE, CURR_ARD_DATE, CURR_CRD_DATE, ESTABLISHMENT_DESCRIPTION, MOVEMENT_TIME, REASON_CODE, DAY_DATE, HDC_REVIEW_FLAG, ACTIVE_STATUS, TYPE, DIRECTION_CODE, LOCATION_TYPE_TO, RELEASE_DATE, CURR_RELEASE_DATE, ARD_, CRD_, REASON FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPd.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "BOOKING_NUMBER",
            "type": "string",
            "display": "Booking Number",
            "legacyId": "DPd.DO10077",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SENTENCE_START_DATE",
            "type": "date",
            "display": "Sentence Start Date",
            "legacyId": "DPd.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DPd.DO2d0",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DPd.DO107cb",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "HDC_CHECKS_DONE_DATE",
            "type": "date",
            "display": "HDC Checks Done Date",
            "legacyId": "DPd.DO54a",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "HDC_PASSED_FLAG",
            "type": "string",
            "display": "HDC Passed Flag",
            "legacyId": "DPd.DO3ad",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "HDC_ASSMENT_APP_STATUS_DESC",
            "type": "string",
            "display": "HDC Status",
            "legacyId": "DPd.DO54",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "HDC_DECISION_DATE",
            "type": "date",
            "display": "HDC Decision Date",
            "legacyId": "DPd.DO3b0",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CURR_HDCED_DATE",
            "type": "date",
            "display": "HDC Eligibility Date",
            "legacyId": "DPd.DO70",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "CURR_ARD_DATE",
            "type": "date",
            "display": "ARD (Approved Release Date)",
            "legacyId": "DPd.DO47",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "CURR_CRD_DATE",
            "type": "date",
            "display": "CRD (Conditional Release Date)",
            "legacyId": "DPd.DO48",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Movement Location From Description (External)",
            "legacyId": "DPd.DO1015d",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DPd.DO107ce",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "REASON_CODE",
            "type": "string",
            "display": "Movement Reason Code (External)",
            "legacyId": "DPd.DO103fc",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date Only (External)",
            "legacyId": "DPd.DO1015c",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "HDC_REVIEW_FLAG",
            "type": "string",
            "display": "HDC Review Flag",
            "legacyId": "DPd.DO3ae",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "ACTIVE_STATUS",
            "type": "string",
            "display": "Active Status",
            "legacyId": "DPd.DO104d5",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "TYPE",
            "type": "string",
            "display": "Movement Type (External)",
            "legacyId": "DPd.DO103ec",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "DIRECTION_CODE",
            "type": "string",
            "display": "Movement Direction Code (External)",
            "legacyId": "DPd.DO103fd",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "LOCATION_TYPE_TO",
            "type": "string",
            "display": "Location Type To",
            "legacyId": "DPd.DO10768",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "RELEASE_DATE",
            "type": "date",
            "display": "Release Date",
            "legacyId": "DPd.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CURR_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DPd.DO2e6",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "ARD_",
            "type": "date",
            "display": "ARD (Approved Release Date) (Historical)",
            "legacyId": "DPd.DO30d",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "CRD_",
            "type": "date",
            "display": "CRD (Conditional Release Date) (Historical)",
            "legacyId": "DPd.DO30a",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "REASON",
            "type": "string",
            "display": "Movement Description (External)",
            "legacyId": "DPd.DO1015b",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DPe",
      "name": "HDC One (T - V)",
      "description": "MIS Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.BOOKING_NUMBER, CASE WHEN AT_SENT_START_DATE.DAY_DATE < '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END AS SENTENCE_START_DATE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA') THEN 'Recall' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '0' THEN 'Dead' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '1' THEN 'Indeterminate Sentence' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('2', '3') THEN 'Sentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('9', '10') OR AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'CIV_RMD' THEN 'Civil Prisoner' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('8', '11') THEN 'Immigration Detainee' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('12', '13', '14') THEN 'Remand' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, CASE WHEN AT_DIM_ASSESSMENT_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_ASSESSMENT_DATE.DAY_DATE END AS HDC_CHECKS_DONE_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'N' THEN 'NO' END AS HDC_PASSED_FLAG, AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_DESC, CASE WHEN AT_DIM_DECISION_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_DECISION_DATE.DAY_DATE END AS HDC_DECISION_DATE, DT_CURRENT_KEY_DATES.CURR_HDCED_DATE, DT_CURRENT_KEY_DATES.CURR_ARD_DATE, DT_CURRENT_KEY_DATES.CURR_CRD_DATE, AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, AT_FACT_MOV_EXT.REASON_CODE, AT_DIM_DATE_EXT_MOV.DAY_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'N' THEN 'NO' END AS HDC_REVIEW_FLAG, AT_OFFENDER_BOOKING.ACTIVE_STATUS, AT_FACT_MOV_EXT.TYPE, AT_FACT_MOV_EXT.DIRECTION_CODE, DT_EXT_MOVE_TO.LOCATION_TYPE_TO, CASE WHEN AT_RELEASE_DATE.DAY_DATE < '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS RELEASE_DATE, DT_CURRENT_KEY_DATES.CURR_RELEASE_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE < '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS ARD_, CASE WHEN AT_CRD_DATE.DAY_DATE < '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CRD_, AT_FACT_MOV_EXT.REASON FROM BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_DIM_ASSESSMENT_DATE, BODIMIS.DIM_DATE AT_DIM_DECISION_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, (SELECT AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK AS OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END AS CURR_APD_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS CURR_ARD_DATE, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CURR_CRD_DATE, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END AS CURR_ETD_DATE, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END AS CURR_HDCAD_DATE, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END AS CURR_HDCED_DATE, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END AS CURR_PED_DATE, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END AS CURR_LED_DATE, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END AS CURR_LTD_DATE, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END AS CURR_MTD_DATE, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END AS CURR_NPD_DATE, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END AS CURR_PRRD_DATE, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS CURR_RELEASE_DATE, CASE WHEN AT_SED_DATE.DAY_DATE <> '31/12/9000' THEN AT_SED_DATE.DAY_DATE END AS SED, MIN(CASE WHEN AT_SENT_START_DATE.DAY_DATE <> '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END) AS SSD, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END AS TARIFF, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END AS CURR_ROTL_DATE, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END AS CURR_ERSED_DATE, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END AS CURR_TERSED_DATE, at_fact_offender_sentence.tused_date_sk AS tused_sk, NULLIF(td.day_date, TO_DATE('31/12/9000', 'DD/MM/YYYY')) AS tused FROM BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_APD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, BODIMIS.DIM_DATE AT_ETD_DATE, BODIMIS.DIM_DATE AT_HDCAD_DATE, BODIMIS.DIM_DATE AT_HDCED_DATE, BODIMIS.DIM_DATE AT_PED_DATE, BODIMIS.DIM_DATE AT_LED_DATE, BODIMIS.DIM_DATE AT_LTD_DATE, BODIMIS.DIM_DATE AT_MTD_DATE, BODIMIS.DIM_DATE AT_NPD_DATE, BODIMIS.DIM_DATE AT_PRRD_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_SED_DATE, BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_TARIFF_DATE, BODIMIS.DIM_DATE AT_ROTL_DATE, BODIMIS.DIM_DATE AT_ERSED_DATE, BODIMIS.DIM_DATE AT_TERSED_DATE, bodimis.dim_date td WHERE AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK = AT_FACT_SENTENCE.OFFENDER_BOOKING_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.APD_DATE_SK = AT_APD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ETD_DATE_SK = AT_ETD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCAD_DATE_SK = AT_HDCAD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCED_DATE_SK = AT_HDCED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LED_DATE_SK = AT_LED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LTD_DATE_SK = AT_LTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.MTD_DATE_SK = AT_MTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.NPD_DATE_SK = AT_NPD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PRRD_DATE_SK = AT_PRRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.SED_DATE_SK = AT_SED_DATE.DATE_SK (+) AND AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TARIFF_DATE_SK = AT_TARIFF_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ROTL_DATE_SK = AT_ROTL_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ERSED_DATE_SK = AT_ERSED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TERSED_DATE_SK = AT_TERSED_DATE.DATE_SK (+) AND at_fact_offender_sentence.tused_date_sk = td.date_sk (+) AND AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y' GROUP BY AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END, CASE WHEN at_sed_date.day_date <> '31/12/9000' THEN at_sed_date.day_date END, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END, at_fact_offender_sentence.tused_date_sk, td.day_date) DT_CURRENT_KEY_DATES, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_CURFEW_ASSESSMENT AT_CURFEW_ASSESSMENT, BODIMIS.DIM_HDC_ASSESSMNT_APP_STATUS AT_DIM_HDC_ASST_APP_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT BODIMIS.FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, BODIMIS.FACT_OFFENDER_SENTENCE.EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.FACT_OFFENDER_SENTENCE WHERE (BODIMIS.FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y')) DT_CURREFFSENLEN, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, (SELECT BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_SK AS SK_ID_TO, BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS TYPE_DESCRIPTION_TO, 'Establishment' AS Location_Type_To FROM BODIMIS.DIM_ESTABLISHMENT UNION ALL SELECT BODIMIS.DIM_PROBATION_OFFICE.PROBATION_OFFICE_SK, BODIMIS.DIM_PROBATION_OFFICE.PROB_OFFICE_DESCRIPTION, 'Probation Office' AS Location_Type_To FROM BODIMIS.DIM_PROBATION_OFFICE UNION ALL SELECT BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_SK, BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_DESCRIPTION, 'Outside Location' AS Location_Type_To FROM BODIMIS.DIM_OUTSIDE_LOCATION UNION ALL SELECT BODIMIS.DIM_CITY.CITY_SK, BODIMIS.DIM_CITY.DESCRIPTION, 'City' AS Location_Type_To FROM BODIMIS.DIM_CITY UNION ALL SELECT BODIMIS.DIM_COURT.COURT_SK, BODIMIS.DIM_COURT.COURT_DESCRIPTION, 'Court' AS Location_Type_To FROM BODIMIS.DIM_COURT UNION ALL SELECT address_id_nk, TRIM(CASE WHEN no_fixed_address_flag = 'Y' THEN 'No fixed address' ELSE CASE WHEN NOT flat IS NULL THEN flat || '  ' END || CASE WHEN NOT premise IS NULL THEN premise || '  ' END || CASE WHEN NOT street IS NULL THEN street || '  ' END || CASE WHEN NOT locality IS NULL THEN locality || '  ' END || CASE WHEN NOT city_desc IS NULL THEN city_desc || '  ' END || CASE WHEN NOT county_desc IS NULL THEN county_desc || '  ' END || CASE WHEN NOT postal_code IS NULL THEN postal_code || '  ' END || CASE WHEN NOT country_desc IS NULL THEN country_desc END END), 'Home Leave Address' FROM bodimis.dim_addresses) DT_EXT_MOVE_TO, BODIMIS.DIM_COURT_CASE AT_COURT_CASE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE WHERE (AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+)) AND (AT_CURFEW_ASSESSMENT.HDC_ASSMENT_APP_STATUS_SK = AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_SK (+)) AND (AT_CURFEW_ASSESSMENT.ASSESSMENT_DATE_SK = AT_DIM_ASSESSMENT_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURRENT_KEY_DATES.OFFENDER_BOOKING_SK (+)) AND (AT_CURFEW_ASSESSMENT.DECISION_DATE_SK = AT_DIM_DECISION_DATE.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURREFFSENLEN.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (CASE WHEN AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = 'Establishment' THEN AT_FACT_MOV_EXT.FROM_LOCATION_SK END = AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_SENTENCE.COURT_CASE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_FACT_MOV_EXT.TO_LOCATION_SK = DT_EXT_MOVE_TO.SK_ID_TO (+) AND AT_FACT_MOV_EXT.TO_LOCATION_TYPE = DT_EXT_MOVE_TO.LOCATION_TYPE_TO (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_CURFEW_ASSESSMENT.OFFENDER_BOOKING_SK (+)) AND ((TRUNC(AT_DIM_DATE_EXT_MOV.DAY_DATE) BETWEEN TO_DATE('02-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND TO_DATE('09-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS')) AND AT_FACT_MOV_EXT.TYPE IN ('Release') AND AT_FACT_MOV_EXT.DIRECTION_CODE IN ('OUT') AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION IN ('THAMESIDE (HMP)', 'THE MOUNT (HMP)', 'THE WEARE (HMP)', 'THORN CROSS (HMPYOI)', 'THORP ARCH (HMP)', 'The Verne Immigration Removal Centre', 'USK (HMP)') AND NOT DT_CURRENT_KEY_DATES.CURR_HDCED_DATE IS NULL AND AT_OFFENDER_BOOKING.ACTIVE_STATUS IN ('Inactive Out'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, BOOKING_NUMBER, SENTENCE_START_DATE, EFFECTIVE_SENTENCE_LENGTH, LEGAL_STATUS_GROUPING, HDC_CHECKS_DONE_DATE, HDC_PASSED_FLAG, HDC_ASSMENT_APP_STATUS_DESC, HDC_DECISION_DATE, CURR_HDCED_DATE, CURR_ARD_DATE, CURR_CRD_DATE, ESTABLISHMENT_DESCRIPTION, MOVEMENT_TIME, REASON_CODE, DAY_DATE, HDC_REVIEW_FLAG, ACTIVE_STATUS, TYPE, DIRECTION_CODE, LOCATION_TYPE_TO, RELEASE_DATE, CURR_RELEASE_DATE, ARD_, CRD_, REASON FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPe.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "BOOKING_NUMBER",
            "type": "string",
            "display": "Booking Number",
            "legacyId": "DPe.DO10077",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SENTENCE_START_DATE",
            "type": "date",
            "display": "Sentence Start Date",
            "legacyId": "DPe.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DPe.DO2d0",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DPe.DO107cb",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "HDC_CHECKS_DONE_DATE",
            "type": "date",
            "display": "HDC Checks Done Date",
            "legacyId": "DPe.DO54a",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "HDC_PASSED_FLAG",
            "type": "string",
            "display": "HDC Passed Flag",
            "legacyId": "DPe.DO3ad",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "HDC_ASSMENT_APP_STATUS_DESC",
            "type": "string",
            "display": "HDC Status",
            "legacyId": "DPe.DO54",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "HDC_DECISION_DATE",
            "type": "date",
            "display": "HDC Decision Date",
            "legacyId": "DPe.DO3b0",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CURR_HDCED_DATE",
            "type": "date",
            "display": "HDC Eligibility Date",
            "legacyId": "DPe.DO70",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "CURR_ARD_DATE",
            "type": "date",
            "display": "ARD (Approved Release Date)",
            "legacyId": "DPe.DO47",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "CURR_CRD_DATE",
            "type": "date",
            "display": "CRD (Conditional Release Date)",
            "legacyId": "DPe.DO48",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Movement Location From Description (External)",
            "legacyId": "DPe.DO1015d",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DPe.DO107ce",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "REASON_CODE",
            "type": "string",
            "display": "Movement Reason Code (External)",
            "legacyId": "DPe.DO103fc",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date Only (External)",
            "legacyId": "DPe.DO1015c",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "HDC_REVIEW_FLAG",
            "type": "string",
            "display": "HDC Review Flag",
            "legacyId": "DPe.DO3ae",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "ACTIVE_STATUS",
            "type": "string",
            "display": "Active Status",
            "legacyId": "DPe.DO104d5",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "TYPE",
            "type": "string",
            "display": "Movement Type (External)",
            "legacyId": "DPe.DO103ec",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "DIRECTION_CODE",
            "type": "string",
            "display": "Movement Direction Code (External)",
            "legacyId": "DPe.DO103fd",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "LOCATION_TYPE_TO",
            "type": "string",
            "display": "Location Type To",
            "legacyId": "DPe.DO10768",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "RELEASE_DATE",
            "type": "date",
            "display": "Release Date",
            "legacyId": "DPe.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CURR_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DPe.DO2e6",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "ARD_",
            "type": "date",
            "display": "ARD (Approved Release Date) (Historical)",
            "legacyId": "DPe.DO30d",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "CRD_",
            "type": "date",
            "display": "CRD (Conditional Release Date) (Historical)",
            "legacyId": "DPe.DO30a",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "REASON",
            "type": "string",
            "display": "Movement Description (External)",
            "legacyId": "DPe.DO1015b",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DPf",
      "name": "HDC One (W - Z)",
      "description": "MIS Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.BOOKING_NUMBER, CASE WHEN AT_SENT_START_DATE.DAY_DATE < '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END AS SENTENCE_START_DATE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA') THEN 'Recall' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '0' THEN 'Dead' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '1' THEN 'Indeterminate Sentence' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('2', '3') THEN 'Sentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('9', '10') OR AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'CIV_RMD' THEN 'Civil Prisoner' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('8', '11') THEN 'Immigration Detainee' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('12', '13', '14') THEN 'Remand' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, CASE WHEN AT_DIM_ASSESSMENT_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_ASSESSMENT_DATE.DAY_DATE END AS HDC_CHECKS_DONE_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'N' THEN 'NO' END AS HDC_PASSED_FLAG, AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_DESC, CASE WHEN AT_DIM_DECISION_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_DECISION_DATE.DAY_DATE END AS HDC_DECISION_DATE, DT_CURRENT_KEY_DATES.CURR_HDCED_DATE, DT_CURRENT_KEY_DATES.CURR_ARD_DATE, DT_CURRENT_KEY_DATES.CURR_CRD_DATE, AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, AT_FACT_MOV_EXT.REASON_CODE, AT_DIM_DATE_EXT_MOV.DAY_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'N' THEN 'NO' END AS HDC_REVIEW_FLAG, AT_OFFENDER_BOOKING.ACTIVE_STATUS, AT_FACT_MOV_EXT.TYPE, AT_FACT_MOV_EXT.DIRECTION_CODE, DT_EXT_MOVE_TO.LOCATION_TYPE_TO, CASE WHEN AT_RELEASE_DATE.DAY_DATE < '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS RELEASE_DATE, DT_CURRENT_KEY_DATES.CURR_RELEASE_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE < '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS ARD_, CASE WHEN AT_CRD_DATE.DAY_DATE < '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CRD_, AT_FACT_MOV_EXT.REASON FROM BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_DIM_ASSESSMENT_DATE, BODIMIS.DIM_DATE AT_DIM_DECISION_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, (SELECT AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK AS OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END AS CURR_APD_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS CURR_ARD_DATE, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CURR_CRD_DATE, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END AS CURR_ETD_DATE, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END AS CURR_HDCAD_DATE, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END AS CURR_HDCED_DATE, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END AS CURR_PED_DATE, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END AS CURR_LED_DATE, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END AS CURR_LTD_DATE, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END AS CURR_MTD_DATE, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END AS CURR_NPD_DATE, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END AS CURR_PRRD_DATE, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS CURR_RELEASE_DATE, CASE WHEN AT_SED_DATE.DAY_DATE <> '31/12/9000' THEN AT_SED_DATE.DAY_DATE END AS SED, MIN(CASE WHEN AT_SENT_START_DATE.DAY_DATE <> '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END) AS SSD, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END AS TARIFF, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END AS CURR_ROTL_DATE, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END AS CURR_ERSED_DATE, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END AS CURR_TERSED_DATE, at_fact_offender_sentence.tused_date_sk AS tused_sk, NULLIF(td.day_date, TO_DATE('31/12/9000', 'DD/MM/YYYY')) AS tused FROM BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_APD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, BODIMIS.DIM_DATE AT_ETD_DATE, BODIMIS.DIM_DATE AT_HDCAD_DATE, BODIMIS.DIM_DATE AT_HDCED_DATE, BODIMIS.DIM_DATE AT_PED_DATE, BODIMIS.DIM_DATE AT_LED_DATE, BODIMIS.DIM_DATE AT_LTD_DATE, BODIMIS.DIM_DATE AT_MTD_DATE, BODIMIS.DIM_DATE AT_NPD_DATE, BODIMIS.DIM_DATE AT_PRRD_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_SED_DATE, BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_TARIFF_DATE, BODIMIS.DIM_DATE AT_ROTL_DATE, BODIMIS.DIM_DATE AT_ERSED_DATE, BODIMIS.DIM_DATE AT_TERSED_DATE, bodimis.dim_date td WHERE AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK = AT_FACT_SENTENCE.OFFENDER_BOOKING_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.APD_DATE_SK = AT_APD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ETD_DATE_SK = AT_ETD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCAD_DATE_SK = AT_HDCAD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCED_DATE_SK = AT_HDCED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LED_DATE_SK = AT_LED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LTD_DATE_SK = AT_LTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.MTD_DATE_SK = AT_MTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.NPD_DATE_SK = AT_NPD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PRRD_DATE_SK = AT_PRRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.SED_DATE_SK = AT_SED_DATE.DATE_SK (+) AND AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TARIFF_DATE_SK = AT_TARIFF_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ROTL_DATE_SK = AT_ROTL_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ERSED_DATE_SK = AT_ERSED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TERSED_DATE_SK = AT_TERSED_DATE.DATE_SK (+) AND at_fact_offender_sentence.tused_date_sk = td.date_sk (+) AND AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y' GROUP BY AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END, CASE WHEN at_sed_date.day_date <> '31/12/9000' THEN at_sed_date.day_date END, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END, at_fact_offender_sentence.tused_date_sk, td.day_date) DT_CURRENT_KEY_DATES, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_CURFEW_ASSESSMENT AT_CURFEW_ASSESSMENT, BODIMIS.DIM_HDC_ASSESSMNT_APP_STATUS AT_DIM_HDC_ASST_APP_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT BODIMIS.FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, BODIMIS.FACT_OFFENDER_SENTENCE.EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.FACT_OFFENDER_SENTENCE WHERE (BODIMIS.FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y')) DT_CURREFFSENLEN, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, (SELECT BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_SK AS SK_ID_TO, BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS TYPE_DESCRIPTION_TO, 'Establishment' AS Location_Type_To FROM BODIMIS.DIM_ESTABLISHMENT UNION ALL SELECT BODIMIS.DIM_PROBATION_OFFICE.PROBATION_OFFICE_SK, BODIMIS.DIM_PROBATION_OFFICE.PROB_OFFICE_DESCRIPTION, 'Probation Office' AS Location_Type_To FROM BODIMIS.DIM_PROBATION_OFFICE UNION ALL SELECT BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_SK, BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_DESCRIPTION, 'Outside Location' AS Location_Type_To FROM BODIMIS.DIM_OUTSIDE_LOCATION UNION ALL SELECT BODIMIS.DIM_CITY.CITY_SK, BODIMIS.DIM_CITY.DESCRIPTION, 'City' AS Location_Type_To FROM BODIMIS.DIM_CITY UNION ALL SELECT BODIMIS.DIM_COURT.COURT_SK, BODIMIS.DIM_COURT.COURT_DESCRIPTION, 'Court' AS Location_Type_To FROM BODIMIS.DIM_COURT UNION ALL SELECT address_id_nk, TRIM(CASE WHEN no_fixed_address_flag = 'Y' THEN 'No fixed address' ELSE CASE WHEN NOT flat IS NULL THEN flat || '  ' END || CASE WHEN NOT premise IS NULL THEN premise || '  ' END || CASE WHEN NOT street IS NULL THEN street || '  ' END || CASE WHEN NOT locality IS NULL THEN locality || '  ' END || CASE WHEN NOT city_desc IS NULL THEN city_desc || '  ' END || CASE WHEN NOT county_desc IS NULL THEN county_desc || '  ' END || CASE WHEN NOT postal_code IS NULL THEN postal_code || '  ' END || CASE WHEN NOT country_desc IS NULL THEN country_desc END END), 'Home Leave Address' FROM bodimis.dim_addresses) DT_EXT_MOVE_TO, BODIMIS.DIM_COURT_CASE AT_COURT_CASE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE WHERE (AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+)) AND (AT_CURFEW_ASSESSMENT.HDC_ASSMENT_APP_STATUS_SK = AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_SK (+)) AND (AT_CURFEW_ASSESSMENT.ASSESSMENT_DATE_SK = AT_DIM_ASSESSMENT_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURRENT_KEY_DATES.OFFENDER_BOOKING_SK (+)) AND (AT_CURFEW_ASSESSMENT.DECISION_DATE_SK = AT_DIM_DECISION_DATE.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURREFFSENLEN.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (CASE WHEN AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = 'Establishment' THEN AT_FACT_MOV_EXT.FROM_LOCATION_SK END = AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_SENTENCE.COURT_CASE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_FACT_MOV_EXT.TO_LOCATION_SK = DT_EXT_MOVE_TO.SK_ID_TO (+) AND AT_FACT_MOV_EXT.TO_LOCATION_TYPE = DT_EXT_MOVE_TO.LOCATION_TYPE_TO (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_CURFEW_ASSESSMENT.OFFENDER_BOOKING_SK (+)) AND ((TRUNC(AT_DIM_DATE_EXT_MOV.DAY_DATE) BETWEEN TO_DATE('02-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND TO_DATE('09-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS')) AND AT_FACT_MOV_EXT.TYPE IN ('Release') AND AT_FACT_MOV_EXT.DIRECTION_CODE IN ('OUT') AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION IN ('WAKEFIELD (HMP)', 'WANDSWORTH (HMP)', 'WARREN HILL (HMP)', 'WAYLAND (HMP)', 'WEALSTUN (HMP)', 'WELLINGBOROUGH (HMP)', 'WERRINGTON (HMPYOI)', 'WETHERBY (HMPYOI)', 'WHATTON (HMP)', 'WHITEMOOR (HMP)', 'WINCHESTER (HMP)', 'WOLDS (HMP)', 'WOODHILL (HMP)', 'WORMWOOD SCRUBS (HMP)', 'WYMOTT (HMP)') AND NOT DT_CURRENT_KEY_DATES.CURR_HDCED_DATE IS NULL AND AT_OFFENDER_BOOKING.ACTIVE_STATUS IN ('Inactive Out'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, BOOKING_NUMBER, SENTENCE_START_DATE, EFFECTIVE_SENTENCE_LENGTH, LEGAL_STATUS_GROUPING, HDC_CHECKS_DONE_DATE, HDC_PASSED_FLAG, HDC_ASSMENT_APP_STATUS_DESC, HDC_DECISION_DATE, CURR_HDCED_DATE, CURR_ARD_DATE, CURR_CRD_DATE, ESTABLISHMENT_DESCRIPTION, MOVEMENT_TIME, REASON_CODE, DAY_DATE, HDC_REVIEW_FLAG, ACTIVE_STATUS, TYPE, DIRECTION_CODE, LOCATION_TYPE_TO, RELEASE_DATE, CURR_RELEASE_DATE, ARD_, CRD_, REASON FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPf.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "BOOKING_NUMBER",
            "type": "string",
            "display": "Booking Number",
            "legacyId": "DPf.DO10077",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SENTENCE_START_DATE",
            "type": "date",
            "display": "Sentence Start Date",
            "legacyId": "DPf.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DPf.DO2d0",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DPf.DO107cb",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "HDC_CHECKS_DONE_DATE",
            "type": "date",
            "display": "HDC Checks Done Date",
            "legacyId": "DPf.DO54a",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "HDC_PASSED_FLAG",
            "type": "string",
            "display": "HDC Passed Flag",
            "legacyId": "DPf.DO3ad",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "HDC_ASSMENT_APP_STATUS_DESC",
            "type": "string",
            "display": "HDC Status",
            "legacyId": "DPf.DO54",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "HDC_DECISION_DATE",
            "type": "date",
            "display": "HDC Decision Date",
            "legacyId": "DPf.DO3b0",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CURR_HDCED_DATE",
            "type": "date",
            "display": "HDC Eligibility Date",
            "legacyId": "DPf.DO70",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "CURR_ARD_DATE",
            "type": "date",
            "display": "ARD (Approved Release Date)",
            "legacyId": "DPf.DO47",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "CURR_CRD_DATE",
            "type": "date",
            "display": "CRD (Conditional Release Date)",
            "legacyId": "DPf.DO48",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Movement Location From Description (External)",
            "legacyId": "DPf.DO1015d",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DPf.DO107ce",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "REASON_CODE",
            "type": "string",
            "display": "Movement Reason Code (External)",
            "legacyId": "DPf.DO103fc",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date Only (External)",
            "legacyId": "DPf.DO1015c",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "HDC_REVIEW_FLAG",
            "type": "string",
            "display": "HDC Review Flag",
            "legacyId": "DPf.DO3ae",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "ACTIVE_STATUS",
            "type": "string",
            "display": "Active Status",
            "legacyId": "DPf.DO104d5",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "TYPE",
            "type": "string",
            "display": "Movement Type (External)",
            "legacyId": "DPf.DO103ec",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "DIRECTION_CODE",
            "type": "string",
            "display": "Movement Direction Code (External)",
            "legacyId": "DPf.DO103fd",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "LOCATION_TYPE_TO",
            "type": "string",
            "display": "Location Type To",
            "legacyId": "DPf.DO10768",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "RELEASE_DATE",
            "type": "date",
            "display": "Release Date",
            "legacyId": "DPf.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CURR_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DPf.DO2e6",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "ARD_",
            "type": "date",
            "display": "ARD (Approved Release Date) (Historical)",
            "legacyId": "DPf.DO30d",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "CRD_",
            "type": "date",
            "display": "CRD (Conditional Release Date) (Historical)",
            "legacyId": "DPf.DO30a",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "REASON",
            "type": "string",
            "display": "Movement Description (External)",
            "legacyId": "DPf.DO1015b",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP10",
      "name": "Active Status - Releases",
      "description": "MIS Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.BOOKING_NUMBER, CASE WHEN AT_SENT_START_DATE.DAY_DATE < '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END AS SENTENCE_START_DATE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE DT_CURREFFSENLEN.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA') THEN 'Recall' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '0' THEN 'Dead' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '1' THEN 'Indeterminate Sentence' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('2', '3') THEN 'Sentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('9', '10') OR AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'CIV_RMD' THEN 'Civil Prisoner' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('8', '11') THEN 'Immigration Detainee' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('12', '13', '14') THEN 'Remand' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, CASE WHEN AT_DIM_ASSESSMENT_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_ASSESSMENT_DATE.DAY_DATE END AS HDC_CHECKS_DONE_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.PASSED_FLAG = 'N' THEN 'NO' END AS HDC_PASSED_FLAG, AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_DESC, CASE WHEN AT_DIM_DECISION_DATE.DAY_DATE < '31/12/9000' THEN AT_DIM_DECISION_DATE.DAY_DATE END AS HDC_DECISION_DATE, DT_CURRENT_KEY_DATES.CURR_HDCED_DATE, DT_CURRENT_KEY_DATES.CURR_ARD_DATE, DT_CURRENT_KEY_DATES.CURR_CRD_DATE, AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, AT_FACT_MOV_EXT.REASON_CODE, AT_DIM_DATE_EXT_MOV.DAY_DATE, CASE WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'Y' THEN 'YES' WHEN AT_CURFEW_ASSESSMENT.REVIEW_FLAG = 'N' THEN 'NO' END AS HDC_REVIEW_FLAG, AT_OFFENDER_BOOKING.ACTIVE_STATUS, AT_FACT_MOV_EXT.TYPE, AT_FACT_MOV_EXT.DIRECTION_CODE, DT_EXT_MOVE_TO.LOCATION_TYPE_TO, CASE WHEN AT_RELEASE_DATE.DAY_DATE < '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS RELEASE_DATE, DT_CURRENT_KEY_DATES.CURR_RELEASE_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE < '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS ARD_, CASE WHEN AT_CRD_DATE.DAY_DATE < '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CRD_, AT_FACT_MOV_EXT.REASON FROM BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_DIM_ASSESSMENT_DATE, BODIMIS.DIM_DATE AT_DIM_DECISION_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, (SELECT AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK AS OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END AS CURR_APD_DATE, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END AS CURR_ARD_DATE, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END AS CURR_CRD_DATE, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END AS CURR_ETD_DATE, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END AS CURR_HDCAD_DATE, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END AS CURR_HDCED_DATE, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END AS CURR_PED_DATE, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END AS CURR_LED_DATE, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END AS CURR_LTD_DATE, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END AS CURR_MTD_DATE, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END AS CURR_NPD_DATE, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END AS CURR_PRRD_DATE, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END AS CURR_RELEASE_DATE, CASE WHEN AT_SED_DATE.DAY_DATE <> '31/12/9000' THEN AT_SED_DATE.DAY_DATE END AS SED, MIN(CASE WHEN AT_SENT_START_DATE.DAY_DATE <> '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END) AS SSD, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END AS TARIFF, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END AS CURR_ROTL_DATE, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END AS CURR_ERSED_DATE, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END AS CURR_TERSED_DATE, at_fact_offender_sentence.tused_date_sk AS tused_sk, NULLIF(td.day_date, TO_DATE('31/12/9000', 'DD/MM/YYYY')) AS tused FROM BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE, BODIMIS.DIM_DATE AT_ARD_DATE, BODIMIS.DIM_DATE AT_APD_DATE, BODIMIS.DIM_DATE AT_CRD_DATE, BODIMIS.DIM_DATE AT_ETD_DATE, BODIMIS.DIM_DATE AT_HDCAD_DATE, BODIMIS.DIM_DATE AT_HDCED_DATE, BODIMIS.DIM_DATE AT_PED_DATE, BODIMIS.DIM_DATE AT_LED_DATE, BODIMIS.DIM_DATE AT_LTD_DATE, BODIMIS.DIM_DATE AT_MTD_DATE, BODIMIS.DIM_DATE AT_NPD_DATE, BODIMIS.DIM_DATE AT_PRRD_DATE, BODIMIS.DIM_DATE AT_RELEASE_DATE, BODIMIS.DIM_DATE AT_SED_DATE, BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.DIM_DATE AT_TARIFF_DATE, BODIMIS.DIM_DATE AT_ROTL_DATE, BODIMIS.DIM_DATE AT_ERSED_DATE, BODIMIS.DIM_DATE AT_TERSED_DATE, bodimis.dim_date td WHERE AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK = AT_FACT_SENTENCE.OFFENDER_BOOKING_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.APD_DATE_SK = AT_APD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ETD_DATE_SK = AT_ETD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCAD_DATE_SK = AT_HDCAD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.HDCED_DATE_SK = AT_HDCED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LED_DATE_SK = AT_LED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.LTD_DATE_SK = AT_LTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.MTD_DATE_SK = AT_MTD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.NPD_DATE_SK = AT_NPD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PED_DATE_SK = AT_PED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.PRRD_DATE_SK = AT_PRRD_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.SED_DATE_SK = AT_SED_DATE.DATE_SK (+) AND AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TARIFF_DATE_SK = AT_TARIFF_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ROTL_DATE_SK = AT_ROTL_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.ERSED_DATE_SK = AT_ERSED_DATE.DATE_SK (+) AND AT_FACT_OFFENDER_SENTENCE.TERSED_DATE_SK = AT_TERSED_DATE.DATE_SK (+) AND at_fact_offender_sentence.tused_date_sk = td.date_sk (+) AND AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y' GROUP BY AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, CASE WHEN AT_APD_DATE.DAY_DATE <> '31/12/9000' THEN AT_APD_DATE.DAY_DATE END, CASE WHEN AT_ARD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ARD_DATE.DAY_DATE END, CASE WHEN AT_CRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_CRD_DATE.DAY_DATE END, CASE WHEN AT_ETD_DATE.DAY_DATE <> '31/12/9000' THEN AT_ETD_DATE.DAY_DATE END, CASE WHEN AT_HDCAD_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCAD_DATE.DAY_DATE END, CASE WHEN AT_HDCED_DATE.DAY_DATE <> '31/12/9000' THEN AT_HDCED_DATE.DAY_DATE END, CASE WHEN AT_PED_DATE.DAY_DATE <> '31/12/9000' THEN AT_PED_DATE.DAY_DATE END, CASE WHEN AT_LED_DATE.DAY_DATE <> '31/12/9000' THEN AT_LED_DATE.DAY_DATE END, CASE WHEN AT_LTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_LTD_DATE.DAY_DATE END, CASE WHEN AT_MTD_DATE.DAY_DATE <> '31/12/9000' THEN AT_MTD_DATE.DAY_DATE END, CASE WHEN AT_NPD_DATE.DAY_DATE <> '31/12/9000' THEN AT_NPD_DATE.DAY_DATE END, CASE WHEN AT_PRRD_DATE.DAY_DATE <> '31/12/9000' THEN AT_PRRD_DATE.DAY_DATE END, CASE WHEN AT_RELEASE_DATE.DAY_DATE <> '31/12/9000' THEN AT_RELEASE_DATE.DAY_DATE END, CASE WHEN at_sed_date.day_date <> '31/12/9000' THEN at_sed_date.day_date END, CASE WHEN AT_TARIFF_DATE.DAY_DATE <> '31/12/9000' THEN AT_TARIFF_DATE.DAY_DATE END, CASE WHEN AT_ROTL_DATE.DAY_DATE <> '31/12/9000' THEN AT_ROTL_DATE.DAY_DATE END, CASE WHEN AT_ERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_ERSED_DATE.DAY_DATE END, CASE WHEN AT_TERSED_DATE.DAY_DATE <> '31/12/9000' THEN AT_TERSED_DATE.DAY_DATE END, at_fact_offender_sentence.tused_date_sk, td.day_date) DT_CURRENT_KEY_DATES, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.FACT_CURFEW_ASSESSMENT AT_CURFEW_ASSESSMENT, BODIMIS.DIM_HDC_ASSESSMNT_APP_STATUS AT_DIM_HDC_ASST_APP_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT BODIMIS.FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK, BODIMIS.FACT_OFFENDER_SENTENCE.EFFECTIVE_SENTENCE_LENGTH FROM BODIMIS.FACT_OFFENDER_SENTENCE WHERE (BODIMIS.FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y')) DT_CURREFFSENLEN, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, (SELECT BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_SK AS SK_ID_TO, BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS TYPE_DESCRIPTION_TO, 'Establishment' AS Location_Type_To FROM BODIMIS.DIM_ESTABLISHMENT UNION ALL SELECT BODIMIS.DIM_PROBATION_OFFICE.PROBATION_OFFICE_SK, BODIMIS.DIM_PROBATION_OFFICE.PROB_OFFICE_DESCRIPTION, 'Probation Office' AS Location_Type_To FROM BODIMIS.DIM_PROBATION_OFFICE UNION ALL SELECT BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_SK, BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_DESCRIPTION, 'Outside Location' AS Location_Type_To FROM BODIMIS.DIM_OUTSIDE_LOCATION UNION ALL SELECT BODIMIS.DIM_CITY.CITY_SK, BODIMIS.DIM_CITY.DESCRIPTION, 'City' AS Location_Type_To FROM BODIMIS.DIM_CITY UNION ALL SELECT BODIMIS.DIM_COURT.COURT_SK, BODIMIS.DIM_COURT.COURT_DESCRIPTION, 'Court' AS Location_Type_To FROM BODIMIS.DIM_COURT UNION ALL SELECT address_id_nk, TRIM(CASE WHEN no_fixed_address_flag = 'Y' THEN 'No fixed address' ELSE CASE WHEN NOT flat IS NULL THEN flat || '  ' END || CASE WHEN NOT premise IS NULL THEN premise || '  ' END || CASE WHEN NOT street IS NULL THEN street || '  ' END || CASE WHEN NOT locality IS NULL THEN locality || '  ' END || CASE WHEN NOT city_desc IS NULL THEN city_desc || '  ' END || CASE WHEN NOT county_desc IS NULL THEN county_desc || '  ' END || CASE WHEN NOT postal_code IS NULL THEN postal_code || '  ' END || CASE WHEN NOT country_desc IS NULL THEN country_desc END END), 'Home Leave Address' FROM bodimis.dim_addresses) DT_EXT_MOVE_TO, BODIMIS.DIM_COURT_CASE AT_COURT_CASE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE WHERE (AT_FACT_OFFENDER_SENTENCE.ARD_DATE_SK = AT_ARD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.CRD_DATE_SK = AT_CRD_DATE.DATE_SK (+)) AND (AT_FACT_OFFENDER_SENTENCE.RELEASE_CALCULATED_DATE_SK = AT_RELEASE_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+)) AND (AT_CURFEW_ASSESSMENT.HDC_ASSMENT_APP_STATUS_SK = AT_DIM_HDC_ASST_APP_STATUS.HDC_ASSMENT_APP_STATUS_SK (+)) AND (AT_CURFEW_ASSESSMENT.ASSESSMENT_DATE_SK = AT_DIM_ASSESSMENT_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURRENT_KEY_DATES.OFFENDER_BOOKING_SK (+)) AND (AT_CURFEW_ASSESSMENT.DECISION_DATE_SK = AT_DIM_DECISION_DATE.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_CURREFFSENLEN.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (CASE WHEN AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = 'Establishment' THEN AT_FACT_MOV_EXT.FROM_LOCATION_SK END = AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_SENTENCE.COURT_CASE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_FACT_MOV_EXT.TO_LOCATION_SK = DT_EXT_MOVE_TO.SK_ID_TO (+) AND AT_FACT_MOV_EXT.TO_LOCATION_TYPE = DT_EXT_MOVE_TO.LOCATION_TYPE_TO (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_CURFEW_ASSESSMENT.OFFENDER_BOOKING_SK (+)) AND ((TRUNC(AT_DIM_DATE_EXT_MOV.DAY_DATE) BETWEEN TO_DATE('02-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND TO_DATE('09-02-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS')) AND AT_FACT_MOV_EXT.TYPE IN ('Release') AND AT_FACT_MOV_EXT.DIRECTION_CODE IN ('OUT') AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_DESCRIPTION IN ('ACKLINGTON (HMP)', 'ALBANY (HMP)', 'ALDINGTON (HMP)', 'ALTCOURSE (HMP)', 'ASHFIELD (HMP)', 'ASHWELL (HMP)', 'ASKHAM GRANGE (HMP & YOI)', 'AYLESBURY (HMP)', 'BEDFORD (HMP)', 'BELMARSH (HMP)', 'BERWYN (HMP)', 'BIRMINGHAM (HMP)', 'BLAKENHURST (HMP)', 'BLANTYRE HOUSE (HMP)', 'BLUNDESTON (HMP)', 'BRINSFORD (HMP)', 'BRISTOL (HMP)', 'BRIXTON (HMP)', 'BROCKHILL (HMP & YOI)', 'BRONZEFIELD (HMP)', 'BUCKLEY HALL (HMP)', 'BULLINGDON (HMP)', 'BULLWOOD HALL (HMP)', 'BURE (HMP)', 'CAMP HILL (HMP)', 'CAMPSFIELD HOUSE (HMYOI)', 'CANTERBURY (HMP)', 'CARDIFF (HMP)', 'CASTINGTON (HMP & YOI)', 'CHANNINGS WOOD (HMP)', 'CHELMSFORD (HMP)', 'CLELAND (HMP)', 'COLCHESTER (HMYOI)', 'COLDINGLEY (HMP)', 'COOKHAM WOOD (HMP)', 'DARTMOOR (HMP)', 'DEERBOLT (HMPYOI)', 'DONCASTER (HMP)', 'DORCHESTER (HMP)', 'DOVEGATE (HMP)', 'DOWNVIEW (HMP)', 'DRAKE HALL (HMP & YOI)', 'DURHAM (HMP)', 'Dover Immigration Removal Centre', 'EAST SUTTON PARK (HMP & YOI)', 'EASTWOOD PARK (HMP)', 'EDMUNDS HILL (HMP)', 'ELMLEY (HMP)', 'ERLESTOKE (HMP)', 'EVERTHORPE (HMP)', 'EXETER (HMP)', 'FEATHERSTONE (HMP)', 'FELTHAM (HMP & YOI)', 'FINNAMORE (HMYOI)', 'FORD (HMP)', 'FOREST BANK (HMP & YOI)', 'FOSTON HALL (HMP)', 'FRANKLAND (HMP)', 'FULL SUTTON (HMP)', 'GARTH (HMP)', 'GARTREE (HMP)', 'GLEN PARVA (HMPYOI & RC)', 'GLOUCESTER (HMP)', 'GRENDON (HMP)', 'GUYS MARSH (HMP)', 'HATFIELD (HMP & YOI)', 'HAVERIGG (HMP)', 'HEWELL GRANGE (HMP)', 'HIGH DOWN (HMP)', 'HIGHPOINT (HMP)', 'HINDLEY (HMP & YOI)', 'HMP HEWELL', 'HOLLESLEY BAY (HMP)', 'HOLLOWAY (HMP)', 'HOLME HOUSE (HMP)', 'HULL (HMP)', 'HUMBER (HMP)', 'HUNTERCOMBE (HMP)', 'Haslar Immigration Removal Centre', 'ISIS HMP/YOI', 'ISLE OF WIGHT (HMP)', 'KENNET (HMP)', 'KINGSTON (HMP)', 'KIRKHAM (HMP)', 'KIRKLEVINGTON GRANGE (HMP)', 'LANCASTER CASTLE (HMP)', 'LANCASTER FARMS (HMP)', 'LATCHMERE HOUSE (HMP)', 'LEEDS (HMP)', 'LEICESTER (HMP)', 'LEWES (HMP)', 'LEYHILL (HMP)', 'LINCOLN (HMP)', 'LINDHOLME (HMP)', 'LITTLEHEY (HMP)', 'LIVERPOOL (HMP)', 'LONG LARTIN (HMP)', 'LOW NEWTON (HMP)', 'LOWDHAM GRANGE (HMP)', 'MAIDSTONE (HMP)', 'MANCHESTER (HMP)', 'MEDWAY (STC)', 'MOORLAND (HMP & YOI)', 'MORTON HALL IMMIGRATION REMOVAL CENTRE', 'NEW HALL (HMP)', 'NORTH SEA CAMP (HMP)', 'NORTHALLERTON (HMP)', 'NORTHEYE (HMP)', 'NORTHUMBERLAND (HMP)', 'NORWICH (HMP & YOI)', 'NOTTINGHAM (HMP)', 'OAKWOOD (HMP)', 'ONLEY (HMP)', 'OUTSIDE', 'OXFORD (HMP)', 'PARC (HMP)', 'PARKHURST (HMP)', 'PENTONVILLE (HMP)', 'PETERBOROUGH (HMP)', 'PETERBOROUGH FEMALE HMP', 'PORTLAND (HMPYOI)', 'PRESCOED (HMP & YOI)', 'PRESTON (HMP)', 'PUCKLECHURCH (HMRC)', 'RANBY (HMP)', 'READING (HMP & YOI)', 'RISLEY (HMP)', 'ROCHESTER (HMP & YOI)', 'ROLLESTONE (HMP)', 'RUDGATE (HMP)', 'RYE HILL (HMP)', 'SEND (HMP)', 'SHEPTON MALLET (HMP)', 'SHREWSBURY (HMP)', 'SPRING HILL (HMP)', 'STAFFORD (HMP)', 'STANDFORD HILL (HMP)', 'STOCKEN (HMP)', 'STOKE HEATH (HMPYOI)', 'STYAL (HMP & YOI)', 'SUDBURY (HMP & YOI)', 'SWALESIDE (HMP)', 'SWANSEA (HMP)', 'SWINFEN HALL (HMP)', 'THAMESIDE (HMP)', 'THE MOUNT (HMP)', 'THE WEARE (HMP)', 'THORN CROSS (HMPYOI)', 'THORP ARCH (HMP)', 'TRANSFER', 'The Verne Immigration Removal Centre', 'USK (HMP)', 'Unknown', 'WAKEFIELD (HMP)', 'WANDSWORTH (HMP)', 'WARREN HILL (HMP)', 'WAYLAND (HMP)', 'WEALSTUN (HMP)', 'WELLINGBOROUGH (HMP)', 'WERRINGTON (HMPYOI)', 'WETHERBY (HMPYOI)', 'WHATTON (HMP)', 'WHITEMOOR (HMP)', 'WINCHESTER (HMP)', 'WOLDS (HMP)', 'WOODHILL (HMP)', 'WORMWOOD SCRUBS (HMP)', 'WYMOTT (HMP)') AND AT_OFFENDER_BOOKING.ACTIVE_STATUS IN ('Active In', 'Active In Transit', 'Active Out', 'Active UAL'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, BOOKING_NUMBER, SENTENCE_START_DATE, EFFECTIVE_SENTENCE_LENGTH, LEGAL_STATUS_GROUPING, HDC_CHECKS_DONE_DATE, HDC_PASSED_FLAG, HDC_ASSMENT_APP_STATUS_DESC, HDC_DECISION_DATE, CURR_HDCED_DATE, CURR_ARD_DATE, CURR_CRD_DATE, ESTABLISHMENT_DESCRIPTION, MOVEMENT_TIME, REASON_CODE, DAY_DATE, HDC_REVIEW_FLAG, ACTIVE_STATUS, TYPE, DIRECTION_CODE, LOCATION_TYPE_TO, RELEASE_DATE, CURR_RELEASE_DATE, ARD_, CRD_, REASON, CASE WHEN ACTIVE_STATUS <> 'Active In' THEN V_DAYS_IN_ESTAB ELSE 'Active' END AS V_DAYS_IN_ESTAB_FINAL, ACTIVE_STATUS___RELEASES.ACTIVE_STATUS AS V_ACTIVE_STATUS FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP10.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "BOOKING_NUMBER",
            "type": "string",
            "display": "Booking Number",
            "legacyId": "DP10.DO10077",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SENTENCE_START_DATE",
            "type": "date",
            "display": "Sentence Start Date",
            "legacyId": "DP10.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DP10.DO2d0",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DP10.DO107cb",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "HDC_CHECKS_DONE_DATE",
            "type": "date",
            "display": "HDC Checks Done Date",
            "legacyId": "DP10.DO54a",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "HDC_PASSED_FLAG",
            "type": "string",
            "display": "HDC Passed Flag",
            "legacyId": "DP10.DO3ad",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "HDC_ASSMENT_APP_STATUS_DESC",
            "type": "string",
            "display": "HDC Status",
            "legacyId": "DP10.DO54",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "HDC_DECISION_DATE",
            "type": "date",
            "display": "HDC Decision Date",
            "legacyId": "DP10.DO3b0",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CURR_HDCED_DATE",
            "type": "date",
            "display": "HDC Eligibility Date",
            "legacyId": "DP10.DO70",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "CURR_ARD_DATE",
            "type": "date",
            "display": "ARD (Approved Release Date)",
            "legacyId": "DP10.DO47",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "CURR_CRD_DATE",
            "type": "date",
            "display": "CRD (Conditional Release Date)",
            "legacyId": "DP10.DO48",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Movement Location From Description (External)",
            "legacyId": "DP10.DO1015d",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DP10.DO107ce",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "REASON_CODE",
            "type": "string",
            "display": "Movement Reason Code (External)",
            "legacyId": "DP10.DO103fc",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date Only (External)",
            "legacyId": "DP10.DO1015c",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "HDC_REVIEW_FLAG",
            "type": "string",
            "display": "HDC Review Flag",
            "legacyId": "DP10.DO3ae",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "ACTIVE_STATUS",
            "type": "string",
            "display": "Active Status",
            "legacyId": "DP10.DO104d5",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "TYPE",
            "type": "string",
            "display": "Movement Type (External)",
            "legacyId": "DP10.DO103ec",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "DIRECTION_CODE",
            "type": "string",
            "display": "Movement Direction Code (External)",
            "legacyId": "DP10.DO103fd",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "LOCATION_TYPE_TO",
            "type": "string",
            "display": "Location Type To",
            "legacyId": "DP10.DO10768",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "RELEASE_DATE",
            "type": "date",
            "display": "Release Date",
            "legacyId": "DP10.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CURR_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DP10.DO2e6",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "ARD_",
            "type": "date",
            "display": "ARD (Approved Release Date) (Historical)",
            "legacyId": "DP10.DO30d",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "CRD_",
            "type": "date",
            "display": "CRD (Conditional Release Date) (Historical)",
            "legacyId": "DP10.DO30a",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "REASON",
            "type": "string",
            "display": "Movement Description (External)",
            "legacyId": "DP10.DO1015b",
            "legacySqlClass": "column"
          },
          {
            "index": 26,
            "name": "V_DAYS_IN_ESTAB_FINAL",
            "type": "string",
            "display": "V_DAYS_IN_ESTAB_FINAL",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 27,
            "name": "V_ACTIVE_STATUS",
            "type": "string",
            "display": "V_ACTIVE_STATUS",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "214316.RS",
      "name": "HDC Releases",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      }
    },
    {
      "id": "215119.RS",
      "name": "HDC Releases - Active In",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DP10",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE HDC_ONE_HDC_REVIEW_FLAG <> 'YES')"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:V_DAYS_IN_ESTAB_FINAL",
            "display": "Days in Last Establishment",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If [Active Status] <>\"Active In\" Then [v_Days_in_Estab] Else \"Active\""
          },
          {
            "name": "$ref:V_ACTIVE_STATUS",
            "display": "Active Status",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Active Status - Releases].[Active Status]"
          },
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Movement Location From Description (External)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO1015d"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO10076"
          },
          {
            "name": "$ref:BOOKING_NUMBER",
            "display": "Booking Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO10077"
          },
          {
            "name": "$ref:LEGAL_STATUS_GROUPING",
            "display": "Legal Status Grouping",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO107cb"
          },
          {
            "name": "$ref:V_MAX_SENTENCE_START_DATE",
            "display": "Sentence Start Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Max([Sentence Start Date]) In ([NOMS Number])"
          },
          {
            "name": "$ref:EFFECTIVE_SENTENCE_LENGTH",
            "display": "Effective Sentence Length",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO2d0"
          },
          {
            "name": "$ref:HDC_CHECKS_DONE_DATE",
            "display": "HDC Checks Done Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO54a"
          },
          {
            "name": "$ref:HDC_PASSED_FLAG",
            "display": "HDC Passed Flag",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO3ad"
          },
          {
            "name": "$ref:HDC_ASSMENT_APP_STATUS_DESC",
            "display": "HDC Status",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO54"
          },
          {
            "name": "$ref:HDC_DECISION_DATE",
            "display": "HDC Decision Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO3b0"
          },
          {
            "name": "$ref:CURR_HDCED_DATE",
            "display": "HDC Eligibility Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO70"
          },
          {
            "name": "$ref:CURR_ARD_DATE",
            "display": "ARD (Approved Release Date)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO47"
          },
          {
            "name": "$ref:ARD_",
            "display": "ARD (Approved Release Date) (Historical)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO30d"
          },
          {
            "name": "$ref:CURR_CRD_DATE",
            "display": "CRD (Conditional Release Date)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO48"
          },
          {
            "name": "$ref:CRD_",
            "display": "CRD (Conditional Release Date) (Historical)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP10.DO30a"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : V_MAX_SENTENCE_START_DATE :: Error: Invalid expression / Unexpected token. Line 1, Col: 29.\n  MAX(SENTENCE_START_DATE) IN \u001b[4m,\u001b[0mOFFENDER_ID_DISPLAY,",
      "entityId": "FljEfVpmYgQAmqoAAHDL5F4AACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[0] requires property \"dataset\"",
      "entityId": "FljEfVpmYgQAmqoAAHDL5F4AACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Report Variant 214316.RS does not have corresponding dataset undefined",
      "entityId": "214316.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_MAX_SENTENCE_START_DATE does not have corresponding dataset schema field",
      "entityId": "215119.RS",
      "entityType": "variant"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DP10",
      "entityType": "dataset"
    }
  ]
}