{
  "id": "Fg8W.1.vGgoAd94AAHCrHV8aACJIAFJ8",
  "name": "MIS Releases with Case Allocation and Primary Address",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "MOV0076  Releases",
      "Discharges",
      "CPA",
      "NPS",
      "Rehabilitation",
      "Rehab"
    ]
  },
  "description": "Identifies case allocation to NPS or CPA Rehab Providers for all Prisoners released between the dates specified at run time.  Please note the demographic data will be as of now, not necessarily when the Prisoner was released. Includes: NOMS Number, Surname, DOB, Cell, Nationality, Main Offence, Release Date, Effective Sentence Length, Main Legal Status, Security Category, Category Review Date, IEP, CSRA, Rehab Code and Area<br/>MOV0076 - v2.0 Last Modified: 28/02/2023",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3376639/DP4",
      "name": "Main Data",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.FIRST_NAME, CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END AS DATE_OF_BIRTH, COALESCE(AT_OFFENDER_BOOKING.IEP_BAND, '** Incentive Level Missing **') AS IEP_BAND, AT_OFFENDER_BOOKING.NATIONALITY_CODE, AT_OFFENDER_BOOKING.PNC_ID, AT_OFFENDER_BOOKING.CRO_NUMBER, AT_DIM_DATE_EXT_MOV.DAY_DATE FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_DOB, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM WHERE (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (CASE WHEN AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = 'Establishment' THEN AT_FACT_MOV_EXT.FROM_LOCATION_SK END = AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_DIM_DATE_EXT_MOV.DAY_DATE >= (SELECT START_DATE FROM prompt_ /* = #prompt('Enter Movement Start Date:','D',,Mono,Free,Not_Persistent,,User:0) */) AND AT_DIM_DATE_EXT_MOV.DAY_DATE <= (SELECT END_DATE FROM prompt_ /* = #prompt('Enter Movement End Date:','D',,Mono,Free,Not_Persistent,,User:1) */) AND AT_FACT_MOV_EXT.DIRECTION_CODE = 'OUT' AND AT_FACT_MOV_EXT.TYPE = 'Release' AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_CODE_NK = (SELECT UNKNOWN_PARAMETER FROM prompt_ /* = #prompt('Released From:','A','External Movements\\Movement Location From Code with Security',Mono,Free,Not_Persistent,,User:2) */))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, SURNAME, FIRST_NAME, DATE_OF_BIRTH, IEP_BAND, NATIONALITY_CODE, PNC_ID, CRO_NUMBER, DAY_DATE, OFFENCE_NAME AS V_OFFENCE_NAME, EFFECTIVE_SENTENCE_LENGTH AS V_EFFECTIVE_SENTENCE_LENGTH, MAIN_LEGAL_STATUS_CODE AS V_MAIN_LEGAL_STATUS, CASE WHEN IEP_BAND = 'Standard' THEN 'Std' ELSE CASE WHEN IEP_BAND = 'Enhanced' THEN 'Enh' ELSE IEP_BAND END END AS V_IEP, REHAB_PROVIDER_CODE || ' - ' || REHAB_PROVIDER_DESCRIPTION AS V_DECISION_CODE_PLUS_PROVIDE41, CURR_HDCED_DATE AS V_HDC, OFFENDER_ADDRESS_AREA_CITY AS V_CITY, OFFENDER_ADDRESS_POST_CODE AS V_HOME_POSTCODE, OFFENDER_ADDRESS_NO_FIXED_ABODE_FLAG AS V_NFA, CURR_HDCAD_DATE AS V_HDCAD FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Movement Start Date:",
          "description": "@prompt('Enter Movement Start Date:','D',,Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Movement End Date:",
          "description": "@prompt('Enter Movement End Date:','D',,Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "unknown_parameter",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Released From:",
          "description": "@prompt('Released From:','A','External Movements\\Movement Location From Code with Security',Mono,Free,Not_Persistent,,User:2)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP4.DO76",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP4.DO7b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "Offender Given Name 1",
            "legacyId": "DP4.DO80",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "DATE_OF_BIRTH",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DP4.DO85",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "IEP_BAND",
            "type": "string",
            "display": "IEP Band",
            "legacyId": "DP4.DOe4",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "NATIONALITY_CODE",
            "type": "string",
            "display": "Nationality Code",
            "legacyId": "DP4.DOb4",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "PNC_ID",
            "type": "string",
            "display": "PNC ID",
            "legacyId": "DP4.DOdb",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "CRO_NUMBER",
            "type": "string",
            "display": "Criminal Records Office number",
            "legacyId": "DP4.DOda",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date Only (External)",
            "legacyId": "DP4.DO15c",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "V_OFFENCE_NAME",
            "type": "string",
            "display": "V_OFFENCE_NAME",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 10,
            "name": "V_EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "V_EFFECTIVE_SENTENCE_LENGTH",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 11,
            "name": "V_MAIN_LEGAL_STATUS",
            "type": "string",
            "display": "V_MAIN_LEGAL_STATUS",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 12,
            "name": "V_IEP",
            "type": "string",
            "display": "V_IEP",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 13,
            "name": "V_DECISION_CODE_PLUS_PROVIDE41",
            "type": "string",
            "display": "V_DECISION_CODE_PLUS_PROVIDE41",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 14,
            "name": "V_HDC",
            "type": "string",
            "display": "V_HDC",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 15,
            "name": "V_CITY",
            "type": "string",
            "display": "V_CITY",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 16,
            "name": "V_HOME_POSTCODE",
            "type": "string",
            "display": "V_HOME_POSTCODE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 17,
            "name": "V_NFA",
            "type": "string",
            "display": "V_NFA",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 18,
            "name": "V_HDCAD",
            "type": "string",
            "display": "V_HDCAD",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375368/DPd",
      "name": "Sentence Data",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, AT_DIM_OFFENCE.OFFENCE_NAME, AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE, FACT_CURR_KEY_DATES_SENT.CURR_HDCED_DATE, FACT_CURR_KEY_DATES_SENT.CURR_HDCAD_DATE FROM BODIMIS.DIM_OFFENCE AT_DIM_OFFENCE, BODIMIS.FACT_COURT_CHARGE AT_FACT_COURT_CHARGE, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, FACT_CURR_KEY_DATES_SENT, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM, BODIMIS.DIM_COURT_CASE AT_COURT_CASE, BODIMIS.FACT_OFFENDER_SENTENCE AT_FACT_OFFENDER_SENTENCE WHERE (AT_FACT_COURT_CHARGE.OFFENCE_SK = AT_DIM_OFFENCE.OFFENCE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_FACT_OFFENDER_SENTENCE.OFFENDER_BOOKING_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_COURT_CHARGE.COURT_CASE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = FACT_CURR_KEY_DATES_SENT.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (CASE WHEN AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = 'Establishment' THEN AT_FACT_MOV_EXT.FROM_LOCATION_SK END = AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_FACT_MOV_EXT.DIRECTION_CODE = 'OUT' AND AT_DIM_DATE_EXT_MOV.DAY_DATE >= (SELECT START_DATE FROM prompt_ /* = #prompt('Enter Movement Start Date:','D',,Mono,Free,Not_Persistent,,User:0) */) AND AT_DIM_DATE_EXT_MOV.DAY_DATE <= (SELECT END_DATE FROM prompt_ /* = #prompt('Enter Movement End Date:','D',,Mono,Free,Not_Persistent,,User:1) */) AND AT_FACT_MOV_EXT.TYPE = 'Release' AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_CODE_NK = (SELECT UNKNOWN_PARAMETER FROM prompt_ /* = #prompt('Released From:','A','External Movements\\Movement Location From Code with Security',Mono,Free,Not_Persistent,,User:2) */) AND (AT_FACT_COURT_CHARGE.MOST_SERIOUS_FLAG = 'Y' AND AT_COURT_CASE.MOST_SERIOUS_COUNT = 1) AND AT_FACT_OFFENDER_SENTENCE.SENTENCE_CURRENT_FLAG = 'Y')), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, EFFECTIVE_SENTENCE_LENGTH, OFFENCE_NAME, MAIN_LEGAL_STATUS_CODE, CURR_HDCED_DATE, CURR_HDCAD_DATE FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Movement Start Date:",
          "description": "@prompt('Enter Movement Start Date:','D',,Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Movement End Date:",
          "description": "@prompt('Enter Movement End Date:','D',,Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "unknown_parameter",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Released From:",
          "description": "@prompt('Released From:','A','External Movements\\Movement Location From Code with Security',Mono,Free,Not_Persistent,,User:2)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPd.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DPd.DO2d0",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "OFFENCE_NAME",
            "type": "string",
            "display": "Offence Name",
            "legacyId": "DPd.DO4b",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "MAIN_LEGAL_STATUS_CODE",
            "type": "string",
            "display": "Main Legal Status Code",
            "legacyId": "DPd.DO100de",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "CURR_HDCED_DATE",
            "type": "date",
            "display": "HDC Eligibility Date",
            "legacyId": "DPd.DO70",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "CURR_HDCAD_DATE",
            "type": "date",
            "display": "HDC AD (Approved Date)",
            "legacyId": "DPd.DO97",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP10",
      "name": "Addresses",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, DT_OFFENDER_ADDRESSES.POSTAL_CODE, case when ( DT_OFFENDER_ADDRESSES.CITY_DESC ) is null then 'Unknown' else ( DT_OFFENDER_ADDRESSES.CITY_DESC ) end , DT_OFFENDER_ADDRESSES.ADDRESS_USAGE, DT_OFFENDER_ADDRESSES.NO_FIXED_ADDRESS_FLAG FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, ( select ROW_NUMBER() OVER (PARTITION BY ss.OWNER_ID ORDER BY PRIMARY_FLAG desc, ss.address_active_flag desc, ss.USAGE_ACTIVE_FLAG desc, ss.usages_dttm DESC nulls last) row_seq_filter, ss.* from ( select * from ( select AT_DIM_ADDRESSES.OWNER_ID, AT_DIM_ADDRESS_USAGES.ADDRESS_ID_NK, AT_DIM_ADDRESS_USAGES.ADDRESS_USAGE, AT_DIM_ADDRESS_USAGES.ADDR_USAGE_DESCRIPTION, AT_DIM_ADDRESS_USAGES.ACTIVE_FLAG as USAGE_ACTIVE_FLAG, AT_DIM_ADDRESSES.flat, AT_DIM_ADDRESSES.premise, AT_DIM_ADDRESSES.Street, AT_DIM_ADDRESSES.locality, AT_DIM_ADDRESSES.city_code, AT_DIM_ADDRESSES.city_desc, AT_DIM_ADDRESSES.county_code, AT_DIM_ADDRESSES.county_desc, AT_DIM_ADDRESSES.postal_code, AT_DIM_ADDRESSES.COUNTRY_CODE, AT_DIM_ADDRESSES.country_desc, AT_DIM_ADDRESSES.HOME_TEL_NO, AT_DIM_ADDRESSES.HOME_EXT_NO, AT_DIM_ADDRESSES.NO_FIXED_ADDRESS_FLAG, AT_DIM_ADDRESSES.establishment_sk, AT_DIM_ADDRESSES.PRIMARY_FLAG, AT_DIM_ADDRESSES.active_flag as address_active_flag, AT_DIM_ADDRESS_USAGES.CREATE_DATETIME, AT_DIM_ADDRESS_USAGES.MODIFY_DATETIME, COALESCE(AT_DIM_ADDRESS_USAGES.modify_datetime, AT_DIM_ADDRESS_USAGES.create_datetime) as usages_dttm from BODIMIS.DIM_ADDRESS_USAGES AT_DIM_ADDRESS_USAGES inner join BODIMIS.dim_addresses AT_DIM_ADDRESSES on AT_DIM_ADDRESS_USAGES.address_id_nk = AT_DIM_ADDRESSES.address_id_nk and AT_DIM_ADDRESSES.owner_class='OFF'  ) Addr_usages --where Addr_usages.usages_dttm is not null ) ss ) DT_OFFENDER_ADDRESSES, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM, BODISTAGING.REF_OFFENDERS AT_BODISTAG_REF_OFFENDERS WHERE ( AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK(+)=AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK ) AND ( AT_DIM_DATE_EXT_MOV.DATE_SK=AT_FACT_MOV_EXT.DATE_SK ) AND ( case when AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = 'Establishment' then AT_FACT_MOV_EXT.FROM_LOCATION_SK end = AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK(+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID=CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /*= #Variable('BOUSER') */ )) AND CSL.ENDYEAR >= to_char(sysdate,'YYYY')-6 ) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_ID=AT_BODISTAG_REF_OFFENDERS.OFFENDER_ID(+) ) AND ( AT_BODISTAG_REF_OFFENDERS.ROOT_OFFENDER_ID=DT_OFFENDER_ADDRESSES.OWNER_ID(+) ) AND ( AT_DIM_DATE_EXT_MOV.DAY_DATE >= (SELECT START_DATE FROM prompt_ /*= #prompt('Enter Movement Start Date:','D',,Mono,Free,Not_Persistent,,User:0) */ ) AND AT_DIM_DATE_EXT_MOV.DAY_DATE <= (SELECT END_DATE FROM prompt_ /*= #prompt('Enter Movement End Date:','D',,Mono,Free,Not_Persistent,,User:1) */ ) AND AT_FACT_MOV_EXT.DIRECTION_CODE = 'OUT' AND AT_FACT_MOV_EXT.TYPE = 'Release' AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_CODE_NK = (SELECT UNKNOWN_PARAMETER FROM prompt_ /*= #prompt('Released From:','A','External Movements\\Movement Location From Code with Security',Mono,Free,Not_Persistent,,User:2) */ ) AND ( DT_OFFENDER_ADDRESSES.ADDRESS_ACTIVE_FLAG='Y' ) AND ( DT_OFFENDER_ADDRESSES.USAGE_ACTIVE_FLAG='Y' ) AND DT_OFFENDER_ADDRESSES.PRIMARY_FLAG = 'Y' )), dataset_ AS (SELECT FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Movement Start Date:",
          "description": "@prompt('Enter Movement Start Date:','D',,Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Movement End Date:",
          "description": "@prompt('Enter Movement End Date:','D',,Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "unknown_parameter",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Released From:",
          "description": "@prompt('Released From:','A','External Movements\\Movement Location From Code with Security',Mono,Free,Not_Persistent,,User:2)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": []
      }
    },
    {
      "id": "3376639/DP13",
      "name": "Rehab",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, CASE WHEN BODIMIS.DIM_REHAB_PROVIDER.REHAB_PROVIDER_SK > 0 THEN BODIMIS.DIM_REHAB_PROVIDER.CODE_NK END AS REHAB_PROVIDER_CODE, CASE WHEN BODIMIS.DIM_REHAB_PROVIDER.REHAB_PROVIDER_SK > 0 THEN BODIMIS.DIM_REHAB_PROVIDER.DESCRIPTION END AS REHAB_PROVIDER_DESCRIPTION FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_REHAB_PROVIDER, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_EXT_MOV_FROM, BODIMIS.FACT_OFFENDER_REHAB WHERE (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (CASE WHEN AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = 'Establishment' THEN AT_FACT_MOV_EXT.FROM_LOCATION_SK END = AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */)) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = BODIMIS.FACT_OFFENDER_REHAB.OFFENDER_BOOKING_SK (+)) AND (BODIMIS.FACT_OFFENDER_REHAB.REHAB_PROVIDER_SK = BODIMIS.DIM_REHAB_PROVIDER.REHAB_PROVIDER_SK (+)) AND (AT_DIM_DATE_EXT_MOV.DAY_DATE >= (SELECT START_DATE FROM prompt_ /* = #prompt('Enter Movement Start Date:','D',,Mono,Free,Not_Persistent,,User:0) */) AND AT_DIM_DATE_EXT_MOV.DAY_DATE <= (SELECT END_DATE FROM prompt_ /* = #prompt('Enter Movement End Date:','D',,Mono,Free,Not_Persistent,,User:1) */) AND AT_FACT_MOV_EXT.DIRECTION_CODE = 'OUT' AND AT_FACT_MOV_EXT.TYPE = 'Release' AND AT_ESTABLISHMENT_EXT_MOV_FROM.ESTABLISHMENT_CODE_NK = (SELECT UNKNOWN_PARAMETER FROM prompt_ /* = #prompt('Released From:','A','External Movements\\Movement Location From Code with Security',Mono,Free,Not_Persistent,,User:2) */) AND (BODIMIS.FACT_OFFENDER_REHAB.PROVIDER_ACTIVE_FLAG = 'Y' OR BODIMIS.FACT_OFFENDER_REHAB.PROVIDER_ACTIVE_FLAG IS NULL) AND (BODIMIS.FACT_OFFENDER_REHAB.DECISION_ACTIVE_FLAG = 'Y' OR BODIMIS.FACT_OFFENDER_REHAB.DECISION_ACTIVE_FLAG IS NULL))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, REHAB_PROVIDER_CODE, REHAB_PROVIDER_DESCRIPTION FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Movement Start Date:",
          "description": "@prompt('Enter Movement Start Date:','D',,Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Movement End Date:",
          "description": "@prompt('Enter Movement End Date:','D',,Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "unknown_parameter",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Released From:",
          "description": "@prompt('Released From:','A','External Movements\\Movement Location From Code with Security',Mono,Free,Not_Persistent,,User:2)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP13.DO76",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "REHAB_PROVIDER_CODE",
            "type": "string",
            "display": "Rehab Provider Code",
            "legacyId": "DP13.DOb37",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "REHAB_PROVIDER_DESCRIPTION",
            "type": "string",
            "display": "Rehab Provider Description",
            "legacyId": "DP13.DOb38",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP8",
      "name": "Latest Date Available",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT BODIMIS.ETL_LOAD_LOG.BUSINESS_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT BUSINESS_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BUSINESS_DATE",
            "type": "date",
            "display": "Latest Business Date Available",
            "legacyId": "DP8.DO4dd",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "131836.RS",
      "name": "Sent Data",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376639/DP4",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO7b"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Offender Given Name 1",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO80"
          },
          {
            "name": "$ref:DATE_OF_BIRTH",
            "display": "Date of Birth",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO85"
          },
          {
            "name": "$ref:NATIONALITY_CODE",
            "display": "Nationality Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DOb4"
          },
          {
            "name": "$ref:V_OFFENCE_NAME",
            "display": "Main Offence",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Offence Name]"
          },
          {
            "name": "$ref:DAY_DATE",
            "display": "Movement Date Only (External)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO15c"
          },
          {
            "name": "$ref:V_EFFECTIVE_SENTENCE_LENGTH",
            "display": "Eff. Sent. Lnth.",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Effective Sentence Length]"
          },
          {
            "name": "$ref:V_MAIN_LEGAL_STATUS",
            "display": "Main Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Main Legal Status Code]"
          },
          {
            "name": "$ref:V_IEP",
            "display": "IEP",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([IEP Band] = \"Standard\"; \"Std\"; If([IEP Band] = \"Enhanced\"; \"Enh\";[IEP Band]))"
          },
          {
            "name": "$ref:V_DECISION_CODE_PLUS_PROVIDE41",
            "display": "Rehab Code and Area",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Rehab Provider Code]+\" - \"+[Rehab Provider Description]"
          }
        ]
      }
    },
    {
      "id": "200470.RS",
      "name": "Release Information",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376639/DP4",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO7b"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Offender Given Name 1",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO80"
          },
          {
            "name": "$ref:CRO_NUMBER",
            "display": "Criminal Records Office number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DOda"
          },
          {
            "name": "$ref:PNC_ID",
            "display": "PNC ID",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DOdb"
          },
          {
            "name": "$ref:V_HDC",
            "display": "HDCED",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[HDC Eligibility Date]"
          },
          {
            "name": "$ref:DAY_DATE",
            "display": "Movement Date Only (External)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO15c"
          },
          {
            "name": "$ref:V_DECISION_CODE_PLUS_PROVIDE41",
            "display": "Rehab Code and Area",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Rehab Provider Code]+\" - \"+[Rehab Provider Description]"
          },
          {
            "name": "$ref:V_CITY",
            "display": "Primary Address City",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Offender Address Area (City)]"
          },
          {
            "name": "$ref:V_HOME_POSTCODE",
            "display": "Primary Address Postcode",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Offender Address Post Code]"
          },
          {
            "name": "$ref:V_NFA",
            "display": "NFA?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Offender Address No Fixed Abode Flag]"
          },
          {
            "name": "$ref:V_HDCAD",
            "display": "HDCAD",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[HDC AD (Approved Date)]"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_OFFENCE_NAME :: ReferenceError: error is not defined",
      "entityId": "Fg8W.1.vGgoAd94AAHCrHV8aACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_EFFECTIVE_SENTENCE_LENGTH :: ReferenceError: error is not defined",
      "entityId": "Fg8W.1.vGgoAd94AAHCrHV8aACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_MAIN_LEGAL_STATUS :: ReferenceError: error is not defined",
      "entityId": "Fg8W.1.vGgoAd94AAHCrHV8aACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_DECISION_CODE_PLUS_PROVIDE41 :: ReferenceError: error is not defined",
      "entityId": "Fg8W.1.vGgoAd94AAHCrHV8aACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_HDC :: ReferenceError: error is not defined",
      "entityId": "Fg8W.1.vGgoAd94AAHCrHV8aACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_HOME_POSTCODE :: ReferenceError: error is not defined",
      "entityId": "Fg8W.1.vGgoAd94AAHCrHV8aACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_OFFENCE_NAME :: ReferenceError: error is not defined",
      "entityId": "Fg8W.1.vGgoAd94AAHCrHV8aACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_EFFECTIVE_SENTENCE_LENGTH :: ReferenceError: error is not defined",
      "entityId": "Fg8W.1.vGgoAd94AAHCrHV8aACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_MAIN_LEGAL_STATUS :: ReferenceError: error is not defined",
      "entityId": "Fg8W.1.vGgoAd94AAHCrHV8aACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_DECISION_CODE_PLUS_PROVIDE41 :: ReferenceError: error is not defined",
      "entityId": "Fg8W.1.vGgoAd94AAHCrHV8aACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_HOME_POSTCODE :: ReferenceError: error is not defined",
      "entityId": "Fg8W.1.vGgoAd94AAHCrHV8aACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::fixSqlFormatting sql is not valid [Expecting ). Line 1, Col: 1695.\n  ESS_USAGES.address_id_nk = AT_DIM_ADDRESSES.address_id_nk and AT_DIM_ADDRESSES.owner_class='OFF'  ) \u001b[4mAddr_usages\u001b[0m --where Addr_usages.usages_dttm is not null ) ss ) DT_OFFENDER_ADDRESSES, BODIMIS.DIM_DATE AT_DIM_D]",
      "entityId": "Fg8W.1.vGgoAd94AAHCrHV8aACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Dataset does not have any schema fields (comments -- in query)",
      "entityId": "3376639/DP10",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3376639/DP4",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DPd",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "unable to generate test sql",
      "entityId": "3376639/DP10",
      "entityType": "dataset"
    }
  ]
}