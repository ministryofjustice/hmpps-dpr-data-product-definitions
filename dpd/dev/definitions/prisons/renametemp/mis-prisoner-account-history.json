{
  "id": "Fu2pF1zopAEAvsoBAHAL9V4IACJIAFJ8",
  "name": "MIS Prisoner Account History",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "FIN0056 - v00.00.02 LSRIT032"
    ]
  },
  "description": "FIN0056 - v00.00.02                  This report provides the account history of a prisoner for a date range of his/her latest booking. To obtain the full transaction history, use the prisoner's Booking From Date for the Transaction Start Date. The report includes all transactions which took place wherever the prisoner resided. Report now including a breakdown to Offender Payroll",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3376115/DP2",
      "name": "Prisoner Trans Statement",
      "description": "MIS Finance",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_ENTRY_AMOUNT, AT_FACT_OFFENDER_TRANSACTION.TXN_ID, AT_FACT_OFFENDER_TRANSACTION.TXN_ENTRY_SEQ, AT_FACT_OFFENDER_TRANSACTION.TXN_ENTRY_TIME, SUM(CASE WHEN (AT_DIM_TXN_POSTING_TYPE.TRANSACTION_POSTING_TYPE_CODE) = 'CR' THEN (AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_ENTRY_AMOUNT) ELSE 0 END) AS CREDIT_AMOUNT, SUM(CASE WHEN (AT_DIM_TXN_POSTING_TYPE.TRANSACTION_POSTING_TYPE_CODE) = 'DR' THEN (AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_ENTRY_AMOUNT) ELSE 0 END) AS DEBIT_AMOUNT, AT_DIM_ACCOUNT_CODE_TXN.ACCOUNT_CODE, AT_DIM_ACCOUNT_CODE_TXN.ACCOUNT_NAME, AT_DIM_TRANSACTION_TYPE.DESCRIPTION, AT_CASELOADS.ESTABLISHMENT_DESCRIPTION, AT_CASELOADS.ESTABLISHMENT_CODE_NK FROM BODIMIS.FACT_OFFENDER_TRANSACTION AT_FACT_OFFENDER_TRANSACTION, BODIMIS.DIM_ESTABLISHMENT AT_CASELOADS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_TXN_POSTING_TYPE AT_DIM_TXN_POSTING_TYPE, BODIMIS.DIM_ACCOUNT_CODE AT_DIM_ACCOUNT_CODE_TXN, BODIMIS.DIM_TRANSACTION_TYPE AT_DIM_TRANSACTION_TYPE, BODIMIS.DIM_DATE AT_DIM_DATE_TRANSACTIONS, BODIMIS.DIM_DATE AT_BUSINESS_DATE WHERE (AT_DIM_TRANSACTION_TYPE.TRANSACTION_TYPE_SK = AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_TYPE_SK) AND (AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_POSTING_TYPE_SK = AT_DIM_TXN_POSTING_TYPE.TRANSACTION_POSTING_TYPE_SK) AND (AT_DIM_DATE_TRANSACTIONS.DATE_SK = AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_ENTRY_DATE_SK) AND (AT_FACT_OFFENDER_TRANSACTION.ACCOUNT_CODE_SK = AT_DIM_ACCOUNT_CODE_TXN.ACCOUNT_CODE_SK) AND (AT_OFFENDER_BOOKING.ALIAS_OFFENDER_SK = AT_FACT_OFFENDER_TRANSACTION.ALIAS_OFFENDER_SK AND AT_OFFENDER_BOOKING.BOOKING_SEQ = 1) AND (AT_CASELOADS.ESTABLISHMENT_SK = AT_FACT_OFFENDER_TRANSACTION.ESTABLISHMENT_SK) AND (AT_BUSINESS_DATE.DATE_SK = AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_BUSINESS_DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = 'A5369DT' AND (AT_DIM_DATE_TRANSACTIONS.DAY_DATE BETWEEN TO_DATE('10-12-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND TO_DATE('16-12-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_BUSINESS_DATE.DAY_DATE BETWEEN TO_DATE(TO_DATE('10-12-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS'), 'DD-MM-YYYY HH24:MI:SS') - 1 AND TO_DATE('16-12-2018 00:00:00', 'DD-MM-YYYY HH24:MI:SS'))) GROUP BY AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_ENTRY_AMOUNT, AT_FACT_OFFENDER_TRANSACTION.TXN_ID, AT_FACT_OFFENDER_TRANSACTION.TXN_ENTRY_SEQ, AT_FACT_OFFENDER_TRANSACTION.TXN_ENTRY_TIME, AT_DIM_ACCOUNT_CODE_TXN.ACCOUNT_CODE, AT_DIM_ACCOUNT_CODE_TXN.ACCOUNT_NAME, AT_DIM_TRANSACTION_TYPE.DESCRIPTION, AT_CASELOADS.ESTABLISHMENT_DESCRIPTION, AT_CASELOADS.ESTABLISHMENT_CODE_NK), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, TRANSACTION_ENTRY_AMOUNT, TXN_ID, TXN_ENTRY_SEQ, TXN_ENTRY_TIME, CREDIT_AMOUNT, DEBIT_AMOUNT, ACCOUNT_CODE, ACCOUNT_NAME, DESCRIPTION, ESTABLISHMENT_DESCRIPTION, ESTABLISHMENT_CODE_NK, 'TBD' AS V_BOOKING_TO FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP2.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "TRANSACTION_ENTRY_AMOUNT",
            "type": "double",
            "display": "Transaction Entry Amount",
            "legacyId": "DP2.DO28",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "TXN_ID",
            "type": "double",
            "display": "Txn Id",
            "legacyId": "DP2.DO5af",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "TXN_ENTRY_SEQ",
            "type": "double",
            "display": "Txn Entry Seq",
            "legacyId": "DP2.DO55a",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "TXN_ENTRY_TIME",
            "type": "date",
            "display": "Txn Entry Time",
            "legacyId": "DP2.DO5c4",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "CREDIT_AMOUNT",
            "type": "double",
            "display": "Credit Amount",
            "legacyId": "DP2.DO11c",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "DEBIT_AMOUNT",
            "type": "double",
            "display": "Debit Amount",
            "legacyId": "DP2.DO11d",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "ACCOUNT_CODE",
            "type": "double",
            "display": "Transaction Account Code",
            "legacyId": "DP2.DO3c",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "ACCOUNT_NAME",
            "type": "string",
            "display": "Transaction Account Name",
            "legacyId": "DP2.DO66",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Transaction Type Description",
            "legacyId": "DP2.DO7",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Transaction Caseload Description",
            "legacyId": "DP2.DO59e",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "ESTABLISHMENT_CODE_NK",
            "type": "string",
            "display": "Transaction Caseload ID",
            "legacyId": "DP2.DO117",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "V_BOOKING_TO",
            "type": "string",
            "display": "V_BOOKING_TO",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3376115/DP3",
      "name": "Current Balance",
      "description": "MIS Finance",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK, AT_DIM_ACCOUNT_CODE_currrent.ACCOUNT_NAME, SUM(AT_FACT_OFF_ACC_CURR_BALANCE.GROSS_BALANCE) AS SUM_OF_CURRENT_ACCOUNT_BALANCE FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_ACCOUNT_CODE AT_DIM_ACCOUNT_CODE_currrent, BODIMIS.FACT_OFF_ACC_CURR_BALANCE AT_FACT_OFF_ACC_CURR_BALANCE WHERE (AT_OFFENDER_BOOKING.ALIAS_OFFENDER_SK = AT_FACT_OFF_ACC_CURR_BALANCE.ALIAS_OFFENDER_SK AND AT_OFFENDER_BOOKING.BOOKING_SEQ = 1) AND (AT_DIM_ACCOUNT_CODE_currrent.ACCOUNT_CODE_SK = AT_FACT_OFF_ACC_CURR_BALANCE.ACCOUNT_CODE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = 'A5369DT' GROUP BY AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK, AT_DIM_ACCOUNT_CODE_currrent.ACCOUNT_NAME), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, OFFENDER_BOOKING_SK, ACCOUNT_NAME, SUM_OF_CURRENT_ACCOUNT_BALANCE, 'TBD' AS V_BOOKING_TO FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP3.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "OFFENDER_BOOKING_SK",
            "type": "double",
            "display": "Offender Booking SK",
            "legacyId": "DP3.DO10710",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "ACCOUNT_NAME",
            "type": "string",
            "display": "Current Account Name",
            "legacyId": "DP3.DO56",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "SUM_OF_CURRENT_ACCOUNT_BALANCE",
            "type": "double",
            "display": "Sum of Current Account Balance",
            "legacyId": "DP3.DO60e",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "V_BOOKING_TO",
            "type": "string",
            "display": "V_BOOKING_TO",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3376115/DP1",
      "name": "MIS Load End Date",
      "description": "MIS Finance",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT BODIMIS.ETL_LOAD_LOG.BUSINESS_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT BUSINESS_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BUSINESS_DATE",
            "type": "date",
            "display": "Latest Business Date Available",
            "legacyId": "DP1.DO104dd",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376115/DP4",
      "name": "Booking",
      "description": "MIS Finance",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, LTRIM(AT_OFFENDER_BOOKING.TITLE || ' ' || AT_OFFENDER_BOOKING.FIRST_NAME || ' ' || AT_OFFENDER_BOOKING.SURNAME) AS OFFENDER_FULL_NAME, AT_BOOKING_START.DAY_DATE, AT_BOOKING_END_DATE.DAY_DATE AS OFFENDER_BOOKING_VALID_TO FROM BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_BOOKING_START, BODIMIS.DIM_DATE AT_BOOKING_END_DATE WHERE (AT_BOOKING_START.DATE_SK = AT_OFFENDER_BOOKING.BOOKING_BEGIN_DATE_SK) AND (AT_OFFENDER_BOOKING.BOOKING_END_DATE_SK = AT_BOOKING_END_DATE.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = 'A5369DT' AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_OFFENDER_BOOKING.BOOKING_SEQ = 1))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, OFFENDER_FULL_NAME, DAY_DATE, OFFENDER_BOOKING_VALID_TO, 'TBD' AS V_BOOKING_TO FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP4.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "OFFENDER_FULL_NAME",
            "type": "string",
            "display": "Offender Full Name",
            "legacyId": "DP4.DO1007a",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Offender Booking - Valid From",
            "legacyId": "DP4.DO104bf",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "OFFENDER_BOOKING_VALID_TO",
            "type": "date",
            "display": "Offender Booking - Valid To",
            "legacyId": "DP4.DO104c1",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "V_BOOKING_TO",
            "type": "string",
            "display": "V_BOOKING_TO",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3376115/DP5",
      "name": "Detailed Transactions",
      "description": "MIS Finance",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_ENTRY_AMOUNT, AT_FACT_OFFENDER_TRANSACTION.TXN_ID, AT_FACT_OFFENDER_TRANSACTION.TXN_ENTRY_SEQ, AT_FACT_OFFENDER_TRANSACTION.TXN_ENTRY_TIME, sum(decode(( AT_DIM_TXN_POSTING_TYPE.TRANSACTION_POSTING_TYPE_CODE ),'CR',( AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_ENTRY_AMOUNT ),0)), sum(decode(( AT_DIM_TXN_POSTING_TYPE.TRANSACTION_POSTING_TYPE_CODE ),'DR',( AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_ENTRY_AMOUNT ),0)), AT_DIM_ACCOUNT_CODE_TXN.ACCOUNT_CODE, AT_DIM_ACCOUNT_CODE_TXN.ACCOUNT_NAME, AT_DIM_TRANSACTION_TYPE.DESCRIPTION, AT_CASELOADS.ESTABLISHMENT_DESCRIPTION, AT_CASELOADS.ESTABLISHMENT_CODE_NK, AT_FACT_OFFENDER_TRANS_DETAIL.PAY_AMOUNT, AT_FACT_OFFENDER_TRANS_DETAIL.SLOT_CATEGORY_CODE, AT_TRANS_DETAILS_ACTIVITY_DATE.DAY_DATE, CASE WHEN AT_FACT_OFFENDER_TRANS_DETAIL.PAY_TYPE_CODE = 'SESSION' THEN AT_DIM_PROGRAMME_TYPE_FOTD.DESCRIPTION ELSE AT_PAY_TYPE_CODES.DESCRIPTION END, AT_FACT_OFFENDER_TRANS_DETAIL.CREATE_USER_ID, nvl(AT_FACT_OFFENDER_TRANS_DETAIL.MODIFY_USER_ID,nvl(AT_FACT_OFFENDER_TRANS_DETAIL.CREATE_USER_ID,'Not Recorded')) FROM BODIMIS.FACT_OFFENDER_TRANSACTION AT_FACT_OFFENDER_TRANSACTION, BODIMIS.DIM_DATE AT_TRANS_DETAILS_ACTIVITY_DATE, BODIMIS.DIM_REFERENCE_CODES AT_PAY_TYPE_CODES, BODIMIS.DIM_PROGRAMME_TYPE AT_DIM_PROGRAMME_TYPE_FOTD, BODIMIS.DIM_ESTABLISHMENT AT_CASELOADS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_TXN_POSTING_TYPE AT_DIM_TXN_POSTING_TYPE, BODIMIS.DIM_ACCOUNT_CODE AT_DIM_ACCOUNT_CODE_TXN, BODIMIS.DIM_TRANSACTION_TYPE AT_DIM_TRANSACTION_TYPE, BODIMIS.FACT_OFFENDER_TRANS_DETAIL AT_FACT_OFFENDER_TRANS_DETAIL, BODIMIS.DIM_DATE AT_DIM_DATE_TRANSACTIONS, BODIMIS.DIM_DATE AT_BUSINESS_DATE WHERE ( AT_DIM_TRANSACTION_TYPE.TRANSACTION_TYPE_SK=AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_TYPE_SK ) AND ( AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_POSTING_TYPE_SK=AT_DIM_TXN_POSTING_TYPE.TRANSACTION_POSTING_TYPE_SK ) AND ( AT_DIM_DATE_TRANSACTIONS.DATE_SK=AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_ENTRY_DATE_SK ) AND ( AT_FACT_OFFENDER_TRANSACTION.ACCOUNT_CODE_SK=AT_DIM_ACCOUNT_CODE_TXN.ACCOUNT_CODE_SK ) AND ( AT_OFFENDER_BOOKING.ALIAS_OFFENDER_SK=AT_FACT_OFFENDER_TRANSACTION.ALIAS_OFFENDER_SK and AT_OFFENDER_BOOKING.BOOKING_SEQ=1 ) AND ( AT_CASELOADS.ESTABLISHMENT_SK=AT_FACT_OFFENDER_TRANSACTION.ESTABLISHMENT_SK ) AND ( AT_BUSINESS_DATE.DATE_SK=AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_BUSINESS_DATE_SK ) AND ( AT_FACT_OFFENDER_TRANSACTION.TXN_ID=AT_FACT_OFFENDER_TRANS_DETAIL.TXN_ID(+) and AT_FACT_OFFENDER_TRANSACTION.TXN_ENTRY_SEQ=AT_FACT_OFFENDER_TRANS_DETAIL.TXN_ENTRY_SEQ(+) ) AND ( AT_FACT_OFFENDER_TRANS_DETAIL.PAY_TYPE_CODE=AT_PAY_TYPE_CODES.CODE(+) ) AND ( AT_FACT_OFFENDER_TRANS_DETAIL.ACTIVITY_DATE_SK=AT_TRANS_DETAILS_ACTIVITY_DATE.DATE_SK(+) ) AND ( AT_PAY_TYPE_CODES.CODE_DOMAIN(+) = 'PAY_TYPE' ) AND ( AT_FACT_OFFENDER_TRANS_DETAIL.PROGRAMME_TYPE_SK=AT_DIM_PROGRAMME_TYPE_FOTD.PROGRAMME_TYPE_SK(+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID=CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username from context_) AND CSL.ENDYEAR >= to_char(sysdate,'YYYY')-6 ) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = 'A5369DT' AND ( AT_DIM_DATE_TRANSACTIONS.DAY_DATE between '10-12-2018 00:00:00' and '16-12-2018 00:00:00' and AT_BUSINESS_DATE.DAY_DATE between to_date('10-12-2018 00:00:00')-1 and '16-12-2018 00:00:00' ) ) GROUP BY AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_FACT_OFFENDER_TRANSACTION.TRANSACTION_ENTRY_AMOUNT, AT_FACT_OFFENDER_TRANSACTION.TXN_ID, AT_FACT_OFFENDER_TRANSACTION.TXN_ENTRY_SEQ, AT_FACT_OFFENDER_TRANSACTION.TXN_ENTRY_TIME, AT_DIM_ACCOUNT_CODE_TXN.ACCOUNT_CODE, AT_DIM_ACCOUNT_CODE_TXN.ACCOUNT_NAME, AT_DIM_TRANSACTION_TYPE.DESCRIPTION, AT_CASELOADS.ESTABLISHMENT_DESCRIPTION, AT_CASELOADS.ESTABLISHMENT_CODE_NK, AT_FACT_OFFENDER_TRANS_DETAIL.PAY_AMOUNT, AT_FACT_OFFENDER_TRANS_DETAIL.SLOT_CATEGORY_CODE, AT_TRANS_DETAILS_ACTIVITY_DATE.DAY_DATE, CASE WHEN AT_FACT_OFFENDER_TRANS_DETAIL.PAY_TYPE_CODE = 'SESSION' THEN AT_DIM_PROGRAMME_TYPE_FOTD.DESCRIPTION ELSE AT_PAY_TYPE_CODES.DESCRIPTION END, AT_FACT_OFFENDER_TRANS_DETAIL.CREATE_USER_ID, nvl(AT_FACT_OFFENDER_TRANS_DETAIL.MODIFY_USER_ID,nvl(AT_FACT_OFFENDER_TRANS_DETAIL.CREATE_USER_ID,'Not Recorded'))), dataset_ AS (SELECT FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": []
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "201446.RS",
      "name": "Prisoner Account History",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376115/DP2",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-tab",
        "field": [
          {
            "name": "$ref:OFFENDER_FULL_NAME",
            "display": "Offender Full Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO1007a"
          },
          {
            "name": "$ref:DAY_DATE",
            "display": "Offender Booking - Valid From",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO104bf"
          },
          {
            "name": "$ref:V_BOOKING_TO",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([Offender Booking - Valid To]>=ToDate('31/12/9000'; \"dd/MM/yyyy\");\"\";[Offender Booking - Valid To])"
          }
        ]
      }
    },
    {
      "id": "201713.RS",
      "name": "Prisoner Payroll History",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376115/DP2",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (PRISONER_TRANS_STATEMENT_TRA49 = 'Spends' AND PRISONER_TRANS_STATEMENT_TRA53 IN ('Offender Payroll','Earnings','Earnings - Spends')))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-tab",
        "field": [
          {
            "name": "$ref:OFFENDER_FULL_NAME",
            "display": "Offender Full Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO1007a"
          },
          {
            "name": "$ref:DAY_DATE",
            "display": "Offender Booking - Valid From",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP4.DO104bf"
          },
          {
            "name": "$ref:V_BOOKING_TO",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([Offender Booking - Valid To]>=ToDate('31/12/9000'; \"dd/MM/yyyy\");\"\";[Offender Booking - Valid To])"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_BOOKING_TO :: Error: =If([Offender Booking - Valid To]>=ToDate('31/12/9000'; \"dd/MM/yyyy\");\"\";[Offender Booking - Valid To]) ==> Error: Expected expression but \"=\" found.\n at undefined:1:1",
      "entityId": "Fu2pF1zopAEAvsoBAHAL9V4IACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_BOOKING_TO :: Error: =If([Offender Booking - Valid To]>=ToDate('31/12/9000'; \"dd/MM/yyyy\");\"\";[Offender Booking - Valid To]) ==> Error: Expected expression but \"=\" found.\n at undefined:1:1",
      "entityId": "Fu2pF1zopAEAvsoBAHAL9V4IACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_BOOKING_TO :: Error: =If([Offender Booking - Valid To]>=ToDate('31/12/9000'; \"dd/MM/yyyy\");\"\";[Offender Booking - Valid To]) ==> Error: Expected expression but \"=\" found.\n at undefined:1:1",
      "entityId": "Fu2pF1zopAEAvsoBAHAL9V4IACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_BOOKING_TO :: Error: =If([Offender Booking - Valid To]>=ToDate('31/12/9000'; \"dd/MM/yyyy\");\"\";[Offender Booking - Valid To]) ==> Error: Expected expression but \"=\" found.\n at undefined:1:1",
      "entityId": "Fu2pF1zopAEAvsoBAHAL9V4IACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_BOOKING_TO :: Error: =If([Offender Booking - Valid To]>=ToDate('31/12/9000'; \"dd/MM/yyyy\");\"\";[Offender Booking - Valid To]) ==> Error: Expected expression but \"=\" found.\n at undefined:1:1",
      "entityId": "Fu2pF1zopAEAvsoBAHAL9V4IACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_BOOKING_TO :: Error: =If([Offender Booking - Valid To]>=ToDate('31/12/9000'; \"dd/MM/yyyy\");\"\";[Offender Booking - Valid To]) ==> Error: Expected expression but \"=\" found.\n at undefined:1:1",
      "entityId": "Fu2pF1zopAEAvsoBAHAL9V4IACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::fixSqlFormatting sql is not valid [Required keyword: 'format' missing for <class 'sqlglot.expressions.StrToDate'>. Line 1, Col: 3503.\n  00:00' and '16-12-2018 00:00:00' and AT_BUSINESS_DATE.DAY_DATE between to_date('10-12-2018 00:00:00'\u001b[4m)\u001b[0m-1 and '16-12-2018 00:00:00' ) ) GROUP BY AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_FACT_OFFENDER_]",
      "entityId": "Fu2pF1zopAEAvsoBAHAL9V4IACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_BOOKING_TO :: Error: =If([Offender Booking - Valid To]>=ToDate('31/12/9000'; \"dd/MM/yyyy\");\"\";[Offender Booking - Valid To]) ==> Error: Expected expression but \"=\" found.\n at undefined:1:1",
      "entityId": "Fu2pF1zopAEAvsoBAHAL9V4IACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Dataset does not have any schema fields",
      "entityId": "3376115/DP5",
      "entityType": "dataset"
    },
    {
      "type": "schema",
      "error": "Report field OFFENDER_FULL_NAME does not have corresponding dataset schema field",
      "entityId": "201446.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DAY_DATE does not have corresponding dataset schema field",
      "entityId": "201446.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field OFFENDER_FULL_NAME does not have corresponding dataset schema field",
      "entityId": "201713.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DAY_DATE does not have corresponding dataset schema field",
      "entityId": "201713.RS",
      "entityType": "variant"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3376115/DP3",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "unable to generate test sql",
      "entityId": "3376115/DP5",
      "entityType": "dataset"
    }
  ]
}