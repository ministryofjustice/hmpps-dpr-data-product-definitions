{
  "id": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
  "name": "MIS Foreign National Report amendment NSR1495 v3",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "PDD0017 v00.01.08",
      "Foreign Nationals",
      "Adjudications"
    ]
  },
  "description": "Foreign national prisoners showing NOMS Number, Name, Date of Birth, Nationality, Location, Legal Status, Sentence Start Date, Sentence length, ERSED, TERSED, Release date, Admission date length of stay and No. of Proven Adjudications Can be run for one, multiple or 'All' Establishments. <br/>PDD0017 v00.01.08 Last Modified: 09/07/2020",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3375368/DP2",
      "name": "Foreign National",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.FIRST_NAME, CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END AS DATE_OF_BIRTH, AT_OFFENDER_BOOKING.NATIONALITY_DESCRIPTION, AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH END AS CURRENT_EFFECTIVE_SENTENCE_L33, FACT_CURR_KEY_DATES_SENT.CURR_RELEASE_DATE, AT_DIM_LOCATION.UNIT_4_SHORT_DESCRIPTION, AT_ESTABLISHMENT_TAP.ESTABLISHMENT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, FACT_CURR_KEY_DATES_SENT.CURR_ERSED_DATE, FACT_CURR_KEY_DATES_SENT.CURR_TERSED_DATE, FACT_CURR_KEY_DATES_SENT.CURR_CRD_DATE, FACT_CURR_KEY_DATES_SENT.SSD, CASE WHEN AT_SENT_START_DATE.DAY_DATE < '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END AS SENTENCE_START_DATE, AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_DESCRIPTION, CASE WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA', 'FTRSCH18_ORA', 'FTRSCH18', 'LR_EDS18', 'LR_EDS21', 'LR_SOPC18', 'LR_SOPC21', 'LRSEC250_ORA', 'LR_ALP_CDE18', 'LR_ALP_CDE21', 'LR_EDSU18') THEN 'Recall' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '0' THEN 'Dead' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '1' THEN 'Indeterminate Sentence' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('2', '3') THEN 'Sentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('9', '10') OR AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'CIV_RMD' THEN 'Civil Prisoner' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('8', '11') THEN 'Immigration Detainee' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('12', '13', '14') THEN 'Remand' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, AT_OFFENDER_BOOKING.BOOKING_NUMBER, AT_OFFENDER_ALIAS.SURNAME AS ALIAS_SURNAME, AT_OFFENDER_ALIAS.FIRST_NAME AS ALIAS_GIVEN_NAME_1, AT_OFFENDER_ALIAS.DISPLAY_NAME, AT_OFFENDER_ALIAS.DATE_OF_BIRTH, FACT_CURR_KEY_DATES_SENT.CURR_HDCED_DATE, 'Not Available' AS CONVICTED_DATE, AT_OFFENDER_BOOKING.HO_REF, AT_OFFENDER_BOOKING.PNC_ID, AT_OFFENDER_BOOKING.BIRTH_PLACE, AT_DIM_OUTCOME_REASON.OUTCOME_REASON_DESCRIPTION, DT_COURT_FIRST_RCVD_FROM.COURT_DESCRIPTION, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' WHEN NOT FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH IS NULL THEN CASE WHEN TO_NUMBER(SUBSTR(FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) IS NULL THEN NULL ELSE TO_NUMBER(SUBSTR(FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) || ' yrs ' END || CASE WHEN TO_NUMBER(SUBSTR(FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH, 4, 2)) IS NULL THEN NULL ELSE TO_NUMBER(SUBSTR(FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH, 4, 2)) || ' mths ' END || CASE WHEN TO_NUMBER(SUBSTR(FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH, 7, 2)) IS NULL THEN NULL ELSE TO_NUMBER(SUBSTR(FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH, 7, 2)) || ' days ' END ELSE '' END AS SENTENCE_LENGTH_FORMATTED FROM BODIMIS.DIM_DATE AT_SENT_START_DATE, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.DIM_CELL AT_DIM_LOCATION, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.DIM_OUTCOME_REASON AT_DIM_OUTCOME_REASON, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_DOB, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, FACT_CURR_KEY_DATES_SENT, BODIMIS.DIM_OFFENDER_ALIAS AT_OFFENDER_ALIAS, (SELECT F_M_E.OFFENDER_BOOKING_SK, D_D.DAY_DATE, F_M_E.MOVEMENT_TIME, D_C.COURT_DESCRIPTION FROM BODIMIS.FACT_MOVEMENT_EXTERNAL F_M_E, BODIMIS.DIM_DATE D_D, BODIMIS.DIM_COURT D_C WHERE D_D.DATE_SK = F_M_E.DATE_SK AND D_C.COURT_SK = F_M_E.FROM_LOCATION_SK AND (F_M_E.OFFENDER_BOOKING_SK, D_D.DAY_DATE, F_M_E.MOVEMENT_TIME) IN (SELECT F_M_E.OFFENDER_BOOKING_SK, MIN(D_D.DAY_DATE), MIN(F_M_E.MOVEMENT_TIME) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL F_M_E, BODIMIS.DIM_DATE D_D WHERE D_D.DATE_SK = F_M_E.DATE_SK GROUP BY F_M_E.OFFENDER_BOOKING_SK)) DT_COURT_FIRST_RCVD_FROM, BODIMIS.DIM_COURT_CASE AT_COURT_CASE WHERE (AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+)) AND (AT_COURT_CASE.OUTCOME_REASON_SK = AT_DIM_OUTCOME_REASON.OUTCOME_REASON_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = FACT_CURR_KEY_DATES_SENT.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_OFFENDER_ALIAS.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (DT_COURT_FIRST_RCVD_FROM.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_SENTENCE.COURT_CASE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_ALIAS.OFFENDER_BOOKING_SK IS NULL OR AT_OFFENDER_ALIAS.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_SK = AT_DIM_LOCATION.UNIT_4_SK (+)) AND ((AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK IN ('All') OR 'All' IN ('All')) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND AT_OFFENDER_BOOKING.IN_OUT <> 'TRN       ' AND (AT_OFFENDER_BOOKING.NATIONALITY_CODE IS NULL OR AT_OFFENDER_BOOKING.NATIONALITY_CODE <> 'BRIT'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, SURNAME, FIRST_NAME, DATE_OF_BIRTH, NATIONALITY_DESCRIPTION, MAIN_LEGAL_STATUS_CODE, CURRENT_EFFECTIVE_SENTENCE_L33, CURR_RELEASE_DATE, UNIT_4_SHORT_DESCRIPTION, ESTABLISHMENT_DESCRIPTION, MOVEMENT_TIME, CURR_ERSED_DATE, CURR_TERSED_DATE, CURR_CRD_DATE, SSD, SENTENCE_START_DATE, MAIN_LEGAL_STATUS_DESCRIPTION, LEGAL_STATUS_GROUPING, BOOKING_NUMBER, ALIAS_SURNAME, ALIAS_GIVEN_NAME_1, DISPLAY_NAME, DATE_OF_BIRTH, CURR_HDCED_DATE, CONVICTED_DATE, HO_REF, PNC_ID, BIRTH_PLACE, OUTCOME_REASON_DESCRIPTION, COURT_DESCRIPTION, SENTENCE_LENGTH_FORMATTED, EXTRACT(day FROM TO_DATE(FOREIGN_NATIONAL.DATE_OF_BIRTH, 'DD-MM-YYYY HH24:MI:SS')) AS V_DAY_DOB, EXTRACT(month FROM TO_DATE(FOREIGN_NATIONAL.DATE_OF_BIRTH, 'DD-MM-YYYY HH24:MI:SS')) AS V_MONTH_DOB, YEAR(TO_DATE(FOREIGN_NATIONAL.DATE_OF_BIRTH, 'DD-MM-YYYY HH24:MI:SS')) AS V_YEAR_DOB, (TO_DATE(FOREIGN_NATIONAL.MOVEMENT_TIME, 'DD/MM/YYYY') - TO_DATE(TRUNC(SYSDATE), 'DD/MM/YYYY')) AS V_LENGTHOFSTAYINDAYS, OFFENCE_NAME AS V_MAIN_OFFENCE, CASE WHEN MAPPA.ALERT_CODE_NK IS NULL THEN 0 ELSE 'Yes' END AS V_MAPPA_NOMINAL, CASE WHEN FINANCIAL_ORDERS.ALERT_CODE_NK IS NULL THEN 0 ELSE 'Yes' END AS V_FINANCIAL_ORDER_ALERT, REHAB_PROVIDER_CODE || ' - ' || REHAB_PROVIDER_DESCRIPTION AS V_REHAB_PROVIDER, OFFENDER_ADDRESS_ADDRESS_COUNTRY_DESC AS V_PRIMARY_ADDRESS_COUNTRY, 'TBD' AS V_MAX_CONCAT_FULL_ALIAS FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP2.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP2.DO1007b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "Offender Given Name 1",
            "legacyId": "DP2.DO10080",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "DATE_OF_BIRTH",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DP2.DO10085",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "NATIONALITY_DESCRIPTION",
            "type": "string",
            "display": "Nationality Description",
            "legacyId": "DP2.DO100b5",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "MAIN_LEGAL_STATUS_CODE",
            "type": "string",
            "display": "Main Legal Status Code",
            "legacyId": "DP2.DO100de",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "CURRENT_EFFECTIVE_SENTENCE_L33",
            "type": "string",
            "display": "Current Effective Sentence Length",
            "legacyId": "DP2.DO2ef",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "CURR_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DP2.DO2e6",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "UNIT_4_SHORT_DESCRIPTION",
            "type": "string",
            "display": "Prisoner Location",
            "legacyId": "DP2.DO10a7c",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Associated Establishment Name",
            "legacyId": "DP2.DO107b1",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DP2.DO107ce",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "CURR_ERSED_DATE",
            "type": "date",
            "display": "ERSED (Early Removal Scheme Eligibility Date)",
            "legacyId": "DP2.DO61c",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "CURR_TERSED_DATE",
            "type": "date",
            "display": "TERSED (Tariff Expiry Removal Scheme Eligibility Date)",
            "legacyId": "DP2.DO61d",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "CURR_CRD_DATE",
            "type": "date",
            "display": "CRD (Conditional Release Date)",
            "legacyId": "DP2.DO48",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "SSD",
            "type": "date",
            "display": "Current Sentence Start Date",
            "legacyId": "DP2.DO32d",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "SENTENCE_START_DATE",
            "type": "date",
            "display": "Sentence Start Date",
            "legacyId": "DP2.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "MAIN_LEGAL_STATUS_DESCRIPTION",
            "type": "string",
            "display": "Main Legal Status Description",
            "legacyId": "DP2.DO100df",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DP2.DO107cb",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "BOOKING_NUMBER",
            "type": "string",
            "display": "Booking Number",
            "legacyId": "DP2.DO10077",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "ALIAS_SURNAME",
            "type": "string",
            "display": "Alias Surname",
            "legacyId": "DP2.DO10089",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "ALIAS_GIVEN_NAME_1",
            "type": "string",
            "display": "Alias Given Name 1",
            "legacyId": "DP2.DO1008b",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "DISPLAY_NAME",
            "type": "string",
            "display": "Alias or Working Name?",
            "legacyId": "DP2.DO1078f",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "DATE_OF_BIRTH",
            "type": "date",
            "display": "Alias Date of Birth",
            "legacyId": "DP2.DO1008d",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "CURR_HDCED_DATE",
            "type": "date",
            "display": "HDC Eligibility Date",
            "legacyId": "DP2.DO70",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "CONVICTED_DATE",
            "type": "string",
            "display": "Convicted Date",
            "legacyId": "DP2.DOa9",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "HO_REF",
            "type": "string",
            "display": "Home Office Reference Number",
            "legacyId": "DP2.DO1096e",
            "legacySqlClass": "column"
          },
          {
            "index": 26,
            "name": "PNC_ID",
            "type": "string",
            "display": "PNC ID",
            "legacyId": "DP2.DO100db",
            "legacySqlClass": "column"
          },
          {
            "index": 27,
            "name": "BIRTH_PLACE",
            "type": "string",
            "display": "Birth Place",
            "legacyId": "DP2.DO10086",
            "legacySqlClass": "column"
          },
          {
            "index": 28,
            "name": "OUTCOME_REASON_DESCRIPTION",
            "type": "string",
            "display": "Court Case Outcome",
            "legacyId": "DP2.DO52",
            "legacySqlClass": "column"
          },
          {
            "index": 29,
            "name": "COURT_DESCRIPTION",
            "type": "string",
            "display": "Court 1st Received From (External)",
            "legacyId": "DP2.DO10163",
            "legacySqlClass": "column"
          },
          {
            "index": 30,
            "name": "SENTENCE_LENGTH_FORMATTED",
            "type": "string",
            "display": "Sentence Length Formatted",
            "legacyId": "DP2.DO42",
            "legacySqlClass": "column"
          },
          {
            "index": 31,
            "name": "V_DAY_DOB",
            "type": "string",
            "display": "V_DAY_DOB",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 32,
            "name": "V_MONTH_DOB",
            "type": "string",
            "display": "V_MONTH_DOB",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 33,
            "name": "V_YEAR_DOB",
            "type": "string",
            "display": "V_YEAR_DOB",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 34,
            "name": "V_LENGTHOFSTAYINDAYS",
            "type": "string",
            "display": "V_LENGTHOFSTAYINDAYS",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 35,
            "name": "V_MAIN_OFFENCE",
            "type": "string",
            "display": "V_MAIN_OFFENCE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 36,
            "name": "V_MAPPA_NOMINAL",
            "type": "string",
            "display": "V_MAPPA_NOMINAL",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 37,
            "name": "V_FINANCIAL_ORDER_ALERT",
            "type": "string",
            "display": "V_FINANCIAL_ORDER_ALERT",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 38,
            "name": "V_REHAB_PROVIDER",
            "type": "string",
            "display": "V_REHAB_PROVIDER",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 39,
            "name": "V_PRIMARY_ADDRESS_COUNTRY",
            "type": "string",
            "display": "V_PRIMARY_ADDRESS_COUNTRY",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 40,
            "name": "V_MAX_CONCAT_FULL_ALIAS",
            "type": "string",
            "display": "V_MAX_CONCAT_FULL_ALIAS",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375368/DP4",
      "name": "Immigration",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_DIM_OFFENCE.OFFENCE_NAME FROM BODIMIS.DIM_OFFENCE AT_DIM_OFFENCE, BODIMIS.FACT_COURT_CHARGE AT_FACT_COURT_CHARGE, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_COURT_CASE_STATUS AT_DIM_COURT_CASE_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_COURT_CASE AT_COURT_CASE WHERE (AT_FACT_COURT_CHARGE.OFFENCE_SK = AT_DIM_OFFENCE.OFFENCE_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_COURT_CHARGE.COURT_CASE_SK (+)) AND (AT_COURT_CASE.COURT_CASE_STATUS_SK = AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND ((AT_FACT_COURT_CHARGE.MOST_SERIOUS_FLAG = 'Y' AND AT_COURT_CASE.MOST_SERIOUS_COUNT = 1) AND (AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK IN ('All') OR 'All' IN ('All')) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS = 'Active') AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_OFFENDER_BOOKING.NATIONALITY_CODE IS NULL OR AT_OFFENDER_BOOKING.NATIONALITY_CODE <> 'BRIT'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, OFFENCE_NAME FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP4.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "OFFENCE_NAME",
            "type": "string",
            "display": "Offence Name",
            "legacyId": "DP4.DO4b",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375377/DP5",
      "name": "Proven Adjudications",
      "description": "MIS - Incidents",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, DT_OFFENDER_ADJUDICATION.OIC_INCIDENT_ID FROM BODIMIS.FACT_INCIDENT_CHARGE_RESULT AT_FACT_INCIDENT_CHARGE_RESULT, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT a.oic_incident_id, c.offender_booking_sk, c.agency_incident_id_nk, c.charge_seq_nk, c.oic_offence_sk, a.oic_hearing_id_nk, a.party_seq_nk, a.establishment_sk, c.report_date, a.oic_hearing_type, a.notification_charge_date_sk FROM bodimis.fact_incident_charge c LEFT OUTER JOIN bodimis.fact_offender_adjudication a ON c.agency_incident_id_nk = a.agency_incident_id_nk AND c.offender_booking_sk = a.offender_booking_sk) DT_OFFENDER_ADJUDICATION WHERE (DT_OFFENDER_ADJUDICATION.OFFENDER_BOOKING_SK = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (DT_OFFENDER_ADJUDICATION.AGENCY_INCIDENT_ID_NK = AT_FACT_INCIDENT_CHARGE_RESULT.AGENCY_INCIDENT_ID (+) AND DT_OFFENDER_ADJUDICATION.OIC_HEARING_ID_NK = AT_FACT_INCIDENT_CHARGE_RESULT.OIC_HEARING_ID_NK (+) AND DT_OFFENDER_ADJUDICATION.OFFENDER_BOOKING_SK = AT_FACT_INCIDENT_CHARGE_RESULT.OFFENDER_BOOKING_SK (+) AND DT_OFFENDER_ADJUDICATION.CHARGE_SEQ_NK = AT_FACT_INCIDENT_CHARGE_RESULT.CHARGE_SEQ (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_FACT_INCIDENT_CHARGE_RESULT.FINDING_CODE = 'PROVED' AND (AT_OFFENDER_BOOKING.NATIONALITY_CODE IS NULL OR AT_OFFENDER_BOOKING.NATIONALITY_CODE <> 'BRIT') AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK IN ('All') OR 'All' IN ('All')) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, OIC_INCIDENT_ID FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP5.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "OIC_INCIDENT_ID",
            "type": "double",
            "display": "OIC Incident ID",
            "legacyId": "DP5.DO75a",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP6",
      "name": "Active Sentences",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, FACT_CURR_KEY_DATES_SENT.SSD, CASE WHEN AT_SENT_START_DATE.DAY_DATE < '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END AS SENTENCE_START_DATE FROM BODIMIS.DIM_DATE AT_SENT_START_DATE, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_COURT_CASE_STATUS AT_DIM_COURT_CASE_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, FACT_CURR_KEY_DATES_SENT, BODIMIS.DIM_COURT_CASE AT_COURT_CASE WHERE (AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+)) AND (AT_COURT_CASE.COURT_CASE_STATUS_SK = AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = FACT_CURR_KEY_DATES_SENT.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_SENTENCE.COURT_CASE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND ((AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS = 'Active' AND (AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK IN ('All') OR 'All' IN ('All')))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, SSD, SENTENCE_START_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP6.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "SSD",
            "type": "date",
            "display": "Current Sentence Start Date",
            "legacyId": "DP6.DO32d",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SENTENCE_START_DATE",
            "type": "date",
            "display": "Sentence Start Date",
            "legacyId": "DP6.DO45",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP8",
      "name": "MAPPA",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_ALERT.ALERT_CODE_NK FROM BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_ALERT AT_ALERT, BODIMIS.FACT_OFFENDER_ALERT AT_OFFENDER_ALERT WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_OFFENDER_ALERT.OFFENDER_BOOKING_SK (+)) AND (AT_ALERT.ALERT_SK (+) = AT_OFFENDER_ALERT.ALERT_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_ALERT.ALERT_CODE_NK IN ('P0', 'P1', 'P2', 'P3', 'PC1', 'PC2', 'PC3', 'PL1', 'PL2', 'PL3') AND (AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK IN ('All') OR 'All' IN ('All')) AND (AT_OFFENDER_ALERT.ALERT_STATUS = 'ACTIVE'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, ALERT_CODE_NK FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP8.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "ALERT_CODE_NK",
            "type": "string",
            "display": "Alert Code",
            "legacyId": "DP8.DO1008e",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP9",
      "name": "Rehab Provider",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, CASE WHEN BODIMIS.DIM_REHAB_PROVIDER.REHAB_PROVIDER_SK > 0 THEN BODIMIS.DIM_REHAB_PROVIDER.CODE_NK END AS REHAB_PROVIDER_CODE, CASE WHEN BODIMIS.DIM_REHAB_PROVIDER.REHAB_PROVIDER_SK > 0 THEN BODIMIS.DIM_REHAB_PROVIDER.DESCRIPTION END AS REHAB_PROVIDER_DESCRIPTION FROM BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_REHAB_PROVIDER, BODIMIS.FACT_OFFENDER_REHAB WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = BODIMIS.FACT_OFFENDER_REHAB.OFFENDER_BOOKING_SK (+)) AND (BODIMIS.FACT_OFFENDER_REHAB.REHAB_PROVIDER_SK = BODIMIS.DIM_REHAB_PROVIDER.REHAB_PROVIDER_SK (+)) AND ((BODIMIS.FACT_OFFENDER_REHAB.PROVIDER_ACTIVE_FLAG = 'Y' OR BODIMIS.FACT_OFFENDER_REHAB.PROVIDER_ACTIVE_FLAG IS NULL) AND (BODIMIS.FACT_OFFENDER_REHAB.DECISION_ACTIVE_FLAG = 'Y' OR BODIMIS.FACT_OFFENDER_REHAB.DECISION_ACTIVE_FLAG IS NULL) AND (AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK IN ('All') OR 'All' IN ('All')) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, REHAB_PROVIDER_CODE, REHAB_PROVIDER_DESCRIPTION FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP9.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "REHAB_PROVIDER_CODE",
            "type": "string",
            "display": "Rehab Provider Code",
            "legacyId": "DP9.DO10b37",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "REHAB_PROVIDER_DESCRIPTION",
            "type": "string",
            "display": "Rehab Provider Description",
            "legacyId": "DP9.DO10b38",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DPa",
      "name": "Primary Address",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, DT_OFFENDER_ADDRESSES.COUNTRY_DESC FROM BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, ( select ROW_NUMBER() OVER (PARTITION BY ss.OWNER_ID ORDER BY PRIMARY_FLAG desc, ss.address_active_flag desc, ss.USAGE_ACTIVE_FLAG desc, ss.usages_dttm DESC nulls last) row_seq_filter, ss.* from ( select * from ( select AT_DIM_ADDRESSES.OWNER_ID, AT_DIM_ADDRESS_USAGES.ADDRESS_ID_NK, AT_DIM_ADDRESS_USAGES.ADDRESS_USAGE, AT_DIM_ADDRESS_USAGES.ADDR_USAGE_DESCRIPTION, AT_DIM_ADDRESS_USAGES.ACTIVE_FLAG as USAGE_ACTIVE_FLAG, AT_DIM_ADDRESSES.flat, AT_DIM_ADDRESSES.premise, AT_DIM_ADDRESSES.Street, AT_DIM_ADDRESSES.locality, AT_DIM_ADDRESSES.city_code, AT_DIM_ADDRESSES.city_desc, AT_DIM_ADDRESSES.county_code, AT_DIM_ADDRESSES.county_desc, AT_DIM_ADDRESSES.postal_code, AT_DIM_ADDRESSES.COUNTRY_CODE, AT_DIM_ADDRESSES.country_desc, AT_DIM_ADDRESSES.HOME_TEL_NO, AT_DIM_ADDRESSES.HOME_EXT_NO, AT_DIM_ADDRESSES.NO_FIXED_ADDRESS_FLAG, AT_DIM_ADDRESSES.establishment_sk, AT_DIM_ADDRESSES.PRIMARY_FLAG, AT_DIM_ADDRESSES.active_flag as address_active_flag, AT_DIM_ADDRESS_USAGES.CREATE_DATETIME, AT_DIM_ADDRESS_USAGES.MODIFY_DATETIME, COALESCE(AT_DIM_ADDRESS_USAGES.modify_datetime, AT_DIM_ADDRESS_USAGES.create_datetime) as usages_dttm from BODIMIS.DIM_ADDRESS_USAGES AT_DIM_ADDRESS_USAGES inner join BODIMIS.dim_addresses AT_DIM_ADDRESSES on AT_DIM_ADDRESS_USAGES.address_id_nk = AT_DIM_ADDRESSES.address_id_nk and AT_DIM_ADDRESSES.owner_class='OFF'  ) Addr_usages --where Addr_usages.usages_dttm is not null ) ss ) DT_OFFENDER_ADDRESSES, BODISTAGING.REF_OFFENDERS AT_BODISTAG_REF_OFFENDERS WHERE ( AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID=CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username from context_) AND CSL.ENDYEAR >= to_char(sysdate,'YYYY')-6 ) ) AND ( AT_OFFENDER_BOOKING.ESTABLISHMENT_SK=AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK ) AND ( AT_ESTABLISHMENT_TAP.ACTIVE_FLAG='Y' ) AND ( AT_OFFENDER_BOOKING.OFFENDER_ID=AT_BODISTAG_REF_OFFENDERS.OFFENDER_ID(+) ) AND ( AT_BODISTAG_REF_OFFENDERS.ROOT_OFFENDER_ID=DT_OFFENDER_ADDRESSES.OWNER_ID(+) ) AND ( ( DT_OFFENDER_ADDRESSES.ADDRESS_ACTIVE_FLAG='Y' ) AND DT_OFFENDER_ADDRESSES.PRIMARY_FLAG = 'Y' AND ( AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK in ('All') Or 'All' in ('All') ) AND ( AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y' ) )), dataset_ AS (SELECT FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": []
      }
    },
    {
      "id": "3375368/DPb",
      "name": "Financial Orders",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_ALERT.ALERT_CODE_NK, AT_DIM_OUTCOME_REASON.OUTCOME_REASON_DESCRIPTION FROM BODIMIS.DIM_OUTCOME_REASON AT_DIM_OUTCOME_REASON, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_COURT_CASE_STATUS AT_DIM_COURT_CASE_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_ALERT AT_ALERT, BODIMIS.FACT_OFFENDER_ALERT AT_OFFENDER_ALERT, BODIMIS.DIM_COURT_CASE AT_COURT_CASE WHERE (AT_COURT_CASE.COURT_CASE_STATUS_SK = AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS_SK (+)) AND (AT_COURT_CASE.OUTCOME_REASON_SK = AT_DIM_OUTCOME_REASON.OUTCOME_REASON_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_OFFENDER_ALERT.OFFENDER_BOOKING_SK (+)) AND (AT_ALERT.ALERT_SK (+) = AT_OFFENDER_ALERT.ALERT_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (((AT_DIM_OUTCOME_REASON.OUTCOME_REASON_DESCRIPTION IN ('Confiscation', 'Forfeiture/Confiscation') AND AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS = 'Active') OR (AT_ALERT.ALERT_CODE_NK = 'XFO' AND (AT_OFFENDER_ALERT.ALERT_STATUS = 'ACTIVE'))) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK IN ('All') OR 'All' IN ('All')))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, ALERT_CODE_NK, OUTCOME_REASON_DESCRIPTION FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPb.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "ALERT_CODE_NK",
            "type": "string",
            "display": "Alert Code",
            "legacyId": "DPb.DO1008e",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "OUTCOME_REASON_DESCRIPTION",
            "type": "string",
            "display": "Court Case Outcome",
            "legacyId": "DPb.DO52",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP3",
      "name": "MIS Load End Date",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT BODIMIS.ETL_LOAD_LOG.BUSINESS_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT BUSINESS_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BUSINESS_DATE",
            "type": "date",
            "display": "Latest Business Date Available",
            "legacyId": "DP3.DO104dd",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DPc",
      "name": "British Prisoners",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.BIRTH_COUNTRY, AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.FIRST_NAME, CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END AS DATE_OF_BIRTH, AT_OFFENDER_BOOKING.NATIONALITY_DESCRIPTION, AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH END AS CURRENT_EFFECTIVE_SENTENCE_L33, FACT_CURR_KEY_DATES_SENT.CURR_RELEASE_DATE, AT_DIM_LOCATION.UNIT_4_SHORT_DESCRIPTION, AT_ESTABLISHMENT_TAP.ESTABLISHMENT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, FACT_CURR_KEY_DATES_SENT.CURR_ERSED_DATE, FACT_CURR_KEY_DATES_SENT.CURR_TERSED_DATE, FACT_CURR_KEY_DATES_SENT.CURR_CRD_DATE, FACT_CURR_KEY_DATES_SENT.SSD, CASE WHEN AT_SENT_START_DATE.DAY_DATE < '31/12/9000' THEN AT_SENT_START_DATE.DAY_DATE END AS SENTENCE_START_DATE, AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_DESCRIPTION, CASE WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE IN ('14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA', 'FTRSCH18_ORA', 'FTRSCH18', 'LR_EDS18', 'LR_EDS21', 'LR_SOPC18', 'LR_SOPC21', 'LRSEC250_ORA', 'LR_ALP_CDE18', 'LR_ALP_CDE21', 'LR_EDSU18') THEN 'Recall' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '0' THEN 'Dead' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND = '1' THEN 'Indeterminate Sentence' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('2', '3') THEN 'Sentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('9', '10') OR AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'CIV_RMD' THEN 'Civil Prisoner' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('8', '11') THEN 'Immigration Detainee' WHEN AT_OFFENDER_BOOKING.LEGAL_STATUS_BAND IN ('12', '13', '14') THEN 'Remand' WHEN AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, AT_OFFENDER_BOOKING.BOOKING_NUMBER, AT_OFFENDER_ALIAS.SURNAME AS ALIAS_SURNAME, AT_OFFENDER_ALIAS.FIRST_NAME AS ALIAS_GIVEN_NAME_1, AT_OFFENDER_ALIAS.DISPLAY_NAME, AT_OFFENDER_ALIAS.DATE_OF_BIRTH, FACT_CURR_KEY_DATES_SENT.CURR_HDCED_DATE, 'Not Available' AS CONVICTED_DATE, AT_OFFENDER_BOOKING.HO_REF, AT_OFFENDER_BOOKING.PNC_ID, AT_OFFENDER_BOOKING.BIRTH_PLACE, AT_DIM_OUTCOME_REASON.OUTCOME_REASON_DESCRIPTION, DT_COURT_FIRST_RCVD_FROM.COURT_DESCRIPTION, CASE WHEN DT_LIFEFLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' WHEN NOT FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH IS NULL THEN CASE WHEN TO_NUMBER(SUBSTR(FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) IS NULL THEN NULL ELSE TO_NUMBER(SUBSTR(FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH, 1, 2)) || ' yrs ' END || CASE WHEN TO_NUMBER(SUBSTR(FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH, 4, 2)) IS NULL THEN NULL ELSE TO_NUMBER(SUBSTR(FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH, 4, 2)) || ' mths ' END || CASE WHEN TO_NUMBER(SUBSTR(FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH, 7, 2)) IS NULL THEN NULL ELSE TO_NUMBER(SUBSTR(FACT_CURR_KEY_DATES_SENT.EFFECTIVE_SENTENCE_LENGTH, 7, 2)) || ' days ' END ELSE '' END AS SENTENCE_LENGTH_FORMATTED FROM BODIMIS.DIM_DATE AT_SENT_START_DATE, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.DIM_CELL AT_DIM_LOCATION, BODIMIS.FACT_CASE_SENTENCE AT_FACT_SENTENCE, BODIMIS.DIM_OUTCOME_REASON AT_DIM_OUTCOME_REASON, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_DOB, (SELECT DISTINCT BODIMIS.FACT_CASE_SENTENCE_TERM.offender_booking_sk, BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG FROM BODIMIS.FACT_CASE_SENTENCE_TERM, BODIMIS.FACT_CASE_SENTENCE, BODIMIS.DIM_SENTENCE_STATUS dss WHERE (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_STATUS_SK = dss.sentence_status_sk) AND dss.sentence_status = 'Active' AND (BODIMIS.FACT_CASE_SENTENCE.OFFENDER_BOOKING_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.OFFENDER_BOOKING_SK) AND (BODIMIS.FACT_CASE_SENTENCE.SENTENCE_SEQ_NK = BODIMIS.FACT_CASE_SENTENCE_TERM.SENTENCE_SEQ_NK) AND (BODIMIS.FACT_CASE_SENTENCE.COURT_CASE_SK = BODIMIS.FACT_CASE_SENTENCE_TERM.COURT_CASE_SK) AND BODIMIS.FACT_CASE_SENTENCE_TERM.LIFE_SENTENCE_FLAG = 'Y') DT_LIFEFLAG, FACT_CURR_KEY_DATES_SENT, BODIMIS.DIM_OFFENDER_ALIAS AT_OFFENDER_ALIAS, (SELECT F_M_E.OFFENDER_BOOKING_SK, D_D.DAY_DATE, F_M_E.MOVEMENT_TIME, D_C.COURT_DESCRIPTION FROM BODIMIS.FACT_MOVEMENT_EXTERNAL F_M_E, BODIMIS.DIM_DATE D_D, BODIMIS.DIM_COURT D_C WHERE D_D.DATE_SK = F_M_E.DATE_SK AND D_C.COURT_SK = F_M_E.FROM_LOCATION_SK AND (F_M_E.OFFENDER_BOOKING_SK, D_D.DAY_DATE, F_M_E.MOVEMENT_TIME) IN (SELECT F_M_E.OFFENDER_BOOKING_SK, MIN(D_D.DAY_DATE), MIN(F_M_E.MOVEMENT_TIME) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL F_M_E, BODIMIS.DIM_DATE D_D WHERE D_D.DATE_SK = F_M_E.DATE_SK GROUP BY F_M_E.OFFENDER_BOOKING_SK)) DT_COURT_FIRST_RCVD_FROM, BODIMIS.DIM_COURT_CASE AT_COURT_CASE WHERE (AT_FACT_SENTENCE.SENTENCE_START_DATE_SK = AT_SENT_START_DATE.DATE_SK (+)) AND (AT_COURT_CASE.OUTCOME_REASON_SK = AT_DIM_OUTCOME_REASON.OUTCOME_REASON_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_LIFEFLAG.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = FACT_CURR_KEY_DATES_SENT.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_OFFENDER_ALIAS.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (DT_COURT_FIRST_RCVD_FROM.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_SENTENCE.COURT_CASE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_ALIAS.OFFENDER_BOOKING_SK IS NULL OR AT_OFFENDER_ALIAS.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_SK = AT_DIM_LOCATION.UNIT_4_SK (+)) AND ((AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK IN ('All') OR 'All' IN ('All')) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND AT_OFFENDER_BOOKING.NATIONALITY_CODE = 'BRIT' AND AT_OFFENDER_BOOKING.IN_OUT <> 'TRN       ' AND NOT AT_OFFENDER_BOOKING.BIRTH_COUNTRY IN ('England', 'Wales', 'Scotland', 'United Kingdom'))), dataset_ AS (SELECT BIRTH_COUNTRY, OFFENDER_ID_DISPLAY, SURNAME, FIRST_NAME, DATE_OF_BIRTH, NATIONALITY_DESCRIPTION, MAIN_LEGAL_STATUS_CODE, CURRENT_EFFECTIVE_SENTENCE_L33, CURR_RELEASE_DATE, UNIT_4_SHORT_DESCRIPTION, ESTABLISHMENT_DESCRIPTION, MOVEMENT_TIME, CURR_ERSED_DATE, CURR_TERSED_DATE, CURR_CRD_DATE, SSD, SENTENCE_START_DATE, MAIN_LEGAL_STATUS_DESCRIPTION, LEGAL_STATUS_GROUPING, BOOKING_NUMBER, ALIAS_SURNAME, ALIAS_GIVEN_NAME_1, DISPLAY_NAME, DATE_OF_BIRTH, CURR_HDCED_DATE, CONVICTED_DATE, HO_REF, PNC_ID, BIRTH_PLACE, OUTCOME_REASON_DESCRIPTION, COURT_DESCRIPTION, SENTENCE_LENGTH_FORMATTED, 'TBD' AS V_MAX_CONCAT_FULL_ALIAS FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BIRTH_COUNTRY",
            "type": "string",
            "display": "Birth Country",
            "legacyId": "DPc.DO10088",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPc.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DPc.DO1007b",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "Offender Given Name 1",
            "legacyId": "DPc.DO10080",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "DATE_OF_BIRTH",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DPc.DO10085",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "NATIONALITY_DESCRIPTION",
            "type": "string",
            "display": "Nationality Description",
            "legacyId": "DPc.DO100b5",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "MAIN_LEGAL_STATUS_CODE",
            "type": "string",
            "display": "Main Legal Status Code",
            "legacyId": "DPc.DO100de",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "CURRENT_EFFECTIVE_SENTENCE_L33",
            "type": "string",
            "display": "Current Effective Sentence Length",
            "legacyId": "DPc.DO2ef",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "CURR_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DPc.DO2e6",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "UNIT_4_SHORT_DESCRIPTION",
            "type": "string",
            "display": "Prisoner Location",
            "legacyId": "DPc.DO10a7c",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Associated Establishment Name",
            "legacyId": "DPc.DO107b1",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DPc.DO107ce",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "CURR_ERSED_DATE",
            "type": "date",
            "display": "ERSED (Early Removal Scheme Eligibility Date)",
            "legacyId": "DPc.DO61c",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "CURR_TERSED_DATE",
            "type": "date",
            "display": "TERSED (Tariff Expiry Removal Scheme Eligibility Date)",
            "legacyId": "DPc.DO61d",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "CURR_CRD_DATE",
            "type": "date",
            "display": "CRD (Conditional Release Date)",
            "legacyId": "DPc.DO48",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "SSD",
            "type": "date",
            "display": "Current Sentence Start Date",
            "legacyId": "DPc.DO32d",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "SENTENCE_START_DATE",
            "type": "date",
            "display": "Sentence Start Date",
            "legacyId": "DPc.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "MAIN_LEGAL_STATUS_DESCRIPTION",
            "type": "string",
            "display": "Main Legal Status Description",
            "legacyId": "DPc.DO100df",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DPc.DO107cb",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "BOOKING_NUMBER",
            "type": "string",
            "display": "Booking Number",
            "legacyId": "DPc.DO10077",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "ALIAS_SURNAME",
            "type": "string",
            "display": "Alias Surname",
            "legacyId": "DPc.DO10089",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "ALIAS_GIVEN_NAME_1",
            "type": "string",
            "display": "Alias Given Name 1",
            "legacyId": "DPc.DO1008b",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "DISPLAY_NAME",
            "type": "string",
            "display": "Alias or Working Name?",
            "legacyId": "DPc.DO1078f",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "DATE_OF_BIRTH",
            "type": "date",
            "display": "Alias Date of Birth",
            "legacyId": "DPc.DO1008d",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "CURR_HDCED_DATE",
            "type": "date",
            "display": "HDC Eligibility Date",
            "legacyId": "DPc.DO70",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "CONVICTED_DATE",
            "type": "string",
            "display": "Convicted Date",
            "legacyId": "DPc.DOa9",
            "legacySqlClass": "column"
          },
          {
            "index": 26,
            "name": "HO_REF",
            "type": "string",
            "display": "Home Office Reference Number",
            "legacyId": "DPc.DO1096e",
            "legacySqlClass": "column"
          },
          {
            "index": 27,
            "name": "PNC_ID",
            "type": "string",
            "display": "PNC ID",
            "legacyId": "DPc.DO100db",
            "legacySqlClass": "column"
          },
          {
            "index": 28,
            "name": "BIRTH_PLACE",
            "type": "string",
            "display": "Birth Place",
            "legacyId": "DPc.DO10086",
            "legacySqlClass": "column"
          },
          {
            "index": 29,
            "name": "OUTCOME_REASON_DESCRIPTION",
            "type": "string",
            "display": "Court Case Outcome",
            "legacyId": "DPc.DO52",
            "legacySqlClass": "column"
          },
          {
            "index": 30,
            "name": "COURT_DESCRIPTION",
            "type": "string",
            "display": "Court 1st Received From (External)",
            "legacyId": "DPc.DO10163",
            "legacySqlClass": "column"
          },
          {
            "index": 31,
            "name": "SENTENCE_LENGTH_FORMATTED",
            "type": "string",
            "display": "Sentence Length Formatted",
            "legacyId": "DPc.DO42",
            "legacySqlClass": "column"
          },
          {
            "index": 32,
            "name": "V_MAX_CONCAT_FULL_ALIAS",
            "type": "string",
            "display": "V_MAX_CONCAT_FULL_ALIAS",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "105046.RS",
      "name": "Sentenced Only",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DP2",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE FOREIGN_NATIONAL_CURRENT_EFF50 IS NOT NULL)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-section",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10076"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO1007b"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Offender Given Name 1",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10080"
          },
          {
            "name": "$ref:NATIONALITY_DESCRIPTION",
            "display": "Nationality Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO100b5"
          },
          {
            "name": "$ref:V_DAY_DOB",
            "display": "DoB Day",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=DayNumberOfMonth([Foreign National].[Date of Birth])"
          },
          {
            "name": "$ref:V_MONTH_DOB",
            "display": "DoB Month",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=MonthNumberOfYear([Foreign National].[Date of Birth])"
          },
          {
            "name": "$ref:V_YEAR_DOB",
            "display": "DoB Year",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Year([Foreign National].[Date of Birth])"
          },
          {
            "name": "$ref:UNIT_4_SHORT_DESCRIPTION",
            "display": "Prisoner Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10a7c"
          },
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Admission Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO107ce"
          },
          {
            "name": "$ref:V_LENGTHOFSTAYINDAYS",
            "display": "Length of Stay (Days)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=DaysBetween([Foreign National].[Admission Date];CurrentDate())"
          },
          {
            "name": "$ref:MAIN_LEGAL_STATUS_CODE",
            "display": "Main Legal Status Code",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO100de"
          },
          {
            "name": "$ref:V_NO_OF_PROVEN_ADJUDICATIONS",
            "display": "Proven Adj.",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([OIC Incident ID]) In ([NOMS Number])"
          },
          {
            "name": "$ref:V_MIN_SENTENCE_START_DATE",
            "display": "Min Sentence Start Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Min([v_DIM_Sentence_Start_Date]) In ([Active Sentences].[NOMS Number])"
          },
          {
            "name": "$ref:CURRENT_EFFECTIVE_SENTENCE_L33",
            "display": "Current Effective Sentence Length",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO2ef"
          },
          {
            "name": "$ref:CURR_ERSED_DATE",
            "display": "ERSED (Early Removal Scheme Eligibility Date)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO61c"
          },
          {
            "name": "$ref:CURR_TERSED_DATE",
            "display": "TERSED (Tariff Expiry Removal Scheme Eligibility Date)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO61d"
          },
          {
            "name": "$ref:CURR_CRD_DATE",
            "display": "CRD (Conditional Release Date)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO48"
          },
          {
            "name": "$ref:CURR_RELEASE_DATE",
            "display": "Current Release Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO2e6"
          }
        ]
      }
    },
    {
      "id": "106562.RS",
      "name": "Merged List (For Excel",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DP2",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Associated Establishment Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO107b1"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10076"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO1007b"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Offender Given Name 1",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10080"
          },
          {
            "name": "$ref:NATIONALITY_DESCRIPTION",
            "display": "Nationality Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO100b5"
          },
          {
            "name": "$ref:DATE_OF_BIRTH",
            "display": "Date of Birth",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10085"
          },
          {
            "name": "$ref:UNIT_4_SHORT_DESCRIPTION",
            "display": "Prisoner Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10a7c"
          },
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Admission Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO107ce"
          },
          {
            "name": "$ref:V_LENGTHOFSTAYINDAYS",
            "display": "Length of Stay (Days)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=DaysBetween([Foreign National].[Admission Date];CurrentDate())"
          },
          {
            "name": "$ref:MAIN_LEGAL_STATUS_CODE",
            "display": "Main Legal Status Code",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO100de"
          },
          {
            "name": "$ref:V_NO_OF_PROVEN_ADJUDICATIONS",
            "display": "Proven Adj.",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([OIC Incident ID]) In ([NOMS Number])"
          },
          {
            "name": "$ref:CURRENT_EFFECTIVE_SENTENCE_L33",
            "display": "Current Effective Sentence Length",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO2ef"
          },
          {
            "name": "$ref:CURR_ERSED_DATE",
            "display": "ERSED (Early Removal Scheme Eligibility Date)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO61c"
          },
          {
            "name": "$ref:CURR_TERSED_DATE",
            "display": "TERSED (Tariff Expiry Removal Scheme Eligibility Date)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO61d"
          },
          {
            "name": "$ref:CURR_CRD_DATE",
            "display": "CRD (Conditional Release Date)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO48"
          },
          {
            "name": "$ref:CURR_RELEASE_DATE",
            "display": "Current Release Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO2e6"
          }
        ]
      }
    },
    {
      "id": "106784.RS",
      "name": "Sent Merged List (For Excel",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DP2",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE FOREIGN_NATIONAL_CURRENT_EFF50 IS NOT NULL)"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10076"
          },
          {
            "name": "$ref:PNC_ID",
            "display": "PNC ID",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO100db"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO1007b"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Offender Given Name 1",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10080"
          },
          {
            "name": "$ref:V_DAY_DOB",
            "display": "DoB Day",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=DayNumberOfMonth([Foreign National].[Date of Birth])"
          },
          {
            "name": "$ref:V_MONTH_DOB",
            "display": "DoB Month",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=MonthNumberOfYear([Foreign National].[Date of Birth])"
          },
          {
            "name": "$ref:V_YEAR_DOB",
            "display": "DoB Year",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Year([Foreign National].[Date of Birth])"
          },
          {
            "name": "$ref:NATIONALITY_DESCRIPTION",
            "display": "Nationality Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO100b5"
          },
          {
            "name": "$ref:CURR_HDCED_DATE",
            "display": "HDC Eligibility Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO70"
          },
          {
            "name": "$ref:CURR_ERSED_DATE",
            "display": "ERSED (Early Removal Scheme Eligibility Date)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO61c"
          },
          {
            "name": "$ref:CURR_TERSED_DATE",
            "display": "TERSED (Tariff Expiry Removal Scheme Eligibility Date)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO61d"
          },
          {
            "name": "$ref:CURR_CRD_DATE",
            "display": "CRD (Conditional Release Date)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO48"
          },
          {
            "name": "$ref:CURR_RELEASE_DATE",
            "display": "Current Release Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO2e6"
          },
          {
            "name": "$ref:BIRTH_PLACE",
            "display": "Birth Place",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10086"
          },
          {
            "name": "$ref:HO_REF",
            "display": "Home Office Reference Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO1096e"
          },
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Associated Establishment Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO107b1"
          },
          {
            "name": "$ref:UNIT_4_SHORT_DESCRIPTION",
            "display": "Prisoner Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10a7c"
          },
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Admission Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO107ce"
          },
          {
            "name": "$ref:V_LENGTHOFSTAYINDAYS",
            "display": "Length of Stay (Days)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=DaysBetween([Foreign National].[Admission Date];CurrentDate())"
          },
          {
            "name": "$ref:V_MAIN_OFFENCE",
            "display": "Main Offence",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Offence Name]"
          },
          {
            "name": "$ref:MAIN_LEGAL_STATUS_CODE",
            "display": "Main Legal Status Code",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO100de"
          },
          {
            "name": "$ref:V_MAPPA_NOMINAL",
            "display": "MAPPA Nominal?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([MAPPA].[Alert Code]);0;\"Yes\")"
          },
          {
            "name": "$ref:V_FINANCIAL_ORDER_ALERT",
            "display": "Financial Order Alert?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Financial Orders].[Alert Code]);0;\"Yes\")"
          },
          {
            "name": "$ref:V_CONFISCATION_OUTCOME",
            "display": "Confiscation Outcome?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([Financial Orders].[Court Case Outcome] InList (\"Confiscation\";\"Forfeiture/Confiscation\");\"Yes\")"
          },
          {
            "name": "$ref:V_NO_OF_PROVEN_ADJUDICATIONS",
            "display": "Proven Adj.",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([OIC Incident ID]) In ([NOMS Number])"
          },
          {
            "name": "$ref:SENTENCE_LENGTH_FORMATTED",
            "display": "Sentence Length Formatted",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO42"
          },
          {
            "name": "$ref:V_MIN_SENTENCE_START_DATE",
            "display": "Min Sentence Start Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Min([v_DIM_Sentence_Start_Date]) In ([Active Sentences].[NOMS Number])"
          },
          {
            "name": "$ref:V_REHAB_PROVIDER",
            "display": "Provider",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Rehab Provider Code]+\" - \"+[Rehab Provider Description]"
          },
          {
            "name": "$ref:V_PRIMARY_ADDRESS_COUNTRY",
            "display": "Primary Address Country",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Offender Address Address Country Desc]"
          },
          {
            "name": "$ref:V_MAX_CONCAT_FULL_ALIAS",
            "display": "Aliases (First Name, Surname, DoB)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[v_concat_full_alias]Where ([v_Full_Alias]= [v_max_full_alias]) In ([NOMS Number])"
          }
        ]
      }
    },
    {
      "id": "213416.RS",
      "name": "Remand Merged List (For Excel)",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DP2",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (FOREIGN_NATIONAL_CURRENT_EFF50 IS NULL AND FOREIGN_NATIONAL_LEGAL_STATU38 NOT(IN ('Indeterminate Sentence','Sentenced'))))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:ESTABLISHMENT_DESCRIPTION",
            "display": "Associated Establishment Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO107b1"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10076"
          },
          {
            "name": "$ref:BOOKING_NUMBER",
            "display": "Booking Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10077"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO1007b"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Offender Given Name 1",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10080"
          },
          {
            "name": "$ref:DATE_OF_BIRTH",
            "display": "Date of Birth",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10085"
          },
          {
            "name": "$ref:V_MAX_CONCAT_FULL_ALIAS",
            "display": "Aliases (First Name, Surname, DoB)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[v_concat_full_alias]Where ([v_Full_Alias]= [v_max_full_alias]) In ([NOMS Number])"
          },
          {
            "name": "$ref:BIRTH_PLACE",
            "display": "Birth Place",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10086"
          },
          {
            "name": "$ref:HO_REF",
            "display": "Home Office Reference Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO1096e"
          },
          {
            "name": "$ref:PNC_ID",
            "display": "PNC ID",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO100db"
          },
          {
            "name": "$ref:NATIONALITY_DESCRIPTION",
            "display": "Nationality Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO100b5"
          },
          {
            "name": "$ref:UNIT_4_SHORT_DESCRIPTION",
            "display": "Prisoner Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO10a7c"
          },
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Admission Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO107ce"
          },
          {
            "name": "$ref:V_LENGTHOFSTAYINDAYS",
            "display": "Length of Stay (Days)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=DaysBetween([Foreign National].[Admission Date];CurrentDate())"
          },
          {
            "name": "$ref:V_MAIN_OFFENCE",
            "display": "Main Offence",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Offence Name]"
          },
          {
            "name": "$ref:MAIN_LEGAL_STATUS_CODE",
            "display": "Main Legal Status Code",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO100de"
          },
          {
            "name": "$ref:V_MAPPA_NOMINAL",
            "display": "MAPPA Nominal?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([MAPPA].[Alert Code]);0;\"Yes\")"
          },
          {
            "name": "$ref:V_FINANCIAL_ORDER_ALERT",
            "display": "Financial Order Alert?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Financial Orders].[Alert Code]);0;\"Yes\")"
          },
          {
            "name": "$ref:V_CONFISCATION_OUTCOME",
            "display": "Confiscation Outcome?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([Financial Orders].[Court Case Outcome] InList (\"Confiscation\";\"Forfeiture/Confiscation\");\"Yes\")"
          },
          {
            "name": "$ref:V_NO_OF_PROVEN_ADJUDICATIONS",
            "display": "Proven Adj.",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Count([OIC Incident ID]) In ([NOMS Number])"
          },
          {
            "name": "$ref:V_REHAB_PROVIDER",
            "display": "Provider",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Rehab Provider Code]+\" - \"+[Rehab Provider Description]"
          },
          {
            "name": "$ref:V_PRIMARY_ADDRESS_COUNTRY",
            "display": "Primary Address Country",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Offender Address Address Country Desc]"
          }
        ]
      }
    },
    {
      "id": "106666.RS",
      "name": "Legal Status Codes",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DP2",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:MAIN_LEGAL_STATUS_CODE",
            "display": "Main Legal Status Code",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO100de"
          },
          {
            "name": "$ref:MAIN_LEGAL_STATUS_DESCRIPTION",
            "display": "Main Legal Status Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO100df"
          },
          {
            "name": "$ref:LEGAL_STATUS_GROUPING",
            "display": "Legal Status Grouping",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP2.DO107cb"
          }
        ]
      }
    },
    {
      "id": "214110.RS",
      "name": "Report 6",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DPc",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPc.DO10076"
          },
          {
            "name": "$ref:BIRTH_COUNTRY",
            "display": "Birth Country",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DPc.DO10088"
          },
          {
            "name": "$ref:V_MAX_CONCAT_FULL_ALIAS",
            "display": "=NameOf([v_max_concat_full_alias])",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[v_concat_full_alias]Where ([v_Full_Alias]= [v_max_full_alias]) In ([NOMS Number])"
          },
          {
            "name": "$ref:BIRTH_PLACE",
            "display": "Birth Place",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPc.DO10086"
          }
        ]
      }
    },
    {
      "id": "214114.RS",
      "name": "Report 7",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      },
      "dataset": "MISSING"
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_MAIN_OFFENCE :: ReferenceError: error is not defined",
      "entityId": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_REHAB_PROVIDER :: ReferenceError: error is not defined",
      "entityId": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_MAX_CONCAT_FULL_ALIAS :: Error: =[v_concat_full_alias]Where ([v_Full_Alias]= [v_max_full_alias]) In ([NOMS Number]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:66",
      "entityId": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : V_NO_OF_PROVEN_ADJUDICATIONS :: Error: Invalid expression / Unexpected token. Line 1, Col: 27.\n  COUNT(OIC_INCIDENT_ID) IN \u001b[4m,\u001b[0mOFFENDER_ID_DISPLAY,",
      "entityId": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : V_MIN_SENTENCE_START_DATE :: Error: Invalid expression / Unexpected token. Line 1, Col: 35.\n  MIN(V_DIM_SENTENCE_START_DATE) IN \u001b[4m,\u001b[0mACTIVE_SENTENCES.OFFENDER_ID_DISPLAY,",
      "entityId": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_MAIN_OFFENCE :: ReferenceError: error is not defined",
      "entityId": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : V_CONFISCATION_OUTCOME :: Error: argument 'sql': 'NoneType' object cannot be converted to 'PyString'",
      "entityId": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_REHAB_PROVIDER :: ReferenceError: error is not defined",
      "entityId": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_MAX_CONCAT_FULL_ALIAS :: Error: =[v_concat_full_alias]Where ([v_Full_Alias]= [v_max_full_alias]) In ([NOMS Number]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:66",
      "entityId": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::fixSqlFormatting sql is not valid [Expecting ). Line 1, Col: 1546.\n  ESS_USAGES.address_id_nk = AT_DIM_ADDRESSES.address_id_nk and AT_DIM_ADDRESSES.owner_class='OFF'  ) \u001b[4mAddr_usages\u001b[0m --where Addr_usages.usages_dttm is not null ) ss ) DT_OFFENDER_ADDRESSES, BODISTAGING.REF_OFFENDERS]",
      "entityId": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_MAX_CONCAT_FULL_ALIAS :: Error: =[v_concat_full_alias]Where ([v_Full_Alias]= [v_max_full_alias]) In ([NOMS Number]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:66",
      "entityId": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_MAX_CONCAT_FULL_ALIAS :: Error: =[v_concat_full_alias]Where ([v_Full_Alias]= [v_max_full_alias]) In ([NOMS Number]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:66",
      "entityId": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "instance.report[6] requires property \"dataset\"",
      "entityId": "FvALHgHvXQMAsyYAAABHiTj.ACJIAGc1",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Report field V_NO_OF_PROVEN_ADJUDICATIONS does not have corresponding dataset schema field",
      "entityId": "105046.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_MIN_SENTENCE_START_DATE does not have corresponding dataset schema field",
      "entityId": "105046.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_NO_OF_PROVEN_ADJUDICATIONS does not have corresponding dataset schema field",
      "entityId": "106562.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CONFISCATION_OUTCOME does not have corresponding dataset schema field",
      "entityId": "106784.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_NO_OF_PROVEN_ADJUDICATIONS does not have corresponding dataset schema field",
      "entityId": "106784.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_MIN_SENTENCE_START_DATE does not have corresponding dataset schema field",
      "entityId": "106784.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_CONFISCATION_OUTCOME does not have corresponding dataset schema field",
      "entityId": "213416.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_NO_OF_PROVEN_ADJUDICATIONS does not have corresponding dataset schema field",
      "entityId": "213416.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report Variant 214114.RS does not have corresponding dataset undefined",
      "entityId": "214114.RS",
      "entityType": "variant"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DP2",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DP6",
      "entityType": "dataset"
    },
    {
      "type": "athenQuery",
      "error": "unable to generate test sql",
      "entityId": "3375368/DPa",
      "entityType": "dataset"
    }
  ]
}