{
  "id": "okXi1joACPMrQ5AAOwGD8LAV8Ys",
  "name": "ORS NOMIS Role Amendment Report",
  "description": "CAD0003 v00.00.02  This report lists the assignment/de-assignment of NOMIS modules to and from roles (e.g. reception officer, property officer) which occurred during a default period of 7 days before the current date. The end user can change the default period at runtime.",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "CAD0003 v00.00.02 drop9.9"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3375624/DP0",
      "name": "Role Amendment",
      "description": "C-NOMIS Audit",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AUDITREF.OMS_ROLES.ROLE_NAME, TRUNC(AUDITDATA.AUDIT_TABLE.AUDIT_TIMESTAMP) AS AT_DATE_OF_CHANGE_, TO_CHAR(AUDITDATA.AUDIT_TABLE.AUDIT_TIMESTAMP, 'HH24:MI:SS') AS AT_TIME_OF_CHANGE_, AUDITREF.OMS_MODULES.DESCRIPTION, AUDITREF.OMS_MODULES.MODULE_TYPE, AUDITREF.OMS_MODULES.MODULE_NAME, CASE WHEN AUDITDATA.AUDIT_TABLE.LCR_COMMAND_TYPE = 'INSERT' THEN 'Assigned' WHEN AUDITDATA.AUDIT_TABLE.LCR_COMMAND_TYPE = 'DELETE' THEN 'De-assigned' ELSE 'Changed' END AS AT_ASSIGNMENT_DE_ASSIGNMENT_37, AUDITREF.STAFF_MEMBERS.LAST_NAME, AUDITREF.STAFF_MEMBERS.FIRST_NAME, COALESCE(AUDITREF.STAFF_USER_ACCOUNTS.USERNAME, 'N/A') AS NOMIS_USER_ACCOUNT_NAME, COALESCE(AUDITREF.STAFF_USER_ACCOUNTS.STAFF_USER_TYPE, 'N/A') AS NOMIS_USER_ACCOUNT_TYPE, AUDITREF.STAFF_USER_ACCOUNTS.WORKING_CASELOAD_ID FROM AUDITDATA.AUDIT_TABLE, AUDITREF.STAFF_MEMBERS, AUDITREF.STAFF_USER_ACCOUNTS, AUDITREF.OMS_MODULES, AUDITREF.OMS_ROLES, AUDITDATA.AUDIT_COLUMN AUDIT_COLUMN_ROLE_ID, AUDITDATA.AUDIT_COLUMN AUDIT_COLUMN_MODULES WHERE (AUDITREF.STAFF_USER_ACCOUNTS.STAFF_ID = AUDITREF.STAFF_MEMBERS.STAFF_ID) AND (AUDITREF.STAFF_USER_ACCOUNTS.USERNAME = AUDITDATA.AUDIT_TABLE.AUDIT_USER_ID) AND (AUDIT_COLUMN_ROLE_ID.LCR_COLUMN_NAME = 'role_id') AND (AUDIT_COLUMN_ROLE_ID.AUDIT_TABLE_SEQ = AUDITDATA.AUDIT_TABLE.AUDIT_TABLE_SEQ AND AUDIT_COLUMN_ROLE_ID.LCR_SOURCE_TIME = AUDITDATA.AUDIT_TABLE.LCR_SOURCE_TIME AND AUDIT_COLUMN_ROLE_ID.LCR_COLUMN_OLD_NEW_IND = CASE WHEN AUDITDATA.AUDIT_TABLE.LCR_COMMAND_TYPE = 'INSERT' THEN 1 ELSE 0 END) AND (auditdata.GETNUMBER(AUDIT_COLUMN_ROLE_ID.LCR_COLUMN_VALUE) = AUDITREF.OMS_ROLES.ROLE_ID) AND (AUDIT_COLUMN_MODULES.LCR_COLUMN_NAME = 'module_name') AND (AUDIT_COLUMN_MODULES.AUDIT_TABLE_SEQ = AUDIT_COLUMN_ROLE_ID.AUDIT_TABLE_SEQ AND AUDIT_COLUMN_MODULES.LCR_SOURCE_TIME = AUDIT_COLUMN_ROLE_ID.LCR_SOURCE_TIME AND AUDIT_COLUMN_MODULES.LCR_COLUMN_OLD_NEW_IND = AUDIT_COLUMN_ROLE_ID.LCR_COLUMN_OLD_NEW_IND) AND (auditdata.GETSTRING(AUDIT_COLUMN_MODULES.LCR_COLUMN_VALUE) = AUDITREF.OMS_MODULES.MODULE_NAME) AND ((TRUNC(AUDITDATA.AUDIT_TABLE.AUDIT_TIMESTAMP) >= TRUNC(CURRENT_TIMESTAMP - 2)) AND (AUDITDATA.AUDIT_TABLE.LCR_OBJECT_NAME = 'MODULE_PRIVILEGES'))), dataset_ AS (SELECT ROLE_NAME, AT_DATE_OF_CHANGE_, AT_TIME_OF_CHANGE_, DESCRIPTION, MODULE_TYPE, MODULE_NAME, AT_ASSIGNMENT_DE_ASSIGNMENT_37, LAST_NAME, FIRST_NAME, NOMIS_USER_ACCOUNT_NAME, NOMIS_USER_ACCOUNT_TYPE, WORKING_CASELOAD_ID, SUBSTR(AT_TIME_OF_CHANGE_, 1, 5) AS V_AT_TIME_OF_CHANGE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "ROLE_NAME",
            "type": "string",
            "display": "AT Role Name",
            "legacyId": "DP0.DO161",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "AT_DATE_OF_CHANGE_",
            "type": "date",
            "display": "AT Date of Change (DD/MM/YYYY)",
            "legacyId": "DP0.DO15f",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "AT_TIME_OF_CHANGE_",
            "type": "string",
            "display": "AT Time of Change (HH24:MI:SS)",
            "legacyId": "DP0.DO160",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "AT NOMIS Module Description",
            "legacyId": "DP0.DO162",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "MODULE_TYPE",
            "type": "string",
            "display": "AT NOMIS Module Type",
            "legacyId": "DP0.DO163",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "MODULE_NAME",
            "type": "string",
            "display": "AT NOMIS Module Name",
            "legacyId": "DP0.DO164",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "AT_ASSIGNMENT_DE_ASSIGNMENT_37",
            "type": "string",
            "display": "AT Assignment De-Assignment Indicator",
            "legacyId": "DP0.DO165",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "LAST_NAME",
            "type": "string",
            "display": "NOMIS User Last Name",
            "legacyId": "DP0.DO130",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "NOMIS User First Name",
            "legacyId": "DP0.DO132",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "NOMIS_USER_ACCOUNT_NAME",
            "type": "string",
            "display": "NOMIS User Account Name",
            "legacyId": "DP0.DO133",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "NOMIS_USER_ACCOUNT_TYPE",
            "type": "string",
            "display": "NOMIS User Account Type",
            "legacyId": "DP0.DO134",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "WORKING_CASELOAD_ID",
            "type": "string",
            "display": "NOMIS User Working Caseload",
            "legacyId": "DP0.DO135",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "V_AT_TIME_OF_CHANGE",
            "type": "string",
            "display": "V_AT_TIME_OF_CHANGE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "136290.RS",
      "name": "NOMIS Role Amendment",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375624/DP0",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:ROLE_NAME",
            "display": "AT Role Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO161"
          },
          {
            "name": "$ref:AT_DATE_OF_CHANGE_",
            "display": "AT Date of Change (DD/MM/YYYY)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO15f"
          },
          {
            "name": "$ref:V_AT_TIME_OF_CHANGE",
            "display": "Time of Change to Role",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Left([AT Time of Change (HH24:MI:SS)];5)"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "AT NOMIS Module Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO162"
          },
          {
            "name": "$ref:MODULE_TYPE",
            "display": "AT NOMIS Module Type",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO163"
          },
          {
            "name": "$ref:MODULE_NAME",
            "display": "AT NOMIS Module Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO164"
          },
          {
            "name": "$ref:AT_ASSIGNMENT_DE_ASSIGNMENT_37",
            "display": "AT Assignment De-Assignment Indicator",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO165"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "NOMIS User Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO130"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "NOMIS User First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO132"
          },
          {
            "name": "$ref:NOMIS_USER_ACCOUNT_NAME",
            "display": "NOMIS User Account Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO133"
          },
          {
            "name": "$ref:NOMIS_USER_ACCOUNT_TYPE",
            "display": "NOMIS User Account Type",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO134"
          },
          {
            "name": "$ref:WORKING_CASELOAD_ID",
            "display": "NOMIS User Working Caseload",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO135"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "sqlQuery",
      "error": "Error: ORA-00942: table or view does not exist\nHelp: https://docs.oracle.com/error-help/db/ora-00942/",
      "entityId": "3375624/DP0",
      "entityType": "dataset"
    }
  ]
}