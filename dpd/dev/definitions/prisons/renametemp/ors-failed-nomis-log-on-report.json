{
  "id": "okXi1joAA9IUQ5AASgGD8LAV8Ys",
  "name": "ORS Failed NOMIS Log On Report",
  "description": "This report lists NOMIS application logon failures which occurred during a default period of the last 7 days. The end user can change the default period at runtime.<br/>CAD0001 - v00.00.05",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "CAD0001 v00.00.05 Drop9.8.1"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3375624/DP0",
      "name": "Failed Logon",
      "description": "C-NOMIS Audit",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AUDITREF.STAFF_MEMBERS.LAST_NAME, AUDITREF.STAFF_MEMBERS.FIRST_NAME, COALESCE(AUDITREF.STAFF_USER_ACCOUNTS.USERNAME, 'N/A') AS NOMIS_USER_ACCOUNT_NAME, COALESCE(AUDITREF.STAFF_USER_ACCOUNTS.STAFF_USER_TYPE, 'N/A') AS NOMIS_USER_ACCOUNT_TYPE, AUDITREF.STAFF_USER_ACCOUNTS.WORKING_CASELOAD_ID, TRUNC(AUDITDATA.REMOTE_AUDIT_TRAIL.TIMESTAMP) AS DATE_OF_ACTION_, TO_CHAR(AUDITDATA.REMOTE_AUDIT_TRAIL.TIMESTAMP, 'HH24:MI:SS') AS TIME_OF_ACTION_, CASE TO_CHAR(AUDITDATA.REMOTE_AUDIT_TRAIL.RETURNCODE) WHEN '1017' THEN 'Invalid username/password' WHEN '1045' THEN 'Create Session privilege not granted to user' WHEN '2002' THEN 'Error while writing to audit trail' WHEN '28000' THEN 'Failed due to repeated logon attempts' WHEN '28001' THEN 'Password expired' WHEN '28003' THEN 'Violation of new password policy' WHEN '28007' THEN 'Violation of password reuse policy' ELSE 'Other event type: ' || TO_CHAR(remote_audit_trail.returncode) END AS ACTION_LOGIN_FAILURE_REASON FROM AUDITDATA.REMOTE_AUDIT_TRAIL, AUDITREF.STAFF_MEMBERS, AUDITREF.STAFF_USER_ACCOUNTS WHERE (AUDITREF.STAFF_USER_ACCOUNTS.STAFF_ID = AUDITREF.STAFF_MEMBERS.STAFF_ID) AND (AUDITDATA.REMOTE_AUDIT_TRAIL.USERNAME = AUDITREF.STAFF_USER_ACCOUNTS.USERNAME) AND ((TRUNC(AUDITDATA.REMOTE_AUDIT_TRAIL.TIMESTAMP) >= TRUNC(CURRENT_TIMESTAMP - 70)) AND (AUDITDATA.REMOTE_AUDIT_TRAIL.REMOTE_DB = 'CNOMIS') AND (AUDITDATA.REMOTE_AUDIT_TRAIL.RETURNCODE <> 0) AND (AUDITDATA.REMOTE_AUDIT_TRAIL.ACTION = 100) AND COALESCE(AUDITREF.STAFF_USER_ACCOUNTS.USERNAME, 'N/A') <> 'DBSNMP') UNION SELECT '', '', COALESCE(AUDITDATA.REMOTE_AUDIT_TRAIL.USERNAME, 'N/A') AS NOMIS_USER_ACCOUNT_NAME, '' AS NOMIS_USER_ACCOUNT_TYPE, '', TRUNC(AUDITDATA.REMOTE_AUDIT_TRAIL.TIMESTAMP) AS DATE_OF_ACTION_, TO_CHAR(AUDITDATA.REMOTE_AUDIT_TRAIL.TIMESTAMP, 'HH24:MI:SS') AS TIME_OF_ACTION_, CASE TO_CHAR(AUDITDATA.REMOTE_AUDIT_TRAIL.RETURNCODE) WHEN '1017' THEN 'Invalid username/password' WHEN '1045' THEN 'Create Session privilege not granted to user' WHEN '2002' THEN 'Error while writing to audit trail' WHEN '28000' THEN 'Failed due to repeated logon attempts' WHEN '28001' THEN 'Password expired' WHEN '28003' THEN 'Violation of new password policy' WHEN '28007' THEN 'Violation of password reuse policy' ELSE 'Other event type: ' || TO_CHAR(remote_audit_trail.returncode) END AS ACTION_LOGIN_FAILURE_REASON FROM AUDITDATA.REMOTE_AUDIT_TRAIL WHERE ((TRUNC(AUDITDATA.REMOTE_AUDIT_TRAIL.TIMESTAMP) >= TRUNC(CURRENT_TIMESTAMP - 70)) AND (AUDITDATA.REMOTE_AUDIT_TRAIL.REMOTE_DB = 'CNOMIS') AND (AUDITDATA.REMOTE_AUDIT_TRAIL.RETURNCODE <> 0) AND (AUDITDATA.REMOTE_AUDIT_TRAIL.ACTION = 100) AND NOT COALESCE(AUDITDATA.REMOTE_AUDIT_TRAIL.USERNAME, 'N/A') IN (SELECT COALESCE(AUDITREF.STAFF_USER_ACCOUNTS.USERNAME, 'N/A') FROM AUDITDATA.REMOTE_AUDIT_TRAIL, AUDITREF.STAFF_USER_ACCOUNTS WHERE (AUDITDATA.REMOTE_AUDIT_TRAIL.USERNAME = AUDITREF.STAFF_USER_ACCOUNTS.USERNAME) AND (AUDITDATA.REMOTE_AUDIT_TRAIL.REMOTE_DB = 'CNOMIS')) AND COALESCE(AUDITDATA.REMOTE_AUDIT_TRAIL.USERNAME, 'N/A') <> 'DBSNMP')), dataset_ AS (SELECT LAST_NAME, FIRST_NAME, NOMIS_USER_ACCOUNT_NAME, NOMIS_USER_ACCOUNT_TYPE, WORKING_CASELOAD_ID, DATE_OF_ACTION_, TIME_OF_ACTION_, ACTION_LOGIN_FAILURE_REASON FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "LAST_NAME",
            "type": "string",
            "display": "NOMIS User Last Name",
            "legacyId": "DP0.DO130",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "NOMIS User First Name",
            "legacyId": "DP0.DO132",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "NOMIS_USER_ACCOUNT_NAME",
            "type": "string",
            "display": "NOMIS User Account Name",
            "legacyId": "DP0.DO133",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "NOMIS_USER_ACCOUNT_TYPE",
            "type": "string",
            "display": "NOMIS User Account Type",
            "legacyId": "DP0.DO134",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "WORKING_CASELOAD_ID",
            "type": "string",
            "display": "NOMIS User Working Caseload",
            "legacyId": "DP0.DO135",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "DATE_OF_ACTION_",
            "type": "date",
            "display": "Date of Action (DD/MM/YYYY)",
            "legacyId": "DP0.DO136",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "TIME_OF_ACTION_",
            "type": "string",
            "display": "Time of Action (HH24:MI:SS)",
            "legacyId": "DP0.DO137",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "ACTION_LOGIN_FAILURE_REASON",
            "type": "string",
            "display": "Action/Login Failure Reason",
            "legacyId": "DP0.DO139",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "137810.RS",
      "name": "Failed NOMIS Log on Report",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375624/DP0",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:LAST_NAME",
            "display": "NOMIS User Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO130"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "NOMIS User First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO132"
          },
          {
            "name": "$ref:NOMIS_USER_ACCOUNT_NAME",
            "display": "NOMIS User Account Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO133"
          },
          {
            "name": "$ref:NOMIS_USER_ACCOUNT_TYPE",
            "display": "NOMIS User Account Type",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO134"
          },
          {
            "name": "$ref:WORKING_CASELOAD_ID",
            "display": "NOMIS User Working Caseload",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO135"
          },
          {
            "name": "$ref:DATE_OF_ACTION_",
            "display": "Date of Action (DD/MM/YYYY)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO136"
          },
          {
            "name": "$ref:TIME_OF_ACTION_",
            "display": "Time of Action (HH24:MI:SS)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO137"
          },
          {
            "name": "$ref:ACTION_LOGIN_FAILURE_REASON",
            "display": "Action/Login Failure Reason",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO139"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "sqlQuery",
      "error": "Error: ORA-00942: table or view does not exist\nHelp: https://docs.oracle.com/error-help/db/ora-00942/",
      "entityId": "3375624/DP0",
      "entityType": "dataset"
    }
  ]
}