{
  "id": "Fh2yWl1fZQEAoe4AAHBbyV4QACJIAFJ8",
  "name": "MIS Current Prisoners without Key Work for a Date Range",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "PDD0112 v00.00.02 Key Workers"
    ]
  },
  "description": "The report displays those Prisoners that have not had a Key Worker Case Note entry between two dates entered at run time.  The report also has a second tab to display those that have, along with the member of staff that entered the case note<br/>PDD0112 v00.00.02 Last Modified: 11/03/2020",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3376639/DPb",
      "name": "KW Case Notes A-I",
      "description": "MIS Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.FIRST_NAME, CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END AS DATE_OF_BIRTH, AT_DIM_LOCATION.UNIT_4_SHORT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, AT_CASE_NOTE_SUB_TYPE.DESCRIPTION, AT_CASE_NOTE_STAFF_MEMBER.LAST_NAME || ', ' || AT_CASE_NOTE_STAFF_MEMBER.FIRST_NAME AS CASE_NOTE_CREATED_BY, AT_ESTABLISHMENT_OFF_CASE_NOTE.ESTABLISHMENT_DESCRIPTION, AT_FACT_OFFENDER_CASE_NOTE.CREATE_TIME FROM BODIMIS.DIM_DATE AT_CASE_NOTE_CONTACT_DATE, BODIMIS.DIM_REFERENCE_CODES AT_CASE_NOTE_SUB_TYPE, BODIMIS.DIM_REFERENCE_CODES AT_CASE_NOTE_TYPE, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.DIM_CELL AT_DIM_LOCATION, BODIMIS.DIM_STAFF_MEMBER AT_CASE_NOTE_STAFF_MEMBER, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_OFF_CASE_NOTE, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_DOB, BODIMIS.FACT_OFFENDER_CASE_NOTE AT_FACT_OFFENDER_CASE_NOTE WHERE (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_SK = AT_DIM_LOCATION.UNIT_4_SK (+)) AND (AT_CASE_NOTE_CONTACT_DATE.DATE_SK = AT_FACT_OFFENDER_CASE_NOTE.CONTACT_DATE_SK) AND (AT_CASE_NOTE_STAFF_MEMBER.STAFF_MEMBER_SK = AT_FACT_OFFENDER_CASE_NOTE.STAFF_MEMBER_SK) AND (AT_CASE_NOTE_TYPE.REFERENCE_CODE_SK = AT_FACT_OFFENDER_CASE_NOTE.CASE_NOTE_TYPE_CODE_SK) AND (AT_CASE_NOTE_SUB_TYPE.REFERENCE_CODE_SK = AT_FACT_OFFENDER_CASE_NOTE.CASE_NOTE_SUB_TYPE_CODE_SK) AND (AT_CASE_NOTE_TYPE.CODE_DOMAIN = 'TASK_TYPE') AND (AT_CASE_NOTE_SUB_TYPE.CODE_DOMAIN = 'TASK_SUBTYPE') AND (AT_FACT_OFFENDER_CASE_NOTE.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_ESTABLISHMENT_OFF_CASE_NOTE.ESTABLISHMENT_SK = AT_FACT_OFFENDER_CASE_NOTE.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_OFF_CASE_NOTE.ESTABLISHMENT_CODE_NK IN (SELECT SAC.CASELOAD_ID FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC WHERE SAC.USERNAME = (SELECT username FROM context_))) AND (AT_OFFENDER_BOOKING.SURNAME < 'J' AND (AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK = (SELECT establishment_code FROM prompt_)) AND AT_CASE_NOTE_CONTACT_DATE.DAY_DATE >= TO_DATE('01-01-2020 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_CASE_NOTE_CONTACT_DATE.DAY_DATE <= TO_DATE('15-01-2020 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_CASE_NOTE_TYPE.CODE = 'KA')), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, SURNAME, FIRST_NAME, DATE_OF_BIRTH, UNIT_4_SHORT_DESCRIPTION, MOVEMENT_TIME, DESCRIPTION, CASE_NOTE_CREATED_BY, ESTABLISHMENT_DESCRIPTION, CREATE_TIME FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPb.DO76",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DPb.DO7b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "Offender Given Name 1",
            "legacyId": "DPb.DO80",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "DATE_OF_BIRTH",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DPb.DO85",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "UNIT_4_SHORT_DESCRIPTION",
            "type": "string",
            "display": "Prisoner Location",
            "legacyId": "DPb.DOa7c",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DPb.DO7ce",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Case Note Sub Type Description",
            "legacyId": "DPb.DOaf6",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "CASE_NOTE_CREATED_BY",
            "type": "string",
            "display": "Case Note Created By",
            "legacyId": "DPb.DOa95",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Case Note Establishment Description",
            "legacyId": "DPb.DOb71",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CREATE_TIME",
            "type": "date",
            "display": "Case Note Create Date/Time",
            "legacyId": "DPb.DOa92",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP7",
      "name": "KW Case Notes J-S",
      "description": "MIS Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.FIRST_NAME, CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END AS DATE_OF_BIRTH, AT_DIM_LOCATION.UNIT_4_SHORT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, AT_CASE_NOTE_SUB_TYPE.DESCRIPTION, AT_CASE_NOTE_STAFF_MEMBER.LAST_NAME || ', ' || AT_CASE_NOTE_STAFF_MEMBER.FIRST_NAME AS CASE_NOTE_CREATED_BY, AT_ESTABLISHMENT_OFF_CASE_NOTE.ESTABLISHMENT_DESCRIPTION, AT_FACT_OFFENDER_CASE_NOTE.CREATE_TIME FROM BODIMIS.DIM_DATE AT_CASE_NOTE_CONTACT_DATE, BODIMIS.DIM_REFERENCE_CODES AT_CASE_NOTE_SUB_TYPE, BODIMIS.DIM_REFERENCE_CODES AT_CASE_NOTE_TYPE, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.DIM_CELL AT_DIM_LOCATION, BODIMIS.DIM_STAFF_MEMBER AT_CASE_NOTE_STAFF_MEMBER, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_OFF_CASE_NOTE, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_DOB, BODIMIS.FACT_OFFENDER_CASE_NOTE AT_FACT_OFFENDER_CASE_NOTE WHERE (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_SK = AT_DIM_LOCATION.UNIT_4_SK (+)) AND (AT_CASE_NOTE_CONTACT_DATE.DATE_SK = AT_FACT_OFFENDER_CASE_NOTE.CONTACT_DATE_SK) AND (AT_CASE_NOTE_STAFF_MEMBER.STAFF_MEMBER_SK = AT_FACT_OFFENDER_CASE_NOTE.STAFF_MEMBER_SK) AND (AT_CASE_NOTE_TYPE.REFERENCE_CODE_SK = AT_FACT_OFFENDER_CASE_NOTE.CASE_NOTE_TYPE_CODE_SK) AND (AT_CASE_NOTE_SUB_TYPE.REFERENCE_CODE_SK = AT_FACT_OFFENDER_CASE_NOTE.CASE_NOTE_SUB_TYPE_CODE_SK) AND (AT_CASE_NOTE_TYPE.CODE_DOMAIN = 'TASK_TYPE') AND (AT_CASE_NOTE_SUB_TYPE.CODE_DOMAIN = 'TASK_SUBTYPE') AND (AT_FACT_OFFENDER_CASE_NOTE.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_ESTABLISHMENT_OFF_CASE_NOTE.ESTABLISHMENT_SK = AT_FACT_OFFENDER_CASE_NOTE.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_OFF_CASE_NOTE.ESTABLISHMENT_CODE_NK IN (SELECT SAC.CASELOAD_ID FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC WHERE SAC.USERNAME = (SELECT username FROM context_))) AND (AT_OFFENDER_BOOKING.SURNAME BETWEEN 'J' AND 'S' AND (AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK = (SELECT establishment_code FROM prompt_)) AND AT_CASE_NOTE_CONTACT_DATE.DAY_DATE >= TO_DATE('01-01-2020 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_CASE_NOTE_CONTACT_DATE.DAY_DATE <= TO_DATE('15-01-2020 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_CASE_NOTE_TYPE.CODE = 'KA')), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, SURNAME, FIRST_NAME, DATE_OF_BIRTH, UNIT_4_SHORT_DESCRIPTION, MOVEMENT_TIME, DESCRIPTION, CASE_NOTE_CREATED_BY, ESTABLISHMENT_DESCRIPTION, CREATE_TIME FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP7.DO76",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP7.DO7b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "Offender Given Name 1",
            "legacyId": "DP7.DO80",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "DATE_OF_BIRTH",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DP7.DO85",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "UNIT_4_SHORT_DESCRIPTION",
            "type": "string",
            "display": "Prisoner Location",
            "legacyId": "DP7.DOa7c",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DP7.DO7ce",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Case Note Sub Type Description",
            "legacyId": "DP7.DOaf6",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "CASE_NOTE_CREATED_BY",
            "type": "string",
            "display": "Case Note Created By",
            "legacyId": "DP7.DOa95",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Case Note Establishment Description",
            "legacyId": "DP7.DOb71",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CREATE_TIME",
            "type": "date",
            "display": "Case Note Create Date/Time",
            "legacyId": "DP7.DOa92",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DPa",
      "name": "KW Case Notes S-Z",
      "description": "MIS Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.FIRST_NAME, CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END AS DATE_OF_BIRTH, AT_DIM_LOCATION.UNIT_4_SHORT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME, AT_CASE_NOTE_SUB_TYPE.DESCRIPTION, AT_CASE_NOTE_STAFF_MEMBER.LAST_NAME || ', ' || AT_CASE_NOTE_STAFF_MEMBER.FIRST_NAME AS CASE_NOTE_CREATED_BY, AT_ESTABLISHMENT_OFF_CASE_NOTE.ESTABLISHMENT_DESCRIPTION, AT_FACT_OFFENDER_CASE_NOTE.CREATE_TIME FROM BODIMIS.DIM_DATE AT_CASE_NOTE_CONTACT_DATE, BODIMIS.DIM_REFERENCE_CODES AT_CASE_NOTE_SUB_TYPE, BODIMIS.DIM_REFERENCE_CODES AT_CASE_NOTE_TYPE, (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.DIM_CELL AT_DIM_LOCATION, BODIMIS.DIM_STAFF_MEMBER AT_CASE_NOTE_STAFF_MEMBER, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_OFF_CASE_NOTE, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_DOB, BODIMIS.FACT_OFFENDER_CASE_NOTE AT_FACT_OFFENDER_CASE_NOTE WHERE (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_SK = AT_DIM_LOCATION.UNIT_4_SK (+)) AND (AT_CASE_NOTE_CONTACT_DATE.DATE_SK = AT_FACT_OFFENDER_CASE_NOTE.CONTACT_DATE_SK) AND (AT_CASE_NOTE_STAFF_MEMBER.STAFF_MEMBER_SK = AT_FACT_OFFENDER_CASE_NOTE.STAFF_MEMBER_SK) AND (AT_CASE_NOTE_TYPE.REFERENCE_CODE_SK = AT_FACT_OFFENDER_CASE_NOTE.CASE_NOTE_TYPE_CODE_SK) AND (AT_CASE_NOTE_SUB_TYPE.REFERENCE_CODE_SK = AT_FACT_OFFENDER_CASE_NOTE.CASE_NOTE_SUB_TYPE_CODE_SK) AND (AT_CASE_NOTE_TYPE.CODE_DOMAIN = 'TASK_TYPE') AND (AT_CASE_NOTE_SUB_TYPE.CODE_DOMAIN = 'TASK_SUBTYPE') AND (AT_FACT_OFFENDER_CASE_NOTE.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_ESTABLISHMENT_OFF_CASE_NOTE.ESTABLISHMENT_SK = AT_FACT_OFFENDER_CASE_NOTE.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_OFF_CASE_NOTE.ESTABLISHMENT_CODE_NK IN (SELECT SAC.CASELOAD_ID FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC WHERE SAC.USERNAME = (SELECT username FROM context_))) AND (AT_OFFENDER_BOOKING.SURNAME > 'S' AND (AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK = (SELECT establishment_code FROM prompt_)) AND AT_CASE_NOTE_CONTACT_DATE.DAY_DATE >= TO_DATE('01-01-2020 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_CASE_NOTE_CONTACT_DATE.DAY_DATE <= TO_DATE('15-01-2020 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_CASE_NOTE_TYPE.CODE = 'KA')), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, SURNAME, FIRST_NAME, DATE_OF_BIRTH, UNIT_4_SHORT_DESCRIPTION, MOVEMENT_TIME, DESCRIPTION, CASE_NOTE_CREATED_BY, ESTABLISHMENT_DESCRIPTION, CREATE_TIME FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPa.DO76",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DPa.DO7b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "Offender Given Name 1",
            "legacyId": "DPa.DO80",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "DATE_OF_BIRTH",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DPa.DO85",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "UNIT_4_SHORT_DESCRIPTION",
            "type": "string",
            "display": "Prisoner Location",
            "legacyId": "DPa.DOa7c",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DPa.DO7ce",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Case Note Sub Type Description",
            "legacyId": "DPa.DOaf6",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "CASE_NOTE_CREATED_BY",
            "type": "string",
            "display": "Case Note Created By",
            "legacyId": "DPa.DOa95",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Case Note Establishment Description",
            "legacyId": "DPa.DOb71",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CREATE_TIME",
            "type": "date",
            "display": "Case Note Create Date/Time",
            "legacyId": "DPa.DOa92",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP9",
      "name": "No KW Case Notes",
      "description": "MIS Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.FIRST_NAME, CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END AS DATE_OF_BIRTH, AT_DIM_LOCATION.UNIT_4_SHORT_DESCRIPTION, DT_ADMISSION.MOVEMENT_TIME FROM (SELECT ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, MAX(fme.MOVEMENT_SEQ) AS MOVEMENT_SEQ, MAX(d.day_date) AS MOVEMENT_TIME, TRUNC(ETL.LOAD_END_DATETIME) AS LOAD_DATE FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme, BODIMIS.DIM_OFFENDER_BOOKING ob, BODIMIS.DIM_ESTABLISHMENT est, BODIMIS.ETL_LOAD_LOG ETL, BODIMIS.DIM_DATE d WHERE ob.ESTABLISHMENT_SK = est.ESTABLISHMENT_SK AND d.date_sk = fme.date_sk AND fme.offender_booking_sk = ob.offender_booking_sk AND ob.active_status IN ('Active In', 'Active Out') AND ob.MIS_CURRENT_RECORD_IND = 'Y' AND ob.ACTIVE_FLAG = 'Y' AND ETL.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL) AND ob.ESTABLISHMENT_SK = fme.to_location_sk AND fme.movement_seq = (SELECT MAX(fme2.movement_seq) FROM BODIMIS.FACT_MOVEMENT_EXTERNAL fme2 WHERE fme.offender_booking_sk = fme2.offender_booking_sk AND fme2.direction_code = 'IN' AND fme2.TYPE = 'Admission' AND fme2.To_location_type = 'Establishment' AND fme2.reason_code <> 'R') GROUP BY ob.offender_id_display, fme.offender_booking_sk, est.establishment_code_nk, fme.to_location_sk, fme.from_location_sk, fme.from_location_type, ETL.LOAD_END_DATETIME) DT_ADMISSION, BODIMIS.DIM_CELL AT_DIM_LOCATION, BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT_TAP, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_DOB WHERE (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_BOOKING.ESTABLISHMENT_SK = AT_ESTABLISHMENT_TAP.ESTABLISHMENT_SK) AND (AT_ESTABLISHMENT_TAP.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_ADMISSION.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_SK = AT_DIM_LOCATION.UNIT_4_SK (+)) AND ((AT_ESTABLISHMENT_TAP.ESTABLISHMENT_CODE_NK = (SELECT establishment_code FROM prompt_)) AND (NOT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A3925EC', 'A5723ED', 'A2143EL', 'A2923DZ', 'A2132DX', 'A4786DY', 'A8665DF', 'A8142EG', 'A3175AR', 'A1400DT', 'A1958EF', 'A5792DJ', 'A2567DN', 'A4214EJ', 'A5331CD', 'A7175DX', 'A8822EA', 'A9691AM', 'A3765AA', 'A6992EJ', 'A3924EK', 'A6647EH', 'A8570DZ', 'A9082EA', 'A8120EC', 'A7749AG', 'A0762DT', 'A7284DZ', 'A4586DJ', 'A7583EH', 'A9511AN', 'A5275EE', 'A0795EH', 'A8156AR', 'A2796EE', 'A5586AP', 'A8537EF', 'A6464DT', 'A4059DY', 'A7058AP', 'A9526CR', 'A2237DY', 'A8420CJ', 'A8874CT', 'A9960AA', 'A9770DW', 'A1877EC', 'A7795AF', 'A3501DR', 'A5190EG', 'A0317DV', 'A6455DJ', 'A2942AA', 'A4387EF', 'A7982EJ', 'A2541AA', 'A8154DV', 'A8169EC', 'A2196CR', 'A3157ED', 'A8323EC', 'A4886AD', 'A2049EL', 'A7328EJ', 'A8925AE', 'A8484EG', 'A1059CT', 'A2169EK', 'A9260DE', 'A7782AG', 'A2879AZ', 'A6442DM', 'A6510CE', 'A3413AM', 'A2395DZ', 'A0116DX', 'A6415DL', 'A4388DX', 'A9634DZ', 'A9179DX', 'A5860DK', 'A3681AL', 'A2896AR', 'A6689EJ', 'A9359EC', 'A6915AW', 'A0938EH', 'A1697AV', 'A9398AG', 'A8357CX', 'A2099DX', 'A7594EF', 'A0183EK', 'A4747CW', 'A1678DT', 'A3983EG', 'A3514AL', 'A2171DZ', 'A5103EK', 'A6145CR', 'A9648EE', 'A0044DW', 'A0841EA', 'A9843DZ', 'A5533EC', 'A7358DN', 'A9012DX', 'A8674DT', 'A3053EK', 'A2100EG', 'A8693EA', 'A9559DX', 'A0067EL', 'A8322DC', 'A1627AA', 'A1676DX', 'A8221EC', 'A2010AP', 'A5210DX', 'A8026DT', 'A9171AC', 'A3523EG', 'A1837DW', 'A4380CR', 'A9822DW', 'A3411CC', 'A8017DW', 'A9261AM', 'A8279EK', 'A9613AJ', 'A0859AA', 'A0732EF', 'A3275CC', 'A2379AA', 'A0855EC', 'A0317DW', 'A1390AA', 'A0006EF', 'A1772DY', 'A4067CV', 'A4075EF', 'A1235EK', 'A0267EG', 'A9103AD', 'A7962DV', 'A2247CY', 'A3643CF', 'A4406EH', 'A3592EE', 'A8212DM', 'A9906CQ', 'A1198AA', 'A6618DP', 'A5372AA', 'A3673DL', 'A8373DY', 'A6436EC', 'A3755CX', 'A4623AA', 'A7988EF', 'A8042CZ', 'A5496DL', 'A4155DM', 'A7989ED', 'A1196EF', 'A4278EH', 'A8548EG', 'A8669DZ', 'A4893AN', 'A0406DF', 'A3656AD', 'A7270AL', 'A8449AL', 'A9892AW', 'A3228CX', 'A9432ED', 'A8541EC', 'A9207EC', 'A2047AT', 'A8036DH', 'A7477EF', 'A8700CQ', 'A0998DL', 'A8356EH', 'A3696EJ', 'A4240DZ', 'A0722EK', 'A5431DY', 'A2368DZ', 'A2734DZ', 'A7326AR', 'A8659DV', 'A5650EC', 'A2608EG', 'A3870DP', 'A1491DD', 'A8805EG', 'A7198DR', 'A5318AN', 'A7278EG', 'A4319CC', 'A9847ED', 'A4434AA', 'A6262EJ', 'A9454DP', 'A4000CW', 'A2359CW', 'A1312CM', 'A0685DY', 'A1304EG', 'A1609EE', 'A9510ED', 'A9251EC', 'A9522EE', 'A3914DQ', 'A9853ED', 'A3279EE', 'A4659CV', 'A1793DL', 'A3896AQ', 'A9642DW', 'A1873EF', 'A4261CY', 'A9918CN', 'A7002CG', 'A9501AK', 'A2914DT', 'A4894EA', 'A9955CH', 'A2733DY', 'A5300DE', 'A4326DQ', 'A0989EH', 'A1048DZ', 'A6580DL', 'A5981DE', 'A3527CP', 'A4578EE', 'A3506EK', 'A4600EG', 'A4307DQ', 'A8108CR', 'A9037EK', 'A3354AV', 'A5054AE', 'A5949AG', 'A5253EH', 'A2579CW', 'A4604AV', 'A5392CX', 'A1453AD', 'A8530AN', 'A6737EE', 'A9091EC', 'A5567EC', 'A5248DH', 'A1820EJ', 'A6869AP', 'A7978EJ', 'A1551EF', 'A2048EK', 'A4197DZ', 'A2974DN', 'A2822DZ', 'A2128DX', 'A6060DV', 'A9133DQ', 'A6543CT', 'A4167CA', 'A4003CA', 'A9908EJ', 'A4283EH', 'A9184EC', 'A2178DR', 'A7833DX', 'A7798DL', 'A2153DW', 'A4035EE', 'A5575DR', 'A0499EH', 'A4438AA', 'A0874AV', 'A7501DP', 'A8528CC', 'A3868ED', 'A2600CL', 'A2359DK', 'A0707DG', 'A6609EF', 'A6841AA', 'A9371DZ', 'A3147DW', 'A5043EA', 'A6934DT', 'A8554EF', 'A2405AA', 'A4582EG', 'A3282CN', 'A1061EH', 'A8621AP', 'A2463DW', 'A3342CN', 'A2335DY', 'A0943EC', 'A2438DZ', 'A3804DL', 'A6435EA', 'A8727EF', 'A2741EA', 'A2835CK', 'A9747DZ', 'A2636DF', 'A3006EE', 'A0706AA', 'A5196EK', 'A8931DW', 'A4133ED', 'A6689EA', 'A9269EE', 'A5045AA', 'A4067EH', 'A9278EK', 'A8604ED', 'A1554EF', 'A7715EF', 'A1244EF', 'A5708EE', 'A7716AL', 'A3350EJ', 'A4450CT', 'A8590EJ', 'A7447EF', 'A5666EE', 'A2725EL', 'A8025EC', 'A4779DY', 'A1324AA', 'A0608EH', 'A8071EC', 'A5749DY', 'A9852EE', 'A5804EJ', 'A4481CX', 'A4527EL', 'A8618EJ', 'A8967DF', 'A8406EH', 'A9438CA', 'A9338EJ', 'A3536EJ', 'A4240EF', 'A0027EL') AND NOT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A7705EH', 'A6678CL', 'A0638DW', 'A7395DJ', 'A5487EC', 'A4479CJ', 'A0017DK', 'A9014EA', 'A6569EG', 'A0269EK', 'A8245EJ', 'A9531EJ', 'A2696EH', 'A1934ED', 'A4886EH', 'A9186EH', 'A5186DV', 'A1807AQ', 'A8618DZ', 'A7645EG', 'A8062DJ', 'A2071DP', 'A5695CY', 'A5588EF', 'A6196EA', 'A6223ED', 'A9718DR', 'A5512AA', 'A3126AQ', 'A2780CE', 'A9278AC', 'A7746CX', 'A7702EH', 'A1274DR', 'A7491EJ', 'A0988AP', 'A9942EJ', 'A0218DN', 'A4401EA', 'A0918AA', 'A5076EL', 'A3804DY', 'A6096EK', 'A8127ED', 'A2154DX', 'A7184EG', 'A0148DR', 'A6615EH', 'A3638EE', 'A0961CR', 'A4416AJ', 'A1752AZ', 'A5672AF', 'A7042EC', 'A1003DC', 'A6256EE', 'A8611ED', 'A3946DY', 'A4787DM', 'A1822EE', 'A5820DQ', 'A6578EH', 'A9883DX', 'A3780DL', 'A5469ED', 'A8322AA', 'A0562ED', 'A9042CT', 'A8761CH', 'A0674CH', 'A5328DX', 'A8255DV', 'A9684DZ', 'A8405EJ', 'A3868AA', 'A6258AC', 'A3610EK', 'A1097AA', 'A4862DY', 'A8616DZ', 'A3450EA', 'A0415DQ', 'A2568EC', 'A9175EF', 'A4279EE', 'A6361DZ', 'A9139EA', 'A8846EE', 'A3799EF', 'A2877EL', 'A5289AE', 'A8617EJ', 'A6375CF', 'A2783DX', 'A1804DC', 'A7590CC', 'A7320DY', 'A0308EG', 'A4643DQ', 'A1634EH', 'A4780DZ', 'A4957CP', 'A7445DF', 'A9794EC', 'A7589EF', 'A2912DE', 'A8082DY', 'A7815DQ', 'A5224EE', 'A8237DL', 'A1673EG', 'A1099EA', 'A6509EF', 'A7804CW', 'A5649AZ', 'A1120DR', 'A7787AN', 'A2699EH', 'A2108AF', 'A6149AZ', 'A0441DW', 'A7731DE', 'A0819AA', 'A2938EK', 'A5293CM', 'A2174CT', 'A3698DE', 'A7145EJ', 'A4529AE', 'A5216EA', 'A5508AN', 'A0056DC', 'A0608EF', 'A0188DY', 'A6358EK', 'A8703EF', 'A5503DP', 'A6889EG', 'A1762DG', 'A3755EL', 'A9535EF', 'A5243EF', 'A1281DX', 'A2366ED', 'A1091AC', 'A4833DP', 'A9579DP', 'A3758DL', 'A8741DQ', 'A9518CM', 'A9537AA', 'A8659EG', 'A6259DW', 'A1907ED', 'A9100DY', 'A7171EE', 'A0746AA', 'A1410DJ', 'A1357AQ', 'A1369EG', 'A8589AH', 'A9436EC', 'A2371AA', 'A3928DW', 'A9646EE', 'A2081CW', 'A2291DQ', 'A5575DZ', 'A0909EG', 'A2984ED', 'A9231EH', 'A9232EE', 'A6883DQ', 'A6935DY', 'A8390DZ', 'A8009AN', 'A3676DT', 'A9077EF', 'A2168DA', 'A8583DW', 'A2465CJ', 'A2873AF', 'A8133AC', 'A1448DZ', 'A8489EF', 'A1445EE', 'A3592CY', 'A0748AA', 'A1098DL', 'A8978DW', 'A5401DD', 'A5221AW', 'A7298AN', 'A5630DH', 'A5813EG', 'A1521AA', 'A6701EC', 'A6579DM', 'A6832CW', 'A7118AX', 'A9786EE', 'A8270EJ', 'A9072DP', 'A2989EK', 'A7398EG', 'A9156EH', 'A5220DQ', 'A0056EE', 'A3328DP', 'A3153DP', 'A7901DX', 'A8505EF', 'A4302AA', 'A1272AP', 'A6078AA', 'A4446DK', 'A8992ED', 'A0118EL', 'A4513DJ', 'A6528EC', 'A3632AE', 'A9093DY', 'A0597EJ', 'A4505AW', 'A0963AQ', 'A0850AG', 'A7787EC', 'A3674CN', 'A8515AF', 'A5786CA', 'A5376EK', 'A4031DA', 'A5996EJ', 'A0837AA', 'A1195EF', 'A7961EE', 'A3411CR', 'A3142AK', 'A4647CL', 'A2676EG', 'A1667EF', 'A0161ED', 'A9258DT', 'A0017AH', 'A9065AV', 'A9329DF', 'A8243EH', 'A2612AY', 'A2352CH', 'A6243EE', 'A6801EK', 'A2545CR') AND NOT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY IN ('A4780CT', 'A6866EC', 'A2954AY', 'A8704DW', 'A7861DD', 'A9961DN', 'A4094EK', 'A0838DY', 'A0223CE', 'A1511EK', 'A8441DP', 'A6546EF', 'A1100EC', 'A7127AG', 'A1955DC', 'A3432DN', 'A5973DP', 'A3997DV', 'A6323AA', 'A2370AL', 'A5528EH', 'A6162EF', 'A3860CC', 'A2931DW', 'A2878DY', 'A5587DX', 'A5949EF', 'A2836AH', 'A0459DT', 'A9610EG', 'A1317AF', 'A9998EJ', 'A4157CY', 'A4740AZ', 'A6899AX', 'A5201CZ', 'A3477EF', 'A0359EJ', 'A6999EK', 'A4037DT', 'A0348EK', 'A4256EJ', 'A3855DY', 'A8341CZ', 'A8201DZ', 'A4891EE', 'A4129CD', 'A7101DV', 'A9025AD', 'A5499DN', 'A1888EA', 'A5101EC', 'A2685DY', 'A5452EC', 'A7805EC', 'A1302DY', 'A2061AW', 'A3870EH', 'A5374EC', 'A8452AA', 'A2420CL', 'A1581EG', 'A4145EF', 'A8757DD', 'A8219DF', 'A3319DV', 'A4971EE', 'A4088CF', 'A4244DZ', 'A9822DD', 'A0903EC', 'A0266DW', 'A4875EJ', 'A7990DQ', 'A2298DZ', 'A5306DV', 'A6574ED', 'A2814EC', 'A0577DP', 'A9337AM', 'A9148AG', 'A0856EK', 'A1314DT', 'A6908EG', 'A9413DF', 'A1468AQ', 'A5391CF', 'A8788EF', 'A6776CF', 'A8792ED', 'A0140DX', 'A2645DR', 'A2125AV', 'A9556DY', 'A6108DZ', 'A9987DP', 'A1640DY', 'A6923DY', 'A4183AA', 'A7802DW', 'A9760CZ', 'A8822EE', 'A9747ED', 'A1448EJ', 'A7391DT', 'A2468ED', 'A1202EA', 'A6830AL', 'A8901EC', 'A2611DM', 'A0040EJ', 'A7883DJ', 'A3795AX', 'A9737AY', 'A3601EC', 'A3892DZ', 'A3399AF', 'A0536ED', 'A2951AT', 'A5077DY', 'A3850DW', 'A3585DK', 'A3139DA', 'A7496DM', 'A0717CN', 'A3557EE', 'A2408DY', 'A6534CV', 'A6791DV', 'A3711DW', 'A2981AT', 'A2776ED', 'A9673DQ', 'A2006EE', 'A5083EG', 'A3130DR', 'A1393EH', 'A5249EA', 'A6217AA', 'A9814DW', 'A0229EC', 'A0208AK', 'A2957EF', 'A6359EK', 'A3086DJ', 'A9443DV', 'A5544AM', 'A9534DH', 'A6976DQ', 'A0842EA', 'A5881EL', 'A8983EK', 'A4324EL', 'A1142AZ', 'A4866EK', 'A0527EL', 'A5021DQ', 'A2623EH')))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, SURNAME, FIRST_NAME, DATE_OF_BIRTH, UNIT_4_SHORT_DESCRIPTION, MOVEMENT_TIME FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP9.DO76",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP9.DO7b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "Offender Given Name 1",
            "legacyId": "DP9.DO80",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "DATE_OF_BIRTH",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DP9.DO85",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "UNIT_4_SHORT_DESCRIPTION",
            "type": "string",
            "display": "Prisoner Location",
            "legacyId": "DP9.DOa7c",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DP9.DO7ce",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP3",
      "name": "MIS Load Log",
      "description": "MIS Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT BODIMIS.ETL_LOAD_LOG.BUSINESS_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT BUSINESS_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BUSINESS_DATE",
            "type": "date",
            "display": "Latest Business Date Available",
            "legacyId": "DP3.DO4dd",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "133512.RS",
      "name": "No KW Entries",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376639/DP9",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Admission Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP9.DO7ce"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP9.DO76"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP9.DO7b"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "Offender Given Name 1",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP9.DO80"
          },
          {
            "name": "$ref:DATE_OF_BIRTH",
            "display": "Date of Birth",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP9.DO85"
          },
          {
            "name": "$ref:UNIT_4_SHORT_DESCRIPTION",
            "display": "Prisoner Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP9.DOa7c"
          }
        ]
      }
    },
    {
      "id": "135792.RS",
      "name": "KW Entries",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "summary",
        "field": []
      },
      "dataset": "MISSING"
    }
  ],
  "errors": [
    {
      "type": "schema",
      "error": "instance.report[1] requires property \"dataset\"",
      "entityId": "Fh2yWl1fZQEAoe4AAHBbyV4QACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Report Variant 135792.RS does not have corresponding dataset undefined",
      "entityId": "135792.RS",
      "entityType": "variant"
    }
  ]
}