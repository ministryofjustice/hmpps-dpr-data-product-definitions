{
  "id": "Fp.tAAD90gkAYicAAAAHO6AAACJIAGc1",
  "name": "MIS Sally DraftPrint Nominal Index Card ",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "PDD0010 v00.03.8"
    ]
  },
  "description": "Produces a nominal index card for a specified prisoner for the current booking; it is a record of all important information held on the system in case of a loss of the manual record, the system being inaccessible or in response to an enquiry from an outside agency i.e. Immigration. <br/>PDD0010 - v00.03.8",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3376639/DP2",
      "name": "Header",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.FIRST_NAME, AT_OFFENDER_BOOKING.MIDDLE_NAME_1, CASE WHEN AT_DOB.DAY_DATE < '31/12/9000' THEN AT_DOB.DAY_DATE END AS DATE_OF_BIRTH, AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_DESCRIPTION, AT_OFFENDER_ALIAS.FIRST_NAME AS ALIAS_GIVEN_NAME_1, AT_OFFENDER_ALIAS.MIDDLE_NAME_1 AS ALIAS_GIVEN_NAME_2, AT_OFFENDER_BOOKING.GENDER_DESCRIPTION, AT_OFFENDER_BOOKING.BIRTH_PLACE, AT_OFFENDER_BOOKING.BIRTH_COUNTRY, CASE WHEN AT_DIM_ETHNICITY_CODES.CODE = 'MERGE' THEN 'Code Missing' WHEN AT_DIM_ETHNICITY_CODES.CODE IS NULL THEN 'Code Missing' WHEN AT_DIM_ETHNICITY_CODES.CODE = 'W8' THEN 'White: Gypsy or Irish Traveller' WHEN AT_DIM_ETHNICITY_CODES.CODE = 'O1' THEN 'Asian/Asian British: Chinese' ELSE AT_DIM_ETHNICITY_CODES.DESCRIPTION END AS ETHNIC_DESCRIPTION, AT_OFFENDER_BOOKING.NATIONALITY_DESCRIPTION, AT_OFFENDER_EMPLOYMENT.OCCUPATION_DESCRIPTION, COALESCE(AT_OFFENDER_BOOKING.RELIGION_CODE, 'Not Specified') AS RELIGION_CODE, COALESCE(AT_OFFENDER_BOOKING.RELIGION_DESCRIPTION, 'Not Specified') AS RELIGION_DESCRIPTION, CASE WHEN AT_CURRENT_SECURITY_CATEGORY.CURRENT_SEC_CAT_LEVEL IS NULL THEN 'Unclassified' ELSE AT_CURRENT_SECURITY_CATEGORY.CURRENT_SEC_CAT_LEVEL END AS CURRENT_SECURITY_CATEGORY, AT_OFFENDER_ALIAS.SURNAME AS ALIAS_SURNAME, AT_OFFENDER_BOOKING.MAIN_LEGAL_STATUS_CODE, AT_OFFENDER_BOOKING.BOOKING_NUMBER, AT_OFFENDER_ALIAS.GENDER, AT_OFFENDER_ALIAS.DISPLAY_NAME, CASE WHEN DT_FIRST_RECEPTION.DAY_DATE < '31/12/9000' THEN DT_FIRST_RECEPTION.DAY_DATE ELSE NULL END AS DATE_FIRST_RECEPTION, AT_CELL.UNIT_4_DESCRIPTION FROM BODIMIS.DIM_ETHNICITY_CODES AT_DIM_ETHNICITY_CODES, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_DATE AT_DOB, BODIMIS.DIM_OFFENDER_ALIAS AT_OFFENDER_ALIAS, BODIMIS.DIM_OFFENDER_EMPLOYMENT AT_OFFENDER_EMPLOYMENT, BODIMIS.DIM_OFFENDER_ASSESSMENT AT_CURRENT_SECURITY_CATEGORY, (SELECT * FROM (SELECT m.offender_booking_sk, d.day_date, m.movement_seq, m.movement_time, ROW_NUMBER() OVER (PARTITION BY m.offender_booking_sk ORDER BY m.movement_seq) AS row_seq_filter FROM bodimis.fact_movement_external m INNER JOIN bodimis.dim_date d ON m.date_sk = d.date_sk WHERE m.direction_code = 'IN') WHERE row_seq_filter = 1) DT_FIRST_RECEPTION, BODIMIS.DIM_CELL AT_CELL WHERE (AT_OFFENDER_BOOKING.BIRTH_DATE_SK = AT_DOB.DATE_SK) AND (AT_OFFENDER_ALIAS.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_CELL.UNIT_4_SK = AT_OFFENDER_BOOKING.LIVING_UNIT_SK) AND (AT_OFFENDER_EMPLOYMENT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (DT_FIRST_RECEPTION.OFFENDER_BOOKING_SK = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_ETHNICITY_CODES.CODE (+) = AT_OFFENDER_BOOKING.ETHNICITY_CODE) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_OFFENDER_ALIAS.OFFENDER_BOOKING_SK IS NULL OR AT_OFFENDER_ALIAS.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_CURRENT_SECURITY_CATEGORY.CURRENT_SEC_CAT_FLAG (+) = 'Y') AND (AT_CURRENT_SECURITY_CATEGORY.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND ((AT_OFFENDER_BOOKING.BOOKING_SEQ = 1) AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = 'A9778EH'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, SURNAME, FIRST_NAME, MIDDLE_NAME_1, DATE_OF_BIRTH, MAIN_LEGAL_STATUS_DESCRIPTION, ALIAS_GIVEN_NAME_1, ALIAS_GIVEN_NAME_2, GENDER_DESCRIPTION, BIRTH_PLACE, BIRTH_COUNTRY, ETHNIC_DESCRIPTION, NATIONALITY_DESCRIPTION, OCCUPATION_DESCRIPTION, RELIGION_CODE, RELIGION_DESCRIPTION, CURRENT_SECURITY_CATEGORY, ALIAS_SURNAME, MAIN_LEGAL_STATUS_CODE, BOOKING_NUMBER, GENDER, DISPLAY_NAME, DATE_FIRST_RECEPTION, UNIT_4_DESCRIPTION FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP2.DO76",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP2.DO7b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "Offender Given Name 1",
            "legacyId": "DP2.DO80",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "MIDDLE_NAME_1",
            "type": "string",
            "display": "Offender Given Name 2",
            "legacyId": "DP2.DO81",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "DATE_OF_BIRTH",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DP2.DO85",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "MAIN_LEGAL_STATUS_DESCRIPTION",
            "type": "string",
            "display": "Main Legal Status Description",
            "legacyId": "DP2.DOdf",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "ALIAS_GIVEN_NAME_1",
            "type": "string",
            "display": "Alias Given Name 1",
            "legacyId": "DP2.DO8b",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "ALIAS_GIVEN_NAME_2",
            "type": "string",
            "display": "Alias Given Name 2",
            "legacyId": "DP2.DO8c",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "GENDER_DESCRIPTION",
            "type": "string",
            "display": "Gender Description",
            "legacyId": "DP2.DOa9",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "BIRTH_PLACE",
            "type": "string",
            "display": "Birth Place",
            "legacyId": "DP2.DO86",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "BIRTH_COUNTRY",
            "type": "string",
            "display": "Birth Country",
            "legacyId": "DP2.DO88",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "ETHNIC_DESCRIPTION",
            "type": "string",
            "display": "Ethnic Description",
            "legacyId": "DP2.DO9d",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "NATIONALITY_DESCRIPTION",
            "type": "string",
            "display": "Nationality Description",
            "legacyId": "DP2.DOb5",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "OCCUPATION_DESCRIPTION",
            "type": "string",
            "display": "Occupation Description",
            "legacyId": "DP2.DOb7",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "RELIGION_CODE",
            "type": "string",
            "display": "Religion Code",
            "legacyId": "DP2.DOb2",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "RELIGION_DESCRIPTION",
            "type": "string",
            "display": "Religion Description",
            "legacyId": "DP2.DOb3",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "CURRENT_SECURITY_CATEGORY",
            "type": "string",
            "display": "Current Security Category",
            "legacyId": "DP2.DOe1",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "ALIAS_SURNAME",
            "type": "string",
            "display": "Alias Surname",
            "legacyId": "DP2.DO89",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "MAIN_LEGAL_STATUS_CODE",
            "type": "string",
            "display": "Main Legal Status Code",
            "legacyId": "DP2.DOde",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "BOOKING_NUMBER",
            "type": "string",
            "display": "Booking Number",
            "legacyId": "DP2.DO77",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "GENDER",
            "type": "string",
            "display": "Alias Gender",
            "legacyId": "DP2.DO70f",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "DISPLAY_NAME",
            "type": "string",
            "display": "Alias or Working Name?",
            "legacyId": "DP2.DO78f",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "DATE_FIRST_RECEPTION",
            "type": "date",
            "display": "Date First Reception",
            "legacyId": "DP2.DO106",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "UNIT_4_DESCRIPTION",
            "type": "string",
            "display": "Unit Description 4",
            "legacyId": "DP2.DO136",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP4",
      "name": "Offences",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_COURT_CASE.COURT_CASE_NUMBER, AT_DIM_OFFENCE.OFFENCE_CODE_NK, AT_COURT_CASE.COURT_CASE_SK, CASE WHEN AT_FACT_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE TO_CHAR(AT_FACT_SENTENCE_TERMS.YEARS) END AS CASE_TERMS_YEARS, CASE WHEN AT_FACT_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y' THEN '' ELSE TO_CHAR(AT_FACT_SENTENCE_TERMS.MONTHS) END AS CASE_TERMS_MONTHS, CASE WHEN AT_FACT_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y' THEN '' ELSE TO_CHAR(AT_FACT_SENTENCE_TERMS.DAYS) END AS CASE_TERMS_DAYS, AT_DIM_OFFENCE.OFFENCE_NAME, AT_FACT_COURT_CHARGE.MOST_SERIOUS_FLAG, AT_MIN_SENTENCE_DATE.DAY_DATE, AT_FACT_COURT_CHARGE.OFFENDER_CHARGE_ID_NK, CASE WHEN AT_FACT_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y' THEN '' ELSE TO_CHAR(AT_FACT_SENTENCE_TERMS.WEEKS) END AS CASE_TERMS_WEEKS FROM BODIMIS.DIM_DATE AT_MIN_SENTENCE_DATE, BODIMIS.DIM_OFFENCE AT_DIM_OFFENCE, BODIMIS.FACT_COURT_CHARGE AT_FACT_COURT_CHARGE, BODIMIS.FACT_SENTENCE_CHARGE AT_FACT_SENTENCE_CHARGE, BODIMIS.FACT_CASE_SENTENCE_TERM AT_FACT_SENTENCE_TERMS, BODIMIS.DIM_COURT_CASE_STATUS AT_DIM_COURT_CASE_STATUS, BODIMIS.DIM_COURT_CASE AT_COURT_CASE, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, (SELECT * FROM (SELECT sentence_start_date_sk, offender_booking_sk, sentence_seq_nk, sentence_type_sk, court_case_sk, sentence_termination_date_sk, expiry_date_sk, ROW_NUMBER() OVER (PARTITION BY offender_booking_sk ORDER BY sentence_start_date_sk, sentence_seq_nk) AS row_seq_filter FROM bodimis.fact_case_sentence) WHERE row_seq_filter = 1) DT_FIRST_SENTENCE WHERE (AT_FACT_COURT_CHARGE.OFFENCE_SK = AT_DIM_OFFENCE.OFFENCE_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_COURT_CHARGE.COURT_CASE_SK (+)) AND (AT_COURT_CASE.COURT_CASE_STATUS_SK = AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS_SK (+)) AND (AT_FACT_COURT_CHARGE.OFFENDER_CHARGE_ID_NK = AT_FACT_SENTENCE_CHARGE.OFFENDER_CHARGE_ID_NK (+)) AND (AT_FACT_SENTENCE_TERMS.OFFENDER_BOOKING_SK (+) = AT_FACT_SENTENCE_CHARGE.OFFENDER_BOOKING_SK AND AT_FACT_SENTENCE_TERMS.SENTENCE_SEQ_NK (+) = AT_FACT_SENTENCE_CHARGE.SENTENCE_SEQ_NK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (DT_FIRST_SENTENCE.SENTENCE_START_DATE_SK = AT_MIN_SENTENCE_DATE.DATE_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = DT_FIRST_SENTENCE.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND ((AT_OFFENDER_BOOKING.BOOKING_SEQ = 1) AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = 'A9778EH') AND (AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS = 'Active'))), dataset_ AS (SELECT COURT_CASE_NUMBER, OFFENCE_CODE_NK, COURT_CASE_SK, CASE_TERMS_YEARS, CASE_TERMS_MONTHS, CASE_TERMS_DAYS, OFFENCE_NAME, MOST_SERIOUS_FLAG, DAY_DATE, OFFENDER_CHARGE_ID_NK, CASE_TERMS_WEEKS FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "COURT_CASE_NUMBER",
            "type": "string",
            "display": "Court Case Number",
            "legacyId": "DP4.DO51",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "OFFENCE_CODE_NK",
            "type": "string",
            "display": "Offence Code",
            "legacyId": "DP4.DO4a",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "COURT_CASE_SK",
            "type": "double",
            "display": "Court Case Internal Key",
            "legacyId": "DP4.DO147",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "CASE_TERMS_YEARS",
            "type": "string",
            "display": "Case Terms - Years",
            "legacyId": "DP4.DO1c6",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "CASE_TERMS_MONTHS",
            "type": "string",
            "display": "Case Terms - Months",
            "legacyId": "DP4.DO1c7",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "CASE_TERMS_DAYS",
            "type": "string",
            "display": "Case Terms - Days",
            "legacyId": "DP4.DO1c8",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "OFFENCE_NAME",
            "type": "string",
            "display": "Offence Name",
            "legacyId": "DP4.DO4b",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "MOST_SERIOUS_FLAG",
            "type": "string",
            "display": "Main Offence Flag",
            "legacyId": "DP4.DO4f",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Minimum Sentence Date",
            "legacyId": "DP4.DO1db",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "OFFENDER_CHARGE_ID_NK",
            "type": "double",
            "display": "Offender Charge Id Nk",
            "legacyId": "DP4.DO1d9",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "CASE_TERMS_WEEKS",
            "type": "string",
            "display": "Case Terms - Weeks",
            "legacyId": "DP4.DO5e3",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DPb",
      "name": "Movements",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_FACT_MOV_EXT.REASON, AT_DIM_DATE_EXT_MOV.DAY_DATE, AT_FACT_MOV_EXT.MOVEMENT_TIME, DT_EXT_MOVE_TO.TYPE_DESCRIPTION_TO, DT_EXT_MOVE_FROM.TYPE_DESCRIPTION_FROM FROM BODIMIS.FACT_MOVEMENT_EXTERNAL AT_FACT_MOV_EXT, BODIMIS.DIM_DATE AT_DIM_DATE_EXT_MOV, (SELECT BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_SK AS SK_ID_TO, BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS TYPE_DESCRIPTION_TO, 'Establishment' AS Location_Type_To FROM BODIMIS.DIM_ESTABLISHMENT UNION ALL SELECT BODIMIS.DIM_PROBATION_OFFICE.PROBATION_OFFICE_SK, BODIMIS.DIM_PROBATION_OFFICE.PROB_OFFICE_DESCRIPTION, 'Probation Office' AS Location_Type_To FROM BODIMIS.DIM_PROBATION_OFFICE UNION ALL SELECT BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_SK, BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_DESCRIPTION, 'Outside Location' AS Location_Type_To FROM BODIMIS.DIM_OUTSIDE_LOCATION UNION ALL SELECT BODIMIS.DIM_CITY.CITY_SK, BODIMIS.DIM_CITY.DESCRIPTION, 'City' AS Location_Type_To FROM BODIMIS.DIM_CITY UNION ALL SELECT BODIMIS.DIM_COURT.COURT_SK, BODIMIS.DIM_COURT.COURT_DESCRIPTION, 'Court' AS Location_Type_To FROM BODIMIS.DIM_COURT UNION ALL SELECT address_id_nk, TRIM(CASE WHEN no_fixed_address_flag = 'Y' THEN 'No fixed address' ELSE CASE WHEN NOT flat IS NULL THEN flat || '  ' END || CASE WHEN NOT premise IS NULL THEN premise || '  ' END || CASE WHEN NOT street IS NULL THEN street || '  ' END || CASE WHEN NOT locality IS NULL THEN locality || '  ' END || CASE WHEN NOT city_desc IS NULL THEN city_desc || '  ' END || CASE WHEN NOT county_desc IS NULL THEN county_desc || '  ' END || CASE WHEN NOT postal_code IS NULL THEN postal_code || '  ' END || CASE WHEN NOT country_desc IS NULL THEN country_desc END END), 'Home Leave Address' FROM bodimis.dim_addresses) DT_EXT_MOVE_TO, (SELECT BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_SK AS SK_ID_FROM, BODIMIS.DIM_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS TYPE_DESCRIPTION_FROM, 'Establishment' AS Location_Type_FROM FROM BODIMIS.DIM_ESTABLISHMENT UNION ALL SELECT BODIMIS.DIM_PROBATION_OFFICE.PROBATION_OFFICE_SK, BODIMIS.DIM_PROBATION_OFFICE.PROB_OFFICE_DESCRIPTION, 'Probation Office' AS Location_Type_From FROM BODIMIS.DIM_PROBATION_OFFICE UNION ALL SELECT BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_SK, BODIMIS.DIM_OUTSIDE_LOCATION.OUTSIDE_LOCATION_DESCRIPTION, 'Outside Location' AS Location_Type_From FROM BODIMIS.DIM_OUTSIDE_LOCATION UNION ALL SELECT BODIMIS.DIM_CITY.CITY_SK, BODIMIS.DIM_CITY.DESCRIPTION, 'City' AS Location_Type_From FROM BODIMIS.DIM_CITY UNION ALL SELECT BODIMIS.DIM_COURT.COURT_SK, BODIMIS.DIM_COURT.COURT_DESCRIPTION, 'Court' AS Location_Type_From FROM BODIMIS.DIM_COURT UNION ALL SELECT address_id_nk, TRIM(CASE WHEN no_fixed_address_flag = 'Y' THEN 'No fixed address' ELSE CASE WHEN NOT flat IS NULL THEN flat || '  ' END || CASE WHEN NOT premise IS NULL THEN premise || '  ' END || CASE WHEN NOT street IS NULL THEN street || '  ' END || CASE WHEN NOT locality IS NULL THEN locality || '  ' END || CASE WHEN NOT city_desc IS NULL THEN city_desc || '  ' END || CASE WHEN NOT county_desc IS NULL THEN county_desc || '  ' END || CASE WHEN NOT postal_code IS NULL THEN postal_code || '  ' END || CASE WHEN NOT country_desc IS NULL THEN country_desc END END), 'Home Leave Address' FROM bodimis.dim_addresses) DT_EXT_MOVE_FROM, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING WHERE (AT_FACT_MOV_EXT.OFFENDER_BOOKING_SK (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK) AND (AT_DIM_DATE_EXT_MOV.DATE_SK = AT_FACT_MOV_EXT.DATE_SK) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_FACT_MOV_EXT.TO_LOCATION_SK = DT_EXT_MOVE_TO.SK_ID_TO (+) AND AT_FACT_MOV_EXT.TO_LOCATION_TYPE = DT_EXT_MOVE_TO.LOCATION_TYPE_TO (+)) AND (AT_FACT_MOV_EXT.FROM_LOCATION_SK = DT_EXT_MOVE_FROM.SK_ID_FROM (+) AND AT_FACT_MOV_EXT.FROM_LOCATION_TYPE = DT_EXT_MOVE_FROM.LOCATION_TYPE_FROM (+)) AND ((AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = 'A9778EH') AND (AT_OFFENDER_BOOKING.BOOKING_SEQ = 1))), dataset_ AS (SELECT REASON, DAY_DATE, MOVEMENT_TIME, TYPE_DESCRIPTION_TO, TYPE_DESCRIPTION_FROM FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "REASON",
            "type": "string",
            "display": "Movement Description (External)",
            "legacyId": "DPb.DO15b",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Movement Date Only (External)",
            "legacyId": "DPb.DO15c",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Movement Date and Time (External)",
            "legacyId": "DPb.DO3eb",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "TYPE_DESCRIPTION_TO",
            "type": "string",
            "display": "Movement Description (To)",
            "legacyId": "DPb.DO6ff",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "TYPE_DESCRIPTION_FROM",
            "type": "string",
            "display": "Movement Description (From)",
            "legacyId": "DPb.DO700",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DPf",
      "name": "Court Event Dates - Court Case Level",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT * AS NOMS_NUMBER FROM (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_COURT_CASE.COURT_CASE_SK, AT_COURT_CASE.COURT_CASE_NUMBER, AT_DIM_OUTCOME_REASON.OUTCOME_REASON_DESCRIPTION, MIN(DT_SPECIAL_COURT_EVENTS.first_sentenced_date), MIN(DT_SPECIAL_COURT_EVENTS.first_convicted_date), MIN(DT_SPECIAL_COURT_EVENTS.first_remand_date), MIN(DT_SPECIAL_COURT_EVENTS.first_committed_date), MIN(DT_SPECIAL_COURT_EVENTS.first_remand_court), MIN(DT_SPECIAL_COURT_EVENTS.first_convicted_court), MIN(DT_SPECIAL_COURT_EVENTS.first_sentenced_court), MIN(DT_SPECIAL_COURT_EVENTS.first_committed_court), MIN(DT_SPECIAL_COURT_EVENTS.second_remand_date), MIN(DT_SPECIAL_COURT_EVENTS.committed_to_court), MIN(DT_SPECIAL_COURT_EVENTS.first_appeal_court), MIN(DT_SPECIAL_COURT_EVENTS.first_appeal_date), MIN(DT_SPECIAL_COURT_EVENTS.first_bailed_court), MIN(DT_SPECIAL_COURT_EVENTS.first_appeal_result), MIN(DT_SPECIAL_COURT_EVENTS.first_bailed_date), MIN(DT_SPECIAL_COURT_EVENTS.first_sentenced_court), MIN(DT_SPECIAL_COURT_EVENTS.first_sentenced_date) FROM BODIMIS.DIM_OUTCOME_REASON AT_DIM_OUTCOME_REASON, (SELECT f.offender_booking_sk, f.court_case_sk, MIN(CASE WHEN f.outcome_key = 1 THEN f.event_date END) AS first_remand_date, MIN(CASE WHEN f.outcome_key = 1 THEN f.court_description END) AS first_remand_court, MIN(CASE WHEN f.outcome_key = 1 THEN f.outcome_reason_description END) AS first_remand_result, MIN(CASE WHEN f.outcome_key = 11 THEN f.event_date END) AS second_remand_date, MIN(CASE WHEN f.outcome_key = 11 THEN f.court_description END) AS second_remand_court, MIN(CASE WHEN f.outcome_key = 11 THEN f.outcome_reason_description END) AS second_remand_result, MIN(CASE WHEN f.outcome_key = 2 THEN f.event_date END) AS first_convicted_date, MIN(CASE WHEN f.outcome_key = 2 THEN f.court_description END) AS first_convicted_court, MIN(CASE WHEN f.outcome_key = 2 THEN f.outcome_reason_description END) AS first_convicted_result, MIN(CASE WHEN f.outcome_key = 3 THEN f.event_date END) AS first_sentenced_date, MIN(CASE WHEN f.outcome_key = 3 THEN f.court_description END) AS first_sentenced_court, MIN(CASE WHEN f.outcome_key = 3 THEN f.outcome_reason_description END) AS first_sentenced_result, MIN(CASE WHEN f.outcome_key = 4 THEN f.event_date END) AS first_committed_date, MIN(CASE WHEN f.outcome_key = 4 THEN f.court_description END) AS first_committed_court, MIN(CASE WHEN f.outcome_key = 4 THEN f.outcome_reason_description END) AS first_committed_result, MIN(CASE WHEN f.outcome_key = 4 THEN f.next_date END) AS committed_to_date, MIN(CASE WHEN f.outcome_key = 4 THEN f.next_court END) AS committed_to_court, MIN(CASE WHEN f.outcome_key = 4 THEN f.next_outcome END) AS committed_to_result, MIN(CASE WHEN f.outcome_key = 5 THEN f.event_date END) AS first_appeal_date, MIN(CASE WHEN f.outcome_key = 5 THEN f.court_description END) AS first_appeal_court, MIN(CASE WHEN f.outcome_key = 5 THEN f.outcome_reason_description END) AS first_appeal_result, MIN(CASE WHEN f.outcome_key = 6 THEN f.event_date END) AS first_bailed_date, MIN(CASE WHEN f.outcome_key = 6 THEN f.court_description END) AS first_bailed_court, MIN(CASE WHEN f.outcome_key = 6 THEN f.outcome_reason_description END) AS first_bailed_result FROM (SELECT row_seq, offender_booking_sk, court_case_sk, event_dt AS event_date, court_description, outcome_reason_description, next_date, next_court, next_outcome, CASE WHEN outcome_key = 1 AND row_seq = 2 THEN 11 ELSE outcome_key END AS outcome_key FROM (SELECT oc.*, fce.*, ROW_NUMBER() OVER (PARTITION BY fce.offender_booking_sk, oc.outcome_key, fce.court_case_sk ORDER BY fce.event_time, fce.court_event_nk) AS row_seq FROM (SELECT 1 AS outcome_key, 'Remand Outcome' AS outcome_type, outcome_code FROM ((SELECT '4011', '4012', '4013', '4014', '4015', '4016', '4017', '4020', '4021', '4506', '4529', '4530', '4531', '4532', '4533', '4534', '4535', '4536', '4537', '4538', '4539', '4541', '4542', '4543', '4548', '4549', '4550', '4551', '4552', '4558', '4559', '4560', '4561', '4562', '4563', '4564', '4565', '4587', '4588', '4589', '4504', '4511', '4512', '4513', '4514', '4515', '4516', '4519', '4520', '4521', '4522', '4523', '4524', '4540', '4578', '4579', '4580', '4581' FROM dual) UNPIVOT(outcome_code FOR value_type IN (\"'4011'\", \"'4012'\", \"'4013'\", \"'4014'\", \"'4015'\", \"'4016'\", \"'4017'\", \"'4020'\", \"'4021'\", \"'4506'\", \"'4529'\", \"'4530'\", \"'4531'\", \"'4532'\", \"'4533'\", \"'4534'\", \"'4535'\", \"'4536'\", \"'4537'\", \"'4538'\", \"'4539'\", \"'4541'\", \"'4542'\", \"'4543'\", \"'4548'\", \"'4549'\", \"'4550'\", \"'4551'\", \"'4552'\", \"'4558'\", \"'4559'\", \"'4560'\", \"'4561'\", \"'4562'\", \"'4563'\", \"'4564'\", \"'4565'\", \"'4587'\", \"'4588'\", \"'4589'\", \"'4504'\", \"'4511'\", \"'4512'\", \"'4513'\", \"'4514'\", \"'4515'\", \"'4516'\", \"'4519'\", \"'4520'\", \"'4521'\", \"'4522'\", \"'4523'\", \"'4524'\", \"'4540'\", \"'4578'\", \"'4579'\", \"'4580'\", \"'4581'\"))) UNION ALL SELECT 2 AS outcome_key, 'Convicted Outcome' AS outcome_type, outcome_code FROM ((SELECT '1002', '1003', '1004', '1005', '1006', '1007', '1008', '1009', '1010', '1011', '1012', '1013', '1014', '1015', '1016', '1017', '1022', '1024', '1025', '1027', '1028', '1029', '1030', '1031', '1032', '1034', '1035', '1036', '1037', '1038', '1039', '1040', '1046', '1049', '1051', '1052', '1054', '1055', '1056', '1057', '1058', '1062', '1063', '1064', '1065', '1066', '1067', '1068', '1070', '1071', '1073', '1074', '1075', '1076', '1077', '1078', '1079', '1080', '1081', '1082', '1083', '1084', '1085', '1086', '1087', '1088', '1089', '1090', '1091', '1092', '1093', '1094', '1096', '1097', '1098', '1099', '1100', '1101', '1102', '1103', '1104', '1105', '1106', '1107', '1108', '1109', '1110', '1111', '1112', '1114', '1115', '1116', '1117', '1118', '1119', '1121', '1501', '1505', '1507', '1508', '1509', '1510', '1511', '1512', '1513', '1514', '2007', '2012', '2015', '2017', '2018', '2023', '2062', '2067', '2505', '3002', '3006', '3007', '3008', '3010', '3011', '3012', '3013', '3014', '3016', '3019', '3020', '3021', '3022', '3025', '3027', '3028', '3029', '3030', '3033', '3034', '3035', '3041', '3042', '3044', '3045', '3047', '3049', '3050', '3051', '3052', '3053', '3054', '3055', '3056', '3058', '3061', '3062', '3063', '3064', '3065', '3066', '3067', '3068', '3069', '3070', '3071', '3072', '3073', '3074', '3075', '3076', '3077', '3079', '3080', '3081', '3082', '3083', '3084', '3085', '3086', '3087', '3088', '3089', '3090', '3091', '3092', '3094', '3095', '3096', '3097', '3098', '3099', '3101', '3102', '3103', '3104', '3105', '3106', '3107', '3108', '3109', '3110', '3111', '3112', '3501', '3502', '3503', '3504', '3508', '3509', '3510', '3512', '4001', '4004', '4005', '4011', '4012', '4013', '4014', '4015', '4016', '4017', '4020', '4021', '4022', '4551', '4552', '4586', '4587', '4588', 'AC', 'FPR', 'G', '1001', '1026', '1043', '1044', '1047', '1050', '1059', '1060', '1061', '1069', '1072', '1503', '1506', '2021', '3001', '3003', '3004', '3005', '3009', '3015', '3017', '3031', '3032', '3036', '3037', '3038', '3039', '3040', '3043', '3046', '3048', '3057', '3059', '3060', '3078', '3093', '3513', '4019', '4511', '4512', '4519', '4520', '4521', '4525', '4527', '4578', '4579', '4580', '4581', '4591', '5001', '5002', '5003', '5004', '5005', '5006', '5008', '5009', '5010', '5012', '5013', '5014', '5015', '5016', '5017', '5018', '5019', '5020' FROM dual) UNPIVOT(outcome_code FOR value_type IN (\"'1002'\", \"'1003'\", \"'1004'\", \"'1005'\", \"'1006'\", \"'1007'\", \"'1008'\", \"'1009'\", \"'1010'\", \"'1011'\", \"'1012'\", \"'1013'\", \"'1014'\", \"'1015'\", \"'1016'\", \"'1017'\", \"'1022'\", \"'1024'\", \"'1025'\", \"'1027'\", \"'1028'\", \"'1029'\", \"'1030'\", \"'1031'\", \"'1032'\", \"'1034'\", \"'1035'\", \"'1036'\", \"'1037'\", \"'1038'\", \"'1039'\", \"'1040'\", \"'1046'\", \"'1049'\", \"'1051'\", \"'1052'\", \"'1054'\", \"'1055'\", \"'1056'\", \"'1057'\", \"'1058'\", \"'1062'\", \"'1063'\", \"'1064'\", \"'1065'\", \"'1066'\", \"'1067'\", \"'1068'\", \"'1070'\", \"'1071'\", \"'1073'\", \"'1074'\", \"'1075'\", \"'1076'\", \"'1077'\", \"'1078'\", \"'1079'\", \"'1080'\", \"'1081'\", \"'1082'\", \"'1083'\", \"'1084'\", \"'1085'\", \"'1086'\", \"'1087'\", \"'1088'\", \"'1089'\", \"'1090'\", \"'1091'\", \"'1092'\", \"'1093'\", \"'1094'\", \"'1096'\", \"'1097'\", \"'1098'\", \"'1099'\", \"'1100'\", \"'1101'\", \"'1102'\", \"'1103'\", \"'1104'\", \"'1105'\", \"'1106'\", \"'1107'\", \"'1108'\", \"'1109'\", \"'1110'\", \"'1111'\", \"'1112'\", \"'1114'\", \"'1115'\", \"'1116'\", \"'1117'\", \"'1118'\", \"'1119'\", \"'1121'\", \"'1501'\", \"'1505'\", \"'1507'\", \"'1508'\", \"'1509'\", \"'1510'\", \"'1511'\", \"'1512'\", \"'1513'\", \"'1514'\", \"'2007'\", \"'2012'\", \"'2015'\", \"'2017'\", \"'2018'\", \"'2023'\", \"'2062'\", \"'2067'\", \"'2505'\", \"'3002'\", \"'3006'\", \"'3007'\", \"'3008'\", \"'3010'\", \"'3011'\", \"'3012'\", \"'3013'\", \"'3014'\", \"'3016'\", \"'3019'\", \"'3020'\", \"'3021'\", \"'3022'\", \"'3025'\", \"'3027'\", \"'3028'\", \"'3029'\", \"'3030'\", \"'3033'\", \"'3034'\", \"'3035'\", \"'3041'\", \"'3042'\", \"'3044'\", \"'3045'\", \"'3047'\", \"'3049'\", \"'3050'\", \"'3051'\", \"'3052'\", \"'3053'\", \"'3054'\", \"'3055'\", \"'3056'\", \"'3058'\", \"'3061'\", \"'3062'\", \"'3063'\", \"'3064'\", \"'3065'\", \"'3066'\", \"'3067'\", \"'3068'\", \"'3069'\", \"'3070'\", \"'3071'\", \"'3072'\", \"'3073'\", \"'3074'\", \"'3075'\", \"'3076'\", \"'3077'\", \"'3079'\", \"'3080'\", \"'3081'\", \"'3082'\", \"'3083'\", \"'3084'\", \"'3085'\", \"'3086'\", \"'3087'\", \"'3088'\", \"'3089'\", \"'3090'\", \"'3091'\", \"'3092'\", \"'3094'\", \"'3095'\", \"'3096'\", \"'3097'\", \"'3098'\", \"'3099'\", \"'3101'\", \"'3102'\", \"'3103'\", \"'3104'\", \"'3105'\", \"'3106'\", \"'3107'\", \"'3108'\", \"'3109'\", \"'3110'\", \"'3111'\", \"'3112'\", \"'3501'\", \"'3502'\", \"'3503'\", \"'3504'\", \"'3508'\", \"'3509'\", \"'3510'\", \"'3512'\", \"'4001'\", \"'4004'\", \"'4005'\", \"'4011'\", \"'4012'\", \"'4013'\", \"'4014'\", \"'4015'\", \"'4016'\", \"'4017'\", \"'4020'\", \"'4021'\", \"'4022'\", \"'4551'\", \"'4552'\", \"'4586'\", \"'4587'\", \"'4588'\", \"'AC'\", \"'FPR'\", \"'G'\", \"'1001'\", \"'1026'\", \"'1043'\", \"'1044'\", \"'1047'\", \"'1050'\", \"'1059'\", \"'1060'\", \"'1061'\", \"'1069'\", \"'1072'\", \"'1503'\", \"'1506'\", \"'2021'\", \"'3001'\", \"'3003'\", \"'3004'\", \"'3005'\", \"'3009'\", \"'3015'\", \"'3017'\", \"'3031'\", \"'3032'\", \"'3036'\", \"'3037'\", \"'3038'\", \"'3039'\", \"'3040'\", \"'3043'\", \"'3046'\", \"'3048'\", \"'3057'\", \"'3059'\", \"'3060'\", \"'3078'\", \"'3093'\", \"'3513'\", \"'4019'\", \"'4511'\", \"'4512'\", \"'4519'\", \"'4520'\", \"'4521'\", \"'4525'\", \"'4527'\", \"'4578'\", \"'4579'\", \"'4580'\", \"'4581'\", \"'4591'\", \"'5001'\", \"'5002'\", \"'5003'\", \"'5004'\", \"'5005'\", \"'5006'\", \"'5008'\", \"'5009'\", \"'5010'\", \"'5012'\", \"'5013'\", \"'5014'\", \"'5015'\", \"'5016'\", \"'5017'\", \"'5018'\", \"'5019'\", \"'5020'\"))) UNION ALL SELECT 3 AS outcome_key, 'Sentenced Outcome' AS outcome_type, outcome_code FROM ((SELECT '1002', '1003', '1022', '1024', '1073', '1081', '1105', '1106', '1107', '1110', '1111', '1112', '1114', '1121', '1509', '1510', '3006', '1001', '4503' FROM dual) UNPIVOT(outcome_code FOR value_type IN (\"'1002'\", \"'1003'\", \"'1022'\", \"'1024'\", \"'1073'\", \"'1081'\", \"'1105'\", \"'1106'\", \"'1107'\", \"'1110'\", \"'1111'\", \"'1112'\", \"'1114'\", \"'1121'\", \"'1509'\", \"'1510'\", \"'3006'\", \"'1001'\", \"'4503'\"))) UNION ALL SELECT 4 AS outcome_key, 'Committed Outcome' AS outcome_type, outcome_code FROM ((SELECT '4001', '4014', '4015', '4016', '4017', '4020', '4021', '4558', '4559', '4560', '4561', '4562', '4563', '4564', '4565' FROM dual) UNPIVOT(outcome_code FOR value_type IN (\"'4001'\", \"'4014'\", \"'4015'\", \"'4016'\", \"'4017'\", \"'4020'\", \"'4021'\", \"'4558'\", \"'4559'\", \"'4560'\", \"'4561'\", \"'4562'\", \"'4563'\", \"'4564'\", \"'4565'\"))) UNION ALL SELECT 5 AS outcome_key, 'Appeal Outcome' AS outcome_type, outcome_code FROM ((SELECT '1046', '3044', '3045', '4534', '3093', '3513' FROM dual) UNPIVOT(outcome_code FOR value_type IN (\"'1046'\", \"'3044'\", \"'3045'\", \"'4534'\", \"'3093'\", \"'3513'\"))) UNION ALL SELECT 6 AS outcome_key, 'Bailed Outcome' AS outcome_type, outcome_code FROM ((SELECT '4011', '4013', '4014', '4015', '4017', '4529', '4530', '4533', '4552', '4558', '4559', '4561', '4587', '4589' FROM dual) UNPIVOT(outcome_code FOR value_type IN (\"'4011'\", \"'4013'\", \"'4014'\", \"'4015'\", \"'4017'\", \"'4529'\", \"'4530'\", \"'4533'\", \"'4552'\", \"'4558'\", \"'4559'\", \"'4561'\", \"'4587'\", \"'4589'\")))) oc RIGHT OUTER JOIN (SELECT f.*, d.day_date AS event_dt, dc.court_description, dor.outcome_reason_description, LEAD(d.day_date) OVER (PARTITION BY f.offender_booking_sk, f.court_case_sk ORDER BY f.event_time, f.court_event_nk) AS next_date, LEAD(dc.court_description) OVER (PARTITION BY f.offender_booking_sk, f.court_case_sk ORDER BY f.event_time, f.court_event_nk) AS next_court, LEAD(dor.outcome_reason_description) OVER (PARTITION BY f.offender_booking_sk, f.court_case_sk ORDER BY f.event_time, f.court_event_nk) AS next_outcome FROM bodimis.fact_court_event f INNER JOIN bodimis.dim_date d ON f.event_date_sk = d.date_sk INNER JOIN bodimis.dim_court dc ON f.court_sk = dc.court_sk LEFT OUTER JOIN bodimis.dim_outcome_reason dor ON f.outcome = dor.outcome_reason_nk WHERE f.court_case_sk > 0) fce ON fce.outcome = oc.outcome_code) WHERE (row_seq = 1 OR (row_seq = 2 AND outcome_key = 1))) f GROUP BY f.offender_booking_sk, f.court_case_sk) DT_SPECIAL_COURT_EVENTS, BODIMIS.DIM_COURT_CASE_STATUS AT_DIM_COURT_CASE_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_COURT_CASE AT_COURT_CASE WHERE (AT_COURT_CASE.COURT_CASE_STATUS_SK = AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS_SK (+)) AND (AT_COURT_CASE.OUTCOME_REASON_SK = AT_DIM_OUTCOME_REASON.OUTCOME_REASON_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = DT_SPECIAL_COURT_EVENTS.COURT_CASE_SK (+) AND AT_COURT_CASE.OFFENDER_BOOKING_SK = DT_SPECIAL_COURT_EVENTS.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND ((AT_OFFENDER_BOOKING.BOOKING_SEQ = 1) AND (AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS = 'Active') AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = 'A9778EH')) GROUP BY AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_COURT_CASE.COURT_CASE_SK, AT_COURT_CASE.COURT_CASE_NUMBER, AT_DIM_OUTCOME_REASON.OUTCOME_REASON_DESCRIPTION) _query0 FULL OUTER JOIN (SELECT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_COURT_CASE.COURT_CASE_SK, AT_COURT_CASE.COURT_CASE_NUMBER, AT_DIM_OUTCOME_REASON.OUTCOME_REASON_DESCRIPTION, MAX(CASE WHEN AT_EVENT_DATE.DAY_DATE < CURRENT_TIMESTAMP THEN AT_EVENT_DATE.DAY_DATE ELSE NULL END), MAX(CASE WHEN AT_EVENT_DATE.DAY_DATE >= CURRENT_TIMESTAMP THEN AT_EVENT_DATE.DAY_DATE ELSE NULL END) FROM BODIMIS.DIM_DATE AT_EVENT_DATE, BODIMIS.DIM_OUTCOME_REASON AT_DIM_OUTCOME_REASON, BODIMIS.FACT_COURT_EVENT AT_FACT_COURT_EVENT, BODIMIS.DIM_COURT_CASE_STATUS AT_DIM_COURT_CASE_STATUS, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_COURT_CASE AT_COURT_CASE WHERE (AT_FACT_COURT_EVENT.EVENT_DATE_SK = AT_EVENT_DATE.DATE_SK (+)) AND (AT_COURT_CASE.COURT_CASE_SK = AT_FACT_COURT_EVENT.COURT_CASE_SK (+)) AND (AT_COURT_CASE.COURT_CASE_STATUS_SK = AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS_SK (+)) AND (AT_COURT_CASE.OUTCOME_REASON_SK = AT_DIM_OUTCOME_REASON.OUTCOME_REASON_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = AT_COURT_CASE.OFFENDER_BOOKING_SK (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND (AT_COURT_CASE.OFFENDER_BOOKING_SK IS NULL OR AT_COURT_CASE.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND ((AT_OFFENDER_BOOKING.BOOKING_SEQ = 1) AND (AT_DIM_COURT_CASE_STATUS.COURT_CASE_STATUS = 'Active') AND (AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY = 'A9778EH')) GROUP BY AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_COURT_CASE.COURT_CASE_SK, AT_COURT_CASE.COURT_CASE_NUMBER, AT_DIM_OUTCOME_REASON.OUTCOME_REASON_DESCRIPTION) _query1 ON _query0.OFFENDER_ID_DISPLAY = _query1.OFFENDER_ID_DISPLAY), dataset_ AS (SELECT NOMS_NUMBER FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "NOMS_NUMBER",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPf.DO10076",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375368/DP10",
      "name": "MIS Load",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT BODIMIS.ETL_LOAD_LOG.BUSINESS_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT BUSINESS_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BUSINESS_DATE",
            "type": "date",
            "display": "Latest Business Date Available",
            "legacyId": "DP10.DO104dd",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "146665.RS",
      "name": "Movements",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376639/DPb",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-tab",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO76"
          },
          {
            "name": "$ref:SURNAME",
            "display": "Offender Surname",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO7b"
          },
          {
            "name": "$ref:DATE_OF_BIRTH",
            "display": "Date of Birth",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO85"
          },
          {
            "name": "$ref:MAIN_LEGAL_STATUS_CODE",
            "display": "Main Legal Status Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DOde"
          },
          {
            "name": "$ref:BOOKING_NUMBER",
            "display": "Booking Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO77"
          },
          {
            "name": "$ref:GENDER_DESCRIPTION",
            "display": "Gender Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DOa9"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "schema",
      "error": "Report field OFFENDER_ID_DISPLAY does not have corresponding dataset schema field",
      "entityId": "146665.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field SURNAME does not have corresponding dataset schema field",
      "entityId": "146665.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DATE_OF_BIRTH does not have corresponding dataset schema field",
      "entityId": "146665.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field MAIN_LEGAL_STATUS_CODE does not have corresponding dataset schema field",
      "entityId": "146665.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field BOOKING_NUMBER does not have corresponding dataset schema field",
      "entityId": "146665.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field GENDER_DESCRIPTION does not have corresponding dataset schema field",
      "entityId": "146665.RS",
      "entityType": "variant"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DPf",
      "entityType": "dataset"
    }
  ]
}