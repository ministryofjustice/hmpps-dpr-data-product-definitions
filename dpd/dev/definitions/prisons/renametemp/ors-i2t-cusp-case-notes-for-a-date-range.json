{
  "id": "FkwIeGGbUQgAN2QAAHCLpl96ACJIAAzC",
  "name": "ORS i2T CuSP Case Notes for a Date Range",
  "description": "This report was created for Young Custody Service and will be used to populate i2Toolbox. This report is not to be amended unless requested by the Security and Intelligence Team at YCS.<br/><br/>DQ0029 v.01 Last Updated 26/10/2021",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "DQ0029  v1.00"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3377299/DP2",
      "name": "Case Notes",
      "description": "OR - Demographics",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_OFFENDER.FIRST_NAME, AT_OFFENDER.LAST_NAME, AT_OFFENDER_CASE_NOTES.CONTACT_DATE, AT_OFFENDER_CASE_NOTES.CONTACT_TIME, AT_STAFF_USER_ACCOUNTS.USERNAME, AT_CASE_NOTES_STAFF_MEMBERS.FIRST_NAME AS CASE_NOTES_STAFF_FIRST_NAME, AT_CASE_NOTES_STAFF_MEMBERS.LAST_NAME AS CASE_NOTES_STAFF_LAST_NAME, AT_OFFENDER_CASE_NOTES.CASE_NOTE_TEXT, AT_OFFENDER_CASE_NOTES.CASE_NOTE_SUB_TYPE, AT_OFFENDER_CASE_NOTES.CASE_NOTE_TYPE, AT_OFFENDER_CASE_NOTES.AUDIT_TIMESTAMP, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_CASE_NOTE_AGENCY_LOC.AGY_LOC_ID AS CASE_NOTE_ESTABLISHMENT_CODE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_CASE_NOTE_AGENCY_LOC, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.STAFF_MEMBERS AT_CASE_NOTES_STAFF_MEMBERS, OMS_OWNER.OFFENDER_CASE_NOTES AT_OFFENDER_CASE_NOTES, OMS_OWNER.STAFF_USER_ACCOUNTS AT_STAFF_USER_ACCOUNTS, USER_ACCESSIBLE_CASELOADS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_CASE_NOTES.OFFENDER_BOOK_ID) AND (AT_STAFF_USER_ACCOUNTS.STAFF_ID = AT_CASE_NOTES_STAFF_MEMBERS.STAFF_ID) AND (AT_OFFENDER_CASE_NOTES.STAFF_ID = AT_STAFF_USER_ACCOUNTS.STAFF_ID) AND (AT_OFFENDER_CASE_NOTES.AGY_LOC_ID = AT_CASE_NOTE_AGENCY_LOC.AGY_LOC_ID (+)) AND (AT_CASE_NOTE_AGENCY_LOC.AGENCY_LOCATION_TYPE (+) = 'INST') AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDER_CASE_NOTES.CONTACT_DATE BETWEEN (SELECT START_DATE FROM prompt_ /* = #prompt('Start Date:','D',,Mono,Free,Not_Persistent,,User:0) */) AND (SELECT END_DATE FROM prompt_ /* = #prompt('End Date:','D',,Mono,Free,Not_Persistent,,User:1) */) AND AT_OFFENDER_CASE_NOTES.CASE_NOTE_TYPE = 'CUSP' AND AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #prompt('Establishment Code(s):','A','Establishment\\Establishment Code',Multi,Free,Not_Persistent,,User:2) */) AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, FIRST_NAME, LAST_NAME, CONTACT_DATE, CONTACT_TIME, USERNAME, CASE_NOTES_STAFF_FIRST_NAME, CASE_NOTES_STAFF_LAST_NAME, CASE_NOTE_TEXT, CASE_NOTE_SUB_TYPE, CASE_NOTE_TYPE, AUDIT_TIMESTAMP, AGY_LOC_ID, CASE_NOTE_ESTABLISHMENT_CODE, CASE_NOTE_TYPE || ' - ' || V_CASE_NOTE_SUBTYPE_ALL AS V_CASE_NOTE_TYPE_SUBTYPE_ALL, CASE_NOTES_STAFF_FIRST_NAME || ' ' || CASE_NOTES_STAFF_LAST_NAME AS V_CONCAT_NAME FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Start Date:",
          "description": "@prompt('Start Date:','D',,Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "End Date:",
          "description": "@prompt('End Date:','D',,Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@prompt('Establishment Code(s):','A','Establishment\\Establishment Code',Multi,Free,Not_Persistent,,User:2)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP2.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP2.DO46",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP2.DO45",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "CONTACT_DATE",
            "type": "date",
            "display": "Contact Date",
            "legacyId": "DP2.DOc94",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "CONTACT_TIME",
            "type": "date",
            "display": "Contact Time",
            "legacyId": "DP2.DOcb3",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "USERNAME",
            "type": "string",
            "display": "Case Notes Staff User Id",
            "legacyId": "DP2.DOcc4",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "CASE_NOTES_STAFF_FIRST_NAME",
            "type": "string",
            "display": "Case Notes Staff First Name",
            "legacyId": "DP2.DOcc2",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "CASE_NOTES_STAFF_LAST_NAME",
            "type": "string",
            "display": "Case Notes Staff Last Name",
            "legacyId": "DP2.DOcc1",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "CASE_NOTE_TEXT",
            "type": "string",
            "display": "Case Note Text",
            "legacyId": "DP2.DOcb8",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CASE_NOTE_SUB_TYPE",
            "type": "string",
            "display": "Case Note Sub Type",
            "legacyId": "DP2.DOcb5",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "CASE_NOTE_TYPE",
            "type": "string",
            "display": "Case Note Type",
            "legacyId": "DP2.DOcb4",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "AUDIT_TIMESTAMP",
            "type": "date",
            "display": "Audit Timestamp",
            "legacyId": "DP2.DOcba",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "Establishment Code",
            "legacyId": "DP2.DO43b",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "CASE_NOTE_ESTABLISHMENT_CODE",
            "type": "string",
            "display": "Case Note Establishment Code",
            "legacyId": "DP2.DO111d",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "V_CASE_NOTE_TYPE_SUBTYPE_ALL",
            "type": "string",
            "display": "V_CASE_NOTE_TYPE_SUBTYPE_ALL",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 15,
            "name": "V_CONCAT_NAME",
            "type": "string",
            "display": "V_CONCAT_NAME",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "164386.RS",
      "name": "CuSP All",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP2",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:CASE_NOTE_ESTABLISHMENT_CODE",
            "display": "Case Note Establishment Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO111d"
          },
          {
            "name": "$ref:AGY_LOC_ID",
            "display": "Establishment Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO43b"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO44"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO45"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DO46"
          },
          {
            "name": "$ref:AUDIT_TIMESTAMP",
            "display": "Audit Timestamp",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DOcba"
          },
          {
            "name": "$ref:CONTACT_TIME",
            "display": "Contact Time",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DOcb3"
          },
          {
            "name": "$ref:V_CASE_NOTE_TYPE_SUBTYPE_ALL",
            "display": "Case Note Type/Sub Type",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Case Note Type]+\" - \" +[v_case_note_subtype_all]"
          },
          {
            "name": "$ref:CASE_NOTE_TEXT",
            "display": "Case Note Text",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP2.DOcb8"
          },
          {
            "name": "$ref:V_CONCAT_NAME",
            "display": "Staff Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Case Notes Staff First Name] +\" \" + [Case Notes Staff Last Name]"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "sqlQuery",
      "error": "Error: ORA-00904: \"V_CASE_NOTE_SUBTYPE_ALL\": invalid identifier\nHelp: https://docs.oracle.com/error-help/db/ora-00904/",
      "entityId": "3377299/DP2",
      "entityType": "dataset"
    }
  ]
}