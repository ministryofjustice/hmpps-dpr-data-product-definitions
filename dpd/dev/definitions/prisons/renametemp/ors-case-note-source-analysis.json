{
  "id": "ok9PfsAABQgAPEgANNOD8K7BO0I",
  "name": "ORS Case Note Source Analysis",
  "description": "This report shows the number of case notes entered by users vs automatic system entries for current prisoners at an establishment. The total prison population is also displayed in order to give context to the case note counts.<br/>DQ0012 - v00.00.02 Last Modified: 21/07/15",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "DQ0012 v00.00.02 LSRIT037"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3377299/DP2",
      "name": "Case Note Source",
      "description": "Demographic",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER_CASE_NOTES.NOTE_SOURCE_CODE, COUNT(AT_OFFENDER_CASE_NOTES.NOTE_SOURCE_CODE) AS COUNT_OF_CASE_NOTE_SOURCE_CODE FROM OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_CASE_NOTES AT_OFFENDER_CASE_NOTES WHERE (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_CASE_NOTES.OFFENDER_BOOK_ID) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_OFFENDER_BOOKING.IN_OUT_STATUS IN ('IN', 'OUT') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3) */)) AND AT_OFFENDER_CASE_NOTES.CONTACT_DATE BETWEEN (SELECT START_DATE FROM prompt_ /* = #prompt('Case Note Entry Start Date','D','Case Notes\\Contact Date',Mono,Free,Not_Persistent,,User:0) */) AND (SELECT END_DATE FROM prompt_ /* = #prompt('Case Note Entry End Date','D','Case Notes\\Contact Date',Mono,Free,Not_Persistent,,User:1) */)) GROUP BY AT_OFFENDER_CASE_NOTES.NOTE_SOURCE_CODE), dataset_ AS (SELECT NOTE_SOURCE_CODE, COUNT_OF_CASE_NOTE_SOURCE_CODE FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true",
          "referenceType": "establishment"
        },
        {
          "index": 1,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Case Note Entry Start Date",
          "description": "@prompt('Case Note Entry Start Date','D','Case Notes\\Contact Date',Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Case Note Entry End Date",
          "description": "@prompt('Case Note Entry End Date','D','Case Notes\\Contact Date',Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "NOTE_SOURCE_CODE",
            "type": "string",
            "display": "Note Source Code",
            "legacyId": "DP2.DOf3c",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "COUNT_OF_CASE_NOTE_SOURCE_CODE",
            "type": "double",
            "display": "Count of Case Note Source Code",
            "legacyId": "DP2.DOf3d",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3377299/DP4",
      "name": "All Case Note Source Types",
      "description": "Demographic",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT DT_ALL_CASE_SOURCE.CASENOTESOURCE FROM (SELECT 'AUTO' AS CaseNoteSource FROM DUAL UNION SELECT 'INST' AS CaseNoteSource FROM DUAL) DT_ALL_CASE_SOURCE), dataset_ AS (SELECT CASENOTESOURCE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "CASENOTESOURCE",
            "type": "string",
            "display": "Casenotesource from DUAL",
            "legacyId": "DP4.DOf40",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3377299/DP5",
      "name": "Population",
      "description": "Demographic",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT COUNT(DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY) AS COUNT_NOMS_NUMBER FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_OFFENDER_BOOKING.IN_OUT_STATUS IN ('IN', 'OUT') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3) */)))), dataset_ AS (SELECT COUNT_NOMS_NUMBER FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "COUNT_NOMS_NUMBER",
            "type": "double",
            "display": "Count NOMS Number",
            "legacyId": "DP5.DO5e4",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "159356.RS",
      "name": "Case Note Source Analysis",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3377299/DP2",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-tab",
        "field": []
      }
    }
  ],
  "errors": [
    {
      "type": "schema",
      "error": "Report does not have any schema fields",
      "entityId": "159356.RS",
      "entityType": "report"
    }
  ]
}