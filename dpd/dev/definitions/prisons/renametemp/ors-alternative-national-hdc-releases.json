{
  "id": "FvuynlpnHwcAqMsBAHCLZV8BACJIABRd",
  "name": "ORS Alternative National HDC Releases",
  "description": "<br/><br/>HDC0008 v1.0  This report has been designed specifically for the Prison & Probation Analytical Services team in order to assist with a government enquiry into the state of HDC releases currently across the prison estate. It can be used to look at HDC releases which have occurred between two dates, it shows key HDC information along with Key dates. ",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "HDC0008"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3376286/DP3",
      "name": "Offenders",
      "description": "OR - Sentence",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_MOV_LOC_FROM_OFFND_LOCTION.DESCRIPTION, Case when AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS In ('14FTR_ORA','14FTRHDC_ORA','CUR_ORA','FTR/08','FTR_HDC','FTR_HDC_ORA','FTR_ORA','FTR_SCH15','FTRSCH15_ORA','HDR_ORA','LR','LR_ALP','LR_ALP_LASPO','LR_DLP','LR_DPP','LR_EPP','LR_ES','LR_HDC','LR_IPP','LR_LASPO_AR','LR_LASPO_DR','LR_LIFE','LR_MLP','LR_ORA','LR_SEC236A','LR_SEC91_ORA','LR_YOI','LR_YOI_ORA') then 'Recall' when AT_IMPRISON_STATUSES.BAND_CODE = '0' then 'Dead' when AT_IMPRISON_STATUSES.BAND_CODE = '1' then 'Indeterminate Sentence' when AT_IMPRISON_STATUSES.BAND_CODE in ('2','3') then 'Sentenced' when AT_IMPRISON_STATUSES.BAND_CODE in ('4','5','6','7') then 'Convicted Unsentenced' when AT_IMPRISON_STATUSES.BAND_CODE in ('9','10') or AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS = 'CIV_RMD' then 'Civil Prisoners' when AT_IMPRISON_STATUSES.BAND_CODE in ('8','11') then 'Immigration Detainees' when AT_IMPRISON_STATUSES.BAND_CODE in ('12','13','14') then 'Remand' when AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS = 'UNKNOWN' then 'Unknown' else 'Other' end, AT_MOVEMENT_REASONS.DESCRIPTION, trunc(AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE), AT_HDC_REQUEST_REFERRALS.REFERRAL_TO, AT_HDC_REQUEST_REFERRALS.REFERRAL_DATE, AT_HDC_REQUEST_REFERRALS.RECEIVED_DATE, AT_OFFENDER_CURFEWS.APPROVAL_STATUS, AT_OFFENDER_CURFEWS.DECISION_DATE, AT_OFFENDER_CURFEWS.REVIEW_FLAG, nvl(AT_OFFENDER_SENT_CALCULATIONS.HDCED_OVERRIDED_DATE,AT_OFFENDER_SENT_CALCULATIONS.HDCED_CALCULATED_DATE), nvl(AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE,AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE), nvl(AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE,AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE), AT_SENT_ORDERS.COURT_DATE, case When DT_OFFENDER_LIFE_FLAG.LIFE_SENTENCE_FLAG='Y' Then 'Life' else AT_OFFENDER_SENT_CALCULATIONS.EFFECTIVE_SENTENCE_LENGTH end, AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID, AT_OFFENDER_SENT_CALCULATIONS.CREATE_DATETIME, AT_OFFENDER_CURFEWS.ASSESSMENT_DATE, AT_OFFENDER_CURFEWS.PASSED_FLAG, AT_OFFENDER_BOOKING.BOOKING_NO, DT_ADMISSION.ADMISSION_DATE, AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_REASON_CODE FROM OMS_OWNER.OFFENDER_SENTENCES AT_OFFENDER_SENTENCES, OMS_OWNER.OFFENDERS AT_OFFENDER, --OMS_OWNER.REFERENCE_CODES AT_MOV_TYPE_DESC, OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_MOV_LOC_FROM_OFFND_LOCTION, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS, OMS_OWNER.MOVEMENT_REASONS AT_MOVEMENT_REASONS, OMS_OWNER.IMPRISONMENT_STATUSES AT_IMPRISON_STATUSES, OMS_OWNER.HDC_REQUEST_REFERRALS AT_HDC_REQUEST_REFERRALS, OMS_OWNER.OFFENDER_CURFEWS AT_OFFENDER_CURFEWS, OMS_OWNER.ORDERS AT_SENT_ORDERS, ( select distinct OFFENDER_SENTENCE_TERMS.OFFENDER_BOOK_ID, OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG from OFFENDER_SENTENCE_TERMS where OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y' ) DT_OFFENDER_LIFE_FLAG, OMS_OWNER.OFFENDER_ASSESSMENTS AT_ASSESSMENTS, ( Select distinct m.OFFENDER_BOOK_ID, max(m.MOVEMENT_TIME) as ADMISSION_DATE from OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS m, OMS_OWNER.offender_bookings h Where m.direction_code='IN' AND m.Movement_reason_code !='R' AND m.Movement_type = 'ADM' and m.to_agy_loc_id = h.agy_loc_id and h.offender_book_id=m.offender_book_id group by m.OFFENDER_BOOK_ID ) DT_ADMISSION, OMS_OWNER.OFFENDER_IMPRISON_STATUSES AT_OFFENDER_IMPRISON_STATUSES WHERE ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID=AT_OFFENDER_CURFEWS.OFFENDER_BOOK_ID(+) ) AND ( AT_OFFENDER_CURFEWS.OFFENDER_BOOK_ID=AT_HDC_REQUEST_REFERRALS.OFFENDER_BOOK_ID(+) and AT_OFFENDER_CURFEWS.OFFENDER_CURFEW_ID=AT_HDC_REQUEST_REFERRALS.OFFENDER_CURFEW_ID(+) ) AND ( AT_OFFENDER.OFFENDER_ID=AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID=AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID(+) ) AND ( AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE=AT_MOVEMENT_REASONS.MOVEMENT_TYPE and AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_REASON_CODE=AT_MOVEMENT_REASONS.MOVEMENT_REASON_CODE ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID=AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID(+) ) AND ( AT_OFFENDER_IMPRISON_STATUSES.OFFENDER_BOOK_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_SENTENCES.OFFENDER_BOOK_ID(+)=AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS='Y' or AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS is null ) --AND ( AT_MOV_TYPE_DESC.CODE(+)=AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE ) --AND ( AT_MOV_TYPE_DESC.DOMAIN(+)=('MOVE_TYPE') ) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE = 'REL') AND ( AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID=AT_MOV_LOC_FROM_OFFND_LOCTION.AGY_LOC_ID(+) ) AND ( DT_OFFENDER_LIFE_FLAG.OFFENDER_BOOK_ID(+)=AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID ) AND ( AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS(+)=AT_OFFENDER_IMPRISON_STATUSES.IMPRISONMENT_STATUS ) AND ( AT_MOV_LOC_FROM_OFFND_LOCTION.AGENCY_LOCATION_TYPE='INST' ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID=DT_ADMISSION.OFFENDER_BOOK_ID(+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID=AT_ASSESSMENTS.OFFENDER_BOOK_ID(+) ) AND ( AT_SENT_ORDERS.ORDER_ID=AT_OFFENDER_SENTENCES.ORDER_ID ) AND ( AT_OFFENDER_SENTENCES.SENTENCE_CATEGORY <> 'LICENCE' AND AT_OFFENDER_SENTENCES.SENTENCE_CALC_TYPE NOT LIKE '%AGG%' ) AND ( trunc(AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE) BETWEEN '01-02-2018 00:00:00' AND '28-02-2018 00:00:00' AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE IN ( 'OUT' ) --AND --AT_MOV_TYPE_DESC.DESCRIPTION IN ( 'Release' ) AND AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_REASON_CODE IN ( '99','AR','AU','CE','CR','D1','D2','D3','D4','D5','D6','DD','DEC','DISC','ER','ESCP','HC','HD','HE','HR','HU','IF','NG','NP','PD','PF','REL','RW','SC' ) AND AT_OFFENDER_SENT_CALCULATIONS.CREATE_DATETIME < AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE AND ( AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID IN ((SELECT establishment_code from prompt_)) or 'All' in ((SELECT establishment_code from prompt_)) ) )), dataset_ AS (SELECT FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": []
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "85153.RS",
      "name": "HDC Releases",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_DISPLAY = 'DISPLAY')"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:DP3_DO10D7E",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DO10C6A",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DO10044",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DO10C23",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DO1082F",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_MIN_SENTENCE",
            "display": "Sentence Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Min([Sentence Date]) In ([NOMS Number])"
          },
          {
            "name": "$ref:DP3_DO1108A",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DO10463",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_MAX_HDC_CHECKS_DONE_DATE",
            "display": "HDC Checks Done Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Max([HDC Checks Done Date])"
          },
          {
            "name": "$ref:DP3_DO9B4",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:V_HDC_REFERRAL_TO_GOVERNOR_D34",
            "display": "Referral To",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(([HDC Referral To]) =\"GOVERNOR\";\"GOVERNOR\") In ([NOMS Number])"
          },
          {
            "name": "$ref:MAX_GOV_REFERRAL_REC_D_DATE",
            "display": "HDC Referral Received Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Max([v_referral_GOVERNOR_rec'd_date]) In ([NOMS Number])"
          },
          {
            "name": "$ref:DP3_DO9B2",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DO9AE",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DO1059C",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DO1082D",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DO1046F",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DO1083B",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::fixSqlFormatting sql is not valid",
      "entityId": "FvuynlpnHwcAqMsBAHCLZV8BACJIABRd",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : V_MIN_SENTENCE :: Error: Invalid expression / Unexpected token. Line 1, Col: 23.\n  MIN(SENTENCE_DATE) IN \u001b[4m,\u001b[0mNOMS_NUMBER,",
      "entityId": "FvuynlpnHwcAqMsBAHCLZV8BACJIABRd",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_HDC_REFERRAL_TO_GOVERNOR_D34 :: Error: =If(([HDC Referral To]) =\"GOVERNOR\";\"GOVERNOR\") In ([NOMS Number]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:49",
      "entityId": "FvuynlpnHwcAqMsBAHCLZV8BACJIABRd",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:MAX_GOV_REFERRAL_REC_D_DATE :: Error: =Max([v_referral_GOVERNOR_rec'd_date]) In ([NOMS Number]) ==> Error: Expected expression but \"=\" found.\n at undefined:1:1",
      "entityId": "FvuynlpnHwcAqMsBAHCLZV8BACJIABRd",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Dataset does not have any schema fields (comments -- in query)",
      "entityId": "3376286/DP3",
      "entityType": "dataset"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO10D7E does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO10C6A does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO10044 does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO10C23 does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO1082F does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_MIN_SENTENCE does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO1108A does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO10463 does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_MAX_HDC_CHECKS_DONE_DATE does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO9B4 does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_HDC_REFERRAL_TO_GOVERNOR_D34 does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field MAX_GOV_REFERRAL_REC_D_DATE does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO9B2 does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO9AE does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO1059C does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO1082D does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO1046F does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DP3_DO1083B does not have corresponding dataset schema field",
      "entityId": "85153.RS",
      "entityType": "variant"
    },
    {
      "type": "sqlQuery",
      "error": "Error: NJS-005: invalid value for parameter 1",
      "entityId": "3376286/DP3",
      "entityType": "dataset"
    }
  ]
}