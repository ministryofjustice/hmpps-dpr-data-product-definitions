{
  "id": "klYmGkAAA_pNJdcA.0cAISgV_bQ",
  "name": "MIS Draft Monthly Serious or Sexual Assault Incident Summary",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "INC0012 v00.00.05 LSRIT026"
    ]
  },
  "description": "Returns the serious and/or sexual assaults for establishments per month. The user enters a date and data is returned for up to twelve months from the start of the month of the date entered, or up until end of the preceding month on which the report is run.<br/>INC0012 - v00.00.05 Last Modified: 19/10/10",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3375377/DP3",
      "name": "MIS Load",
      "description": "MIS Incidents",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT BODIMIS.ETL_LOAD_LOG.BUSINESS_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT BUSINESS_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BUSINESS_DATE",
            "type": "date",
            "display": "Latest Business Date Available",
            "legacyId": "DP3.DO104dd",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375377/DPc",
      "name": "Incidents Serious",
      "description": "MIS Incidents",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT AT_INCIDENT_DATE.DAY_DATE, AT_INCIDENT_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION, count(distinct CASE WHEN AT_INCIDENT_QUESTION.QUESTION_DESCRIPTION IN ( 'WAS A SERIOUS INJURY SUSTAINED', 'WAS THIS A SEXUAL ASSAULT', 'DID INJURIES RESULT IN DETENTION IN OUTSIDE HOSPITAL AS AN IN-PATIENT', 'WAS MEDICAL TREATMENT FOR CONCUSSION OR INTERNAL INJURIES REQUIRED' ) AND AT_INCIDENT_ANSWER.ANSWER_DESCRIPTION='YES' THEN AT_INCIDENT_QUESTIONNAIRE.INCIDENT_CASE_ID WHEN AT_INCIDENT_QUESTION.QUESTION_DESCRIPTION ='WHICH SERIOUS INJURIES WERE SUSTAINED' AND AT_INCIDENT_ANSWER.ANSWER_DESCRIPTION IN ( 'BITES', 'BLACK EYE', 'BROKEN NOSE', 'BROKEN TEETH', 'CRUSHING', 'EXTENSIVE/MULTIPLE BRUISING', 'EXTENSIVE OR MULTIPLE BRUISING', 'FRACTURE', 'SCALD OR BURN', 'STABBING', 'TEMPORARY/PERMANENT BLINDNESS') THEN AT_INCIDENT_QUESTIONNAIRE.INCIDENT_CASE_ID END) FROM BODIMIS.FACT_INCIDENT_QUESTIONNAIRE AT_INCIDENT_QUESTIONNAIRE, BODIMIS.FACT_INCIDENT AT_INCIDENT, BODIMIS.DIM_ESTABLISHMENT AT_INCIDENT_ESTABLISHMENT, BODIMIS.DIM_DATE AT_INCIDENT_DATE, BODIMIS.DIM_INCIDENT_QUESTION AT_INCIDENT_QUESTION, BODIMIS.DIM_INCIDENT_ANSWER AT_INCIDENT_ANSWER, BODIMIS.DIM_INCIDENT_STATUS AT_INCIDENT_STATUS, (       select  a.incident_case_id as INCIDENT_CASE_ID  ,max(b.questionnaire_id) as MAX_QUESTIONNARE_ID  from  bodimis.fact_incident_questionnaire a  ,bodimis.dim_incident_question b  where  a.incident_question_sk=b.incident_question_sk  group by  a.incident_case_id   )  DT_MOST_RECENT_QUESTIONNAIRE WHERE   ( AT_INCIDENT.INCIDENT_STATUS_SK=AT_INCIDENT_STATUS.INCIDENT_STATUS_SK  )   AND  ( AT_INCIDENT_ESTABLISHMENT.ESTABLISHMENT_SK=AT_INCIDENT.ESTABLISHMENT_SK  )   AND  ( AT_INCIDENT_DATE.DATE_SK=AT_INCIDENT.INCIDENT_DATE_SK  )   AND  ( AT_INCIDENT_QUESTIONNAIRE.INCIDENT_CASE_ID=AT_INCIDENT.INCIDENT_CASE_ID  )   AND  ( AT_INCIDENT_ANSWER.INCIDENT_QUESTION_SK=AT_INCIDENT_QUESTION.INCIDENT_QUESTION_SK  )   AND  ( AT_INCIDENT_QUESTIONNAIRE.INCIDENT_ANSWER_SK=AT_INCIDENT_ANSWER.INCIDENT_ANSWER_SK  )   AND  ( AT_INCIDENT_STATUS.INCIDENT_STATUS_ID_NK!='DUP'  )   AND  ( AT_INCIDENT_QUESTIONNAIRE.INCIDENT_CASE_ID=DT_MOST_RECENT_QUESTIONNAIRE.INCIDENT_CASE_ID  )   AND  ( AT_INCIDENT_STATUS.INCIDENT_STATUS_ID_NK!='DUP'  )   AND     (    AT_INCIDENT_DATE.DAY_DATE  >=  '01-10-2015 00:00:00'    AND    AT_INCIDENT_DATE.DAY_DATE  <=  '20-10-2015 00:00:00'    AND    AT_INCIDENT_ESTABLISHMENT.ESTABLISHMENT_CODE_NK  IN  ((SELECT establishment_code from prompt_))    AND    ( ( AT_INCIDENT_QUESTION.QUESTIONNAIRE_ID ) = ( DT_MOST_RECENT_QUESTIONNAIRE.MAX_QUESTIONNARE_ID )  )    AND    ( (AT_INCIDENT_QUESTION.QUESTION_DESCRIPTION   IN (  'WAS A SERIOUS INJURY SUSTAINED',  'WAS THIS A SEXUAL ASSAULT',  'DID INJURIES RESULT IN DETENTION IN OUTSIDE HOSPITAL AS AN IN-PATIENT',  'WAS MEDICAL TREATMENT FOR CONCUSSION OR INTERNAL INJURIES REQUIRED') AND AT_INCIDENT_ANSWER.ANSWER_DESCRIPTION = 'YES' ) or   (AT_INCIDENT_QUESTION.QUESTION_DESCRIPTION ='WHICH SERIOUS INJURIES WERE SUSTAINED' AND   AT_INCIDENT_ANSWER.ANSWER_DESCRIPTION   IN (  'BITES',  'BLACK EYE',  'BROKEN NOSE',  'BROKEN TEETH',  'CRUSHING',  'EXTENSIVE/MULTIPLE BRUISING',  'EXTENSIVE OR MULTIPLE BRUISING',  'FRACTURE',  'SCALD OR BURN',  'STABBING',  'TEMPORARY/PERMANENT BLINDNESS)) ) ) GROUP BY AT_INCIDENT_DATE.DAY_DATE, AT_INCIDENT_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION), dataset_ AS (SELECT FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": []
      }
    },
    {
      "id": "3375377/DPe",
      "name": "Incidents Assault On",
      "description": "MIS Incidents",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT SUM(CASE WHEN AT_INCIDENT_QUESTION.QUESTION_DESCRIPTION = 'WHAT TYPE OF ASSAULT WAS IT' AND AT_INCIDENT_ANSWER.ANSWER_DESCRIPTION = 'PRISONER ON OFFICER' THEN 1 ELSE 0 END) AS NUMBER_OF_PRISONER_ON_OFFICE38, SUM(CASE WHEN AT_INCIDENT_QUESTION.QUESTION_DESCRIPTION = 'WHAT TYPE OF ASSAULT WAS IT' AND AT_INCIDENT_ANSWER.ANSWER_DESCRIPTION = 'PRISONER ON PRISONER' THEN 1 ELSE 0 END) AS NUMBER_OF_PRISONER_ON_PRISON39, SUM(CASE WHEN AT_INCIDENT_QUESTION.QUESTION_DESCRIPTION = 'WHAT TYPE OF ASSAULT WAS IT' AND AT_INCIDENT_ANSWER.ANSWER_DESCRIPTION = 'PRISONER ON OTHER' THEN 1 ELSE 0 END) AS NUMBER_OF_PRISONER_ON_OTHER_36, SUM(CASE WHEN AT_INCIDENT_QUESTION.QUESTION_DESCRIPTION = 'WHAT TYPE OF ASSAULT WAS IT' AND AT_INCIDENT_ANSWER.ANSWER_DESCRIPTION = 'OTHER' THEN 1 ELSE 0 END) AS NUMBER_OF_OTHER_ASSAULTS, AT_INCIDENT_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION, AT_INCIDENT_DATE.DAY_DATE FROM BODIMIS.FACT_INCIDENT_QUESTIONNAIRE AT_INCIDENT_QUESTIONNAIRE, BODIMIS.FACT_INCIDENT AT_INCIDENT, BODIMIS.DIM_ESTABLISHMENT AT_INCIDENT_ESTABLISHMENT, BODIMIS.DIM_INCIDENT_QUESTION AT_INCIDENT_QUESTION, BODIMIS.DIM_INCIDENT_ANSWER AT_INCIDENT_ANSWER, BODIMIS.DIM_INCIDENT_STATUS AT_INCIDENT_STATUS, BODIMIS.DIM_DATE AT_INCIDENT_DATE WHERE (AT_INCIDENT.INCIDENT_STATUS_SK = AT_INCIDENT_STATUS.INCIDENT_STATUS_SK) AND (AT_INCIDENT_ESTABLISHMENT.ESTABLISHMENT_SK = AT_INCIDENT.ESTABLISHMENT_SK) AND (AT_INCIDENT_DATE.DATE_SK = AT_INCIDENT.INCIDENT_DATE_SK) AND (AT_INCIDENT_QUESTIONNAIRE.INCIDENT_CASE_ID = AT_INCIDENT.INCIDENT_CASE_ID) AND (AT_INCIDENT_ANSWER.INCIDENT_QUESTION_SK = AT_INCIDENT_QUESTION.INCIDENT_QUESTION_SK) AND (AT_INCIDENT_QUESTIONNAIRE.INCIDENT_ANSWER_SK = AT_INCIDENT_ANSWER.INCIDENT_ANSWER_SK) AND (AT_INCIDENT_STATUS.INCIDENT_STATUS_ID_NK <> 'DUP') AND (AT_INCIDENT_STATUS.INCIDENT_STATUS_ID_NK <> 'DUP') AND (AT_INCIDENT_STATUS.INCIDENT_STATUS_ID_NK <> 'DUP') AND (AT_INCIDENT_STATUS.INCIDENT_STATUS_ID_NK <> 'DUP') AND (AT_INCIDENT_STATUS.INCIDENT_STATUS_ID_NK <> 'DUP') AND (AT_INCIDENT_DATE.DAY_DATE >= TO_DATE('01-10-2015 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_INCIDENT_DATE.DAY_DATE <= TO_DATE('20-10-2015 00:00:00', 'DD-MM-YYYY HH24:MI:SS') AND AT_INCIDENT_ESTABLISHMENT.ESTABLISHMENT_CODE_NK IN ((SELECT establishment_code FROM prompt_)) AND AT_INCIDENT_ANSWER.QUESTIONNAIRE_ANS_ID IN (180540, 179730, 179731, 179732, 179733)) GROUP BY AT_INCIDENT_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION, AT_INCIDENT_DATE.DAY_DATE), dataset_ AS (SELECT NUMBER_OF_PRISONER_ON_OFFICE38, NUMBER_OF_PRISONER_ON_PRISON39, NUMBER_OF_PRISONER_ON_OTHER_36, NUMBER_OF_OTHER_ASSAULTS, ESTABLISHMENT_DESCRIPTION, DAY_DATE FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "NUMBER_OF_PRISONER_ON_OFFICE38",
            "type": "double",
            "display": "Number of Prisoner on Officer Assaults",
            "legacyId": "DPe.DO6a1",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "NUMBER_OF_PRISONER_ON_PRISON39",
            "type": "double",
            "display": "Number of Prisoner on Prisoner Assaults",
            "legacyId": "DPe.DO6a2",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "NUMBER_OF_PRISONER_ON_OTHER_36",
            "type": "double",
            "display": "Number of Prisoner on Other Assaults",
            "legacyId": "DPe.DO6a3",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "NUMBER_OF_OTHER_ASSAULTS",
            "type": "double",
            "display": "Number of Other Assaults",
            "legacyId": "DPe.DO6a4",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "ESTABLISHMENT_DESCRIPTION",
            "type": "string",
            "display": "Incident Establishment Name",
            "legacyId": "DPe.DO20",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "DAY_DATE",
            "type": "date",
            "display": "Incident Date (Date Only)",
            "legacyId": "DPe.DO1b",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "117208.RS",
      "name": "Monthly Serious or Sexual Assault Incident Summary",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375377/DPc",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:DPC_DO20",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DPC_DO6A5",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:NUMBER_OF_PRISONER_ON_OFFICE38",
            "display": "Number of Prisoner on Officer Assaults",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPe.DO6a1"
          },
          {
            "name": "$ref:NUMBER_OF_PRISONER_ON_PRISON39",
            "display": "Number of Prisoner on Prisoner Assaults",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPe.DO6a2"
          },
          {
            "name": "$ref:NUMBER_OF_PRISONER_ON_OTHER_36",
            "display": "Number of Prisoner on Other Assaults",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPe.DO6a3"
          },
          {
            "name": "$ref:NUMBER_OF_OTHER_ASSAULTS",
            "display": "Number of Other Assaults",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DPe.DO6a4"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::fixSqlFormatting sql is not valid [Error tokenizing 'T_INCIDENT_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTIO': Missing ' from 1:3339]",
      "entityId": "klYmGkAAA_pNJdcA.0cAISgV_bQ",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Dataset does not have any schema fields",
      "entityId": "3375377/DPc",
      "entityType": "dataset"
    },
    {
      "type": "schema",
      "error": "Report field DPC_DO20 does not have corresponding dataset schema field",
      "entityId": "117208.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field DPC_DO6A5 does not have corresponding dataset schema field",
      "entityId": "117208.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field NUMBER_OF_PRISONER_ON_OFFICE38 does not have corresponding dataset schema field",
      "entityId": "117208.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field NUMBER_OF_PRISONER_ON_PRISON39 does not have corresponding dataset schema field",
      "entityId": "117208.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field NUMBER_OF_PRISONER_ON_OTHER_36 does not have corresponding dataset schema field",
      "entityId": "117208.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field NUMBER_OF_OTHER_ASSAULTS does not have corresponding dataset schema field",
      "entityId": "117208.RS",
      "entityType": "variant"
    },
    {
      "type": "athenQuery",
      "error": "unable to generate test sql",
      "entityId": "3375377/DPc",
      "entityType": "dataset"
    }
  ]
}