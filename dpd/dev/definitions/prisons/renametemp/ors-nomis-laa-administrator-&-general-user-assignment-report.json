{
  "id": "okjGpx0ABplzIpMANz2EcEP6cGc",
  "name": "ORS NOMIS LAA Administrator & General User Assignment  Report",
  "description": "CAD0006 - v00.00.05 This report lists the NOMIS user accounts whose account (of type General or Administrator) has been assigned or de-assigned as a 'Local Administrator' during a default period of 7 days before the current date. The end user can change the default period at runtime.",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "CAD0006  v00.00.05 drop10"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3375624/DP0",
      "name": "LAA Administrator & General User",
      "description": "C-NOMIS Audit",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AUDITREF_STAFF_MBRS.LAST_NAME, AUDITREF_STAFF_MBRS.FIRST_NAME, AUDITREF_STAFF_USER_ACCS.USERNAME, AUDITREF_STAFF_USER_ACCS.STAFF_USER_TYPE, AUDITREF_STAFF_USER_ACCS.WORKING_CASELOAD_ID, CASE WHEN AUDITDATA.AUDIT_TABLE.LCR_OBJECT_NAME = 'LAA_ADMINISTRATORS' THEN 'Adminstrator' ELSE 'General User' END AS AT_NOMIS_LAA_USER_TYPE, TRUNC(AUDITDATA.AUDIT_TABLE.AUDIT_TIMESTAMP) AS AT_DATE_OF_CHANGE_, TO_CHAR(AUDITDATA.AUDIT_TABLE.AUDIT_TIMESTAMP, 'HH24:MI:SS') AS AT_TIME_OF_CHANGE_, AUDITREF.LOCAL_ADMIN_AUTHORITIES.LOCAL_AUTHORITY_CODE, AUDITREF.LOCAL_ADMIN_AUTHORITIES.DESCRIPTION, CASE WHEN AUDITDATA.AUDIT_TABLE.LCR_COMMAND_TYPE = 'INSERT' THEN 'Assigned' WHEN AUDITDATA.AUDIT_TABLE.LCR_COMMAND_TYPE = 'DELETE' THEN 'De-assigned' ELSE 'Changed' END AS AT_ASSIGNMENT_DE_ASSIGNMENT_37, AUDITREF.STAFF_MEMBERS.LAST_NAME AS NOMIS_USER_LAST_NAME, AUDITREF.STAFF_MEMBERS.FIRST_NAME AS NOMIS_USER_FIRST_NAME, COALESCE(AUDITREF.STAFF_USER_ACCOUNTS.USERNAME, 'N/A') AS NOMIS_USER_ACCOUNT_NAME, COALESCE(AUDITREF.STAFF_USER_ACCOUNTS.STAFF_USER_TYPE, 'N/A') AS NOMIS_USER_ACCOUNT_TYPE, AUDITREF.STAFF_USER_ACCOUNTS.WORKING_CASELOAD_ID AS NOMIS_USER_WORKING_CASELOAD FROM AUDITDATA.AUDIT_COLUMN AUDIT_COLUMN_LAUTH, AUDITDATA.AUDIT_COLUMN AUDIT_COLUMN_LAAUSER, AUDITDATA.AUDIT_TABLE, AUDITREF.STAFF_MEMBERS AUDITREF_STAFF_MBRS, AUDITREF.STAFF_MEMBERS, AUDITREF.STAFF_USER_ACCOUNTS AUDITREF_STAFF_USER_ACCS, AUDITREF.STAFF_USER_ACCOUNTS, AUDITREF.LOCAL_ADMIN_AUTHORITIES WHERE (AUDITREF.STAFF_USER_ACCOUNTS.STAFF_ID = AUDITREF.STAFF_MEMBERS.STAFF_ID) AND (AUDITREF.STAFF_USER_ACCOUNTS.USERNAME = AUDITDATA.AUDIT_TABLE.AUDIT_USER_ID) AND (AUDITREF_STAFF_USER_ACCS.STAFF_ID = AUDITREF_STAFF_MBRS.STAFF_ID) AND (AUDIT_COLUMN_LAUTH.LCR_COLUMN_NAME = 'local_authority_code') AND (AUDIT_COLUMN_LAUTH.AUDIT_TABLE_SEQ = AUDITDATA.AUDIT_TABLE.AUDIT_TABLE_SEQ AND AUDIT_COLUMN_LAUTH.LCR_SOURCE_TIME = AUDITDATA.AUDIT_TABLE.LCR_SOURCE_TIME AND AUDIT_COLUMN_LAUTH.LCR_COLUMN_OLD_NEW_IND = CASE WHEN AUDITDATA.AUDIT_TABLE.LCR_COMMAND_TYPE = 'INSERT' THEN 1 ELSE 0 END) AND (auditdata.GETSTRING(AUDIT_COLUMN_LAUTH.LCR_COLUMN_VALUE) = AUDITREF.LOCAL_ADMIN_AUTHORITIES.LOCAL_AUTHORITY_CODE) AND (AUDIT_COLUMN_LAAUSER.AUDIT_TABLE_SEQ = AUDIT_COLUMN_LAUTH.AUDIT_TABLE_SEQ) AND (AUDIT_COLUMN_LAAUSER.LCR_COLUMN_NAME = 'username') AND (auditdata.GETSTRING(AUDIT_COLUMN_LAAUSER.LCR_COLUMN_VALUE) = AUDITREF_STAFF_USER_ACCS.USERNAME) AND ((AUDITDATA.AUDIT_TABLE.LCR_OBJECT_NAME IN ('LAA_ADMINISTRATORS', 'LAA_GENERAL_USERS')) AND (TRUNC(AUDITDATA.AUDIT_TABLE.AUDIT_TIMESTAMP) >= TRUNC(CURRENT_TIMESTAMP - 7)))), dataset_ AS (SELECT LAST_NAME, FIRST_NAME, USERNAME, STAFF_USER_TYPE, WORKING_CASELOAD_ID, AT_NOMIS_LAA_USER_TYPE, AT_DATE_OF_CHANGE_, AT_TIME_OF_CHANGE_, LOCAL_AUTHORITY_CODE, DESCRIPTION, AT_ASSIGNMENT_DE_ASSIGNMENT_37, NOMIS_USER_LAST_NAME, NOMIS_USER_FIRST_NAME, NOMIS_USER_ACCOUNT_NAME, NOMIS_USER_ACCOUNT_TYPE, NOMIS_USER_WORKING_CASELOAD FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "LAST_NAME",
            "type": "string",
            "display": "AT NOMIS User Last Name",
            "legacyId": "DP0.DO16a",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "AT NOMIS User First Name",
            "legacyId": "DP0.DO16b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "USERNAME",
            "type": "string",
            "display": "AT NOMIS User Account Name",
            "legacyId": "DP0.DO16c",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "STAFF_USER_TYPE",
            "type": "string",
            "display": "AT NOMIS User Account Type",
            "legacyId": "DP0.DO16d",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "WORKING_CASELOAD_ID",
            "type": "string",
            "display": "AT NOMIS Working Caseload Id",
            "legacyId": "DP0.DO173",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "AT_NOMIS_LAA_USER_TYPE",
            "type": "string",
            "display": "AT NOMIS LAA User type",
            "legacyId": "DP0.DO16f",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "AT_DATE_OF_CHANGE_",
            "type": "date",
            "display": "AT Date of Change (DD/MM/YYYY)",
            "legacyId": "DP0.DO15f",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "AT_TIME_OF_CHANGE_",
            "type": "string",
            "display": "AT Time of Change (HH24:MI:SS)",
            "legacyId": "DP0.DO160",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "LOCAL_AUTHORITY_CODE",
            "type": "string",
            "display": "AT Local Authority Code",
            "legacyId": "DP0.DO170",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "AT Local Authority Description",
            "legacyId": "DP0.DO171",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "AT_ASSIGNMENT_DE_ASSIGNMENT_37",
            "type": "string",
            "display": "AT Assignment De-Assignment Indicator",
            "legacyId": "DP0.DO165",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "NOMIS_USER_LAST_NAME",
            "type": "string",
            "display": "NOMIS User Last Name",
            "legacyId": "DP0.DO130",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "NOMIS_USER_FIRST_NAME",
            "type": "string",
            "display": "NOMIS User First Name",
            "legacyId": "DP0.DO132",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "NOMIS_USER_ACCOUNT_NAME",
            "type": "string",
            "display": "NOMIS User Account Name",
            "legacyId": "DP0.DO133",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "NOMIS_USER_ACCOUNT_TYPE",
            "type": "string",
            "display": "NOMIS User Account Type",
            "legacyId": "DP0.DO134",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "NOMIS_USER_WORKING_CASELOAD",
            "type": "string",
            "display": "NOMIS User Working Caseload",
            "legacyId": "DP0.DO135",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "138205.RS",
      "name": "NOMIS LAA Administrator & General User Report",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375624/DP0",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-section",
        "field": [
          {
            "name": "$ref:NOMIS_USER_LAST_NAME",
            "display": "NOMIS User Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO130"
          },
          {
            "name": "$ref:NOMIS_USER_FIRST_NAME",
            "display": "NOMIS User First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO132"
          },
          {
            "name": "$ref:NOMIS_USER_ACCOUNT_NAME",
            "display": "NOMIS User Account Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO133"
          },
          {
            "name": "$ref:NOMIS_USER_WORKING_CASELOAD",
            "display": "NOMIS User Working Caseload",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP0.DO135"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "sqlQuery",
      "error": "Error: ORA-00942: table or view does not exist\nHelp: https://docs.oracle.com/error-help/db/ora-00942/",
      "entityId": "3375624/DP0",
      "entityType": "dataset"
    }
  ]
}