{
  "id": "Fk_zi1y2HwEAzT4AAHBLlV8YACJIAAzC",
  "name": "ORS CSIP Establishment Specific",
  "description": "The Report retrieves those Referral records that have been entered at the Establishment.  The Prisoner may no longer be residing at this Establishment but the data is still available for stats purposes. If exported should be done so in excel due to not fitting in the parameters of a PDF<br/>INC0026 v00.00.04 Last Modified: 27/04/2020",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "INC0026 v5.0",
      "CSIP",
      "Establishment Specific"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3375850/DP1d",
      "name": "CSIP Referrals",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, TRUNC(MONTHS_BETWEEN(CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12) AS AGE_IN_YEARS, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END AS ETHNIC_CODE, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END || '-' || CASE WHEN AT_ETHNICITY_DESC.CODE = 'W8' THEN 'White: Gypsy or Irish Traveller' WHEN AT_ETHNICITY_DESC.CODE = 'O1' THEN 'Asian/Asian British: Chinese' ELSE AT_ETHNICITY_DESC.DESCRIPTION END AS ETHNIC_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID, AT_OFFENDER_CSIP_REPORTS.CSIP_SEQ, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_DATE, TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_date) + (AT_OFFENDER_CSIP_REPORTS.rfr_incident_time - TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_time)) AS RFR_INCIDENT_TIME_, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE, AT_REF_CSIP_TYPE.DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION, AT_REF_CSIP_LOC.DESCRIPTION AS RFR_INCIDENT_LOCATION_DESCRI33, AT_OFFENDER_CSIP_REPORTS.RFR_REPORTED_BY, AT_REF_CSIP_FUNC.DESCRIPTION AS RFR_AREA_OF_WORK_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED, AT_OFFENDER_CSIP_REPORTS.RFR_PROACTIVE_RESPONSE, AT_OFFENDER_CSIP_REPORTS.RFR_STAFF_ASSAULTED, AT_OFFENDER_CSIP_REPORTS.CSIP_ID, AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION AS DEC_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME_DATE, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME_DATE, AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION AS CDR_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR, AT_REF_CSIP_FAC.DESCRIPTION AS CDR_FACTOR_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OCCURRENCE_REASON, AT_OFFENDER_CSIP_REPORTS.CASE_MANAGER, AT_OFFENDER_CSIP_REPORTS.REASON, AT_OFFENDER_CSIP_PLANS.CREATE_DATE, AT_OFFENDER_CSIP_PLANS.TARGET_DATE, AT_OFFENDER_CSIP_PLANS.CLOSED_DATE, AT_OFFENDER_CSIP_PLANS.PLAN_ID, AT_OFFENDER_CSIP_REVIEWS.NEXT_REVIEW_DATE, AT_OFFENDER_CSIP_REVIEWS.CREATE_DATE AS REV_DATE, AT_OFFENDER_CSIP_REVIEWS.CLOSE_DATE, AT_OFFENDER_CSIP_REVIEWS.REVIEW_SEQ FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_ETHNICITY_DESC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_TYPE, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_LOC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FUNC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_DECISION_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_CONSID_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FAC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS, OMS_OWNER.OFFENDER_CSIP_FACTORS AT_OFFENDER_CSIP_FACTORS, OMS_OWNER.OFFENDER_CSIP_PLANS AT_OFFENDER_CSIP_PLANS, OMS_OWNER.OFFENDER_CSIP_REVIEWS AT_OFFENDER_CSIP_REVIEWS WHERE (AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID) AND (AT_OFFENDER_CSIP_REVIEWS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID) AND (AT_OFFENDER_CSIP_FACTORS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID) AND (AT_OFFENDER_CSIP_PLANS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID) AND (AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE = AT_REF_CSIP_TYPE.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION = AT_REF_CSIP_LOC.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.RFR_CSIP_FUNCTION = AT_REF_CSIP_FUNC.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME = AT_REF_CSIP_CONSID_OUTCOME.CODE (+)) AND (AT_REF_CSIP_FAC.CODE (+) = AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR) AND (AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME = AT_REF_CSIP_DECISION_OUTCOME.CODE (+)) AND (AT_REF_CSIP_DECISION_OUTCOME.domain (+) = 'CSIP_OUT') AND (AT_REF_CSIP_CONSID_OUTCOME.domain (+) = 'CSIP_OUT') AND (AT_REF_CSIP_FUNC.domain (+) = 'CSIP_FUNC') AND (AT_REF_CSIP_LOC.domain (+) = 'CSIP_LOC') AND (AT_REF_CSIP_TYPE.domain (+) = 'CSIP_TYP') AND (AT_REF_CSIP_FAC.domain (+) = 'CSIP_FAC') AND (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_ETHNICITY_DESC.DOMAIN (+) = 'ETHNICITY') AND (AT_ETHNICITY_DESC.CODE (+) = AT_OFFENDER.RACE_CODE) AND ((AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */) OR 'All' IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */)) AND AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED BETWEEN (SELECT START_DATE FROM prompt_ /* = #prompt('Enter Date Referred(Start):','D',,Mono,Free,Not_Persistent,,User:0) */) AND (SELECT END_DATE FROM prompt_ /* = #prompt('Enter Date Referred(End):','D',,Mono,Free,Not_Persistent,,User:1) */))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGE_IN_YEARS, ETHNIC_CODE, ETHNIC_DESCRIPTION, AGY_LOC_ID, CSIP_SEQ, RFR_INCIDENT_DATE, RFR_INCIDENT_TIME_, RFR_INCIDENT_TYPE, DESCRIPTION, RFR_INCIDENT_LOCATION, RFR_INCIDENT_LOCATION_DESCRI33, RFR_REPORTED_BY, RFR_AREA_OF_WORK_DESCRIPTION, RFR_DATE_REPORTED, RFR_PROACTIVE_RESPONSE, RFR_STAFF_ASSAULTED, CSIP_ID, DEC_OUTCOME_DESCRIPTION, INV_OUTCOME_DATE, CDR_OUTCOME_DATE, CDR_OUTCOME_DESCRIPTION, CSIP_FACTOR, CDR_FACTOR_DESCRIPTION, INV_OCCURRENCE_REASON, CASE_MANAGER, REASON, CREATE_DATE, TARGET_DATE, CLOSED_DATE, PLAN_ID, NEXT_REVIEW_DATE, REV_DATE, CLOSE_DATE, REVIEW_SEQ, CASE WHEN CURRENT_PRISONERS.AGY_LOC_ID IS NULL THEN 'OUT' ELSE (CURRENT_PRISONERS.AGY_LOC_ID) END AS V_CURRENT_ESTAB, CASE WHEN UNIT_DESCRIPTION_4_SHORT IS NULL THEN 'OUT' ELSE UNIT_DESCRIPTION_4_SHORT END AS V_CELL_LOCATION, CASE WHEN V_FACTORS = V_MAX_FACTORS THEN V_CONCAT_FACTORS END AS V_MAX_CONCAT_FACTORS_CODE, CASE WHEN CSIP_REFERRALS.CREATE_DATE IS NULL THEN 'No' ELSE 'Yes' END AS V_PLAN_CREATED_ FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3)",
          "mandatory": "true",
          "referenceType": "establishment"
        },
        {
          "index": 1,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Date Referred(Start):",
          "description": "@prompt('Enter Date Referred(Start):','D',,Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Date Referred(End):",
          "description": "@prompt('Enter Date Referred(End):','D',,Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP1d.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP1d.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP1d.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "AGE_IN_YEARS",
            "type": "double",
            "display": "Age in Years",
            "legacyId": "DP1d.DO10a15",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "ETHNIC_CODE",
            "type": "string",
            "display": "Ethnic Code",
            "legacyId": "DP1d.DO10088",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "ETHNIC_DESCRIPTION",
            "type": "string",
            "display": "Ethnic Description",
            "legacyId": "DP1d.DO1009d",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "CSIP Agy Loc Id",
            "legacyId": "DP1d.DO6c4",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "CSIP_SEQ",
            "type": "string",
            "display": "CSIP Log #",
            "legacyId": "DP1d.DO65d",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "RFR_INCIDENT_DATE",
            "type": "date",
            "display": "RFR Incident Date",
            "legacyId": "DP1d.DO65e",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "RFR_INCIDENT_TIME_",
            "type": "date",
            "display": "RFR Incident Time (see description)",
            "legacyId": "DP1d.DO65f",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "RFR_INCIDENT_TYPE",
            "type": "string",
            "display": "RFR Incident Type Code",
            "legacyId": "DP1d.DO660",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "RFR Incident Type Description",
            "legacyId": "DP1d.DO679",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "RFR_INCIDENT_LOCATION",
            "type": "string",
            "display": "RFR Incident Location Code",
            "legacyId": "DP1d.DO661",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "RFR_INCIDENT_LOCATION_DESCRI33",
            "type": "string",
            "display": "RFR Incident Location Description",
            "legacyId": "DP1d.DO67a",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "RFR_REPORTED_BY",
            "type": "string",
            "display": "RFR Referred By",
            "legacyId": "DP1d.DO663",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "RFR_AREA_OF_WORK_DESCRIPTION",
            "type": "string",
            "display": "RFR Area of Work Description",
            "legacyId": "DP1d.DO67b",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "RFR_DATE_REPORTED",
            "type": "date",
            "display": "RFR Date Referred",
            "legacyId": "DP1d.DO664",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "RFR_PROACTIVE_RESPONSE",
            "type": "string",
            "display": "RFR Proactive Referral (Prevention)",
            "legacyId": "DP1d.DO666",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "RFR_STAFF_ASSAULTED",
            "type": "string",
            "display": "RFR Staff Assaulted",
            "legacyId": "DP1d.DO667",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "CSIP_ID",
            "type": "double",
            "display": "RFR CSIP ID",
            "legacyId": "DP1d.DO65c",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "DEC_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "DEC Outcome Description",
            "legacyId": "DP1d.DO697",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "INV_OUTCOME_DATE",
            "type": "date",
            "display": "DEC Outcome Date",
            "legacyId": "DP1d.DO68d",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CDR_OUTCOME_DATE",
            "type": "date",
            "display": "CDR Outcome Date",
            "legacyId": "DP1d.DO66b",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "CDR_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "CDR Outcome Description",
            "legacyId": "DP1d.DO680",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "CSIP_FACTOR",
            "type": "string",
            "display": "CDR Factor Code",
            "legacyId": "DP1d.DO67e",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "CDR_FACTOR_DESCRIPTION",
            "type": "string",
            "display": "CDR Factor Description",
            "legacyId": "DP1d.DO681",
            "legacySqlClass": "column"
          },
          {
            "index": 26,
            "name": "INV_OCCURRENCE_REASON",
            "type": "string",
            "display": "INV Occurrence Reason",
            "legacyId": "DP1d.DO676",
            "legacySqlClass": "column"
          },
          {
            "index": 27,
            "name": "CASE_MANAGER",
            "type": "string",
            "display": "PLN Case Manager",
            "legacyId": "DP1d.DO699",
            "legacySqlClass": "column"
          },
          {
            "index": 28,
            "name": "REASON",
            "type": "string",
            "display": "PLN Reason",
            "legacyId": "DP1d.DO69a",
            "legacySqlClass": "column"
          },
          {
            "index": 29,
            "name": "CREATE_DATE",
            "type": "date",
            "display": "PLN Create Date",
            "legacyId": "DP1d.DO69d",
            "legacySqlClass": "column"
          },
          {
            "index": 30,
            "name": "TARGET_DATE",
            "type": "date",
            "display": "PLN Target Date",
            "legacyId": "DP1d.DO6a0",
            "legacySqlClass": "column"
          },
          {
            "index": 31,
            "name": "CLOSED_DATE",
            "type": "date",
            "display": "PLN Closed Date",
            "legacyId": "DP1d.DO6a1",
            "legacySqlClass": "column"
          },
          {
            "index": 32,
            "name": "PLAN_ID",
            "type": "double",
            "display": "PLN Plan Id",
            "legacyId": "DP1d.DO69b",
            "legacySqlClass": "column"
          },
          {
            "index": 33,
            "name": "NEXT_REVIEW_DATE",
            "type": "date",
            "display": "REV Next Review Date",
            "legacyId": "DP1d.DO6a4",
            "legacySqlClass": "column"
          },
          {
            "index": 34,
            "name": "REV_DATE",
            "type": "date",
            "display": "REV Date",
            "legacyId": "DP1d.DO6a7",
            "legacySqlClass": "column"
          },
          {
            "index": 35,
            "name": "CLOSE_DATE",
            "type": "date",
            "display": "REV Close Date",
            "legacyId": "DP1d.DO6ad",
            "legacySqlClass": "column"
          },
          {
            "index": 36,
            "name": "REVIEW_SEQ",
            "type": "double",
            "display": "REV Review Seq",
            "legacyId": "DP1d.DO6a6",
            "legacySqlClass": "column"
          },
          {
            "index": 37,
            "name": "V_CURRENT_ESTAB",
            "type": "string",
            "display": "V_CURRENT_ESTAB",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 38,
            "name": "V_CELL_LOCATION",
            "type": "string",
            "display": "V_CELL_LOCATION",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 39,
            "name": "V_MAX_CONCAT_FACTORS_CODE",
            "type": "string",
            "display": "V_MAX_CONCAT_FACTORS_CODE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 40,
            "name": "V_PLAN_CREATED_",
            "type": "string",
            "display": "V_PLAN_CREATED_",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375850/DP24",
      "name": "Current Prisoners",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID, AT_LIVING_UNITS.DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS WHERE (AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID) AND (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID) AND (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND ((AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */) OR 'All' IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */)) AND AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED BETWEEN (SELECT START_DATE FROM prompt_ /* = #prompt('Enter Date Referred(Start):','D',,Mono,Free,Not_Persistent,,User:0) */) AND (SELECT END_DATE FROM prompt_ /* = #prompt('Enter Date Referred(End):','D',,Mono,Free,Not_Persistent,,User:1) */))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, UNIT_DESCRIPTION_4_SHORT, AGY_LOC_ID, DESCRIPTION, AGY_AND_LOCATION FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3)",
          "mandatory": "true",
          "referenceType": "establishment"
        },
        {
          "index": 1,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Date Referred(Start):",
          "description": "@prompt('Enter Date Referred(Start):','D',,Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Date Referred(End):",
          "description": "@prompt('Enter Date Referred(End):','D',,Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP24.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP24.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP24.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "UNIT_DESCRIPTION_4_SHORT",
            "type": "string",
            "display": "Unit Description 4 Short",
            "legacyId": "DP24.DO10427",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "Establishment Code",
            "legacyId": "DP24.DO1043b",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Level 1 Living Unit",
            "legacyId": "DP24.DO109fb",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "AGY_AND_LOCATION",
            "type": "string",
            "display": "Agy and Location",
            "legacyId": "DP24.DO11069",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375850/DP25",
      "name": "Plans",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, TRUNC(MONTHS_BETWEEN(CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12) AS AGE_IN_YEARS, AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID, AT_OFFENDER_CSIP_REPORTS.CSIP_SEQ, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_DATE, TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_date) + (AT_OFFENDER_CSIP_REPORTS.rfr_incident_time - TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_time)) AS RFR_INCIDENT_TIME_, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE, AT_REF_CSIP_TYPE.DESCRIPTION, AT_REF_CSIP_LOC.DESCRIPTION AS RFR_INCIDENT_LOCATION_DESCRI33, AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED, AT_OFFENDER_CSIP_REPORTS.CSIP_ID, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME_DATE, AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION AS DEC_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME_DATE, AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION AS CDR_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.CASE_MANAGER, AT_OFFENDER_CSIP_REPORTS.REASON, AT_OFFENDER_CSIP_PLANS.CREATE_DATE, AT_OFFENDER_CSIP_PLANS.TARGET_DATE, AT_OFFENDER_CSIP_PLANS.CLOSED_DATE, AT_OFFENDER_CSIP_PLANS.PLAN_ID, AT_OFFENDER_CSIP_REVIEWS.NEXT_REVIEW_DATE, AT_OFFENDER_CSIP_REVIEWS.CREATE_DATE AS REV_DATE, AT_OFFENDER_CSIP_REVIEWS.CLOSE_DATE, AT_OFFENDER_CSIP_REVIEWS.REVIEW_SEQ FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_TYPE, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_LOC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_DECISION_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_CONSID_OUTCOME, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS, OMS_OWNER.OFFENDER_CSIP_PLANS AT_OFFENDER_CSIP_PLANS, OMS_OWNER.OFFENDER_CSIP_REVIEWS AT_OFFENDER_CSIP_REVIEWS WHERE (AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID) AND (AT_OFFENDER_CSIP_REVIEWS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID) AND (AT_OFFENDER_CSIP_PLANS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID) AND (AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE = AT_REF_CSIP_TYPE.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION = AT_REF_CSIP_LOC.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME = AT_REF_CSIP_CONSID_OUTCOME.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME = AT_REF_CSIP_DECISION_OUTCOME.CODE (+)) AND (AT_REF_CSIP_DECISION_OUTCOME.domain (+) = 'CSIP_OUT') AND (AT_REF_CSIP_CONSID_OUTCOME.domain (+) = 'CSIP_OUT') AND (AT_REF_CSIP_LOC.domain (+) = 'CSIP_LOC') AND (AT_REF_CSIP_TYPE.domain (+) = 'CSIP_TYP') AND (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND ((AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */) OR 'All' IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */)) AND AT_OFFENDER_CSIP_PLANS.CREATE_DATE BETWEEN (SELECT START_DATE FROM prompt_ /* = #prompt('Enter Date Referred(Start):','D',,Mono,Free,Not_Persistent,,User:0) */) AND (SELECT END_DATE FROM prompt_ /* = #prompt('Enter Date Referred(End):','D',,Mono,Free,Not_Persistent,,User:1) */))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGE_IN_YEARS, AGY_LOC_ID, CSIP_SEQ, RFR_INCIDENT_DATE, RFR_INCIDENT_TIME_, RFR_INCIDENT_TYPE, DESCRIPTION, RFR_INCIDENT_LOCATION_DESCRI33, RFR_DATE_REPORTED, CSIP_ID, INV_OUTCOME_DATE, DEC_OUTCOME_DESCRIPTION, CDR_OUTCOME_DATE, CDR_OUTCOME_DESCRIPTION, CASE_MANAGER, REASON, CREATE_DATE, TARGET_DATE, CLOSED_DATE, PLAN_ID, NEXT_REVIEW_DATE, REV_DATE, CLOSE_DATE, REVIEW_SEQ, CASE WHEN CURRENT_PRISONERS.AGY_LOC_ID IS NULL THEN 'OUT' ELSE (CURRENT_PRISONERS.AGY_LOC_ID) END AS V_CURRENT_ESTAB, CASE WHEN UNIT_DESCRIPTION_4_SHORT IS NULL THEN 'OUT' ELSE UNIT_DESCRIPTION_4_SHORT END AS V_CELL_LOCATION FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3)",
          "mandatory": "true",
          "referenceType": "establishment"
        },
        {
          "index": 1,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Date Referred(Start):",
          "description": "@prompt('Enter Date Referred(Start):','D',,Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Date Referred(End):",
          "description": "@prompt('Enter Date Referred(End):','D',,Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP25.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP25.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP25.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "AGE_IN_YEARS",
            "type": "double",
            "display": "Age in Years",
            "legacyId": "DP25.DO10a15",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "CSIP Agy Loc Id",
            "legacyId": "DP25.DO6c4",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "CSIP_SEQ",
            "type": "string",
            "display": "CSIP Log #",
            "legacyId": "DP25.DO65d",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "RFR_INCIDENT_DATE",
            "type": "date",
            "display": "RFR Incident Date",
            "legacyId": "DP25.DO65e",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "RFR_INCIDENT_TIME_",
            "type": "date",
            "display": "RFR Incident Time (see description)",
            "legacyId": "DP25.DO65f",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "RFR_INCIDENT_TYPE",
            "type": "string",
            "display": "RFR Incident Type Code",
            "legacyId": "DP25.DO660",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "RFR Incident Type Description",
            "legacyId": "DP25.DO679",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "RFR_INCIDENT_LOCATION_DESCRI33",
            "type": "string",
            "display": "RFR Incident Location Description",
            "legacyId": "DP25.DO67a",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "RFR_DATE_REPORTED",
            "type": "date",
            "display": "RFR Date Referred",
            "legacyId": "DP25.DO664",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "CSIP_ID",
            "type": "double",
            "display": "RFR CSIP ID",
            "legacyId": "DP25.DO65c",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "INV_OUTCOME_DATE",
            "type": "date",
            "display": "DEC Outcome Date",
            "legacyId": "DP25.DO68d",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "DEC_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "DEC Outcome Description",
            "legacyId": "DP25.DO697",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "CDR_OUTCOME_DATE",
            "type": "date",
            "display": "CDR Outcome Date",
            "legacyId": "DP25.DO66b",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "CDR_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "CDR Outcome Description",
            "legacyId": "DP25.DO680",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "CASE_MANAGER",
            "type": "string",
            "display": "PLN Case Manager",
            "legacyId": "DP25.DO699",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "REASON",
            "type": "string",
            "display": "PLN Reason",
            "legacyId": "DP25.DO69a",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "CREATE_DATE",
            "type": "date",
            "display": "PLN Create Date",
            "legacyId": "DP25.DO69d",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "TARGET_DATE",
            "type": "date",
            "display": "PLN Target Date",
            "legacyId": "DP25.DO6a0",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "CLOSED_DATE",
            "type": "date",
            "display": "PLN Closed Date",
            "legacyId": "DP25.DO6a1",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "PLAN_ID",
            "type": "double",
            "display": "PLN Plan Id",
            "legacyId": "DP25.DO69b",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "NEXT_REVIEW_DATE",
            "type": "date",
            "display": "REV Next Review Date",
            "legacyId": "DP25.DO6a4",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "REV_DATE",
            "type": "date",
            "display": "REV Date",
            "legacyId": "DP25.DO6a7",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "CLOSE_DATE",
            "type": "date",
            "display": "REV Close Date",
            "legacyId": "DP25.DO6ad",
            "legacySqlClass": "column"
          },
          {
            "index": 26,
            "name": "REVIEW_SEQ",
            "type": "double",
            "display": "REV Review Seq",
            "legacyId": "DP25.DO6a6",
            "legacySqlClass": "column"
          },
          {
            "index": 27,
            "name": "V_CURRENT_ESTAB",
            "type": "string",
            "display": "V_CURRENT_ESTAB",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 28,
            "name": "V_CELL_LOCATION",
            "type": "string",
            "display": "V_CELL_LOCATION",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375850/DP26",
      "name": "Tx or Released",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "DP1d_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, TRUNC(MONTHS_BETWEEN(CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12) AS AGE_IN_YEARS, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END AS ETHNIC_CODE, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END || '-' || CASE WHEN AT_ETHNICITY_DESC.CODE = 'W8' THEN 'White: Gypsy or Irish Traveller' WHEN AT_ETHNICITY_DESC.CODE = 'O1' THEN 'Asian/Asian British: Chinese' ELSE AT_ETHNICITY_DESC.DESCRIPTION END AS ETHNIC_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID, AT_OFFENDER_CSIP_REPORTS.CSIP_SEQ, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_DATE, TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_date) + (AT_OFFENDER_CSIP_REPORTS.rfr_incident_time - TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_time)) AS RFR_INCIDENT_TIME_, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE, AT_REF_CSIP_TYPE.DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION, AT_REF_CSIP_LOC.DESCRIPTION AS RFR_INCIDENT_LOCATION_DESCRI33, AT_OFFENDER_CSIP_REPORTS.RFR_REPORTED_BY, AT_REF_CSIP_FUNC.DESCRIPTION AS RFR_AREA_OF_WORK_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED, AT_OFFENDER_CSIP_REPORTS.RFR_PROACTIVE_RESPONSE, AT_OFFENDER_CSIP_REPORTS.RFR_STAFF_ASSAULTED, AT_OFFENDER_CSIP_REPORTS.CSIP_ID, AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION AS DEC_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME_DATE, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME_DATE, AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION AS CDR_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR, AT_REF_CSIP_FAC.DESCRIPTION AS CDR_FACTOR_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OCCURRENCE_REASON, AT_OFFENDER_CSIP_REPORTS.CASE_MANAGER, AT_OFFENDER_CSIP_REPORTS.REASON, AT_OFFENDER_CSIP_PLANS.CREATE_DATE, AT_OFFENDER_CSIP_PLANS.TARGET_DATE, AT_OFFENDER_CSIP_PLANS.CLOSED_DATE, AT_OFFENDER_CSIP_PLANS.PLAN_ID, AT_OFFENDER_CSIP_REVIEWS.NEXT_REVIEW_DATE, AT_OFFENDER_CSIP_REVIEWS.CREATE_DATE AS REV_DATE, AT_OFFENDER_CSIP_REVIEWS.CLOSE_DATE, AT_OFFENDER_CSIP_REVIEWS.REVIEW_SEQ FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_ETHNICITY_DESC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_TYPE, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_LOC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FUNC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_DECISION_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_CONSID_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FAC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS, OMS_OWNER.OFFENDER_CSIP_FACTORS AT_OFFENDER_CSIP_FACTORS, OMS_OWNER.OFFENDER_CSIP_PLANS AT_OFFENDER_CSIP_PLANS, OMS_OWNER.OFFENDER_CSIP_REVIEWS AT_OFFENDER_CSIP_REVIEWS WHERE (AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID) AND (AT_OFFENDER_CSIP_REVIEWS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID) AND (AT_OFFENDER_CSIP_FACTORS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID) AND (AT_OFFENDER_CSIP_PLANS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID) AND (AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE = AT_REF_CSIP_TYPE.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION = AT_REF_CSIP_LOC.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.RFR_CSIP_FUNCTION = AT_REF_CSIP_FUNC.CODE (+)) AND (AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME = AT_REF_CSIP_CONSID_OUTCOME.CODE (+)) AND (AT_REF_CSIP_FAC.CODE (+) = AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR) AND (AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME = AT_REF_CSIP_DECISION_OUTCOME.CODE (+)) AND (AT_REF_CSIP_DECISION_OUTCOME.domain (+) = 'CSIP_OUT') AND (AT_REF_CSIP_CONSID_OUTCOME.domain (+) = 'CSIP_OUT') AND (AT_REF_CSIP_FUNC.domain (+) = 'CSIP_FUNC') AND (AT_REF_CSIP_LOC.domain (+) = 'CSIP_LOC') AND (AT_REF_CSIP_TYPE.domain (+) = 'CSIP_TYP') AND (AT_REF_CSIP_FAC.domain (+) = 'CSIP_FAC') AND (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_ETHNICITY_DESC.DOMAIN (+) = 'ETHNICITY') AND (AT_ETHNICITY_DESC.CODE (+) = AT_OFFENDER.RACE_CODE) AND ((AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */) OR 'All' IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */)) AND AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED BETWEEN (SELECT START_DATE FROM prompt_ /* = #prompt('Enter Date Referred(Start):','D',,Mono,Free,Not_Persistent,,User:0) */) AND (SELECT END_DATE FROM prompt_ /* = #prompt('Enter Date Referred(End):','D',,Mono,Free,Not_Persistent,,User:1) */))), dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME, AT_OFFENDER.FIRST_NAME, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS ESTABLISHMENT_CODE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_MOV_LOC_FROM_OFFND_LOCTION, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS, USER_ACCESSIBLE_CASELOADS, OMS_OWNER.OFFENDER_CSIP_PLANS AT_OFFENDER_CSIP_PLANS, undefined_ WHERE ((AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID) AND (AT_OFFENDER_CSIP_PLANS.CSIP_ID = AT_OFFENDER_CSIP_REPORTS.CSIP_ID) AND (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID = AT_MOV_LOC_FROM_OFFND_LOCTION.AGY_LOC_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_MOV_LOC_FROM_OFFND_LOCTION.AGENCY_LOCATION_TYPE = 'INST') AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID IN (SELECT AGY_LOC_ID FROM DP1d_) AND NOT AT_OFFENDER_CSIP_REPORTS.CSIP_ID IS NULL AND AT_MOV_LOC_FROM_OFFND_LOCTION.AGY_LOC_ID IN (SELECT AGY_LOC_ID FROM DP1d_) AND TRUNC(AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE) >= (SELECT * FROM DP1d_) AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE = 'OUT' AND (AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED BETWEEN (SELECT START_DATE FROM prompt_ /* = #prompt('Enter Date Referred(Start):','D',,Mono,Free,Not_Persistent,,User:0) */) AND (SELECT END_DATE FROM prompt_ /* = #prompt('Enter Date Referred(End):','D',,Mono,Free,Not_Persistent,,User:1) */) OR AT_OFFENDER_CSIP_PLANS.CREATE_DATE BETWEEN (SELECT START_DATE FROM prompt_ /* = #prompt('Enter Date Referred(Start):','D',,Mono,Free,Not_Persistent,,User:3) */) AND (SELECT END_DATE FROM prompt_ /* = #prompt('Enter Date Referred(End):','D',,Mono,Free,Not_Persistent,,User:2) */)))) AND (undefined)), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGY_AND_LOCATION, AGY_LOC_ID, ESTABLISHMENT_CODE FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Date Referred(Start):",
          "description": "@prompt('Enter Date Referred(Start):','D',,Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Enter Date Referred(End):",
          "description": "@prompt('Enter Date Referred(End):','D',,Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP26.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP26.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP26.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "AGY_AND_LOCATION",
            "type": "string",
            "display": "Agy and Location",
            "legacyId": "DP26.DO11069",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "CSIP Agy Loc Id",
            "legacyId": "DP26.DO6c4",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "ESTABLISHMENT_CODE",
            "type": "string",
            "display": "Establishment Code",
            "legacyId": "DP26.DO1043b",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "166802.RS",
      "name": "All Referrals by Date",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375850/DP1d",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE CURRENT_PRISONERS_ESTABLISHM36 <> 'ZZGHI')"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:CSIP_ID",
            "display": "RFR CSIP ID",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO65c"
          },
          {
            "name": "$ref:AGY_LOC_ID",
            "display": "CSIP Agy Loc Id",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO6c4"
          },
          {
            "name": "$ref:V_CURRENT_ESTAB",
            "display": "Current Estab",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Current Prisoners].[Establishment Code]);\"OUT\";([Current Prisoners].[Establishment Code]))"
          },
          {
            "name": "$ref:CSIP_SEQ",
            "display": "CSIP Log #",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO65d"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10044"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10045"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10046"
          },
          {
            "name": "$ref:V_CELL_LOCATION",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Unit Description 4 Short]);\"OUT\";[Unit Description 4 Short])"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age in Years",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10a15"
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO10088"
          },
          {
            "name": "$ref:RFR_PROACTIVE_RESPONSE",
            "display": "RFR Proactive Referral (Prevention)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO666"
          },
          {
            "name": "$ref:RFR_STAFF_ASSAULTED",
            "display": "RFR Staff Assaulted",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO667"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "RFR Incident Type Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO679"
          },
          {
            "name": "$ref:RFR_AREA_OF_WORK_DESCRIPTION",
            "display": "RFR Area of Work Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO67b"
          },
          {
            "name": "$ref:V_MAX_CONCAT_FACTORS_CODE",
            "display": "Cont. Factor(s)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[v_concat_factors]Where ([v_Factors]= [v_max_factors]) "
          },
          {
            "name": "$ref:RFR_DATE_REPORTED",
            "display": "RFR Date Referred",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO664"
          },
          {
            "name": "$ref:CDR_OUTCOME_DATE",
            "display": "CDR Outcome Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO66b"
          },
          {
            "name": "$ref:CDR_OUTCOME_DESCRIPTION",
            "display": "CDR Outcome Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO680"
          },
          {
            "name": "$ref:V_INVEST_INFO_GATHERING",
            "display": "Invest Info Gathering",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([CSIP Referrals].[CDR Outcome Description] InList(\"Progress to Investigation\" ;\"Progress to CSIP\") And ([v_is_null_Occurrence_reason] =1); \"Yes\";\"No\")"
          },
          {
            "name": "$ref:INV_OUTCOME_DATE",
            "display": "DEC Outcome Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO68d"
          },
          {
            "name": "$ref:DEC_OUTCOME_DESCRIPTION",
            "display": "DEC Outcome Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO697"
          },
          {
            "name": "$ref:V_PLAN_CREATED_",
            "display": "Plan Created?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([CSIP Referrals].[PLN Create Date]); \"No\";\"Yes\")"
          }
        ]
      }
    },
    {
      "id": "173037.RS",
      "name": "Closed Supp and Interven Plans",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375850/DP1d",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (CURRENT_PRISONERS_ESTABLISHM36 <> 'ZZGHI' AND CSIP_REFERRALS_REV_CLOSE_DATE IS NOT NULL AND CSIP_REFERRALS_PLN_PLAN_ID IS NOT NULL AND CSIP_REFERRALS_PLN_CLOSED_DATE IS NOT NULL AND (CSIP_REFERRALS_DEC_OUTCOME_D38 = 'Progress to CSIP' OR CSIP_REFERRALS_CDR_OUTCOME_D38 IN ('Progress to CSIP'))))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:CSIP_ID",
            "display": "RFR CSIP ID",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO65c"
          },
          {
            "name": "$ref:AGY_LOC_ID",
            "display": "CSIP Agy Loc Id",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO6c4"
          },
          {
            "name": "$ref:V_CURRENT_ESTAB",
            "display": "Current Estab",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Current Prisoners].[Establishment Code]);\"OUT\";([Current Prisoners].[Establishment Code]))"
          },
          {
            "name": "$ref:CSIP_SEQ",
            "display": "CSIP Log #",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO65d"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10044"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10045"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10046"
          },
          {
            "name": "$ref:V_CELL_LOCATION",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Unit Description 4 Short]);\"OUT\";[Unit Description 4 Short])"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age in Years",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10a15"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "RFR Incident Type Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO679"
          },
          {
            "name": "$ref:RFR_DATE_REPORTED",
            "display": "RFR Date Referred",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO664"
          },
          {
            "name": "$ref:INV_OUTCOME_DATE",
            "display": "DEC Outcome Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO68d"
          },
          {
            "name": "$ref:MIN_PLAN_CREATE_DATE",
            "display": "Min Plan Create Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Min([CSIP Referrals].[PLN Create Date]) In ([CSIP Referrals].[RFR CSIP ID])"
          },
          {
            "name": "$ref:REASON",
            "display": "PLN Reason",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO69a"
          },
          {
            "name": "$ref:CASE_MANAGER",
            "display": "PLN Case Manager",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO699"
          },
          {
            "name": "$ref:CLOSE_DATE",
            "display": "REV Close Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO6ad"
          }
        ]
      }
    },
    {
      "id": "175190.RS",
      "name": "All Supp and Interven Plans",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375850/DP25",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (CURRENT_PRISONERS_ESTABLISHM36 <> 'ZZGHI' AND PLANS_PLN_PLAN_ID IS NOT NULL AND (PLANS_DEC_OUTCOME_DESCRIPTION = 'Progress to CSIP' OR PLANS_CDR_OUTCOME_DESCRIPTION = 'Progress to CSIP')))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:CSIP_ID",
            "display": "RFR CSIP ID",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP25.DO65c"
          },
          {
            "name": "$ref:AGY_LOC_ID",
            "display": "CSIP Agy Loc Id",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO6c4"
          },
          {
            "name": "$ref:V_CURRENT_ESTAB",
            "display": "Current Estab",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Current Prisoners].[Establishment Code]);\"OUT\";([Current Prisoners].[Establishment Code]))"
          },
          {
            "name": "$ref:CSIP_SEQ",
            "display": "CSIP Log #",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP25.DO65d"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP25.DO10044"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP25.DO10045"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP25.DO10046"
          },
          {
            "name": "$ref:V_CELL_LOCATION",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([Unit Description 4 Short]);\"OUT\";[Unit Description 4 Short])"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age in Years",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP25.DO10a15"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "RFR Incident Type Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP25.DO679"
          },
          {
            "name": "$ref:RFR_DATE_REPORTED",
            "display": "RFR Date Referred",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP25.DO664"
          },
          {
            "name": "$ref:INV_OUTCOME_DATE",
            "display": "DEC Outcome Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP25.DO68d"
          },
          {
            "name": "$ref:MIN_PLAN_CREATE_DATE_PLANS",
            "display": "Min Plan Create Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Min([Plans].[PLN Create Date]) In ([Plans].[RFR CSIP ID])"
          },
          {
            "name": "$ref:REASON",
            "display": "PLN Reason",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP25.DO69a"
          },
          {
            "name": "$ref:CASE_MANAGER",
            "display": "PLN Case Manager",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP25.DO699"
          },
          {
            "name": "$ref:CLOSE_DATE",
            "display": "REV Close Date",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP25.DO6ad"
          }
        ]
      }
    },
    {
      "id": "173117.RS",
      "name": "Referral Stats",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375850/DP1d",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE CURRENT_PRISONERS_ESTABLISHM36 <> 'ZZGHI')"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-tab",
        "field": [
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO10088"
          },
          {
            "name": "$ref:ETHNIC_DESCRIPTION",
            "display": "Ethnic Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO1009d"
          }
        ]
      }
    },
    {
      "id": "173325.RS",
      "name": "Investigation Stats",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375850/DP1d",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (CSIP_REFERRALS_CDR_OUTCOME_D38 = 'Progress to Investigation' AND CURRENT_PRISONERS_ESTABLISHM36 <> 'ZZGHI'))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list-tab",
        "field": [
          {
            "name": "$ref:RFR_INCIDENT_LOCATION_DESCRI33",
            "display": "RFR Incident Location Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO67a"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_CELL_LOCATION :: ReferenceError: error is not defined",
      "entityId": "Fk_zi1y2HwEAzT4AAHBLlV8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_CELL_LOCATION :: ReferenceError: error is not defined",
      "entityId": "Fk_zi1y2HwEAzT4AAHBLlV8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : V_INVEST_INFO_GATHERING :: Error: argument 'sql': 'NoneType' object cannot be converted to 'PyString'",
      "entityId": "Fk_zi1y2HwEAzT4AAHBLlV8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : MIN_PLAN_CREATE_DATE :: Error: Invalid expression / Unexpected token. Line 1, Col: 36.\n  MIN(CSIP_REFERRALS.CREATE_DATE) IN \u001b[4m,\u001b[0mCSIP_REFERRALS.CSIP_ID,",
      "entityId": "Fk_zi1y2HwEAzT4AAHBLlV8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : MIN_PLAN_CREATE_DATE_PLANS :: Error: Invalid expression / Unexpected token. Line 1, Col: 27.\n  MIN(PLANS.CREATE_DATE) IN \u001b[4m,\u001b[0mPLANS.CSIP_ID,",
      "entityId": "Fk_zi1y2HwEAzT4AAHBLlV8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_CELL_LOCATION :: ReferenceError: error is not defined",
      "entityId": "Fk_zi1y2HwEAzT4AAHBLlV8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_CELL_LOCATION :: ReferenceError: error is not defined",
      "entityId": "Fk_zi1y2HwEAzT4AAHBLlV8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : MIN_PLAN_CREATE_DATE_PLANS :: Error: Invalid expression / Unexpected token. Line 1, Col: 27.\n  MIN(PLANS.CREATE_DATE) IN \u001b[4m,\u001b[0mPLANS.CSIP_ID,",
      "entityId": "Fk_zi1y2HwEAzT4AAHBLlV8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Report field V_INVEST_INFO_GATHERING does not have corresponding dataset schema field",
      "entityId": "166802.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field MIN_PLAN_CREATE_DATE does not have corresponding dataset schema field",
      "entityId": "173037.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field MIN_PLAN_CREATE_DATE_PLANS does not have corresponding dataset schema field",
      "entityId": "175190.RS",
      "entityType": "variant"
    },
    {
      "type": "sqlQuery",
      "error": "Error: ORA-00920: invalid relational operator\nHelp: https://docs.oracle.com/error-help/db/ora-00920/\n\u0000or-help/db/ora-00904/",
      "entityId": "3375850/DP1d",
      "entityType": "dataset"
    },
    {
      "type": "sqlQuery",
      "error": "Error: ORA-00904: \"UNIT_DESCRIPTION_4_SHORT\": invalid identifier\nHelp: https://docs.oracle.com/error-help/db/ora-00904/",
      "entityId": "3375850/DP25",
      "entityType": "dataset"
    },
    {
      "type": "sqlQuery",
      "error": "Error: ORA-00920: invalid relational operator\nHelp: https://docs.oracle.com/error-help/db/ora-00920/",
      "entityId": "3375850/DP26",
      "entityType": "dataset"
    }
  ]
}