{
  "id": "Fia.wGDMRwUAmZsBAHBrTl8dACJIAFJ8",
  "name": "MIS Maths and English scores report NSR2254",
  "metadata": {
    "version": "1.0.0",
    "tags": []
  },
  "description": "This report lists all prisoners in a selected establishment along with their qualifications in Maths or English where recorded.",
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3375368/DP4",
      "name": "All Prisoners",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.SURNAME, AT_OFFENDER_BOOKING.INITIALS FROM BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_CELL AT_CELL WHERE (AT_CELL.ESTABLISHMENT_SK = AT_ESTABLISHMENT.ESTABLISHMENT_SK) AND (AT_CELL.UNIT_4_SK = AT_OFFENDER_BOOKING.LIVING_UNIT_SK) AND (AT_ESTABLISHMENT.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND ((AT_ESTABLISHMENT.ESTABLISHMENT_CODE_NK IN ((SELECT establishment_code FROM prompt_)) OR 'All' IN ((SELECT establishment_code FROM prompt_))) AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, SURNAME, INITIALS, CASE WHEN DESCRIPTION IS NULL THEN '--' ELSE DESCRIPTION END AS V_STUDY_AREA, CASE WHEN EDUCATION_LEVEL_DESC IS NULL THEN '--' ELSE EDUCATION_LEVEL_DESC END AS V_STUDY_LEVEL FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP4.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "SURNAME",
            "type": "string",
            "display": "Offender Surname",
            "legacyId": "DP4.DO1007b",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "INITIALS",
            "type": "string",
            "display": "Offender Initials",
            "legacyId": "DP4.DO1012d",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "V_STUDY_AREA",
            "type": "string",
            "display": "V_STUDY_AREA",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 4,
            "name": "V_STUDY_LEVEL",
            "type": "string",
            "display": "V_STUDY_LEVEL",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375368/DPa",
      "name": "Edu Scores",
      "description": "MIS - Sentence",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER_BOOKING.OFFENDER_ID_DISPLAY, AT_EDUCATION_STUDY_AREA.DESCRIPTION, AT_EDUCATION_LEVEL.DESCRIPTION AS EDUCATION_LEVEL_DESC FROM BODIMIS.DIM_ESTABLISHMENT AT_ESTABLISHMENT, BODIMIS.DIM_OFFENDER_BOOKING AT_OFFENDER_BOOKING, BODIMIS.DIM_REFERENCE_CODES AT_EDUCATION_STUDY_AREA, BODIMIS.DIM_REFERENCE_CODES AT_EDUCATION_LEVEL, BODIMIS.DIM_OFFENDER_EDUCATION, BODIMIS.DIM_CELL AT_CELL WHERE (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK = BODIMIS.DIM_OFFENDER_EDUCATION.OFFENDER_BOOKING_SK (+)) AND (BODIMIS.DIM_OFFENDER_EDUCATION.STUDY_AREA_SK = AT_EDUCATION_STUDY_AREA.REFERENCE_CODE_SK) AND (BODIMIS.DIM_OFFENDER_EDUCATION.EDUCATION_LEVEL_SK = AT_EDUCATION_LEVEL.REFERENCE_CODE_SK) AND (AT_CELL.ESTABLISHMENT_SK = AT_ESTABLISHMENT.ESTABLISHMENT_SK) AND (AT_CELL.UNIT_4_SK = AT_OFFENDER_BOOKING.LIVING_UNIT_SK) AND (AT_ESTABLISHMENT.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOKING_SK IN (SELECT CSL.OFFENDER_BOOKING_SK FROM BODIMIS.DIM_STAFF_ACCESSIBLE_CASELOAD SAC, BODIMIS.DIM_CASELOAD_SECURITY_LIST CSL WHERE SAC.CASELOAD_ID = CSL.CASELOAD_CODE AND SAC.USERNAME = (SELECT username FROM context_) AND CSL.ENDYEAR >= TO_CHAR(CURRENT_TIMESTAMP, 'YYYY') - 6)) AND ((AT_ESTABLISHMENT.ESTABLISHMENT_CODE_NK IN ((SELECT establishment_code FROM prompt_)) OR 'All' IN ((SELECT establishment_code FROM prompt_))) AND (AT_OFFENDER_BOOKING.MIS_CURRENT_RECORD_IND = 'Y') AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_EDUCATION_STUDY_AREA.DESCRIPTION IN ('English', 'English Entry Level 1', 'English Entry Level 2', 'English Entry Level 3', 'English Language', 'English Level 1', 'English Level 2', 'English Level 3', 'English Literature', 'Funct Skills qualif in English at Ent 1', 'Funct Skills qualif in English at Ent 2', 'Funct Skills qualif in English at Ent 3', 'Functional Skills qualif in English', 'Little English Spoken', 'Cambridge Award in Maths Entry 3', 'Func Skills qual Maths Entry 3 OCR', 'Functional Skills qual in Maths at Ent 1', 'Functional Skills qual in Maths at Ent 2', 'Functional Skills qual in Maths at Ent 3', 'Functional Skills qualification in Maths', 'Mathematician', 'Mathematics', 'Maths Entry Level 1', 'Maths Entry Level 2', 'Maths Entry Level 3', 'Maths Level 1', 'Maths Level 2', 'Maths Level 3', 'Using Maths Skills to problem solve'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DESCRIPTION, EDUCATION_LEVEL_DESC FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "(SELECT establishment_code from prompt_)",
          "mandatory": "true",
          "referenceType": "establishment"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPa.DO10076",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Education Study Area Desc",
            "legacyId": "DPa.DO605",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "EDUCATION_LEVEL_DESC",
            "type": "string",
            "display": "Education Level Desc",
            "legacyId": "DPa.DO607",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376639/DP9",
      "name": "MIS load",
      "description": "MIS - Demographics",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT BODIMIS.ETL_LOAD_LOG.BUSINESS_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT BUSINESS_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "BUSINESS_DATE",
            "type": "date",
            "display": "Latest Business Date Available",
            "legacyId": "DP9.DO4dd",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "120441.RS",
      "name": "Edu Scores",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375368/DP4",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP4.DO10076"
          },
          {
            "name": "$ref:V_STUDY_AREA",
            "display": "Study Area",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If IsNull([Education Study Area Desc]) Then \"--\" Else[Education Study Area Desc]"
          },
          {
            "name": "$ref:V_STUDY_LEVEL",
            "display": "Level",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If IsNull([Education Level Desc]) Then \"--\" Else[Education Level Desc]"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_STUDY_AREA :: ReferenceError: error is not defined",
      "entityId": "Fia.wGDMRwUAmZsBAHBrTl8dACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_STUDY_LEVEL :: ReferenceError: error is not defined",
      "entityId": "Fia.wGDMRwUAmZsBAHBrTl8dACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_STUDY_LEVEL :: ReferenceError: error is not defined",
      "entityId": "Fia.wGDMRwUAmZsBAHBrTl8dACJIAFJ8",
      "entityType": "dpd"
    },
    {
      "type": "athenQuery",
      "error": "Error: Error: Query failed: GENERIC_USER_ERROR: Failed To Get Query Passthrough Schema",
      "entityId": "3375368/DP4",
      "entityType": "dataset"
    }
  ]
}