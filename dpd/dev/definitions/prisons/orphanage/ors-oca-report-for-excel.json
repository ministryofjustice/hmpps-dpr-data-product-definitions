{
  "id": "FogxQgBlMggAcAgTAAB3fsIAACJIAGE1",
  "name": "ORS OCA Report For Excel",
  "description": "A list of Prisoners in the Establishment along with numerous details including their Cell Location, Age, Sentence, Categorisation, CSRA, IEP, Nationality, Religion,  Ethnicity, Scheduled Court Appearances Release Date and Alert details.  The report also retrieves Offender Supervisor and Case Administrator information.  This report is for use in Excel. MOV0044  - v5 Last Modified 01/08/2023",
  "metadata": {
    "version": "1.0.0",
    "tags": ["MOV0044 v5 DPR OCA", "Cat", "CSRA", "Alert", "Court"]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3376286/DP3",
      "name": "Offenders",
      "description": "OR - Sentence",
      "datasource": "nomis",
      "query": "DP12_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS AS MAIN_LEGAL_STATUS, CASE WHEN NOT AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE WHEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN DT_LAST_RELEASE_DATE.LAST_REL_DATE ELSE NULL END AS CURRENT_RELEASE_DATE, CASE WHEN DT_OFFENDER_LIFE_FLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE AT_OFFENDER_SENT_CALCULATIONS.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS IN ( '14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA', 'FTRSCH18_ORA', 'FTRSCH18', 'LR_ALP_CDE18', 'LR_ALP_CDE21', 'LR_EDS18', 'LR_EDS21', 'LR_SOPC18', 'LR_SOPC21', 'LRSEC250_ORA', 'LR_EDSU18' ) THEN 'Recall' WHEN AT_IMPRISON_STATUSES.BAND_CODE = '0' THEN 'Dead' WHEN AT_IMPRISON_STATUSES.BAND_CODE = '1' THEN 'Indeterminate Sentence' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('2', '3') THEN 'Sentenced' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('9', '10') OR AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS = 'CIV_RMD' THEN 'Civil Prisoners' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('8', '11') THEN 'Immigration Detainees' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('12', '13', '14') THEN 'Remand' WHEN AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, AT_IMPRISON_STATUSES.DESCRIPTION AS MAIN_LS_DESCRIPTION FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.IMPRISONMENT_STATUSES AT_IMPRISON_STATUSES, OMS_OWNER.OFFENDER_RELEASE_DETAILS AT_OFFENDER_RELEASE_DETAILS, ( SELECT AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID, CASE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE /* when AT_OFFENDER_SENT_CALCULATIONS.ETD_OVERRIDED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.ETD_OVERRIDED_DATE when AT_OFFENDER_SENT_CALCULATIONS.ETD_CALCULATED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.ETD_CALCULATED_DATE when AT_OFFENDER_SENT_CALCULATIONS.LTD_OVERRIDED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.LTD_OVERRIDED_DATE when AT_OFFENDER_SENT_CALCULATIONS.LTD_CALCULATED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.LTD_CALCULATED_DATE */ ELSE NULL END AS Last_Rel_Date, EFFECTIVE_SENTENCE_LENGTH FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = ( SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID ) ) DT_LAST_RELEASE_DATE, ( SELECT DISTINCT OFFENDER_SENTENCE_TERMS.OFFENDER_BOOK_ID, OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG FROM OFFENDER_SENTENCE_TERMS WHERE OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y' ) DT_OFFENDER_LIFE_FLAG, OMS_OWNER.OFFENDER_IMPRISON_STATUSES AT_OFFENDER_IMPRISON_STATUSES WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDER_IMPRISON_STATUSES.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS = 'Y' OR AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS IS NULL ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_RELEASE_DETAILS.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_LAST_RELEASE_DATE.OFFENDER_BOOK_ID (+) ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( DT_OFFENDER_LIFE_FLAG.OFFENDER_BOOK_ID (+) = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID ) AND ( AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS (+) = AT_OFFENDER_IMPRISON_STATUSES.IMPRISONMENT_STATUS ) AND ( ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND ( AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = ( SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID ) OR AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID IS NULL /* END Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */ ) /* START Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */ ) ), DP10_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER_REHAB_PROVIDERS.PROVIDER_CODE AS REHAB_PROVIDER_CODE, AT_REHABILITATION_PROVIDERS.DESCRIPTION AS REHAB_PROVIDER_DESCRIPTION FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_REHAB_PROVIDERS AT_OFFENDER_REHAB_PROVIDERS, OMS_OWNER.REHABILITATION_PROVIDERS AT_REHABILITATION_PROVIDERS, OMS_OWNER.OFFENDER_REHAB_DECISIONS AT_OFFENDER_REHAB_DECISIONS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_OFFENDER_REHAB_DECISIONS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_REHAB_PROVIDERS.OFFENDER_REHAB_DECISION_ID (+) = AT_OFFENDER_REHAB_DECISIONS.OFFENDER_REHAB_DECISION_ID ) AND ( AT_REHABILITATION_PROVIDERS.PROVIDER_CODE (+) = AT_OFFENDER_REHAB_PROVIDERS.PROVIDER_CODE ) AND ( ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_OFFENDER_REHAB_DECISIONS.ACTIVE_FLAG = 'Y' AND AT_OFFENDER_REHAB_PROVIDERS.ACTIVE_FLAG = 'Y' ) ), DPb_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_ALERT_TYPE_DESC.DESCRIPTION AS ALERT_DESCRIPTION, AT_OFFENDER_ALERTS.ALERT_CODE AS ALERT_TYPE_CODE, AT_OFFENDER_ALERTS.ALERT_DATE AS ALERT_EFFECTIVE_DATE, AT_OFFENDER_ALERTS.COMMENT_TEXT AS ALERT_COMMENT_TEXT, AT_OFFENDER_ALERTS.EXPIRY_DATE AS EXPIRY_DATE, AT_OFFENDER_ALERTS.CREATE_DATE AS CREATE_DATE, AT_OFFENDER_ALERTS.CREATE_USER_ID AS CREATE_USER_ID, CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE IN ('TAP','TAH','TCPA','TG','TM','TPR','TSE' ) THEN 'Y' ELSE NULL END AS TRANSFER, CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE IN ('SOR','SR','SONR' ) THEN 'Y' ELSE NULL END AS SOR FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_ALERT_TYPE_DESC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_ALERT_TYPE_DESC.CODE (+) = AT_OFFENDER_ALERTS.ALERT_CODE ) AND ( AT_ALERT_TYPE_DESC.DOMAIN = 'ALERT_CODE' OR AT_ALERT_TYPE_DESC.DOMAIN IS NULL ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND (AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE') ) ), DPc_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_PEOPLE.FIRST_NAME AS CONTACT_FIRST_NAME, AT_PEOPLE.LAST_NAME AS CONTACT_LAST_NAME, AT_CONTACTS.RELATIONSHIP_TYPE AS CONTACT_RELATIONSHIP_TYPE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.PERSONS AT_PEOPLE, OMS_OWNER.OFFENDER_CONTACT_PERSONS AT_CONTACTS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_CONTACTS.OFFENDER_BOOK_ID (+) ) AND (AT_PEOPLE.PERSON_ID (+) = AT_CONTACTS.PERSON_ID) AND ( (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND AT_CONTACTS.ACTIVE_FLAG IN ('Y') AND AT_CONTACTS.RELATIONSHIP_TYPE IN ('OFS', 'CA') ) ), CASE_ADMINISTRATOR_ AS ( SELECT OFFENDER_ID_DISPLAY, CASE WHEN DPc_.CONTACT_RELATIONSHIP_TYPE = 'CA' THEN DPc_.CONTACT_FIRST_NAME || ' ' || DPc_.CONTACT_LAST_NAME END AS CA_NAME, CASE WHEN DPc_.CONTACT_RELATIONSHIP_TYPE = 'CA' THEN COUNT(1) OVER (PARTITION BY OFFENDER_ID_DISPLAY) END AS CA_COUNT, CASE WHEN DPc_.CONTACT_RELATIONSHIP_TYPE = 'OFS' THEN DPc_.CONTACT_FIRST_NAME || ' ' || DPc_.CONTACT_LAST_NAME END AS OF_NAME, CASE WHEN DPc_.CONTACT_RELATIONSHIP_TYPE = 'OFS' THEN COUNT(1) OVER (PARTITION BY OFFENDER_ID_DISPLAY) END AS OF_COUNT FROM DPc_ ), DP15_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_COURT_EVENT_MVMTS.EVENT_ID AS EVENT_ID, AT_COURT_EVENT_MVMTS.START_TIME AS START_TIME, CourtMovementReason.DESCRIPTION AS DESCRIPTION, AT_DESTINATION_COURT.DESCRIPTION AS COURT_NAME, TO_CHAR(AT_COURT_EVENT_MVMTS.START_TIME, 'AM') AS COURT_SLOT_ FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES CourtMovementReason, OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_DESTINATION_COURT, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.COURT_EVENTS AT_COURT_EVENT_MVMTS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND (CourtMovementReason.PARENT_CODE = 'CRT') AND (CourtMovementReason.DOMAIN = 'MOVE_RSN') AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_COURT_EVENT_MVMTS.OFFENDER_BOOK_ID ) AND ( AT_COURT_EVENT_MVMTS.COURT_EVENT_TYPE = CourtMovementReason.CODE ) AND ( AT_COURT_EVENT_MVMTS.AGY_LOC_ID = AT_DESTINATION_COURT.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_COURT_EVENT_MVMTS.EVENT_STATUS IN ('SCH') AND AT_COURT_EVENT_MVMTS.EVENT_DATE >= TRUNC(CURRENT_TIMESTAMP) AND AT_COURT_EVENT_MVMTS.DIRECTION_CODE IN ('OUT') AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND ( AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = ( SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID ) OR AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID IS NULL /* END Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */ ) /* START Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */ ) ), COURT_ AS ( SELECT DP15_.OFFENDER_ID_DISPLAY, DP15_.DESCRIPTION AS COURT_REASON, LISTAGG(DP15_.COURT_NAME, ', ') WITHIN GROUP(ORDER BY DP15_.COURT_NAME) AS COURT_NAMES, LISTAGG(DP15_.START_TIME,', ') WITHIN GROUP(ORDER BY DP15_.START_TIME) AS COURT_DATES FROM DP15_ GROUP BY OFFENDER_ID_DISPLAY, DESCRIPTION ), DP14_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENCES.DESCRIPTION AS DESCRIPTION FROM OMS_OWNER.COURT_EVENTS AT_OFFENDER_COURT_EVENTS, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENCES AT_OFFENCES, OMS_OWNER.COURT_EVENT_CHARGES AT_COURT_EVENT_CHARGES, OMS_OWNER.OFFENDER_CHARGES AT_OFFENDER_CHARGES, OMS_OWNER.OFFENDER_CASES AT_OFFENDER_CASES WHERE ( AT_COURT_EVENT_CHARGES.EVENT_ID (+) = AT_OFFENDER_COURT_EVENTS.EVENT_ID ) AND ( AT_OFFENDER_CHARGES.OFFENDER_CHARGE_ID (+) = AT_COURT_EVENT_CHARGES.OFFENDER_CHARGE_ID ) AND ( AT_OFFENDER_COURT_EVENTS.CASE_ID = AT_OFFENDER_CASES.CASE_ID ) AND ( AT_OFFENDER_CHARGES.OFFENCE_CODE = AT_OFFENCES.OFFENCE_CODE (+) ) AND ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_CASES.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_COURT_EVENT_CHARGES.MOST_SERIOUS_FLAG = 'Y' ) ), OFFENCE_ AS ( SELECT DP14_.OFFENDER_ID_DISPLAY, LISTAGG(DP14_.DESCRIPTION, ', ') WITHIN GROUP(ORDER BY DP14_.DESCRIPTION) AS MAIN_OFFENCES FROM DP14_ GROUP BY OFFENDER_ID_DISPLAY, DESCRIPTION ), dataset_base_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_HEADER_BLOCK.STATUS_2 AS STATUS_2, AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, AT_OFFENDER.BIRTH_DATE AS BIRTH_DATE, TRUNC( MONTHS_BETWEEN(CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12 ) AS AGE, AT_NATIONALITY.DESCRIPTION AS NATIONALITY, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END AS ETHNIC_CODE, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, DT_IEP_BAND_LAST.IEP_LEVEL AS IEP_LEVEL, DT_APPROVED_LEVEL.DESCRIPTION AS APPROVED_LEVEL_RESULT, DT_CALC_LEVEL.DESCRIPTION AS CALCULATED_RESULT, DT_CATEGORISATION.ASSESSMENT_DATE AS ASSESSMENT_DATE, DT_ADMISSION.ADMISSION_DATE AS ADMISSION_DATE, DT_OFFENDER_CSR_ASSESSMENT.APPROVED_RESULT AS CSR_APPROVED_RESULT, DT_OFFENDER_CSR_ASSESSMENT.CALC_SUP_LEVEL_TYPE AS CALC_SUP_LEVEL_TYPE, DT_CATEGORISATION.NEXT_REVIEW_DATE AS NEXT_REVIEW_DATE, DT_CATEGORISATION.REVIEW_PLACE_AGY_LOC_ID AS REVIEW_PLACE_AGY_LOC_ID, AT_RELIGION.DESCRIPTION AS RELIGION_DESCRIPTION, DP12_.LEGAL_STATUS_GROUPING, DP12_.MAIN_LEGAL_STATUS, DP12_.MAIN_LS_DESCRIPTION, DP12_.EFFECTIVE_SENTENCE_LENGTH, DP12_.CURRENT_RELEASE_DATE, DP10_.REHAB_PROVIDER_CODE, DP10_.REHAB_PROVIDER_DESCRIPTION, DPb_.ALERT_TYPE_CODE, DPb_.ALERT_DESCRIPTION, DPb_.ALERT_COMMENT_TEXT, DPb_.ALERT_EFFECTIVE_DATE, DPb_.EXPIRY_DATE, DPb_.CREATE_USER_ID, DPb_.TRANSFER, DPb_.SOR, CASE_ADMINISTRATOR_.CA_NAME, CASE_ADMINISTRATOR_.CA_COUNT, CASE_ADMINISTRATOR_.OF_NAME, CASE_ADMINISTRATOR_.OF_COUNT, COURT_.COURT_NAMES, COURT_.COURT_DATES, COURT_.COURT_REASON, OFFENCE_.MAIN_OFFENCES FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.REFERENCE_CODES DT_APPROVED_LEVEL, OMS_OWNER.REFERENCE_CODES DT_CALC_LEVEL, ( SELECT iep_level, description, agy_loc_id, offender_book_id, iep_date FROM ( SELECT iep.iep_level, rc.description, iep.agy_loc_id, iep.offender_book_id, iep.iep_date, ROW_NUMBER() OVER ( PARTITION BY iep.offender_book_id ORDER BY iep.iep_time DESC, iep.iep_level_seq DESC ) AS row_seq_filter FROM oms_owner.offender_iep_levels iep LEFT OUTER JOIN oms_owner.reference_codes rc ON iep.iep_level = rc.code AND rc.domain = 'IEP_LEVEL' ) WHERE row_seq_filter = 1 ) DT_IEP_BAND_LAST, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.OFFENDER_PROFILE_DETAILS AT_OFF_PROF_DET_NAT, OMS_OWNER.OFFENDER_PROFILE_DETAILS AT_OFFENDER_RELIGION, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.V_HEADER_BLOCK AT_HEADER_BLOCK, OMS_OWNER.PROFILE_CODES AT_NATIONALITY, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, ( SELECT oa.offender_book_id, oa.assessment_seq, oa.assess_status, oa.review_place_agy_loc_id, oa.assessment_date, oa.calc_sup_level_type, oa.overrided_sup_level_type, oa.review_sup_level_type, oa.next_review_date, rc.description AS review_sup_level_description, oa.evaluation_result_code, ROW_NUMBER() OVER ( PARTITION BY oa.offender_book_id ORDER BY CASE WHEN oa.assess_status <> 'I' THEN 1 ELSE 2 END, oa.assessment_date DESC, oa.assessment_seq DESC ) AS row_seq_filter FROM offender_assessments oa INNER JOIN assessments a ON a.assessment_id = oa.assessment_type_id AND a.assessment_class = 'TYPE' AND a.assessment_code = 'CATEGORY' AND a.determine_sup_level_flag = 'Y' LEFT OUTER JOIN reference_codes rc ON rc.code = oa.review_sup_level_type AND rc.domain = 'SUP_LVL_TYPE' ) DT_CATEGORISATION, ( SELECT DISTINCT m.OFFENDER_BOOK_ID, MAX(m.MOVEMENT_TIME) AS ADMISSION_DATE FROM OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS m, OMS_OWNER.offender_bookings h WHERE h.booking_status = 'O' AND h.active_flag = 'Y' AND m.direction_code = 'IN' /* AND m.Movement_reason_code !='R' */ AND m.Movement_type = 'ADM' AND m.to_agy_loc_id = h.agy_loc_id AND h.offender_book_id = m.offender_book_id GROUP BY m.OFFENDER_BOOK_ID ) DT_ADMISSION, ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, coalesced_result_description, row_seq_filter FROM ( SELECT v.*, rc.description AS coalesced_result_description FROM ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, CASE WHEN row_seq_filter_latest = 1 THEN 1 ELSE row_seq_filter_previous END AS row_seq_filter FROM ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, CASE WHEN row_seq_filter_latest = 1 AND assess_status = 'A' THEN 1 ELSE 0 END AS row_seq_filter_latest, COUNT( CASE WHEN row_seq_filter_previous = 1 AND assess_status <> 'A' THEN 1 END ) OVER (PARTITION BY offender_book_id) + row_seq_filter_previous AS row_seq_filter_previous FROM ( SELECT oa.offender_book_id, oa.assessment_date, a.description AS assessment_type, oa.calc_sup_level_type, oa.overrided_sup_level_type, oa.review_sup_level_type AS approved_result, oa.review_committe_code AS authority, oa.next_review_date, oa.assessment_seq, oa.assess_status, oa.score, COALESCE( oa.review_sup_level_type, oa.overrided_sup_level_type, oa.calc_sup_level_type ) AS coalesced_result, ROW_NUMBER() OVER ( PARTITION BY oa.offender_book_id ORDER BY oa.assess_status, oa.assessment_date DESC, oa.assessment_seq DESC ) AS row_seq_filter_latest, ROW_NUMBER() OVER ( PARTITION BY oa.offender_book_id ORDER BY oa.assessment_date DESC, oa.assessment_seq DESC ) AS row_seq_filter_previous FROM offender_assessments oa INNER JOIN assessments a ON a.assessment_id = oa.assessment_type_id AND a.assessment_class = 'TYPE' AND a.cell_sharing_alert_flag = 'Y' ) ) ) v LEFT OUTER JOIN reference_codes rc ON rc.code = v.coalesced_result AND rc.domain = 'SUP_LVL_TYPE' ) ) DT_OFFENDER_CSR_ASSESSMENT, OMS_OWNER.PROFILE_CODES AT_RELIGION, DP12_, DP10_, DPb_, CASE_ADMINISTRATOR_, COURT_, OFFENCE_ WHERE ( ( ( ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDER_RELIGION.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND (AT_OFFENDER_RELIGION.PROFILE_TYPE = 'RELF') AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( DT_IEP_BAND_LAST.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFF_PROF_DET_NAT.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND (AT_OFF_PROF_DET_NAT.PROFILE_TYPE = ('NAT')) AND ( AT_NATIONALITY.PROFILE_TYPE = AT_OFF_PROF_DET_NAT.PROFILE_TYPE AND AT_NATIONALITY.PROFILE_CODE = AT_OFF_PROF_DET_NAT.PROFILE_CODE ) AND (AT_NATIONALITY.PROFILE_TYPE = ('NAT')) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( AT_RELIGION.PROFILE_CODE = AT_OFFENDER_RELIGION.PROFILE_CODE ) AND ( AT_RELIGION.PROFILE_TYPE = AT_OFFENDER_RELIGION.PROFILE_TYPE ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_OFFENDER_CSR_ASSESSMENT.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_HEADER_BLOCK.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_ADMISSION.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_CATEGORISATION.OFFENDER_BOOK_ID ) AND ( DT_CATEGORISATION.CALC_SUP_LEVEL_TYPE = DT_CALC_LEVEL.CODE ) AND ( DT_CATEGORISATION.REVIEW_SUP_LEVEL_TYPE = DT_APPROVED_LEVEL.CODE ) AND (DT_CALC_LEVEL.DOMAIN = 'SUP_LVL_TYPE') AND (DT_APPROVED_LEVEL.DOMAIN = 'SUP_LVL_TYPE') AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND ( DT_CATEGORISATION.row_seq_filter = 1 OR DT_CATEGORISATION.row_seq_filter IS NULL ) AND ( DT_OFFENDER_CSR_ASSESSMENT.row_seq_filter = 1 OR DT_OFFENDER_CSR_ASSESSMENT.row_seq_filter IS NULL ) ) ) AND ( DP12_.OFFENDER_ID_DISPLAY(+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) ) AND ( DP10_.OFFENDER_ID_DISPLAY(+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) ) AND ( DPb_.OFFENDER_ID_DISPLAY(+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) AND ( CASE_ADMINISTRATOR_.OFFENDER_ID_DISPLAY(+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) AND ( COURT_.OFFENDER_ID_DISPLAY(+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) AND ( OFFENCE_.OFFENDER_ID_DISPLAY(+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) ), dataset_ AS ( SELECT OFFENDER_ID_DISPLAY, STATUS_2, LAST_NAME, FIRST_NAME, BIRTH_DATE, AGE, NATIONALITY, ETHNIC_CODE, UNIT_DESCRIPTION_4_SHORT, IEP_LEVEL, APPROVED_LEVEL_RESULT, CALCULATED_RESULT, ASSESSMENT_DATE, ADMISSION_DATE, CSR_APPROVED_RESULT, CALC_SUP_LEVEL_TYPE, NEXT_REVIEW_DATE, REVIEW_PLACE_AGY_LOC_ID, RELIGION_DESCRIPTION, LEGAL_STATUS_GROUPING AS V_LEGAL_STATUS_GROUPING, MAIN_LEGAL_STATUS, MAIN_LS_DESCRIPTION AS V_MAIN_LEGAL_STATUS_DESCRIPT31, MAIN_OFFENCES, CASE WHEN APPROVED_LEVEL_RESULT IS NULL THEN CALCULATED_RESULT ELSE APPROVED_LEVEL_RESULT END AS V_CSRA, CASE WHEN CASE WHEN APPROVED_LEVEL_RESULT IS NULL THEN CALCULATED_RESULT ELSE APPROVED_LEVEL_RESULT END = 'STANDARD' THEN 'STAND' ELSE CASE WHEN APPROVED_LEVEL_RESULT IS NULL THEN CALCULATED_RESULT ELSE APPROVED_LEVEL_RESULT END END AS V_CSRA_DISPLAY, CASE WHEN REVIEW_PLACE_AGY_LOC_ID IS NULL THEN '-' ELSE REVIEW_PLACE_AGY_LOC_ID END AS V_RECOMMENDED_ESTAB, COURT_DATES AS V_MAX_CONCAT_SCHEDULED_COURT33, COURT_NAMES AS V_MAX_CONCAT_COURT_NAME, CASE WHEN SUBSTR(COURT_REASON,1,10)='Video Link' THEN 'Y' ELSE '-' END AS VIDEO_LINK, CASE WHEN TRANSFER IS NULL THEN '-' ELSE 'Y' END AS V_HOLD_AGAINST_TX_DISPLAY, EFFECTIVE_SENTENCE_LENGTH, CURRENT_RELEASE_DATE, MONTHS_BETWEEN( TO_DATE((TRUNC(SYSDATE) + 0), 'DD/MM/YYYY'), TO_DATE(CURRENT_RELEASE_DATE, 'DD/MM/YYYY')) AS V_TIME_LEFT_TO_SERVE, CASE WHEN SOR IS NULL THEN '-' ELSE 'Y' END AS V_SEX_OFFENDER, CASE WHEN NATIONALITY IS NULL OR NATIONALITY <> 'British' THEN 'Y' ELSE '-' END AS V_FOREIGN_NATIONAL_DISPLAY, CASE WHEN OF_COUNT > 1 THEN 'MULTI ENTRIES - CHECK RECORD' ELSE OF_NAME END AS V_OFFENDER_SUP_DISPLAY, CASE WHEN CA_COUNT > 1 THEN 'MULTI ENTRIES - CHECK RECORD' ELSE CA_NAME END AS V_CASE_ADMIN_DISPLAY, REHAB_PROVIDER_CODE || ' ' || REHAB_PROVIDER_DESCRIPTION AS V_PROVIDER_DESC, ALERT_TYPE_CODE, ALERT_DESCRIPTION, ALERT_COMMENT_TEXT, ALERT_EFFECTIVE_DATE, CASE WHEN EXPIRY_DATE IS NULL THEN '-' ELSE TO_CHAR(EXPIRY_DATE, 'DD-MON-YY') END AS V_EXPIRY_DATE, CASE WHEN ALERT_TYPE_CODE IN ('TAP', 'TAH', 'TCPA', 'TG', 'TM', 'TPR', 'TSE') THEN CREATE_USER_ID ELSE '-' END AS V_ALERT_CREATE_USER_ID FROM dataset_base_ )",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP3.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "STATUS_2",
            "type": "string",
            "display": "Header Block Category",
            "legacyId": "DP3.DO11051",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP3.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP3.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "BIRTH_DATE",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DP3.DO10075",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "AGE",
            "type": "double",
            "display": "Age",
            "legacyId": "DP3.DO10072",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "NATIONALITY",
            "type": "string",
            "display": "Nationality",
            "legacyId": "DP3.DO10b7e",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "ETHNIC_CODE",
            "type": "string",
            "display": "Ethnic Code",
            "legacyId": "DP3.DO10088",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "UNIT_DESCRIPTION_4_SHORT",
            "type": "string",
            "display": "Cell Location",
            "legacyId": "DP3.DO10427",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "IEP_LEVEL",
            "type": "string",
            "display": "IEP Level",
            "legacyId": "DP3.DO10715",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "APPROVED_LEVEL_RESULT",
            "type": "string",
            "display": "Approved Result",
            "legacyId": "DP3.DO11012",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "CALCULATED_RESULT",
            "type": "string",
            "display": "Calculated Result",
            "legacyId": "DP3.DO11011",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ASSESSMENT_DATE",
            "type": "date",
            "display": "Assessment Date",
            "legacyId": "DP3.DO1100a",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "ADMISSION_DATE",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DP3.DO10c6a",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "CSR_APPROVED_RESULT",
            "type": "string",
            "display": "CSRA Approved Result",
            "legacyId": "DP3.DO10c50",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "CALC_SUP_LEVEL_TYPE",
            "type": "string",
            "display": "CSRA Calculated Result",
            "legacyId": "DP3.DO10c2f",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "NEXT_REVIEW_DATE",
            "type": "date",
            "display": "Next Review Date",
            "legacyId": "DP3.DO1100f",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "REVIEW_PLACE_AGY_LOC_ID",
            "type": "string",
            "display": "Recommended Placement",
            "legacyId": "DP3.DO10c6d",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "RELIGION_DESCRIPTION",
            "type": "string",
            "display": "Religion Description",
            "legacyId": "DP3.DO10c29",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "V_LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 20,
            "name": "MAIN_LEGAL_STATUS",
            "type": "string",
            "display": "Main Legal Status",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 21,
            "name": "V_MAIN_LEGAL_STATUS_DESCRIPT31",
            "type": "string",
            "display": "Main Legal Status Description",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 22,
            "name": "MAIN_OFFENCES",
            "type": "string",
            "display": "Main Offences",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 23,
            "name": "V_CSRA",
            "type": "string",
            "display": "CSRA",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 24,
            "name": "V_CSRA_DISPLAY",
            "type": "string",
            "display": "CSRA Display",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 25,
            "name": "V_RECOMMENDED_ESTAB",
            "type": "string",
            "display": "Recommended Establishment",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 26,
            "name": "V_MAX_CONCAT_SCHEDULED_COURT33",
            "type": "string",
            "display": "Scheduled Court Dates",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 27,
            "name": "V_MAX_CONCAT_COURT_NAME",
            "type": "string",
            "display": "Scheduled Court Names",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 28,
            "name": "VIDEO_LINK",
            "type": "string",
            "display": "Video Link",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 29,
            "name": "V_HOLD_AGAINST_TX_DISPLAY",
            "type": "string",
            "display": "Transfer Hold ?",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 30,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 31,
            "name": "CURRENT_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 32,
            "name": "V_TIME_LEFT_TO_SERVE",
            "type": "double",
            "display": "Time Left to Serve",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 33,
            "name": "V_SEX_OFFENDER",
            "type": "string",
            "display": "Sex Offender",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 34,
            "name": "V_FOREIGN_NATIONAL_DISPLAY",
            "type": "string",
            "display": "Foreign National",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 35,
            "name": "V_OFFENDER_SUP_DISPLAY",
            "type": "string",
            "display": "Offender Supervisor",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 36,
            "name": "V_CASE_ADMIN_DISPLAY",
            "type": "string",
            "display": "Case Administrator",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 37,
            "name": "V_PROVIDER_DESC",
            "type": "string",
            "display": "Provider Description",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 38,
            "name": "ALERT_TYPE_CODE",
            "type": "string",
            "display": "Alert Code",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 39,
            "name": "ALERT_DESCRIPTION",
            "type": "string",
            "display": "Alert Description",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 40,
            "name": "ALERT_COMMENT_TEXT",
            "type": "string",
            "display": "Alert Comment",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 41,
            "name": "ALERT_EFFECTIVE_DATE",
            "type": "date",
            "display": "Alert Effective Date",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 42,
            "name": "V_EXPIRY_DATE",
            "type": "string",
            "display": "Alert Expiry Date",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 43,
            "name": "V_ALERT_CREATE_USER_ID",
            "type": "string",
            "display": "Create User Id",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3376286/DP3S",
      "name": "Offenders",
      "description": "OR - Sentence",
      "datasource": "nomis",
      "query": "DP12_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS AS MAIN_LEGAL_STATUS, CASE WHEN NOT AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE WHEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN DT_LAST_RELEASE_DATE.LAST_REL_DATE ELSE NULL END AS CURRENT_RELEASE_DATE, CASE WHEN DT_OFFENDER_LIFE_FLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE AT_OFFENDER_SENT_CALCULATIONS.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS IN ( '14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA', 'FTRSCH18_ORA', 'FTRSCH18', 'LR_ALP_CDE18', 'LR_ALP_CDE21', 'LR_EDS18', 'LR_EDS21', 'LR_SOPC18', 'LR_SOPC21', 'LRSEC250_ORA', 'LR_EDSU18' ) THEN 'Recall' WHEN AT_IMPRISON_STATUSES.BAND_CODE = '0' THEN 'Dead' WHEN AT_IMPRISON_STATUSES.BAND_CODE = '1' THEN 'Indeterminate Sentence' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('2', '3') THEN 'Sentenced' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('9', '10') OR AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS = 'CIV_RMD' THEN 'Civil Prisoners' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('8', '11') THEN 'Immigration Detainees' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('12', '13', '14') THEN 'Remand' WHEN AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, AT_IMPRISON_STATUSES.DESCRIPTION AS MAIN_LS_DESCRIPTION FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.IMPRISONMENT_STATUSES AT_IMPRISON_STATUSES, OMS_OWNER.OFFENDER_RELEASE_DETAILS AT_OFFENDER_RELEASE_DETAILS, ( SELECT AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID, CASE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE /* when AT_OFFENDER_SENT_CALCULATIONS.ETD_OVERRIDED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.ETD_OVERRIDED_DATE when AT_OFFENDER_SENT_CALCULATIONS.ETD_CALCULATED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.ETD_CALCULATED_DATE when AT_OFFENDER_SENT_CALCULATIONS.LTD_OVERRIDED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.LTD_OVERRIDED_DATE when AT_OFFENDER_SENT_CALCULATIONS.LTD_CALCULATED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.LTD_CALCULATED_DATE */ ELSE NULL END AS Last_Rel_Date, EFFECTIVE_SENTENCE_LENGTH FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = ( SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID ) ) DT_LAST_RELEASE_DATE, ( SELECT DISTINCT OFFENDER_SENTENCE_TERMS.OFFENDER_BOOK_ID, OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG FROM OFFENDER_SENTENCE_TERMS WHERE OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y' ) DT_OFFENDER_LIFE_FLAG, OMS_OWNER.OFFENDER_IMPRISON_STATUSES AT_OFFENDER_IMPRISON_STATUSES WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDER_IMPRISON_STATUSES.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS = 'Y' OR AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS IS NULL ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_RELEASE_DETAILS.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_LAST_RELEASE_DATE.OFFENDER_BOOK_ID (+) ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( DT_OFFENDER_LIFE_FLAG.OFFENDER_BOOK_ID (+) = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID ) AND ( AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS (+) = AT_OFFENDER_IMPRISON_STATUSES.IMPRISONMENT_STATUS ) AND ( ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND ( AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = ( SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID ) OR AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID IS NULL /* END Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */ ) /* START Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */ ) ), DP10_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER_REHAB_PROVIDERS.PROVIDER_CODE AS REHAB_PROVIDER_CODE, AT_REHABILITATION_PROVIDERS.DESCRIPTION AS REHAB_PROVIDER_DESCRIPTION FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_REHAB_PROVIDERS AT_OFFENDER_REHAB_PROVIDERS, OMS_OWNER.REHABILITATION_PROVIDERS AT_REHABILITATION_PROVIDERS, OMS_OWNER.OFFENDER_REHAB_DECISIONS AT_OFFENDER_REHAB_DECISIONS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_OFFENDER_REHAB_DECISIONS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_REHAB_PROVIDERS.OFFENDER_REHAB_DECISION_ID (+) = AT_OFFENDER_REHAB_DECISIONS.OFFENDER_REHAB_DECISION_ID ) AND ( AT_REHABILITATION_PROVIDERS.PROVIDER_CODE (+) = AT_OFFENDER_REHAB_PROVIDERS.PROVIDER_CODE ) AND ( ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_OFFENDER_REHAB_DECISIONS.ACTIVE_FLAG = 'Y' AND AT_OFFENDER_REHAB_PROVIDERS.ACTIVE_FLAG = 'Y' ) ), DPb_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_ALERT_TYPE_DESC.DESCRIPTION AS ALERT_DESCRIPTION, AT_OFFENDER_ALERTS.ALERT_CODE AS ALERT_TYPE_CODE, AT_OFFENDER_ALERTS.ALERT_DATE AS ALERT_EFFECTIVE_DATE, AT_OFFENDER_ALERTS.COMMENT_TEXT AS ALERT_COMMENT_TEXT, AT_OFFENDER_ALERTS.EXPIRY_DATE AS EXPIRY_DATE, AT_OFFENDER_ALERTS.CREATE_DATE AS CREATE_DATE, AT_OFFENDER_ALERTS.CREATE_USER_ID AS CREATE_USER_ID, CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE IN ('TAP','TAH','TCPA','TG','TM','TPR','TSE' ) THEN 'Y' ELSE NULL END AS TRANSFER, CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE IN ('SOR','SR','SONR' ) THEN 'Y' ELSE NULL END AS SOR FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_ALERT_TYPE_DESC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_ALERT_TYPE_DESC.CODE (+) = AT_OFFENDER_ALERTS.ALERT_CODE ) AND ( AT_ALERT_TYPE_DESC.DOMAIN = 'ALERT_CODE' OR AT_ALERT_TYPE_DESC.DOMAIN IS NULL ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND (AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE') ) ), DPc_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_PEOPLE.FIRST_NAME AS CONTACT_FIRST_NAME, AT_PEOPLE.LAST_NAME AS CONTACT_LAST_NAME, AT_CONTACTS.RELATIONSHIP_TYPE AS CONTACT_RELATIONSHIP_TYPE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.PERSONS AT_PEOPLE, OMS_OWNER.OFFENDER_CONTACT_PERSONS AT_CONTACTS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_CONTACTS.OFFENDER_BOOK_ID (+) ) AND (AT_PEOPLE.PERSON_ID (+) = AT_CONTACTS.PERSON_ID) AND ( (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND AT_CONTACTS.ACTIVE_FLAG IN ('Y') AND AT_CONTACTS.RELATIONSHIP_TYPE IN ('OFS', 'CA') ) ), CASE_ADMINISTRATOR_ AS ( SELECT OFFENDER_ID_DISPLAY, CASE WHEN DPc_.CONTACT_RELATIONSHIP_TYPE = 'CA' THEN DPc_.CONTACT_FIRST_NAME || ' ' || DPc_.CONTACT_LAST_NAME END AS CA_NAME, CASE WHEN DPc_.CONTACT_RELATIONSHIP_TYPE = 'CA' THEN COUNT(1) OVER (PARTITION BY OFFENDER_ID_DISPLAY) END AS CA_COUNT, CASE WHEN DPc_.CONTACT_RELATIONSHIP_TYPE = 'OFS' THEN DPc_.CONTACT_FIRST_NAME || ' ' || DPc_.CONTACT_LAST_NAME END AS OF_NAME, CASE WHEN DPc_.CONTACT_RELATIONSHIP_TYPE = 'OFS' THEN COUNT(1) OVER (PARTITION BY OFFENDER_ID_DISPLAY) END AS OF_COUNT FROM DPc_ ), DP15_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_COURT_EVENT_MVMTS.EVENT_ID AS EVENT_ID, AT_COURT_EVENT_MVMTS.START_TIME AS START_TIME, CourtMovementReason.DESCRIPTION AS DESCRIPTION, AT_DESTINATION_COURT.DESCRIPTION AS COURT_NAME, TO_CHAR(AT_COURT_EVENT_MVMTS.START_TIME, 'AM') AS COURT_SLOT_ FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES CourtMovementReason, OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_DESTINATION_COURT, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.COURT_EVENTS AT_COURT_EVENT_MVMTS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND (CourtMovementReason.PARENT_CODE = 'CRT') AND (CourtMovementReason.DOMAIN = 'MOVE_RSN') AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_COURT_EVENT_MVMTS.OFFENDER_BOOK_ID ) AND ( AT_COURT_EVENT_MVMTS.COURT_EVENT_TYPE = CourtMovementReason.CODE ) AND ( AT_COURT_EVENT_MVMTS.AGY_LOC_ID = AT_DESTINATION_COURT.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_COURT_EVENT_MVMTS.EVENT_STATUS IN ('SCH') AND AT_COURT_EVENT_MVMTS.EVENT_DATE >= TRUNC(CURRENT_TIMESTAMP) AND AT_COURT_EVENT_MVMTS.DIRECTION_CODE IN ('OUT') AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND ( AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = ( SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID ) OR AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID IS NULL /* END Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */ ) /* START Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */ ) ), COURT_ AS ( SELECT DP15_.OFFENDER_ID_DISPLAY, DP15_.DESCRIPTION AS COURT_REASON, LISTAGG(DP15_.COURT_NAME, ', ') WITHIN GROUP(ORDER BY DP15_.COURT_NAME) AS COURT_NAMES, LISTAGG(DP15_.START_TIME,', ') WITHIN GROUP(ORDER BY DP15_.START_TIME) AS COURT_DATES FROM DP15_ GROUP BY OFFENDER_ID_DISPLAY, DESCRIPTION ), DP14_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENCES.DESCRIPTION AS DESCRIPTION FROM OMS_OWNER.COURT_EVENTS AT_OFFENDER_COURT_EVENTS, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENCES AT_OFFENCES, OMS_OWNER.COURT_EVENT_CHARGES AT_COURT_EVENT_CHARGES, OMS_OWNER.OFFENDER_CHARGES AT_OFFENDER_CHARGES, OMS_OWNER.OFFENDER_CASES AT_OFFENDER_CASES WHERE ( AT_COURT_EVENT_CHARGES.EVENT_ID (+) = AT_OFFENDER_COURT_EVENTS.EVENT_ID ) AND ( AT_OFFENDER_CHARGES.OFFENDER_CHARGE_ID (+) = AT_COURT_EVENT_CHARGES.OFFENDER_CHARGE_ID ) AND ( AT_OFFENDER_COURT_EVENTS.CASE_ID = AT_OFFENDER_CASES.CASE_ID ) AND ( AT_OFFENDER_CHARGES.OFFENCE_CODE = AT_OFFENCES.OFFENCE_CODE (+) ) AND ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_CASES.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_COURT_EVENT_CHARGES.MOST_SERIOUS_FLAG = 'Y' ) ), OFFENCE_ AS ( SELECT DP14_.OFFENDER_ID_DISPLAY, LISTAGG(DP14_.DESCRIPTION, ', ') WITHIN GROUP(ORDER BY DP14_.DESCRIPTION) AS MAIN_OFFENCES FROM DP14_ GROUP BY OFFENDER_ID_DISPLAY, DESCRIPTION ), dataset_base_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_HEADER_BLOCK.STATUS_2 AS STATUS_2, AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, AT_OFFENDER.BIRTH_DATE AS BIRTH_DATE, TRUNC( MONTHS_BETWEEN(CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12 ) AS AGE, AT_NATIONALITY.DESCRIPTION AS NATIONALITY, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END AS ETHNIC_CODE, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, DT_IEP_BAND_LAST.IEP_LEVEL AS IEP_LEVEL, DT_APPROVED_LEVEL.DESCRIPTION AS APPROVED_LEVEL_RESULT, DT_CALC_LEVEL.DESCRIPTION AS CALCULATED_RESULT, DT_CATEGORISATION.ASSESSMENT_DATE AS ASSESSMENT_DATE, DT_ADMISSION.ADMISSION_DATE AS ADMISSION_DATE, DT_OFFENDER_CSR_ASSESSMENT.APPROVED_RESULT AS CSR_APPROVED_RESULT, DT_OFFENDER_CSR_ASSESSMENT.CALC_SUP_LEVEL_TYPE AS CALC_SUP_LEVEL_TYPE, DT_CATEGORISATION.NEXT_REVIEW_DATE AS NEXT_REVIEW_DATE, DT_CATEGORISATION.REVIEW_PLACE_AGY_LOC_ID AS REVIEW_PLACE_AGY_LOC_ID, AT_RELIGION.DESCRIPTION AS RELIGION_DESCRIPTION, DP12_.LEGAL_STATUS_GROUPING, DP12_.MAIN_LEGAL_STATUS, DP12_.MAIN_LS_DESCRIPTION, DP12_.EFFECTIVE_SENTENCE_LENGTH, DP12_.CURRENT_RELEASE_DATE, DP10_.REHAB_PROVIDER_CODE, DP10_.REHAB_PROVIDER_DESCRIPTION, DPb_.ALERT_TYPE_CODE, DPb_.ALERT_DESCRIPTION, DPb_.ALERT_COMMENT_TEXT, DPb_.ALERT_EFFECTIVE_DATE, DPb_.EXPIRY_DATE, DPb_.CREATE_USER_ID, DPb_.TRANSFER, DPb_.SOR, CASE_ADMINISTRATOR_.CA_NAME, CASE_ADMINISTRATOR_.CA_COUNT, CASE_ADMINISTRATOR_.OF_NAME, CASE_ADMINISTRATOR_.OF_COUNT, COURT_.COURT_NAMES, COURT_.COURT_DATES, COURT_.COURT_REASON, OFFENCE_.MAIN_OFFENCES FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.REFERENCE_CODES DT_APPROVED_LEVEL, OMS_OWNER.REFERENCE_CODES DT_CALC_LEVEL, ( SELECT iep_level, description, agy_loc_id, offender_book_id, iep_date FROM ( SELECT iep.iep_level, rc.description, iep.agy_loc_id, iep.offender_book_id, iep.iep_date, ROW_NUMBER() OVER ( PARTITION BY iep.offender_book_id ORDER BY iep.iep_time DESC, iep.iep_level_seq DESC ) AS row_seq_filter FROM oms_owner.offender_iep_levels iep LEFT OUTER JOIN oms_owner.reference_codes rc ON iep.iep_level = rc.code AND rc.domain = 'IEP_LEVEL' ) WHERE row_seq_filter = 1 ) DT_IEP_BAND_LAST, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.OFFENDER_PROFILE_DETAILS AT_OFF_PROF_DET_NAT, OMS_OWNER.OFFENDER_PROFILE_DETAILS AT_OFFENDER_RELIGION, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.V_HEADER_BLOCK AT_HEADER_BLOCK, OMS_OWNER.PROFILE_CODES AT_NATIONALITY, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, ( SELECT oa.offender_book_id, oa.assessment_seq, oa.assess_status, oa.review_place_agy_loc_id, oa.assessment_date, oa.calc_sup_level_type, oa.overrided_sup_level_type, oa.review_sup_level_type, oa.next_review_date, rc.description AS review_sup_level_description, oa.evaluation_result_code, ROW_NUMBER() OVER ( PARTITION BY oa.offender_book_id ORDER BY CASE WHEN oa.assess_status <> 'I' THEN 1 ELSE 2 END, oa.assessment_date DESC, oa.assessment_seq DESC ) AS row_seq_filter FROM offender_assessments oa INNER JOIN assessments a ON a.assessment_id = oa.assessment_type_id AND a.assessment_class = 'TYPE' AND a.assessment_code = 'CATEGORY' AND a.determine_sup_level_flag = 'Y' LEFT OUTER JOIN reference_codes rc ON rc.code = oa.review_sup_level_type AND rc.domain = 'SUP_LVL_TYPE' ) DT_CATEGORISATION, ( SELECT DISTINCT m.OFFENDER_BOOK_ID, MAX(m.MOVEMENT_TIME) AS ADMISSION_DATE FROM OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS m, OMS_OWNER.offender_bookings h WHERE h.booking_status = 'O' AND h.active_flag = 'Y' AND m.direction_code = 'IN' /* AND m.Movement_reason_code !='R' */ AND m.Movement_type = 'ADM' AND m.to_agy_loc_id = h.agy_loc_id AND h.offender_book_id = m.offender_book_id GROUP BY m.OFFENDER_BOOK_ID ) DT_ADMISSION, ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, coalesced_result_description, row_seq_filter FROM ( SELECT v.*, rc.description AS coalesced_result_description FROM ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, CASE WHEN row_seq_filter_latest = 1 THEN 1 ELSE row_seq_filter_previous END AS row_seq_filter FROM ( SELECT offender_book_id, assessment_date, assessment_type, calc_sup_level_type, overrided_sup_level_type, approved_result, authority, next_review_date, assessment_seq, assess_status, score, coalesced_result, CASE WHEN row_seq_filter_latest = 1 AND assess_status = 'A' THEN 1 ELSE 0 END AS row_seq_filter_latest, COUNT( CASE WHEN row_seq_filter_previous = 1 AND assess_status <> 'A' THEN 1 END ) OVER (PARTITION BY offender_book_id) + row_seq_filter_previous AS row_seq_filter_previous FROM ( SELECT oa.offender_book_id, oa.assessment_date, a.description AS assessment_type, oa.calc_sup_level_type, oa.overrided_sup_level_type, oa.review_sup_level_type AS approved_result, oa.review_committe_code AS authority, oa.next_review_date, oa.assessment_seq, oa.assess_status, oa.score, COALESCE( oa.review_sup_level_type, oa.overrided_sup_level_type, oa.calc_sup_level_type ) AS coalesced_result, ROW_NUMBER() OVER ( PARTITION BY oa.offender_book_id ORDER BY oa.assess_status, oa.assessment_date DESC, oa.assessment_seq DESC ) AS row_seq_filter_latest, ROW_NUMBER() OVER ( PARTITION BY oa.offender_book_id ORDER BY oa.assessment_date DESC, oa.assessment_seq DESC ) AS row_seq_filter_previous FROM offender_assessments oa INNER JOIN assessments a ON a.assessment_id = oa.assessment_type_id AND a.assessment_class = 'TYPE' AND a.cell_sharing_alert_flag = 'Y' ) ) ) v LEFT OUTER JOIN reference_codes rc ON rc.code = v.coalesced_result AND rc.domain = 'SUP_LVL_TYPE' ) ) DT_OFFENDER_CSR_ASSESSMENT, OMS_OWNER.PROFILE_CODES AT_RELIGION, DP12_, DP10_, DPb_, CASE_ADMINISTRATOR_, COURT_, OFFENCE_ WHERE ( ( ( ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDER_RELIGION.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND (AT_OFFENDER_RELIGION.PROFILE_TYPE = 'RELF') AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( DT_IEP_BAND_LAST.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFF_PROF_DET_NAT.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND (AT_OFF_PROF_DET_NAT.PROFILE_TYPE = ('NAT')) AND ( AT_NATIONALITY.PROFILE_TYPE = AT_OFF_PROF_DET_NAT.PROFILE_TYPE AND AT_NATIONALITY.PROFILE_CODE = AT_OFF_PROF_DET_NAT.PROFILE_CODE ) AND (AT_NATIONALITY.PROFILE_TYPE = ('NAT')) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( AT_RELIGION.PROFILE_CODE = AT_OFFENDER_RELIGION.PROFILE_CODE ) AND ( AT_RELIGION.PROFILE_TYPE = AT_OFFENDER_RELIGION.PROFILE_TYPE ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_OFFENDER_CSR_ASSESSMENT.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_HEADER_BLOCK.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_ADMISSION.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_CATEGORISATION.OFFENDER_BOOK_ID ) AND ( DT_CATEGORISATION.CALC_SUP_LEVEL_TYPE = DT_CALC_LEVEL.CODE ) AND ( DT_CATEGORISATION.REVIEW_SUP_LEVEL_TYPE = DT_APPROVED_LEVEL.CODE ) AND (DT_CALC_LEVEL.DOMAIN = 'SUP_LVL_TYPE') AND (DT_APPROVED_LEVEL.DOMAIN = 'SUP_LVL_TYPE') AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */ ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND ( DT_CATEGORISATION.row_seq_filter = 1 OR DT_CATEGORISATION.row_seq_filter IS NULL ) AND ( DT_OFFENDER_CSR_ASSESSMENT.row_seq_filter = 1 OR DT_OFFENDER_CSR_ASSESSMENT.row_seq_filter IS NULL ) ) ) AND ( DP12_.OFFENDER_ID_DISPLAY(+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) ) AND ( DP10_.OFFENDER_ID_DISPLAY(+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) ) AND ( DPb_.OFFENDER_ID_DISPLAY(+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) AND ( CASE_ADMINISTRATOR_.OFFENDER_ID_DISPLAY(+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) AND ( COURT_.OFFENDER_ID_DISPLAY(+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) AND ( OFFENCE_.OFFENDER_ID_DISPLAY(+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) ), dataset_ AS ( SELECT OFFENDER_ID_DISPLAY, STATUS_2, LAST_NAME, FIRST_NAME, BIRTH_DATE, AGE, NATIONALITY, ETHNIC_CODE, UNIT_DESCRIPTION_4_SHORT, IEP_LEVEL, APPROVED_LEVEL_RESULT, CALCULATED_RESULT, ASSESSMENT_DATE, ADMISSION_DATE, CSR_APPROVED_RESULT, CALC_SUP_LEVEL_TYPE, NEXT_REVIEW_DATE, REVIEW_PLACE_AGY_LOC_ID, RELIGION_DESCRIPTION, LEGAL_STATUS_GROUPING AS V_LEGAL_STATUS_GROUPING, MAIN_LEGAL_STATUS, MAIN_LS_DESCRIPTION AS V_MAIN_LEGAL_STATUS_DESCRIPT31, MAIN_OFFENCES, CASE WHEN APPROVED_LEVEL_RESULT IS NULL THEN CALCULATED_RESULT ELSE APPROVED_LEVEL_RESULT END AS V_CSRA, CASE WHEN CASE WHEN APPROVED_LEVEL_RESULT IS NULL THEN CALCULATED_RESULT ELSE APPROVED_LEVEL_RESULT END = 'STANDARD' THEN 'STAND' ELSE CASE WHEN APPROVED_LEVEL_RESULT IS NULL THEN CALCULATED_RESULT ELSE APPROVED_LEVEL_RESULT END END AS V_CSRA_DISPLAY, CASE WHEN REVIEW_PLACE_AGY_LOC_ID IS NULL THEN '-' ELSE REVIEW_PLACE_AGY_LOC_ID END AS V_RECOMMENDED_ESTAB, COURT_DATES AS V_MAX_CONCAT_SCHEDULED_COURT33, COURT_NAMES AS V_MAX_CONCAT_COURT_NAME, CASE WHEN SUBSTR(COURT_REASON,1,10)='Video Link' THEN 'Y' ELSE '-' END AS VIDEO_LINK, CASE WHEN TRANSFER IS NULL THEN '-' ELSE 'Y' END AS V_HOLD_AGAINST_TX_DISPLAY, EFFECTIVE_SENTENCE_LENGTH, CURRENT_RELEASE_DATE, MONTHS_BETWEEN( TO_DATE((TRUNC(SYSDATE) + 0), 'DD/MM/YYYY'), TO_DATE(CURRENT_RELEASE_DATE, 'DD/MM/YYYY')) AS V_TIME_LEFT_TO_SERVE, CASE WHEN SOR IS NULL THEN '-' ELSE 'Y' END AS V_SEX_OFFENDER, CASE WHEN NATIONALITY IS NULL OR NATIONALITY <> 'British' THEN 'Y' ELSE '-' END AS V_FOREIGN_NATIONAL_DISPLAY, CASE WHEN OF_COUNT > 1 THEN 'MULTI ENTRIES - CHECK RECORD' ELSE OF_NAME END AS V_OFFENDER_SUP_DISPLAY, CASE WHEN CA_COUNT > 1 THEN 'MULTI ENTRIES - CHECK RECORD' ELSE CA_NAME END AS V_CASE_ADMIN_DISPLAY, REHAB_PROVIDER_CODE || ' ' || REHAB_PROVIDER_DESCRIPTION AS V_PROVIDER_DESC FROM dataset_base_ )",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP3.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "STATUS_2",
            "type": "string",
            "display": "Header Block Category",
            "legacyId": "DP3.DO11051",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP3.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP3.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "BIRTH_DATE",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DP3.DO10075",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "AGE",
            "type": "double",
            "display": "Age",
            "legacyId": "DP3.DO10072",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "NATIONALITY",
            "type": "string",
            "display": "Nationality",
            "legacyId": "DP3.DO10b7e",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "ETHNIC_CODE",
            "type": "string",
            "display": "Ethnic Code",
            "legacyId": "DP3.DO10088",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "UNIT_DESCRIPTION_4_SHORT",
            "type": "string",
            "display": "Cell Location",
            "legacyId": "DP3.DO10427",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "IEP_LEVEL",
            "type": "string",
            "display": "IEP Level",
            "legacyId": "DP3.DO10715",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "APPROVED_LEVEL_RESULT",
            "type": "string",
            "display": "Approved Result",
            "legacyId": "DP3.DO11012",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "CALCULATED_RESULT",
            "type": "string",
            "display": "Calculated Result",
            "legacyId": "DP3.DO11011",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "ASSESSMENT_DATE",
            "type": "date",
            "display": "Assessment Date",
            "legacyId": "DP3.DO1100a",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "ADMISSION_DATE",
            "type": "date",
            "display": "Admission Date",
            "legacyId": "DP3.DO10c6a",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "CSR_APPROVED_RESULT",
            "type": "string",
            "display": "CSRA Approved Result",
            "legacyId": "DP3.DO10c50",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "CALC_SUP_LEVEL_TYPE",
            "type": "string",
            "display": "CSRA Calculated Result",
            "legacyId": "DP3.DO10c2f",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "NEXT_REVIEW_DATE",
            "type": "date",
            "display": "Next Review Date",
            "legacyId": "DP3.DO1100f",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "REVIEW_PLACE_AGY_LOC_ID",
            "type": "string",
            "display": "Recommended Placement",
            "legacyId": "DP3.DO10c6d",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "RELIGION_DESCRIPTION",
            "type": "string",
            "display": "Religion Description",
            "legacyId": "DP3.DO10c29",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "V_LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 20,
            "name": "MAIN_LEGAL_STATUS",
            "type": "string",
            "display": "Main Legal Status",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 21,
            "name": "V_MAIN_LEGAL_STATUS_DESCRIPT31",
            "type": "string",
            "display": "Main Legal Status Description",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 22,
            "name": "MAIN_OFFENCES",
            "type": "string",
            "display": "Main Offences",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 23,
            "name": "V_CSRA",
            "type": "string",
            "display": "CSRA",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 24,
            "name": "V_CSRA_DISPLAY",
            "type": "string",
            "display": "CSRA Display",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 25,
            "name": "V_RECOMMENDED_ESTAB",
            "type": "string",
            "display": "Recommended Establishment",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 26,
            "name": "V_MAX_CONCAT_SCHEDULED_COURT33",
            "type": "string",
            "display": "Scheduled Court Dates",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 27,
            "name": "V_MAX_CONCAT_COURT_NAME",
            "type": "string",
            "display": "Scheduled Court Names",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 28,
            "name": "VIDEO_LINK",
            "type": "string",
            "display": "Video Link",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 29,
            "name": "V_HOLD_AGAINST_TX_DISPLAY",
            "type": "string",
            "display": "Transfer Hold ?",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 30,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 31,
            "name": "CURRENT_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 32,
            "name": "V_TIME_LEFT_TO_SERVE",
            "type": "double",
            "display": "Time Left to Serve",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 33,
            "name": "V_SEX_OFFENDER",
            "type": "string",
            "display": "Sex Offender",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 34,
            "name": "V_FOREIGN_NATIONAL_DISPLAY",
            "type": "string",
            "display": "Foreign National",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 35,
            "name": "V_OFFENDER_SUP_DISPLAY",
            "type": "string",
            "display": "Offender Supervisor",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 36,
            "name": "V_CASE_ADMIN_DISPLAY",
            "type": "string",
            "display": "Case Administrator",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 37,
            "name": "V_PROVIDER_DESC",
            "type": "string",
            "display": "Provider Description",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3377299/DPb",
      "name": "Alerts",
      "description": "OR - Demographics",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_ALERT_TYPE_DESC.DESCRIPTION AS DESCRIPTION, AT_OFFENDER_ALERTS.ALERT_CODE AS ALERT_CODE, AT_OFFENDER_ALERTS.ALERT_DATE AS ALERT_DATE, AT_OFFENDER_ALERTS.COMMENT_TEXT AS COMMENT_TEXT, AT_OFFENDER_ALERTS.EXPIRY_DATE AS EXPIRY_DATE, AT_OFFENDER_ALERTS.CREATE_DATE AS CREATE_DATE, AT_OFFENDER_ALERTS.CREATE_USER_ID AS CREATE_USER_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_ALERT_TYPE_DESC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_ALERT_TYPE_DESC.CODE (+) = AT_OFFENDER_ALERTS.ALERT_CODE) AND (AT_ALERT_TYPE_DESC.DOMAIN = 'ALERT_CODE' OR AT_ALERT_TYPE_DESC.DOMAIN IS NULL) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */)) AND (AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DESCRIPTION, ALERT_CODE, ALERT_DATE, COMMENT_TEXT, EXPIRY_DATE, CREATE_DATE, CREATE_USER_ID FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPb.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Alert Description",
            "legacyId": "DPb.DO97",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "ALERT_CODE",
            "type": "string",
            "display": "Alert Type Code",
            "legacyId": "DPb.DO7e",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "ALERT_DATE",
            "type": "date",
            "display": "Alert Effective Date",
            "legacyId": "DPb.DO59e",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "COMMENT_TEXT",
            "type": "string",
            "display": "Alert Comment Text",
            "legacyId": "DPb.DO10eb",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "EXPIRY_DATE",
            "type": "date",
            "display": "Expiry Date",
            "legacyId": "DPb.DO82",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "CREATE_DATE",
            "type": "date",
            "display": "Create Date",
            "legacyId": "DPb.DO81",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "CREATE_USER_ID",
            "type": "string",
            "display": "Alert Create User Id (see Description)",
            "legacyId": "DPb.DO1102",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3377299/DPc",
      "name": "Contacts",
      "description": "OR - Demographics",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_PEOPLE.FIRST_NAME AS FIRST_NAME, AT_PEOPLE.LAST_NAME AS LAST_NAME, AT_CONTACTS.RELATIONSHIP_TYPE AS RELATIONSHIP_TYPE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.PERSONS AT_PEOPLE, OMS_OWNER.OFFENDER_CONTACT_PERSONS AT_CONTACTS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_CONTACTS.OFFENDER_BOOK_ID (+)) AND (AT_PEOPLE.PERSON_ID (+) = AT_CONTACTS.PERSON_ID) AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */)) AND AT_CONTACTS.ACTIVE_FLAG IN ('Y') AND AT_CONTACTS.RELATIONSHIP_TYPE IN ('OFS', 'CA'))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, FIRST_NAME, LAST_NAME, RELATIONSHIP_TYPE FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPc.DO44",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "CP First Name",
            "legacyId": "DPc.DOed9",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "LAST_NAME",
            "type": "string",
            "display": "CP Last Name",
            "legacyId": "DPc.DOed8",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "RELATIONSHIP_TYPE",
            "type": "string",
            "display": "Relationship Type",
            "legacyId": "DPc.DO107d",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376286/DP10",
      "name": "Rehab",
      "description": "OR - Sentence",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER_REHAB_PROVIDERS.PROVIDER_CODE AS PROVIDER_CODE, AT_REHABILITATION_PROVIDERS.DESCRIPTION AS DESCRIPTION FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_REHAB_PROVIDERS AT_OFFENDER_REHAB_PROVIDERS, OMS_OWNER.REHABILITATION_PROVIDERS AT_REHABILITATION_PROVIDERS, OMS_OWNER.OFFENDER_REHAB_DECISIONS AT_OFFENDER_REHAB_DECISIONS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_OFFENDER_REHAB_DECISIONS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_REHAB_PROVIDERS.OFFENDER_REHAB_DECISION_ID (+) = AT_OFFENDER_REHAB_DECISIONS.OFFENDER_REHAB_DECISION_ID) AND (AT_REHABILITATION_PROVIDERS.PROVIDER_CODE (+) = AT_OFFENDER_REHAB_PROVIDERS.PROVIDER_CODE) AND ((AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */)) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_OFFENDER_REHAB_DECISIONS.ACTIVE_FLAG = 'Y' AND AT_OFFENDER_REHAB_PROVIDERS.ACTIVE_FLAG = 'Y')), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, PROVIDER_CODE, DESCRIPTION FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP10.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "PROVIDER_CODE",
            "type": "string",
            "display": "Rehab Provider Code",
            "legacyId": "DP10.DO110fc",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Rehab Provider Description",
            "legacyId": "DP10.DO110fd",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376286/DP12",
      "name": "Sentence",
      "description": "OR - Sentence",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS AS IMPRISONMENT_STATUS, CASE WHEN NOT AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE WHEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN DT_LAST_RELEASE_DATE.LAST_REL_DATE ELSE NULL END AS CURRENT_RELEASE_DATE, CASE WHEN DT_OFFENDER_LIFE_FLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE AT_OFFENDER_SENT_CALCULATIONS.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH, CASE WHEN AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS IN ('14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA', 'FTRSCH18_ORA', 'FTRSCH18', 'LR_ALP_CDE18', 'LR_ALP_CDE21', 'LR_EDS18', 'LR_EDS21', 'LR_SOPC18', 'LR_SOPC21', 'LRSEC250_ORA', 'LR_EDSU18') THEN 'Recall' WHEN AT_IMPRISON_STATUSES.BAND_CODE = '0' THEN 'Dead' WHEN AT_IMPRISON_STATUSES.BAND_CODE = '1' THEN 'Indeterminate Sentence' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('2', '3') THEN 'Sentenced' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('9', '10') OR AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS = 'CIV_RMD' THEN 'Civil Prisoners' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('8', '11') THEN 'Immigration Detainees' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('12', '13', '14') THEN 'Remand' WHEN AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, AT_IMPRISON_STATUSES.DESCRIPTION AS DESCRIPTION FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.IMPRISONMENT_STATUSES AT_IMPRISON_STATUSES, OMS_OWNER.OFFENDER_RELEASE_DETAILS AT_OFFENDER_RELEASE_DETAILS, (SELECT AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID, CASE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE /* when AT_OFFENDER_SENT_CALCULATIONS.ETD_OVERRIDED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.ETD_OVERRIDED_DATE when AT_OFFENDER_SENT_CALCULATIONS.ETD_CALCULATED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.ETD_CALCULATED_DATE when AT_OFFENDER_SENT_CALCULATIONS.LTD_OVERRIDED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.LTD_OVERRIDED_DATE when AT_OFFENDER_SENT_CALCULATIONS.LTD_CALCULATED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.LTD_CALCULATED_DATE */ ELSE NULL END AS Last_Rel_Date, EFFECTIVE_SENTENCE_LENGTH FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = (SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID)) DT_LAST_RELEASE_DATE, (SELECT DISTINCT OFFENDER_SENTENCE_TERMS.OFFENDER_BOOK_ID, OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG FROM OFFENDER_SENTENCE_TERMS WHERE OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y') DT_OFFENDER_LIFE_FLAG, OMS_OWNER.OFFENDER_IMPRISON_STATUSES AT_OFFENDER_IMPRISON_STATUSES WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDER_IMPRISON_STATUSES.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) AND (AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS = 'Y' OR AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS IS NULL) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_RELEASE_DETAILS.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_LAST_RELEASE_DATE.OFFENDER_BOOK_ID (+)) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (DT_OFFENDER_LIFE_FLAG.OFFENDER_BOOK_ID (+) = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID) AND (AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS (+) = AT_OFFENDER_IMPRISON_STATUSES.IMPRISONMENT_STATUS) AND ((AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */)) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = (SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID) OR AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID IS NULL /* END Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */) /* START Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */)), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, IMPRISONMENT_STATUS, CURRENT_RELEASE_DATE, EFFECTIVE_SENTENCE_LENGTH, LEGAL_STATUS_GROUPING, DESCRIPTION FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP12.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "IMPRISONMENT_STATUS",
            "type": "string",
            "display": "Main Legal Status",
            "legacyId": "DP12.DO103c7",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "CURRENT_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DP12.DO10b29",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DP12.DO1082f",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DP12.DO1108a",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Main Legal Status - Description",
            "legacyId": "DP12.DO104b6",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376286/DP14",
      "name": "Main Offence",
      "description": "OR - Sentence",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENCES.DESCRIPTION AS DESCRIPTION FROM OMS_OWNER.COURT_EVENTS AT_OFFENDER_COURT_EVENTS, OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENCES AT_OFFENCES, OMS_OWNER.COURT_EVENT_CHARGES AT_COURT_EVENT_CHARGES, OMS_OWNER.OFFENDER_CHARGES AT_OFFENDER_CHARGES, OMS_OWNER.OFFENDER_CASES AT_OFFENDER_CASES WHERE (AT_COURT_EVENT_CHARGES.EVENT_ID (+) = AT_OFFENDER_COURT_EVENTS.EVENT_ID) AND (AT_OFFENDER_CHARGES.OFFENDER_CHARGE_ID (+) = AT_COURT_EVENT_CHARGES.OFFENDER_CHARGE_ID) AND (AT_OFFENDER_COURT_EVENTS.CASE_ID = AT_OFFENDER_CASES.CASE_ID) AND (AT_OFFENDER_CHARGES.OFFENCE_CODE = AT_OFFENCES.OFFENCE_CODE (+)) AND (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_CASES.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND ((AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */)) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_COURT_EVENT_CHARGES.MOST_SERIOUS_FLAG = 'Y')), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DESCRIPTION FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP14.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Offence Description",
            "legacyId": "DP14.DO974",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376286/DP15",
      "name": "Court Schedule",
      "description": "OR - Sentence",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_COURT_EVENT_MVMTS.EVENT_ID AS EVENT_ID, AT_COURT_EVENT_MVMTS.START_TIME AS START_TIME, CourtMovementReason.DESCRIPTION AS DESCRIPTION, AT_DESTINATION_COURT.DESCRIPTION AS COURT_NAME, TO_CHAR(AT_COURT_EVENT_MVMTS.START_TIME, 'AM') AS COURT_SLOT_ FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES CourtMovementReason, OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_DESTINATION_COURT, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.COURT_EVENTS AT_COURT_EVENT_MVMTS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (CourtMovementReason.PARENT_CODE = 'CRT') AND (CourtMovementReason.DOMAIN = 'MOVE_RSN') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_COURT_EVENT_MVMTS.OFFENDER_BOOK_ID) AND (AT_COURT_EVENT_MVMTS.COURT_EVENT_TYPE = CourtMovementReason.CODE) AND (AT_COURT_EVENT_MVMTS.AGY_LOC_ID = AT_DESTINATION_COURT.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_COURT_EVENT_MVMTS.EVENT_STATUS IN ('SCH') AND AT_COURT_EVENT_MVMTS.EVENT_DATE >= TRUNC(CURRENT_TIMESTAMP) AND AT_COURT_EVENT_MVMTS.DIRECTION_CODE IN ('OUT') AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3) */)) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND (AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = (SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID) OR AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID IS NULL /* END Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */) /* START Filter: Hierarchies/Sentence/Sentence Dates/Other Sentence Dates/''Latest Calculation Date'' */)), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, EVENT_ID, START_TIME, DESCRIPTION, COURT_NAME, COURT_SLOT_ FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment/Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP15.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "EVENT_ID",
            "type": "double",
            "display": "Event Id",
            "legacyId": "DP15.DO1097f",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "START_TIME",
            "type": "date",
            "display": "Court Start Time",
            "legacyId": "DP15.DO10983",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Court Movement Reason",
            "legacyId": "DP15.DO109a5",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "COURT_NAME",
            "type": "string",
            "display": "Court Name",
            "legacyId": "DP15.DO109a1",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "COURT_SLOT_",
            "type": "string",
            "display": "Court Slot (AM or PM)",
            "legacyId": "DP15.DO10d5d",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": ["${role}", "ROLE_PRISONS_REPORTING_USER"]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "80010.RS",
      "name": "By Release Date",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_)"
      },
      "feature": [ 
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Date of Birth",
            "formula": "format_date(${BIRTH_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:AGE",
            "display": "Age",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:NATIONALITY",
            "display": "Nationality",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:RELIGION_DESCRIPTION",
            "display": "Religion",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_DESCRIPTION_4_SHORT",
            "display": "Cell Location",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ADMISSION_DATE",
            "display": "Admission Date",
            "formula": "format_date(${ADMISSION_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_LEGAL_STATUS_GROUPING",
            "display": "Legal Status Grouping",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:MAIN_LEGAL_STATUS",
            "display": "Main Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_MAIN_LEGAL_STATUS_DESCRIPT31",
            "display": "Main Legal Status Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:MAIN_OFFENCES",
            "display": "Main Offence",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:IEP_LEVEL",
            "display": "IEP",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_CSRA_DISPLAY",
            "display": "CSRA",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:STATUS_2",
            "display": "Current Category",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:CALCULATED_RESULT",
            "display": "Proposed Cat. during Review",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:APPROVED_LEVEL_RESULT",
            "display": "Approved Cat. at Review",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:NEXT_REVIEW_DATE",
            "display": "Cat - Next Review Date",
            "formula": "format_date(${NEXT_REVIEW_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_RECOMMENDED_ESTAB",
            "display": "Approved Placement",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_MAX_CONCAT_SCHEDULED_COURT33",
            "display": "Scheduled Court Appearance",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_MAX_CONCAT_COURT_NAME",
            "display": "Court",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:VIDEO_LINK",
            "display": "Video Link?",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_HOLD_AGAINST_TX_DISPLAY",
            "display": "Transfer Hold?",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:EFFECTIVE_SENTENCE_LENGTH",
            "display": "Sentence Length",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:CURRENT_RELEASE_DATE",
            "display": "Release Date",
            "formula": "format_date(${CURRENT_RELEASE_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          },
          {
            "name": "$ref:V_TIME_LEFT_TO_SERVE",
            "display": "Months Left to Serve",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_SEX_OFFENDER",
            "display": "Sex Offender?",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_FOREIGN_NATIONAL_DISPLAY",
            "display": "Foreign National?",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_OFFENDER_SUP_DISPLAY",
            "display": "Offender Supervisor",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_CASE_ADMIN_DISPLAY",
            "display": "Case Administrator",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_PROVIDER_DESC",
            "display": "Rehab Provider",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    },
    {
      "id": "81777.RS",
      "name": "Alerts by Release Date",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3",
      "feature": [ 
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Date of Birth",
            "formula": "format_date(${BIRTH_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:AGE",
            "display": "Age",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:NATIONALITY",
            "display": "Nationality",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:RELIGION_DESCRIPTION",
            "display": "Religion",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_DESCRIPTION_4_SHORT",
            "display": "Cell Location",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ALERT_TYPE_CODE",
            "display": "Alert Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ALERT_DESCRIPTION",
            "display": "Alert Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ALERT_COMMENT_TEXT",
            "display": "Alert Comment",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ALERT_EFFECTIVE_DATE",
            "display": "Alert Effective Date",
            "formula": "format_date(${ALERT_EFFECTIVE_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_EXPIRY_DATE",
            "display": "Alert Expiry Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_ALERT_CREATE_USER_ID",
            "display": "Hold Alert Create User Id",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:CURRENT_RELEASE_DATE",
            "display": "Release Date",
            "formula": "format_date(${CURRENT_RELEASE_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          }
        ]
      }
    },
    {
      "id": "83196.RS",
      "name": "By Surname",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3S",
      "feature": [ 
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Date of Birth",
            "formula": "format_date(${BIRTH_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:AGE",
            "display": "Age",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:NATIONALITY",
            "display": "Nationality",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:RELIGION_DESCRIPTION",
            "display": "Religion",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_DESCRIPTION_4_SHORT",
            "display": "Cell Location",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ADMISSION_DATE",
            "display": "Admission Date",
            "formula": "format_date(${ADMISSION_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_LEGAL_STATUS_GROUPING",
            "display": "Legal Status Grouping",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:MAIN_LEGAL_STATUS",
            "display": "Main Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_MAIN_LEGAL_STATUS_DESCRIPT31",
            "display": "Main Legal Status Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:MAIN_OFFENCES",
            "display": "Main Offence",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:IEP_LEVEL",
            "display": "IEP",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_CSRA_DISPLAY",
            "display": "CSRA",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:STATUS_2",
            "display": "Current Category",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:CALCULATED_RESULT",
            "display": "Proposed Cat. during Review",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:APPROVED_LEVEL_RESULT",
            "display": "Approved Cat. at Review",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:NEXT_REVIEW_DATE",
            "display": "Cat - Next Review Date",
            "formula": "format_date(${NEXT_REVIEW_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_RECOMMENDED_ESTAB",
            "display": "Approved Placement",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_MAX_CONCAT_SCHEDULED_COURT33",
            "display": "Scheduled Court Appearance",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_MAX_CONCAT_COURT_NAME",
            "display": "Court",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:VIDEO_LINK",
            "display": "Video Link?",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_HOLD_AGAINST_TX_DISPLAY",
            "display": "Transfer Hold?",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:EFFECTIVE_SENTENCE_LENGTH",
            "display": "Sentence Length",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:CURRENT_RELEASE_DATE",
            "display": "Release Date",
            "formula": "format_date(${CURRENT_RELEASE_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_TIME_LEFT_TO_SERVE",
            "display": "Months Left to Serve",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_SEX_OFFENDER",
            "display": "Sex Offender?",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_FOREIGN_NATIONAL_DISPLAY",
            "display": "Foreign National?",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_OFFENDER_SUP_DISPLAY",
            "display": "Offender Supervisor",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_CASE_ADMIN_DISPLAY",
            "display": "Case Administrator",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_PROVIDER_DESC",
            "display": "Rehab Provider",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    },
    {
      "id": "83326.RS",
      "name": "Alerts by Surname",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3",
      "feature": [ 
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Date of Birth",
            "formula": "format_date(${BIRTH_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:AGE",
            "display": "Age",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:NATIONALITY",
            "display": "Nationality",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:RELIGION_DESCRIPTION",
            "display": "Religion",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_DESCRIPTION_4_SHORT",
            "display": "Cell Location",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ALERT_TYPE_CODE",
            "display": "Alert Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ALERT_DESCRIPTION",
            "display": "Alert Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ALERT_COMMENT_TEXT",
            "display": "Alert Comment",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:ALERT_EFFECTIVE_DATE",
            "display": "Alert Effective Date",
            "formula": "format_date(${ALERT_EFFECTIVE_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_EXPIRY_DATE",
            "display": "Alert Expiry Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_ALERT_CREATE_USER_ID",
            "display": "Hold Alert Create User Id",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:CURRENT_RELEASE_DATE",
            "display": "Release Date",
            "formula": "format_date(${CURRENT_RELEASE_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    }
  ]
}
