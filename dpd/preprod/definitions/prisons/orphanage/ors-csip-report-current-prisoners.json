{
  "id": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
  "name": "ORS CSIP Report Current Prisoners",
  "description": "Displays those Prisoners in their Current Establishment who have CSIP Referrals. These may have been opened at their current or previous Establishment.  Due to the size of the report it does not export correctly to a PDF, therefore it is adviseable to export to excel, if required. <br/><br/>INC0025 v8.0 Last Modified: 25/05/2021",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "INC0025",
      "v8.0",
      "CSIP",
      "Current Establishment"
    ]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3375850/DP1d",
      "name": "CSIP Referrals",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "DP22_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDER.LAST_NAME BETWEEN 'AAAA' AND 'I' AND ( AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) OR 'All' IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) ) ) ), DP23_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDER.LAST_NAME BETWEEN 'I' AND 'Q' AND ( AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) OR 'All' IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) ) ) ), DP24_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDER.LAST_NAME BETWEEN 'Q' AND 'ZZZZ' AND ( AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) OR 'All' IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) ) ) ), DP1D_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, TRUNC( MONTHS_BETWEEN (CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12 ) AS AGE_IN_YEARS, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END AS ETHNIC_CODE, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END || '-' || CASE WHEN AT_ETHNICITY_DESC.CODE = 'W8' THEN 'White: Gypsy or Irish Traveller' WHEN AT_ETHNICITY_DESC.CODE = 'O1' THEN 'Asian/Asian British: Chinese' ELSE AT_ETHNICITY_DESC.DESCRIPTION END AS ETHNIC_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID AS AGY_LOC_ID, AT_OFFENDER_CSIP_REPORTS.CSIP_SEQ AS CSIP_SEQ, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_DATE AS RFR_INCIDENT_DATE, TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_date) + ( AT_OFFENDER_CSIP_REPORTS.rfr_incident_time - TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_time) ) AS RFR_INCIDENT_TIME_, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE AS RFR_INCIDENT_TYPE, AT_REF_CSIP_TYPE.DESCRIPTION AS DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION AS RFR_INCIDENT_LOCATION, AT_REF_CSIP_LOC.DESCRIPTION AS RFR_INCIDENT_LOCATION_DESCRI33, AT_OFFENDER_CSIP_REPORTS.RFR_REPORTED_BY AS RFR_REPORTED_BY, AT_REF_CSIP_FUNC.DESCRIPTION AS RFR_AREA_OF_WORK_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED AS RFR_DATE_REPORTED, AT_OFFENDER_CSIP_REPORTS.RFR_PROACTIVE_RESPONSE AS RFR_PROACTIVE_RESPONSE, AT_OFFENDER_CSIP_REPORTS.RFR_STAFF_ASSAULTED AS RFR_STAFF_ASSAULTED, AT_OFFENDER_CSIP_REPORTS.CSIP_ID AS CSIP_ID, AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION AS DEC_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME_DATE AS INV_OUTCOME_DATE, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME_DATE AS CDR_OUTCOME_DATE, AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION AS CDR_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR AS CSIP_FACTOR, AT_REF_CSIP_FAC.DESCRIPTION AS CDR_FACTOR_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OCCURRENCE_REASON AS INV_OCCURRENCE_REASON, AT_OFFENDER_CSIP_REPORTS.CASE_MANAGER AS CASE_MANAGER, AT_OFFENDER_CSIP_REPORTS.REASON AS REASON, AT_OFFENDER_CSIP_PLANS.CREATE_DATE AS CREATE_DATE, AT_OFFENDER_CSIP_PLANS.TARGET_DATE AS TARGET_DATE, AT_OFFENDER_CSIP_PLANS.CLOSED_DATE AS CLOSED_DATE, AT_OFFENDER_CSIP_PLANS.PLAN_ID AS PLAN_ID, AT_OFFENDER_CSIP_REVIEWS.NEXT_REVIEW_DATE AS NEXT_REVIEW_DATE, AT_OFFENDER_CSIP_REVIEWS.CREATE_DATE AS REV_DATE, AT_OFFENDER_CSIP_REVIEWS.CLOSE_DATE AS CLOSE_DATE, AT_OFFENDER_CSIP_REVIEWS.REVIEW_SEQ AS REVIEW_SEQ, AT_OFFENDER_CSIP_REPORTS.CDR_DECISION_REASON AS CDR_DECISION_REASON, AT_OFFENDER_CSIP_REPORTS.CASE_REV_DATE AS CASE_REV_DATE, AT_OFFENDER_CSIP_REPORTS.REFERRAL_COMPLETED_BY AS REFERRAL_COMPLETED_BY, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN MAX( CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END ) OVER ( PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) ) = 2 THEN 'Y' ELSE 'N' END AS ACCT_ACTIVE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_ETHNICITY_DESC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_TYPE, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_LOC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FUNC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_DECISION_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_CONSID_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FAC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS, OMS_OWNER.OFFENDER_CSIP_FACTORS AT_OFFENDER_CSIP_FACTORS, OMS_OWNER.OFFENDER_CSIP_PLANS AT_OFFENDER_CSIP_PLANS, OMS_OWNER.OFFENDER_CSIP_REVIEWS AT_OFFENDER_CSIP_REVIEWS, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS WHERE ( ( AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID ) AND ( AT_OFFENDER_CSIP_REVIEWS.CSIP_ID = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_FACTORS.CSIP_ID = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_PLANS.CSIP_ID = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE = AT_REF_CSIP_TYPE.CODE ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION = AT_REF_CSIP_LOC.CODE ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_CSIP_FUNCTION = AT_REF_CSIP_FUNC.CODE ) AND ( AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME = AT_REF_CSIP_CONSID_OUTCOME.CODE ) AND ( AT_REF_CSIP_FAC.CODE = AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR ) AND ( AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME = AT_REF_CSIP_DECISION_OUTCOME.CODE ) AND (AT_REF_CSIP_DECISION_OUTCOME.domain = 'CSIP_OUT') AND (AT_REF_CSIP_CONSID_OUTCOME.domain = 'CSIP_OUT') AND (AT_REF_CSIP_FUNC.domain = 'CSIP_FUNC') AND (AT_REF_CSIP_LOC.domain = 'CSIP_LOC') AND (AT_REF_CSIP_TYPE.domain = 'CSIP_TYP') AND (AT_REF_CSIP_FAC.domain = 'CSIP_FAC') AND ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND (AT_ETHNICITY_DESC.DOMAIN = 'ETHNICITY') AND (AT_ETHNICITY_DESC.CODE = AT_OFFENDER.RACE_CODE) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER.OFFENDER_ID_DISPLAY IN ( SELECT OFFENDER_ID_DISPLAY FROM DP22_ ) ) ) ), FACTOR_ AS ( SELECT DISTINCT DP1D_.OFFENDER_ID_DISPLAY, LISTAGG (DP1D_.CSIP_FACTOR, ', ') WITHIN GROUP ( ORDER BY DP1D_.CSIP_FACTOR ) OVER(PARTITION BY DP1D_.OFFENDER_ID_DISPLAY) AS CONCAT_FACTORS_CODE FROM DP1D_ GROUP BY CSIP_FACTOR, OFFENDER_ID_DISPLAY ), PLAN_DATE_ AS ( SELECT DP1D_.OFFENDER_ID_DISPLAY, MIN(DP1D_.CREATE_DATE) AS MIN_PLAN_DATE FROM DP1D_ GROUP BY OFFENDER_ID_DISPLAY ), dataset_base_ AS ( SELECT DISTINCT DP1D_.OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGE_IN_YEARS, ETHNIC_CODE, ETHNIC_DESCRIPTION, AGY_LOC_ID, CSIP_SEQ, RFR_INCIDENT_DATE, RFR_INCIDENT_TIME_, RFR_INCIDENT_TYPE, DESCRIPTION, RFR_INCIDENT_LOCATION, RFR_INCIDENT_LOCATION_DESCRI33, RFR_REPORTED_BY, RFR_AREA_OF_WORK_DESCRIPTION, RFR_DATE_REPORTED, RFR_PROACTIVE_RESPONSE, RFR_STAFF_ASSAULTED, CSIP_ID, DEC_OUTCOME_DESCRIPTION, INV_OUTCOME_DATE, CDR_OUTCOME_DATE, CDR_OUTCOME_DESCRIPTION, INV_OCCURRENCE_REASON, CASE_MANAGER, REASON, CREATE_DATE, TARGET_DATE, CLOSED_DATE, PLAN_ID, NEXT_REVIEW_DATE, REV_DATE, CLOSE_DATE, REVIEW_SEQ, CDR_DECISION_REASON, CASE_REV_DATE, REFERRAL_COMPLETED_BY, UNIT_DESCRIPTION_4_SHORT AS V_LOCATION, ACCT_ACTIVE AS V_ACTIVE_ACCT_DISPLAY, FACTOR_.CONCAT_FACTORS_CODE AS V_MAX_CONCAT_FACTORS_CODE, CASE WHEN REFERRAL_COMPLETED_BY IS NULL THEN 'No' ELSE 'Yes' END AS V_REFERRAL_CONT_COMPLETE_, CASE WHEN CDR_OUTCOME_DESCRIPTION = 'Progress to Investigation' THEN 'Yes' ELSE 'No' END AS V_INVEST_INFO_GATHERING, ( TO_DATE(RFR_DATE_REPORTED, 'DD/MM/YYYY') - TO_DATE(TRUNC(SYSDATE), 'DD/MM/YYYY') ) AS V_LENGTH_OF_TIME_OPEN, CASE WHEN CREATE_DATE IS NULL THEN 'No' ELSE 'Yes' END AS V_PLAN_CREATED_, ( TO_DATE(CDR_OUTCOME_DATE, 'DD/MM/YYYY') - TO_DATE(INV_OUTCOME_DATE, 'DD/MM/YYYY') ) AS V_DAYS_BETWEEN_SCREEN_DATE, ( TO_DATE(PLAN_DATE_.MIN_PLAN_DATE, 'DD/MM/YYYY') - TO_DATE(CLOSE_DATE, 'DD/MM/YYYY') ) AS V_LENGTH_OF_TIME_PLAN_OPEN, INV_OUTCOME_DATE AS V_INVEST_DEC_DATE, DEC_OUTCOME_DESCRIPTION AS V_INVEST_DEC_OUTCOME, PLAN_DATE_.MIN_PLAN_DATE AS MIN_PLAN_CREATE_DATE FROM DP1D_, FACTOR_, PLAN_DATE_ WHERE FACTOR_.OFFENDER_ID_DISPLAY(+) = DP1D_.OFFENDER_ID_DISPLAY AND ( PLAN_DATE_.OFFENDER_ID_DISPLAY(+) = DP1D_.OFFENDER_ID_DISPLAY ) ), dataset_ AS ( SELECT DISTINCT OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGE_IN_YEARS, ETHNIC_CODE, ETHNIC_DESCRIPTION, AGY_LOC_ID, CSIP_SEQ, RFR_INCIDENT_DATE, RFR_INCIDENT_TIME_, RFR_INCIDENT_TYPE, DESCRIPTION, RFR_INCIDENT_LOCATION, RFR_INCIDENT_LOCATION_DESCRI33, RFR_REPORTED_BY, RFR_AREA_OF_WORK_DESCRIPTION, RFR_DATE_REPORTED, RFR_PROACTIVE_RESPONSE, RFR_STAFF_ASSAULTED, CSIP_ID, DEC_OUTCOME_DESCRIPTION, INV_OUTCOME_DATE, CDR_OUTCOME_DATE, CDR_OUTCOME_DESCRIPTION, INV_OCCURRENCE_REASON, CASE_MANAGER, REASON, CREATE_DATE, TARGET_DATE, CLOSED_DATE, PLAN_ID, NEXT_REVIEW_DATE, REV_DATE, CLOSE_DATE, REVIEW_SEQ, CDR_DECISION_REASON, CASE_REV_DATE, REFERRAL_COMPLETED_BY, V_LOCATION, V_ACTIVE_ACCT_DISPLAY, V_MAX_CONCAT_FACTORS_CODE, V_REFERRAL_CONT_COMPLETE_, V_INVEST_INFO_GATHERING, V_LENGTH_OF_TIME_OPEN, V_PLAN_CREATED_, V_DAYS_BETWEEN_SCREEN_DATE, V_LENGTH_OF_TIME_PLAN_OPEN, V_INVEST_DEC_DATE, V_INVEST_DEC_OUTCOME, MIN_PLAN_CREATE_DATE FROM dataset_base_ )",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "wing",
          "filterType": "autocomplete",
          "referenceType": "wing",
          "reportFieldType": "string",
          "display": "Wing (All for all)",
          "description": "@Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP1d.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP1d.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP1d.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "AGE_IN_YEARS",
            "type": "string",
            "display": "Age in Years",
            "legacyId": "DP1d.DO10a15",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "ETHNIC_CODE",
            "type": "string",
            "display": "Ethnic Code",
            "legacyId": "DP1d.DO10088",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "ETHNIC_DESCRIPTION",
            "type": "string",
            "display": "Ethnic Description",
            "legacyId": "DP1d.DO1009d",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "CSIP Agy Loc Id",
            "legacyId": "DP1d.DO6c4",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "CSIP_SEQ",
            "type": "string",
            "display": "CSIP Log #",
            "legacyId": "DP1d.DO65d",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "RFR_INCIDENT_DATE",
            "type": "string",
            "display": "RFR Incident Date",
            "legacyId": "DP1d.DO65e",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "RFR_INCIDENT_TIME_",
            "type": "string",
            "display": "RFR Incident Time (see description)",
            "legacyId": "DP1d.DO65f",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "RFR_INCIDENT_TYPE",
            "type": "string",
            "display": "RFR Incident Type Code",
            "legacyId": "DP1d.DO660",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "RFR Incident Type Description",
            "legacyId": "DP1d.DO679",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "RFR_INCIDENT_LOCATION",
            "type": "string",
            "display": "RFR Incident Location Code",
            "legacyId": "DP1d.DO661",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "RFR_INCIDENT_LOCATION_DESCRI33",
            "type": "string",
            "display": "RFR Incident Location Description",
            "legacyId": "DP1d.DO67a",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "RFR_REPORTED_BY",
            "type": "string",
            "display": "RFR Referred By",
            "legacyId": "DP1d.DO663",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "RFR_AREA_OF_WORK_DESCRIPTION",
            "type": "string",
            "display": "RFR Area of Work Description",
            "legacyId": "DP1d.DO67b",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "RFR_DATE_REPORTED",
            "type": "string",
            "display": "RFR Date Referred",
            "legacyId": "DP1d.DO664",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "RFR_PROACTIVE_RESPONSE",
            "type": "string",
            "display": "RFR Proactive Referral (Prevention)",
            "legacyId": "DP1d.DO666",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "RFR_STAFF_ASSAULTED",
            "type": "string",
            "display": "RFR Staff Assaulted",
            "legacyId": "DP1d.DO667",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "CSIP_ID",
            "type": "string",
            "display": "RFR CSIP ID",
            "legacyId": "DP1d.DO65c",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "DEC_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "DEC Outcome Description",
            "legacyId": "DP1d.DO697",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "INV_OUTCOME_DATE",
            "type": "string",
            "display": "DEC Outcome Date",
            "legacyId": "DP1d.DO68d",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CDR_OUTCOME_DATE",
            "type": "string",
            "display": "CDR Outcome Date",
            "legacyId": "DP1d.DO66b",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "CDR_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "CDR Outcome Description",
            "legacyId": "DP1d.DO680",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "INV_OCCURRENCE_REASON",
            "type": "string",
            "display": "INV Occurrence Reason",
            "legacyId": "DP1d.DO676",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "CASE_MANAGER",
            "type": "string",
            "display": "PLN Case Manager",
            "legacyId": "DP1d.DO699",
            "legacySqlClass": "column"
          },
          {
            "index": 26,
            "name": "REASON",
            "type": "string",
            "display": "PLN Reason",
            "legacyId": "DP1d.DO69a",
            "legacySqlClass": "column"
          },
          {
            "index": 27,
            "name": "CREATE_DATE",
            "type": "string",
            "display": "PLN Create Date",
            "legacyId": "DP1d.DO69d",
            "legacySqlClass": "column"
          },
          {
            "index": 28,
            "name": "TARGET_DATE",
            "type": "string",
            "display": "PLN Target Date",
            "legacyId": "DP1d.DO6a0",
            "legacySqlClass": "column"
          },
          {
            "index": 29,
            "name": "CLOSED_DATE",
            "type": "string",
            "display": "PLN Closed Date",
            "legacyId": "DP1d.DO6a1",
            "legacySqlClass": "column"
          },
          {
            "index": 30,
            "name": "PLAN_ID",
            "type": "string",
            "display": "PLN Plan Id",
            "legacyId": "DP1d.DO69b",
            "legacySqlClass": "column"
          },
          {
            "index": 31,
            "name": "NEXT_REVIEW_DATE",
            "type": "string",
            "display": "REV Next Review Date",
            "legacyId": "DP1d.DO6a4",
            "legacySqlClass": "column"
          },
          {
            "index": 32,
            "name": "REV_DATE",
            "type": "string",
            "display": "REV Date",
            "legacyId": "DP1d.DO6a7",
            "legacySqlClass": "column"
          },
          {
            "index": 33,
            "name": "CLOSE_DATE",
            "type": "string",
            "display": "REV Close Date",
            "legacyId": "DP1d.DO6ad",
            "legacySqlClass": "column"
          },
          {
            "index": 34,
            "name": "REVIEW_SEQ",
            "type": "string",
            "display": "REV Review Seq",
            "legacyId": "DP1d.DO6a6",
            "legacySqlClass": "column"
          },
          {
            "index": 35,
            "name": "CDR_DECISION_REASON",
            "type": "string",
            "display": "CDR Decision Reason",
            "legacyId": "DP1d.DO6c8",
            "legacySqlClass": "column"
          },
          {
            "index": 36,
            "name": "CASE_REV_DATE",
            "type": "string",
            "display": "PLN Case Rev Date",
            "legacyId": "DP1d.DO6ca",
            "legacySqlClass": "column"
          },
          {
            "index": 37,
            "name": "REFERRAL_COMPLETED_BY",
            "type": "string",
            "display": "RFR Completed By",
            "legacyId": "DP1d.DO6c5",
            "legacySqlClass": "column"
          },
          {
            "index": 38,
            "name": "V_LOCATION",
            "type": "string",
            "display": "V_LOCATION",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 39,
            "name": "V_ACTIVE_ACCT_DISPLAY",
            "type": "string",
            "display": "V_ACTIVE_ACCT_DISPLAY",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 40,
            "name": "V_MAX_CONCAT_FACTORS_CODE",
            "type": "string",
            "display": "V_MAX_CONCAT_FACTORS_CODE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 41,
            "name": "V_REFERRAL_CONT_COMPLETE_",
            "type": "string",
            "display": "V_REFERRAL_CONT_COMPLETE_",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 42,
            "name": "V_INVEST_INFO_GATHERING",
            "type": "string",
            "display": "V_INVEST_INFO_GATHERING",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 43,
            "name": "V_LENGTH_OF_TIME_OPEN",
            "type": "string",
            "display": "V_LENGTH_OF_TIME_OPEN",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 44,
            "name": "V_PLAN_CREATED_",
            "type": "string",
            "display": "V_PLAN_CREATED_",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 45,
            "name": "V_DAYS_BETWEEN_SCREEN_DATE",
            "type": "string",
            "display": "V_DAYS_BETWEEN_SCREEN_DATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 46,
            "name": "V_LENGTH_OF_TIME_PLAN_OPEN",
            "type": "string",
            "display": "V_LENGTH_OF_TIME_PLAN_OPEN",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 47,
            "name": "V_INVEST_DEC_DATE",
            "type": "string",
            "display": "V_INVEST_DEC_DATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 48,
            "name": "V_INVEST_DEC_OUTCOME",
            "type": "string",
            "display": "V_INVEST_DEC_OUTCOME",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 49,
            "name": "MIN_PLAN_CREATE_DATE",
            "type": "string",
            "display": "MIN_PLAN_CREATE_DATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375850/DP1d_NEW",
      "name": "CSIP Referrals",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "DP22_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID (+) ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( ( AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) OR 'All' IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) ) ) ), DP1D_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, TRUNC( MONTHS_BETWEEN (CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12 ) AS AGE_IN_YEARS, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END AS ETHNIC_CODE, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END || '-' || CASE WHEN AT_ETHNICITY_DESC.CODE = 'W8' THEN 'White: Gypsy or Irish Traveller' WHEN AT_ETHNICITY_DESC.CODE = 'O1' THEN 'Asian/Asian British: Chinese' ELSE AT_ETHNICITY_DESC.DESCRIPTION END AS ETHNIC_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID AS AGY_LOC_ID, AT_OFFENDER_CSIP_REPORTS.CSIP_SEQ AS CSIP_SEQ, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_DATE AS RFR_INCIDENT_DATE, TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_date) + ( AT_OFFENDER_CSIP_REPORTS.rfr_incident_time - TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_time) ) AS RFR_INCIDENT_TIME_, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE AS RFR_INCIDENT_TYPE, AT_REF_CSIP_TYPE.DESCRIPTION AS DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION AS RFR_INCIDENT_LOCATION, AT_REF_CSIP_LOC.DESCRIPTION AS RFR_INCIDENT_LOCATION_DESCRI33, AT_OFFENDER_CSIP_REPORTS.RFR_REPORTED_BY AS RFR_REPORTED_BY, AT_REF_CSIP_FUNC.DESCRIPTION AS RFR_AREA_OF_WORK_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED AS RFR_DATE_REPORTED, AT_OFFENDER_CSIP_REPORTS.RFR_PROACTIVE_RESPONSE AS RFR_PROACTIVE_RESPONSE, AT_OFFENDER_CSIP_REPORTS.RFR_STAFF_ASSAULTED AS RFR_STAFF_ASSAULTED, AT_OFFENDER_CSIP_REPORTS.CSIP_ID AS CSIP_ID, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME, CASE WHEN AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME IS NOT NULL THEN AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION ELSE NULL END AS DEC_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME_DATE AS INV_OUTCOME_DATE, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME_DATE AS CDR_OUTCOME_DATE, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME, CASE WHEN AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME IS NOT NULL THEN AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION ELSE NULL END AS CDR_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR AS CSIP_FACTOR, AT_REF_CSIP_FAC.DESCRIPTION AS CDR_FACTOR_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OCCURRENCE_REASON AS INV_OCCURRENCE_REASON, AT_OFFENDER_CSIP_REPORTS.CASE_MANAGER AS CASE_MANAGER, AT_OFFENDER_CSIP_REPORTS.REASON AS REASON, AT_OFFENDER_CSIP_PLANS.CREATE_DATE AS CREATE_DATE, AT_OFFENDER_CSIP_PLANS.TARGET_DATE AS TARGET_DATE, AT_OFFENDER_CSIP_PLANS.CLOSED_DATE AS CLOSED_DATE, AT_OFFENDER_CSIP_PLANS.PLAN_ID AS PLAN_ID, AT_OFFENDER_CSIP_REVIEWS.NEXT_REVIEW_DATE AS NEXT_REVIEW_DATE, AT_OFFENDER_CSIP_REVIEWS.CREATE_DATE AS REV_DATE, AT_OFFENDER_CSIP_REVIEWS.CLOSE_DATE AS CLOSE_DATE, AT_OFFENDER_CSIP_REVIEWS.REVIEW_SEQ AS REVIEW_SEQ, AT_OFFENDER_CSIP_REPORTS.CDR_DECISION_REASON AS CDR_DECISION_REASON, AT_OFFENDER_CSIP_REPORTS.CASE_REV_DATE AS CASE_REV_DATE, AT_OFFENDER_CSIP_REPORTS.REFERRAL_COMPLETED_BY AS REFERRAL_COMPLETED_BY, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN MAX( CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END ) OVER ( PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) ) = 2 THEN 'Y' ELSE 'N' END AS ACCT_ACTIVE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_ETHNICITY_DESC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_TYPE, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_LOC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FUNC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_DECISION_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_CONSID_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FAC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS, OMS_OWNER.OFFENDER_CSIP_FACTORS AT_OFFENDER_CSIP_FACTORS, OMS_OWNER.OFFENDER_CSIP_PLANS AT_OFFENDER_CSIP_PLANS, OMS_OWNER.OFFENDER_CSIP_REVIEWS AT_OFFENDER_CSIP_REVIEWS, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS WHERE ( ( AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID ) AND ( AT_OFFENDER_CSIP_REVIEWS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_FACTORS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_PLANS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE = AT_REF_CSIP_TYPE.CODE (+) ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION = AT_REF_CSIP_LOC.CODE (+) ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_CSIP_FUNCTION = AT_REF_CSIP_FUNC.CODE (+) ) AND ( AT_REF_CSIP_FAC.CODE (+) = AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR ) AND ( AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME = AT_REF_CSIP_CONSID_OUTCOME.CODE (+) ) AND ( AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME = AT_REF_CSIP_DECISION_OUTCOME.CODE (+) ) AND ( AT_REF_CSIP_DECISION_OUTCOME.domain (+) = 'CSIP_OUT' ) AND ( AT_REF_CSIP_CONSID_OUTCOME.domain (+) = 'CSIP_OUT' ) AND (AT_REF_CSIP_FUNC.domain (+) = 'CSIP_FUNC') AND (AT_REF_CSIP_LOC.domain (+) = 'CSIP_LOC') AND (AT_REF_CSIP_TYPE.domain (+) = 'CSIP_TYP') AND (AT_REF_CSIP_FAC.domain (+) = 'CSIP_FAC') AND ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND (AT_ETHNICITY_DESC.DOMAIN (+) = 'ETHNICITY') AND ( AT_ETHNICITY_DESC.CODE (+) = AT_OFFENDER.RACE_CODE ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID  = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID (+) ) AND ( AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER.OFFENDER_ID_DISPLAY IN ( SELECT OFFENDER_ID_DISPLAY FROM DP22_ ) ) ) ), FACTOR_ AS ( SELECT DISTINCT DP1D_.CSIP_ID, LISTAGG (DP1D_.CSIP_FACTOR, ', ') WITHIN GROUP ( ORDER BY DP1D_.CSIP_FACTOR ) OVER ( PARTITION BY DP1D_.CSIP_ID ) AS CONCAT_FACTORS_CODE FROM DP1D_ GROUP BY CSIP_ID, CSIP_FACTOR ), PLAN_DATE_ AS ( SELECT DP1D_.CSIP_ID, MIN(DP1D_.CREATE_DATE) AS MIN_PLAN_DATE FROM DP1D_ GROUP BY CSIP_ID ), MAX_REVIEW_SEQ_ AS ( SELECT DP1D_.CSIP_ID, MAX(DP1D_.REVIEW_SEQ) AS MAX_REVIEW_SEQ FROM DP1D_ GROUP BY CSIP_ID ), dataset_base_ AS ( SELECT DISTINCT DP1D_.CSIP_ID, DP1D_.OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGE_IN_YEARS, ETHNIC_CODE, ETHNIC_DESCRIPTION, AGY_LOC_ID, CSIP_SEQ, RFR_INCIDENT_DATE, RFR_INCIDENT_TIME_, RFR_INCIDENT_TYPE, DESCRIPTION, RFR_INCIDENT_LOCATION, RFR_INCIDENT_LOCATION_DESCRI33, RFR_REPORTED_BY, RFR_AREA_OF_WORK_DESCRIPTION, RFR_DATE_REPORTED, RFR_PROACTIVE_RESPONSE, RFR_STAFF_ASSAULTED, INV_OUTCOME, DEC_OUTCOME_DESCRIPTION, INV_OUTCOME_DATE, CDR_OUTCOME_DATE, CDR_OUTCOME, CDR_OUTCOME_DESCRIPTION, INV_OCCURRENCE_REASON, CASE_MANAGER, REASON, CREATE_DATE, TARGET_DATE, CLOSED_DATE, PLAN_ID, NEXT_REVIEW_DATE, REV_DATE, CLOSE_DATE, REVIEW_SEQ, CDR_DECISION_REASON, CASE_REV_DATE, REFERRAL_COMPLETED_BY, UNIT_DESCRIPTION_4_SHORT AS V_LOCATION, ACCT_ACTIVE AS V_ACTIVE_ACCT_DISPLAY, FACTOR_.CONCAT_FACTORS_CODE AS V_MAX_CONCAT_FACTORS_CODE, CASE WHEN REFERRAL_COMPLETED_BY IS NULL THEN 'No' ELSE 'Yes' END AS V_REFERRAL_CONT_COMPLETE_, CASE WHEN CDR_OUTCOME_DESCRIPTION = 'Progress to Investigation' THEN 'Yes' ELSE 'No' END AS V_INVEST_INFO_GATHERING, ( TO_DATE(RFR_DATE_REPORTED, 'DD/MM/YYYY') - TO_DATE(TRUNC(SYSDATE), 'DD/MM/YYYY') ) AS V_LENGTH_OF_TIME_OPEN, CASE WHEN CREATE_DATE IS NULL THEN 'No' ELSE 'Yes' END AS V_PLAN_CREATED_, ( TO_DATE(CDR_OUTCOME_DATE, 'DD/MM/YYYY') - TO_DATE(INV_OUTCOME_DATE, 'DD/MM/YYYY') ) AS V_DAYS_BETWEEN_SCREEN_DATE, ( TO_DATE(PLAN_DATE_.MIN_PLAN_DATE, 'DD/MM/YYYY') - TO_DATE(CLOSE_DATE, 'DD/MM/YYYY') ) AS V_LENGTH_OF_TIME_PLAN_OPEN, INV_OUTCOME_DATE AS V_INVEST_DEC_DATE, DEC_OUTCOME_DESCRIPTION AS V_INVEST_DEC_OUTCOME, PLAN_DATE_.MIN_PLAN_DATE AS MIN_PLAN_CREATE_DATE FROM DP1D_, FACTOR_, PLAN_DATE_, MAX_REVIEW_SEQ_ WHERE ( MAX_REVIEW_SEQ_.CSIP_ID = DP1D_.CSIP_ID AND MAX_REVIEW_SEQ_.MAX_REVIEW_SEQ = DP1D_.REVIEW_SEQ OR DP1D_.REVIEW_SEQ IS NULL ) AND FACTOR_.CSIP_ID (+) = DP1D_.CSIP_ID AND (PLAN_DATE_.CSIP_ID (+) = DP1D_.CSIP_ID) ), dataset_ AS ( SELECT DISTINCT CSIP_ID, OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGE_IN_YEARS, ETHNIC_CODE, ETHNIC_DESCRIPTION, AGY_LOC_ID, CSIP_SEQ, RFR_INCIDENT_DATE, RFR_INCIDENT_TIME_, RFR_INCIDENT_TYPE, DESCRIPTION, RFR_INCIDENT_LOCATION, RFR_INCIDENT_LOCATION_DESCRI33, RFR_REPORTED_BY, RFR_AREA_OF_WORK_DESCRIPTION, RFR_DATE_REPORTED, RFR_PROACTIVE_RESPONSE, RFR_STAFF_ASSAULTED, DEC_OUTCOME_DESCRIPTION, INV_OUTCOME_DATE, CDR_OUTCOME_DATE, CDR_OUTCOME_DESCRIPTION, INV_OCCURRENCE_REASON, CASE_MANAGER, REASON, NEXT_REVIEW_DATE, REV_DATE, REVIEW_SEQ, CDR_DECISION_REASON, CASE_REV_DATE, REFERRAL_COMPLETED_BY, V_LOCATION, V_ACTIVE_ACCT_DISPLAY, V_MAX_CONCAT_FACTORS_CODE, V_REFERRAL_CONT_COMPLETE_, V_INVEST_INFO_GATHERING, V_LENGTH_OF_TIME_OPEN, V_PLAN_CREATED_, V_DAYS_BETWEEN_SCREEN_DATE, V_LENGTH_OF_TIME_PLAN_OPEN, V_INVEST_DEC_DATE, V_INVEST_DEC_OUTCOME, MIN_PLAN_CREATE_DATE, INV_OUTCOME, CDR_OUTCOME FROM dataset_base_ )",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "wing",
          "filterType": "autocomplete",
          "referenceType": "wing",
          "reportFieldType": "string",
          "display": "Wing (All for all)",
          "description": "@Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "CSIP_ID",
            "type": "string",
            "display": "RFR CSIP ID",
            "legacyId": "DP1d.DO65c",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP1d.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP1d.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP1d.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "AGE_IN_YEARS",
            "type": "string",
            "display": "Age in Years",
            "legacyId": "DP1d.DO10a15",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "ETHNIC_CODE",
            "type": "string",
            "display": "Ethnic Code",
            "legacyId": "DP1d.DO10088",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "ETHNIC_DESCRIPTION",
            "type": "string",
            "display": "Ethnic Description",
            "legacyId": "DP1d.DO1009d",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "CSIP Agy Loc Id",
            "legacyId": "DP1d.DO6c4",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "CSIP_SEQ",
            "type": "string",
            "display": "CSIP Log #",
            "legacyId": "DP1d.DO65d",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "RFR_INCIDENT_DATE",
            "type": "string",
            "display": "RFR Incident Date",
            "legacyId": "DP1d.DO65e",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "RFR_INCIDENT_TIME_",
            "type": "string",
            "display": "RFR Incident Time (see description)",
            "legacyId": "DP1d.DO65f",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "RFR_INCIDENT_TYPE",
            "type": "string",
            "display": "RFR Incident Type Code",
            "legacyId": "DP1d.DO660",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "RFR Incident Type Description",
            "legacyId": "DP1d.DO679",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "RFR_INCIDENT_LOCATION",
            "type": "string",
            "display": "RFR Incident Location Code",
            "legacyId": "DP1d.DO661",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "RFR_INCIDENT_LOCATION_DESCRI33",
            "type": "string",
            "display": "RFR Incident Location Description",
            "legacyId": "DP1d.DO67a",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "RFR_REPORTED_BY",
            "type": "string",
            "display": "RFR Referred By",
            "legacyId": "DP1d.DO663",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "RFR_AREA_OF_WORK_DESCRIPTION",
            "type": "string",
            "display": "RFR Area of Work Description",
            "legacyId": "DP1d.DO67b",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "RFR_DATE_REPORTED",
            "type": "string",
            "display": "RFR Date Referred",
            "legacyId": "DP1d.DO664",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "RFR_PROACTIVE_RESPONSE",
            "type": "string",
            "display": "RFR Proactive Referral (Prevention)",
            "legacyId": "DP1d.DO666",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "RFR_STAFF_ASSAULTED",
            "type": "string",
            "display": "RFR Staff Assaulted",
            "legacyId": "DP1d.DO667",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "DEC_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "DEC Outcome Description",
            "legacyId": "DP1d.DO697",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "INV_OUTCOME_DATE",
            "type": "string",
            "display": "DEC Outcome Date",
            "legacyId": "DP1d.DO68d",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CDR_OUTCOME_DATE",
            "type": "string",
            "display": "CDR Outcome Date",
            "legacyId": "DP1d.DO66b",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "CDR_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "CDR Outcome Description",
            "legacyId": "DP1d.DO680",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "INV_OCCURRENCE_REASON",
            "type": "string",
            "display": "INV Occurrence Reason",
            "legacyId": "DP1d.DO676",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "CASE_MANAGER",
            "type": "string",
            "display": "PLN Case Manager",
            "legacyId": "DP1d.DO699",
            "legacySqlClass": "column"
          },
          {
            "index": 26,
            "name": "REASON",
            "type": "string",
            "display": "PLN Reason",
            "legacyId": "DP1d.DO69a",
            "legacySqlClass": "column"
          },
          {
            "index": 27,
            "name": "CREATE_DATE",
            "type": "string",
            "display": "PLN Create Date",
            "legacyId": "DP1d.DO69d",
            "legacySqlClass": "column"
          },
          {
            "index": 28,
            "name": "TARGET_DATE",
            "type": "string",
            "display": "PLN Target Date",
            "legacyId": "DP1d.DO6a0",
            "legacySqlClass": "column"
          },
          {
            "index": 29,
            "name": "CLOSED_DATE",
            "type": "string",
            "display": "PLN Closed Date",
            "legacyId": "DP1d.DO6a1",
            "legacySqlClass": "column"
          },
          {
            "index": 30,
            "name": "PLAN_ID",
            "type": "string",
            "display": "PLN Plan Id",
            "legacyId": "DP1d.DO69b",
            "legacySqlClass": "column"
          },
          {
            "index": 31,
            "name": "NEXT_REVIEW_DATE",
            "type": "string",
            "display": "REV Next Review Date",
            "legacyId": "DP1d.DO6a4",
            "legacySqlClass": "column"
          },
          {
            "index": 32,
            "name": "REV_DATE",
            "type": "string",
            "display": "REV Date",
            "legacyId": "DP1d.DO6a7",
            "legacySqlClass": "column"
          },
          {
            "index": 33,
            "name": "CLOSE_DATE",
            "type": "string",
            "display": "REV Close Date",
            "legacyId": "DP1d.DO6ad",
            "legacySqlClass": "column"
          },
          {
            "index": 34,
            "name": "REVIEW_SEQ",
            "type": "string",
            "display": "REV Review Seq",
            "legacyId": "DP1d.DO6a6",
            "legacySqlClass": "column"
          },
          {
            "index": 35,
            "name": "CDR_DECISION_REASON",
            "type": "string",
            "display": "CDR Decision Reason",
            "legacyId": "DP1d.DO6c8",
            "legacySqlClass": "column"
          },
          {
            "index": 36,
            "name": "CASE_REV_DATE",
            "type": "string",
            "display": "PLN Case Rev Date",
            "legacyId": "DP1d.DO6ca",
            "legacySqlClass": "column"
          },
          {
            "index": 37,
            "name": "REFERRAL_COMPLETED_BY",
            "type": "string",
            "display": "RFR Completed By",
            "legacyId": "DP1d.DO6c5",
            "legacySqlClass": "column"
          },
          {
            "index": 38,
            "name": "V_LOCATION",
            "type": "string",
            "display": "V_LOCATION",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 39,
            "name": "V_ACTIVE_ACCT_DISPLAY",
            "type": "string",
            "display": "V_ACTIVE_ACCT_DISPLAY",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 40,
            "name": "V_MAX_CONCAT_FACTORS_CODE",
            "type": "string",
            "display": "V_MAX_CONCAT_FACTORS_CODE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 41,
            "name": "V_REFERRAL_CONT_COMPLETE_",
            "type": "string",
            "display": "V_REFERRAL_CONT_COMPLETE_",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 42,
            "name": "V_INVEST_INFO_GATHERING",
            "type": "string",
            "display": "V_INVEST_INFO_GATHERING",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 43,
            "name": "V_LENGTH_OF_TIME_OPEN",
            "type": "string",
            "display": "V_LENGTH_OF_TIME_OPEN",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 44,
            "name": "V_PLAN_CREATED_",
            "type": "string",
            "display": "V_PLAN_CREATED_",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 45,
            "name": "V_DAYS_BETWEEN_SCREEN_DATE",
            "type": "string",
            "display": "V_DAYS_BETWEEN_SCREEN_DATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 46,
            "name": "V_LENGTH_OF_TIME_PLAN_OPEN",
            "type": "string",
            "display": "V_LENGTH_OF_TIME_PLAN_OPEN",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 47,
            "name": "V_INVEST_DEC_DATE",
            "type": "string",
            "display": "V_INVEST_DEC_DATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 48,
            "name": "V_INVEST_DEC_OUTCOME",
            "type": "string",
            "display": "V_INVEST_DEC_OUTCOME",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 49,
            "name": "MIN_PLAN_CREATE_DATE",
            "type": "string",
            "display": "MIN_PLAN_CREATE_DATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 50,
            "name": "INV_OUTCOME",
            "type": "string",
            "display": "INV_OUTCOME",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 51,
            "name": "CDR_OUTCOME",
            "type": "string",
            "display": "CDR_OUTCOME",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375850/21_NEW",
      "name": "CSIP Referrals",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "DP22_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( ( AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) OR 'All' IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) ) ) ), DP1D_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, TRUNC( MONTHS_BETWEEN (CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12 ) AS AGE_IN_YEARS, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END AS ETHNIC_CODE, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END || '-' || CASE WHEN AT_ETHNICITY_DESC.CODE = 'W8' THEN 'White: Gypsy or Irish Traveller' WHEN AT_ETHNICITY_DESC.CODE = 'O1' THEN 'Asian/Asian British: Chinese' ELSE AT_ETHNICITY_DESC.DESCRIPTION END AS ETHNIC_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID AS AGY_LOC_ID, AT_OFFENDER_CSIP_REPORTS.CSIP_SEQ AS CSIP_SEQ, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_DATE AS RFR_INCIDENT_DATE, TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_date) + ( AT_OFFENDER_CSIP_REPORTS.rfr_incident_time - TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_time) ) AS RFR_INCIDENT_TIME_, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE AS RFR_INCIDENT_TYPE, AT_REF_CSIP_TYPE.DESCRIPTION AS DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION AS RFR_INCIDENT_LOCATION, AT_REF_CSIP_LOC.DESCRIPTION AS RFR_INCIDENT_LOCATION_DESCRI33, AT_OFFENDER_CSIP_REPORTS.RFR_REPORTED_BY AS RFR_REPORTED_BY, AT_REF_CSIP_FUNC.DESCRIPTION AS RFR_AREA_OF_WORK_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED AS RFR_DATE_REPORTED, AT_OFFENDER_CSIP_REPORTS.RFR_PROACTIVE_RESPONSE AS RFR_PROACTIVE_RESPONSE, AT_OFFENDER_CSIP_REPORTS.RFR_STAFF_ASSAULTED AS RFR_STAFF_ASSAULTED, AT_OFFENDER_CSIP_REPORTS.CSIP_ID AS CSIP_ID, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME, CASE WHEN AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME IS NOT NULL THEN AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION ELSE NULL END AS DEC_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME_DATE AS INV_OUTCOME_DATE, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME_DATE AS CDR_OUTCOME_DATE, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME, CASE WHEN AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME IS NOT NULL THEN AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION ELSE NULL END AS CDR_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR AS CSIP_FACTOR, AT_REF_CSIP_FAC.DESCRIPTION AS CDR_FACTOR_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OCCURRENCE_REASON AS INV_OCCURRENCE_REASON, AT_OFFENDER_CSIP_REPORTS.CASE_MANAGER AS CASE_MANAGER, AT_OFFENDER_CSIP_REPORTS.REASON AS REASON, AT_OFFENDER_CSIP_PLANS.CREATE_DATE AS CREATE_DATE, AT_OFFENDER_CSIP_PLANS.TARGET_DATE AS TARGET_DATE, AT_OFFENDER_CSIP_PLANS.CLOSED_DATE AS CLOSED_DATE, AT_OFFENDER_CSIP_PLANS.PLAN_ID AS PLAN_ID, AT_OFFENDER_CSIP_REVIEWS.NEXT_REVIEW_DATE AS NEXT_REVIEW_DATE, AT_OFFENDER_CSIP_REVIEWS.CREATE_DATE AS REV_DATE, AT_OFFENDER_CSIP_REVIEWS.CLOSE_DATE AS CLOSE_DATE, AT_OFFENDER_CSIP_REVIEWS.REVIEW_SEQ AS REVIEW_SEQ, AT_OFFENDER_CSIP_REPORTS.CDR_DECISION_REASON AS CDR_DECISION_REASON, AT_OFFENDER_CSIP_REPORTS.CASE_REV_DATE AS CASE_REV_DATE, AT_OFFENDER_CSIP_REPORTS.REFERRAL_COMPLETED_BY AS REFERRAL_COMPLETED_BY, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN MAX( CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END ) OVER ( PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) ) = 2 THEN 'Y' ELSE 'N' END AS ACCT_ACTIVE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_ETHNICITY_DESC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_TYPE, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_LOC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FUNC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_DECISION_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_CONSID_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FAC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS, OMS_OWNER.OFFENDER_CSIP_FACTORS AT_OFFENDER_CSIP_FACTORS, OMS_OWNER.OFFENDER_CSIP_PLANS AT_OFFENDER_CSIP_PLANS, OMS_OWNER.OFFENDER_CSIP_REVIEWS AT_OFFENDER_CSIP_REVIEWS, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS WHERE ( ( AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID ) AND ( AT_OFFENDER_CSIP_REVIEWS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_FACTORS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_PLANS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( ( AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE = AT_REF_CSIP_TYPE.CODE (+) ) ) AND ( ( AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION = AT_REF_CSIP_LOC.CODE (+) ) ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_CSIP_FUNCTION = AT_REF_CSIP_FUNC.CODE (+) ) AND ( ( AT_REF_CSIP_FAC.CODE (+) = AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR ) ) AND ( ( AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME = AT_REF_CSIP_CONSID_OUTCOME.CODE (+) ) ) AND ( ( AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME = AT_REF_CSIP_DECISION_OUTCOME.CODE ) OR AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME IS NULL ) AND ( AT_REF_CSIP_DECISION_OUTCOME.domain (+) = 'CSIP_OUT' ) AND ( AT_REF_CSIP_CONSID_OUTCOME.domain (+) = 'CSIP_OUT' ) AND (AT_REF_CSIP_FUNC.domain (+) = 'CSIP_FUNC') AND (AT_REF_CSIP_LOC.domain (+) = 'CSIP_LOC') AND (AT_REF_CSIP_TYPE.domain (+) = 'CSIP_TYP') AND (AT_REF_CSIP_FAC.domain (+) = 'CSIP_FAC') AND ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND (AT_ETHNICITY_DESC.DOMAIN (+)= 'ETHNICITY') AND (AT_ETHNICITY_DESC.CODE (+) = AT_OFFENDER.RACE_CODE) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID (+) ) AND ( AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER.OFFENDER_ID_DISPLAY IN ( SELECT OFFENDER_ID_DISPLAY FROM DP22_ ) ) AND ( AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION = 'Progress to CSIP' OR AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION = 'Progress to CSIP' ) AND NOT AT_OFFENDER_CSIP_PLANS.PLAN_ID IS NULL ) ), PLAN_DATE_ AS ( SELECT DP1D_.CSIP_ID, MIN(DP1D_.CREATE_DATE) AS MIN_PLAN_DATE, MIN(DP1D_.TARGET_DATE) AS MIN_TARGET_DATE, MAX(DP1D_.TARGET_DATE) AS MAX_TARGET_DATE FROM DP1D_ GROUP BY CSIP_ID ), MAX_REVIEW_SEQ_ AS ( SELECT DP1D_.CSIP_ID, MAX(DP1D_.REVIEW_SEQ) AS MAX_REVIEW_SEQ FROM DP1D_ GROUP BY CSIP_ID ), dataset_base_ AS ( SELECT DISTINCT DP1D_.CSIP_ID, DP1D_.OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGE_IN_YEARS, ETHNIC_CODE, ETHNIC_DESCRIPTION, AGY_LOC_ID, CSIP_SEQ, RFR_INCIDENT_DATE, RFR_INCIDENT_TIME_, RFR_INCIDENT_TYPE, DESCRIPTION, RFR_INCIDENT_LOCATION, RFR_INCIDENT_LOCATION_DESCRI33, RFR_REPORTED_BY, RFR_AREA_OF_WORK_DESCRIPTION, RFR_DATE_REPORTED, RFR_PROACTIVE_RESPONSE, RFR_STAFF_ASSAULTED, INV_OUTCOME, DEC_OUTCOME_DESCRIPTION, INV_OUTCOME_DATE, CDR_OUTCOME_DATE, CDR_OUTCOME, CDR_OUTCOME_DESCRIPTION, INV_OCCURRENCE_REASON, CASE_MANAGER, REASON, CREATE_DATE, TARGET_DATE, CLOSED_DATE, PLAN_ID, NEXT_REVIEW_DATE, REV_DATE, CLOSE_DATE, REVIEW_SEQ, CDR_DECISION_REASON, CASE_REV_DATE, REFERRAL_COMPLETED_BY, UNIT_DESCRIPTION_4_SHORT AS V_LOCATION, ACCT_ACTIVE AS V_ACTIVE_ACCT_DISPLAY, CASE WHEN REFERRAL_COMPLETED_BY IS NULL THEN 'No' ELSE 'Yes' END AS V_REFERRAL_CONT_COMPLETE_, CASE WHEN CDR_OUTCOME_DESCRIPTION = 'Progress to Investigation' THEN 'Yes' ELSE 'No' END AS V_INVEST_INFO_GATHERING, ( TO_DATE(RFR_DATE_REPORTED, 'DD/MM/YYYY') - TO_DATE(TRUNC(SYSDATE), 'DD/MM/YYYY') ) AS V_LENGTH_OF_TIME_OPEN, CASE WHEN CREATE_DATE IS NULL THEN 'No' ELSE 'Yes' END AS V_PLAN_CREATED_, ( TO_DATE(CDR_OUTCOME_DATE, 'DD/MM/YYYY') - TO_DATE(INV_OUTCOME_DATE, 'DD/MM/YYYY') ) AS V_DAYS_BETWEEN_SCREEN_DATE, ( TO_DATE(PLAN_DATE_.MIN_PLAN_DATE, 'DD/MM/YYYY') - TO_DATE(CLOSE_DATE, 'DD/MM/YYYY') ) AS V_LENGTH_OF_TIME_PLAN_OPEN, INV_OUTCOME_DATE AS V_INVEST_DEC_DATE, DEC_OUTCOME_DESCRIPTION AS V_INVEST_DEC_OUTCOME, PLAN_DATE_.MIN_PLAN_DATE AS MIN_PLAN_CREATE_DATE, PLAN_DATE_.MIN_TARGET_DATE AS MIN_PLAN_TARGET_DATE_ALL, PLAN_DATE_.MAX_TARGET_DATE AS MAX_PLAN_TARGET_DATE_ALL, CASE WHEN CLOSED_DATE IS NULL AND CLOSE_DATE IS NULL THEN 1 ELSE 0 END AS V_OPEN_INTERVEN_REVIEW FROM DP1D_, PLAN_DATE_, MAX_REVIEW_SEQ_ WHERE ( ( MAX_REVIEW_SEQ_.CSIP_ID = DP1D_.CSIP_ID AND MAX_REVIEW_SEQ_.MAX_REVIEW_SEQ = DP1D_.REVIEW_SEQ OR DP1D_.REVIEW_SEQ IS NULL ) ) AND (PLAN_DATE_.CSIP_ID (+) = DP1D_.CSIP_ID) ), dataset_ AS ( SELECT DISTINCT CSIP_ID, OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGE_IN_YEARS, ETHNIC_CODE, ETHNIC_DESCRIPTION, AGY_LOC_ID, CSIP_SEQ, RFR_INCIDENT_DATE, RFR_INCIDENT_TIME_, RFR_INCIDENT_TYPE, DESCRIPTION, RFR_INCIDENT_LOCATION, RFR_INCIDENT_LOCATION_DESCRI33, RFR_REPORTED_BY, RFR_AREA_OF_WORK_DESCRIPTION, RFR_DATE_REPORTED, RFR_PROACTIVE_RESPONSE, RFR_STAFF_ASSAULTED, DEC_OUTCOME_DESCRIPTION, INV_OUTCOME_DATE, CDR_OUTCOME_DATE, CDR_OUTCOME_DESCRIPTION, INV_OCCURRENCE_REASON, CASE_MANAGER, REASON, CLOSED_DATE, NEXT_REVIEW_DATE, REV_DATE, CLOSE_DATE, REVIEW_SEQ, CDR_DECISION_REASON, CASE_REV_DATE, REFERRAL_COMPLETED_BY, V_LOCATION, V_ACTIVE_ACCT_DISPLAY, V_REFERRAL_CONT_COMPLETE_, V_INVEST_INFO_GATHERING, V_LENGTH_OF_TIME_OPEN, V_PLAN_CREATED_, V_DAYS_BETWEEN_SCREEN_DATE, V_LENGTH_OF_TIME_PLAN_OPEN, V_INVEST_DEC_DATE, V_INVEST_DEC_OUTCOME, MIN_PLAN_CREATE_DATE, CDR_OUTCOME, MIN_PLAN_TARGET_DATE_ALL, MAX_PLAN_TARGET_DATE_ALL, V_OPEN_INTERVEN_REVIEW FROM dataset_base_ )",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "wing",
          "filterType": "autocomplete",
          "referenceType": "wing",
          "reportFieldType": "string",
          "display": "Wing (All for all)",
          "description": "@Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "CSIP_ID",
            "type": "string",
            "display": "RFR CSIP ID",
            "legacyId": "DP1d.DO65c",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP1d.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP1d.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP1d.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "AGE_IN_YEARS",
            "type": "string",
            "display": "Age in Years",
            "legacyId": "DP1d.DO10a15",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "ETHNIC_CODE",
            "type": "string",
            "display": "Ethnic Code",
            "legacyId": "DP1d.DO10088",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "ETHNIC_DESCRIPTION",
            "type": "string",
            "display": "Ethnic Description",
            "legacyId": "DP1d.DO1009d",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "CSIP Agy Loc Id",
            "legacyId": "DP1d.DO6c4",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "CSIP_SEQ",
            "type": "string",
            "display": "CSIP Log #",
            "legacyId": "DP1d.DO65d",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "RFR_INCIDENT_DATE",
            "type": "string",
            "display": "RFR Incident Date",
            "legacyId": "DP1d.DO65e",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "RFR_INCIDENT_TIME_",
            "type": "string",
            "display": "RFR Incident Time (see description)",
            "legacyId": "DP1d.DO65f",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "RFR_INCIDENT_TYPE",
            "type": "string",
            "display": "RFR Incident Type Code",
            "legacyId": "DP1d.DO660",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "RFR Incident Type Description",
            "legacyId": "DP1d.DO679",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "RFR_INCIDENT_LOCATION",
            "type": "string",
            "display": "RFR Incident Location Code",
            "legacyId": "DP1d.DO661",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "RFR_INCIDENT_LOCATION_DESCRI33",
            "type": "string",
            "display": "RFR Incident Location Description",
            "legacyId": "DP1d.DO67a",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "RFR_REPORTED_BY",
            "type": "string",
            "display": "RFR Referred By",
            "legacyId": "DP1d.DO663",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "RFR_AREA_OF_WORK_DESCRIPTION",
            "type": "string",
            "display": "RFR Area of Work Description",
            "legacyId": "DP1d.DO67b",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "RFR_DATE_REPORTED",
            "type": "string",
            "display": "RFR Date Referred",
            "legacyId": "DP1d.DO664",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "RFR_PROACTIVE_RESPONSE",
            "type": "string",
            "display": "RFR Proactive Referral (Prevention)",
            "legacyId": "DP1d.DO666",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "RFR_STAFF_ASSAULTED",
            "type": "string",
            "display": "RFR Staff Assaulted",
            "legacyId": "DP1d.DO667",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "DEC_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "DEC Outcome Description",
            "legacyId": "DP1d.DO697",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "INV_OUTCOME_DATE",
            "type": "string",
            "display": "DEC Outcome Date",
            "legacyId": "DP1d.DO68d",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CDR_OUTCOME_DATE",
            "type": "string",
            "display": "CDR Outcome Date",
            "legacyId": "DP1d.DO66b",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "CDR_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "CDR Outcome Description",
            "legacyId": "DP1d.DO680",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "INV_OCCURRENCE_REASON",
            "type": "string",
            "display": "INV Occurrence Reason",
            "legacyId": "DP1d.DO676",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "CASE_MANAGER",
            "type": "string",
            "display": "PLN Case Manager",
            "legacyId": "DP1d.DO699",
            "legacySqlClass": "column"
          },
          {
            "index": 26,
            "name": "REASON",
            "type": "string",
            "display": "PLN Reason",
            "legacyId": "DP1d.DO69a",
            "legacySqlClass": "column"
          },
          {
            "index": 29,
            "name": "CLOSED_DATE",
            "type": "string",
            "display": "PLN Closed Date",
            "legacyId": "DP1d.DO6a1",
            "legacySqlClass": "column"
          },
          {
            "index": 30,
            "name": "NEXT_REVIEW_DATE",
            "type": "string",
            "display": "REV Next Review Date",
            "legacyId": "DP1d.DO6a4",
            "legacySqlClass": "column"
          },
          {
            "index": 31,
            "name": "REV_DATE",
            "type": "string",
            "display": "REV Date",
            "legacyId": "DP1d.DO6a7",
            "legacySqlClass": "column"
          },
          {
            "index": 32,
            "name": "CLOSE_DATE",
            "type": "string",
            "display": "REV Close Date",
            "legacyId": "DP1d.DO6ad",
            "legacySqlClass": "column"
          },
          {
            "index": 33,
            "name": "REVIEW_SEQ",
            "type": "string",
            "display": "REV Review Seq",
            "legacyId": "DP1d.DO6a6",
            "legacySqlClass": "column"
          },
          {
            "index": 34,
            "name": "CDR_DECISION_REASON",
            "type": "string",
            "display": "CDR Decision Reason",
            "legacyId": "DP1d.DO6c8",
            "legacySqlClass": "column"
          },
          {
            "index": 35,
            "name": "CASE_REV_DATE",
            "type": "string",
            "display": "PLN Case Rev Date",
            "legacyId": "DP1d.DO6ca",
            "legacySqlClass": "column"
          },
          {
            "index": 36,
            "name": "REFERRAL_COMPLETED_BY",
            "type": "string",
            "display": "RFR Completed By",
            "legacyId": "DP1d.DO6c5",
            "legacySqlClass": "column"
          },
          {
            "index": 37,
            "name": "V_LOCATION",
            "type": "string",
            "display": "V_LOCATION",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 38,
            "name": "V_ACTIVE_ACCT_DISPLAY",
            "type": "string",
            "display": "V_ACTIVE_ACCT_DISPLAY",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 40,
            "name": "V_REFERRAL_CONT_COMPLETE_",
            "type": "string",
            "display": "V_REFERRAL_CONT_COMPLETE_",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 41,
            "name": "V_INVEST_INFO_GATHERING",
            "type": "string",
            "display": "V_INVEST_INFO_GATHERING",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 42,
            "name": "V_LENGTH_OF_TIME_OPEN",
            "type": "string",
            "display": "V_LENGTH_OF_TIME_OPEN",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 43,
            "name": "V_PLAN_CREATED_",
            "type": "string",
            "display": "V_PLAN_CREATED_",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 44,
            "name": "V_DAYS_BETWEEN_SCREEN_DATE",
            "type": "string",
            "display": "V_DAYS_BETWEEN_SCREEN_DATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 45,
            "name": "V_LENGTH_OF_TIME_PLAN_OPEN",
            "type": "string",
            "display": "V_LENGTH_OF_TIME_PLAN_OPEN",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 46,
            "name": "V_INVEST_DEC_DATE",
            "type": "string",
            "display": "V_INVEST_DEC_DATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 47,
            "name": "V_INVEST_DEC_OUTCOME",
            "type": "string",
            "display": "V_INVEST_DEC_OUTCOME",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 48,
            "name": "MIN_PLAN_CREATE_DATE",
            "type": "string",
            "display": "MIN_PLAN_CREATE_DATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 49,
            "name": "INV_OUTCOME",
            "type": "string",
            "display": "INV_OUTCOME",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 50,
            "name": "CDR_OUTCOME",
            "type": "string",
            "display": "CDR_OUTCOME",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 51,
            "name": "MIN_PLAN_TARGET_DATE_ALL",
            "type": "string",
            "display": "MIN_PLAN_TARGET_DATE_ALL",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 52,
            "name": "MAX_PLAN_TARGET_DATE_ALL",
            "type": "string",
            "display": "MAX_PLAN_TARGET_DATE_ALL",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 53,
            "name": "V_OPEN_INTERVEN_REVIEW",
            "type": "string",
            "display": "V_OPEN_INTERVEN_REVIEW",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375850/21_CLOSED",
      "name": "CSIP Referrals",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "DP22_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( ( AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) OR 'All' IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) ) ) ), DP1D_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, TRUNC( MONTHS_BETWEEN (CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12 ) AS AGE_IN_YEARS, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END AS ETHNIC_CODE, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END || '-' || CASE WHEN AT_ETHNICITY_DESC.CODE = 'W8' THEN 'White: Gypsy or Irish Traveller' WHEN AT_ETHNICITY_DESC.CODE = 'O1' THEN 'Asian/Asian British: Chinese' ELSE AT_ETHNICITY_DESC.DESCRIPTION END AS ETHNIC_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID AS AGY_LOC_ID, AT_OFFENDER_CSIP_REPORTS.CSIP_SEQ AS CSIP_SEQ, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_DATE AS RFR_INCIDENT_DATE, TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_date) + ( AT_OFFENDER_CSIP_REPORTS.rfr_incident_time - TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_time) ) AS RFR_INCIDENT_TIME_, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE AS RFR_INCIDENT_TYPE, AT_REF_CSIP_TYPE.DESCRIPTION AS DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION AS RFR_INCIDENT_LOCATION, AT_REF_CSIP_LOC.DESCRIPTION AS RFR_INCIDENT_LOCATION_DESCRI33, AT_OFFENDER_CSIP_REPORTS.RFR_REPORTED_BY AS RFR_REPORTED_BY, AT_REF_CSIP_FUNC.DESCRIPTION AS RFR_AREA_OF_WORK_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED AS RFR_DATE_REPORTED, AT_OFFENDER_CSIP_REPORTS.RFR_PROACTIVE_RESPONSE AS RFR_PROACTIVE_RESPONSE, AT_OFFENDER_CSIP_REPORTS.RFR_STAFF_ASSAULTED AS RFR_STAFF_ASSAULTED, AT_OFFENDER_CSIP_REPORTS.CSIP_ID AS CSIP_ID, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME, CASE WHEN AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME IS NOT NULL THEN AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION ELSE NULL END AS DEC_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME_DATE AS INV_OUTCOME_DATE, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME_DATE AS CDR_OUTCOME_DATE, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME, CASE WHEN AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME IS NOT NULL THEN AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION ELSE NULL END AS CDR_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR AS CSIP_FACTOR, AT_REF_CSIP_FAC.DESCRIPTION AS CDR_FACTOR_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OCCURRENCE_REASON AS INV_OCCURRENCE_REASON, AT_OFFENDER_CSIP_REPORTS.CASE_MANAGER AS CASE_MANAGER, AT_OFFENDER_CSIP_REPORTS.REASON AS REASON, AT_OFFENDER_CSIP_PLANS.CREATE_DATE AS CREATE_DATE, AT_OFFENDER_CSIP_PLANS.TARGET_DATE AS TARGET_DATE, AT_OFFENDER_CSIP_PLANS.CLOSED_DATE AS CLOSED_DATE, AT_OFFENDER_CSIP_PLANS.PLAN_ID AS PLAN_ID, AT_OFFENDER_CSIP_REVIEWS.NEXT_REVIEW_DATE AS NEXT_REVIEW_DATE, AT_OFFENDER_CSIP_REVIEWS.CREATE_DATE AS REV_DATE, AT_OFFENDER_CSIP_REVIEWS.CLOSE_DATE AS CLOSE_DATE, AT_OFFENDER_CSIP_REVIEWS.REVIEW_SEQ AS REVIEW_SEQ, AT_OFFENDER_CSIP_REPORTS.CDR_DECISION_REASON AS CDR_DECISION_REASON, AT_OFFENDER_CSIP_REPORTS.CASE_REV_DATE AS CASE_REV_DATE, AT_OFFENDER_CSIP_REPORTS.REFERRAL_COMPLETED_BY AS REFERRAL_COMPLETED_BY, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN MAX( CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END ) OVER ( PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) ) = 2 THEN 'Y' ELSE 'N' END AS ACCT_ACTIVE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_ETHNICITY_DESC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_TYPE, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_LOC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FUNC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_DECISION_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_CONSID_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FAC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS, OMS_OWNER.OFFENDER_CSIP_FACTORS AT_OFFENDER_CSIP_FACTORS, OMS_OWNER.OFFENDER_CSIP_PLANS AT_OFFENDER_CSIP_PLANS, OMS_OWNER.OFFENDER_CSIP_REVIEWS AT_OFFENDER_CSIP_REVIEWS, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS WHERE ( ( AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID ) AND ( AT_OFFENDER_CSIP_REVIEWS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_FACTORS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_PLANS.CSIP_ID (+) = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE = AT_REF_CSIP_TYPE.CODE (+) ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION = AT_REF_CSIP_LOC.CODE (+) ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_CSIP_FUNCTION = AT_REF_CSIP_FUNC.CODE (+) ) AND ( AT_REF_CSIP_FAC.CODE (+) = AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR ) AND ( AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME = AT_REF_CSIP_CONSID_OUTCOME.CODE (+) ) AND ( AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME = AT_REF_CSIP_DECISION_OUTCOME.CODE (+) ) AND ( AT_REF_CSIP_DECISION_OUTCOME.domain (+) = 'CSIP_OUT' ) AND ( AT_REF_CSIP_CONSID_OUTCOME.domain (+) = 'CSIP_OUT' ) AND (AT_REF_CSIP_FUNC.domain (+) = 'CSIP_FUNC') AND (AT_REF_CSIP_LOC.domain (+) = 'CSIP_LOC') AND (AT_REF_CSIP_TYPE.domain (+) = 'CSIP_TYP') AND (AT_REF_CSIP_FAC.domain (+) = 'CSIP_FAC') AND ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND (AT_ETHNICITY_DESC.DOMAIN (+) = 'ETHNICITY') AND ( AT_ETHNICITY_DESC.CODE (+) = AT_OFFENDER.RACE_CODE ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID (+) ) AND ( AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER.OFFENDER_ID_DISPLAY IN ( SELECT OFFENDER_ID_DISPLAY FROM DP22_ ) ) ) ), PLAN_DATE_ AS ( SELECT DP1D_.CSIP_ID, MIN(DP1D_.CREATE_DATE) AS MIN_PLAN_DATE, MIN(DP1D_.TARGET_DATE) AS MIN_TARGET_DATE, MAX(DP1D_.TARGET_DATE) AS MAX_TARGET_DATE FROM DP1D_ GROUP BY CSIP_ID ), MAX_REVIEW_SEQ_ AS ( SELECT DP1D_.CSIP_ID, MAX(DP1D_.REVIEW_SEQ) AS MAX_REVIEW_SEQ FROM DP1D_ GROUP BY CSIP_ID ), MAX_CLOSED_DATE_ AS ( SELECT DP1D_.CSIP_ID, MAX(DP1D_.CLOSED_DATE) AS MAX_CLOSED_DATE FROM DP1D_ GROUP BY CSIP_ID ), dataset_base_ AS ( SELECT DISTINCT DP1D_.CSIP_ID, DP1D_.OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGE_IN_YEARS, ETHNIC_CODE, ETHNIC_DESCRIPTION, AGY_LOC_ID, CSIP_SEQ, RFR_INCIDENT_DATE, RFR_INCIDENT_TIME_, RFR_INCIDENT_TYPE, DESCRIPTION, RFR_INCIDENT_LOCATION, RFR_INCIDENT_LOCATION_DESCRI33, RFR_REPORTED_BY, RFR_AREA_OF_WORK_DESCRIPTION, RFR_DATE_REPORTED, RFR_PROACTIVE_RESPONSE, RFR_STAFF_ASSAULTED, INV_OUTCOME, DEC_OUTCOME_DESCRIPTION, INV_OUTCOME_DATE, CDR_OUTCOME_DATE, CDR_OUTCOME, CDR_OUTCOME_DESCRIPTION, INV_OCCURRENCE_REASON, CASE_MANAGER, REASON, CREATE_DATE, TARGET_DATE, CLOSED_DATE, PLAN_ID, NEXT_REVIEW_DATE, REV_DATE, CLOSE_DATE, REVIEW_SEQ, CDR_DECISION_REASON, CASE_REV_DATE, REFERRAL_COMPLETED_BY, UNIT_DESCRIPTION_4_SHORT AS V_LOCATION, ACCT_ACTIVE AS V_ACTIVE_ACCT_DISPLAY, CASE WHEN REFERRAL_COMPLETED_BY IS NULL THEN 'No' ELSE 'Yes' END AS V_REFERRAL_CONT_COMPLETE_, CASE WHEN CDR_OUTCOME_DESCRIPTION = 'Progress to Investigation' THEN 'Yes' ELSE 'No' END AS V_INVEST_INFO_GATHERING, ( TO_DATE(RFR_DATE_REPORTED, 'DD/MM/YYYY') - TO_DATE(TRUNC(SYSDATE), 'DD/MM/YYYY') ) AS V_LENGTH_OF_TIME_OPEN, CASE WHEN CREATE_DATE IS NULL THEN 'No' ELSE 'Yes' END AS V_PLAN_CREATED_, ( TO_DATE(CDR_OUTCOME_DATE, 'DD/MM/YYYY') - TO_DATE(INV_OUTCOME_DATE, 'DD/MM/YYYY') ) AS V_DAYS_BETWEEN_SCREEN_DATE, ( TO_DATE(PLAN_DATE_.MIN_PLAN_DATE, 'DD/MM/YYYY') - TO_DATE(CLOSE_DATE, 'DD/MM/YYYY') ) AS V_LENGTH_OF_TIME_PLAN_OPEN, INV_OUTCOME_DATE AS V_INVEST_DEC_DATE, DEC_OUTCOME_DESCRIPTION AS V_INVEST_DEC_OUTCOME, PLAN_DATE_.MIN_PLAN_DATE AS MIN_PLAN_CREATE_DATE, PLAN_DATE_.MIN_TARGET_DATE AS MIN_PLAN_TARGET_DATE_ALL, PLAN_DATE_.MAX_TARGET_DATE AS MAX_PLAN_TARGET_DATE_ALL, CASE WHEN CLOSED_DATE IS NULL AND CLOSE_DATE IS NULL THEN 1 ELSE 0 END AS V_OPEN_INTERVEN_REVIEW FROM DP1D_, PLAN_DATE_, MAX_REVIEW_SEQ_, MAX_CLOSED_DATE_ WHERE ( MAX_CLOSED_DATE_.CSIP_ID (+) = DP1D_.CSIP_ID AND MAX_CLOSED_DATE_.MAX_CLOSED_DATE = DP1D_.CLOSED_DATE ) AND (PLAN_DATE_.CSIP_ID (+) = DP1D_.CSIP_ID) ), dataset_ AS ( SELECT DISTINCT CSIP_ID, OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGE_IN_YEARS, ETHNIC_CODE, ETHNIC_DESCRIPTION, AGY_LOC_ID, CSIP_SEQ, RFR_INCIDENT_DATE, RFR_INCIDENT_TIME_, RFR_INCIDENT_TYPE, DESCRIPTION, RFR_INCIDENT_LOCATION, RFR_INCIDENT_LOCATION_DESCRI33, RFR_REPORTED_BY, RFR_AREA_OF_WORK_DESCRIPTION, RFR_DATE_REPORTED, RFR_PROACTIVE_RESPONSE, RFR_STAFF_ASSAULTED, DEC_OUTCOME_DESCRIPTION, INV_OUTCOME_DATE, CDR_OUTCOME_DATE, CDR_OUTCOME_DESCRIPTION, INV_OCCURRENCE_REASON, CASE_MANAGER, REASON, CLOSED_DATE, NEXT_REVIEW_DATE, REV_DATE, CLOSE_DATE, REVIEW_SEQ, CDR_DECISION_REASON, CASE_REV_DATE, REFERRAL_COMPLETED_BY, V_LOCATION, V_ACTIVE_ACCT_DISPLAY, V_REFERRAL_CONT_COMPLETE_, V_INVEST_INFO_GATHERING, V_LENGTH_OF_TIME_OPEN, V_PLAN_CREATED_, V_DAYS_BETWEEN_SCREEN_DATE, V_LENGTH_OF_TIME_PLAN_OPEN, V_INVEST_DEC_DATE, V_INVEST_DEC_OUTCOME, MIN_PLAN_CREATE_DATE, CDR_OUTCOME, MIN_PLAN_TARGET_DATE_ALL, MAX_PLAN_TARGET_DATE_ALL, V_OPEN_INTERVEN_REVIEW FROM dataset_base_ )",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "wing",
          "filterType": "autocomplete",
          "referenceType": "wing",
          "reportFieldType": "string",
          "display": "Wing (All for all)",
          "description": "@Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "CSIP_ID",
            "type": "string",
            "display": "RFR CSIP ID",
            "legacyId": "DP1d.DO65c",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP1d.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP1d.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP1d.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "AGE_IN_YEARS",
            "type": "string",
            "display": "Age in Years",
            "legacyId": "DP1d.DO10a15",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "ETHNIC_CODE",
            "type": "string",
            "display": "Ethnic Code",
            "legacyId": "DP1d.DO10088",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "ETHNIC_DESCRIPTION",
            "type": "string",
            "display": "Ethnic Description",
            "legacyId": "DP1d.DO1009d",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "CSIP Agy Loc Id",
            "legacyId": "DP1d.DO6c4",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "CSIP_SEQ",
            "type": "string",
            "display": "CSIP Log #",
            "legacyId": "DP1d.DO65d",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "RFR_INCIDENT_DATE",
            "type": "string",
            "display": "RFR Incident Date",
            "legacyId": "DP1d.DO65e",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "RFR_INCIDENT_TIME_",
            "type": "string",
            "display": "RFR Incident Time (see description)",
            "legacyId": "DP1d.DO65f",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "RFR_INCIDENT_TYPE",
            "type": "string",
            "display": "RFR Incident Type Code",
            "legacyId": "DP1d.DO660",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "RFR Incident Type Description",
            "legacyId": "DP1d.DO679",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "RFR_INCIDENT_LOCATION",
            "type": "string",
            "display": "RFR Incident Location Code",
            "legacyId": "DP1d.DO661",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "RFR_INCIDENT_LOCATION_DESCRI33",
            "type": "string",
            "display": "RFR Incident Location Description",
            "legacyId": "DP1d.DO67a",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "RFR_REPORTED_BY",
            "type": "string",
            "display": "RFR Referred By",
            "legacyId": "DP1d.DO663",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "RFR_AREA_OF_WORK_DESCRIPTION",
            "type": "string",
            "display": "RFR Area of Work Description",
            "legacyId": "DP1d.DO67b",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "RFR_DATE_REPORTED",
            "type": "string",
            "display": "RFR Date Referred",
            "legacyId": "DP1d.DO664",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "RFR_PROACTIVE_RESPONSE",
            "type": "string",
            "display": "RFR Proactive Referral (Prevention)",
            "legacyId": "DP1d.DO666",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "RFR_STAFF_ASSAULTED",
            "type": "string",
            "display": "RFR Staff Assaulted",
            "legacyId": "DP1d.DO667",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "DEC_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "DEC Outcome Description",
            "legacyId": "DP1d.DO697",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "INV_OUTCOME_DATE",
            "type": "string",
            "display": "DEC Outcome Date",
            "legacyId": "DP1d.DO68d",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CDR_OUTCOME_DATE",
            "type": "string",
            "display": "CDR Outcome Date",
            "legacyId": "DP1d.DO66b",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "CDR_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "CDR Outcome Description",
            "legacyId": "DP1d.DO680",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "INV_OCCURRENCE_REASON",
            "type": "string",
            "display": "INV Occurrence Reason",
            "legacyId": "DP1d.DO676",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "CASE_MANAGER",
            "type": "string",
            "display": "PLN Case Manager",
            "legacyId": "DP1d.DO699",
            "legacySqlClass": "column"
          },
          {
            "index": 26,
            "name": "REASON",
            "type": "string",
            "display": "PLN Reason",
            "legacyId": "DP1d.DO69a",
            "legacySqlClass": "column"
          },
          {
            "index": 29,
            "name": "CLOSED_DATE",
            "type": "string",
            "display": "PLN Closed Date",
            "legacyId": "DP1d.DO6a1",
            "legacySqlClass": "column"
          },
          {
            "index": 30,
            "name": "NEXT_REVIEW_DATE",
            "type": "string",
            "display": "REV Next Review Date",
            "legacyId": "DP1d.DO6a4",
            "legacySqlClass": "column"
          },
          {
            "index": 31,
            "name": "REV_DATE",
            "type": "string",
            "display": "REV Date",
            "legacyId": "DP1d.DO6a7",
            "legacySqlClass": "column"
          },
          {
            "index": 32,
            "name": "CLOSE_DATE",
            "type": "string",
            "display": "REV Close Date",
            "legacyId": "DP1d.DO6ad",
            "legacySqlClass": "column"
          },
          {
            "index": 33,
            "name": "REVIEW_SEQ",
            "type": "string",
            "display": "REV Review Seq",
            "legacyId": "DP1d.DO6a6",
            "legacySqlClass": "column"
          },
          {
            "index": 34,
            "name": "CDR_DECISION_REASON",
            "type": "string",
            "display": "CDR Decision Reason",
            "legacyId": "DP1d.DO6c8",
            "legacySqlClass": "column"
          },
          {
            "index": 35,
            "name": "CASE_REV_DATE",
            "type": "string",
            "display": "PLN Case Rev Date",
            "legacyId": "DP1d.DO6ca",
            "legacySqlClass": "column"
          },
          {
            "index": 36,
            "name": "REFERRAL_COMPLETED_BY",
            "type": "string",
            "display": "RFR Completed By",
            "legacyId": "DP1d.DO6c5",
            "legacySqlClass": "column"
          },
          {
            "index": 37,
            "name": "V_LOCATION",
            "type": "string",
            "display": "V_LOCATION",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 38,
            "name": "V_ACTIVE_ACCT_DISPLAY",
            "type": "string",
            "display": "V_ACTIVE_ACCT_DISPLAY",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 40,
            "name": "V_REFERRAL_CONT_COMPLETE_",
            "type": "string",
            "display": "V_REFERRAL_CONT_COMPLETE_",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 41,
            "name": "V_INVEST_INFO_GATHERING",
            "type": "string",
            "display": "V_INVEST_INFO_GATHERING",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 42,
            "name": "V_LENGTH_OF_TIME_OPEN",
            "type": "string",
            "display": "V_LENGTH_OF_TIME_OPEN",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 43,
            "name": "V_PLAN_CREATED_",
            "type": "string",
            "display": "V_PLAN_CREATED_",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 44,
            "name": "V_DAYS_BETWEEN_SCREEN_DATE",
            "type": "string",
            "display": "V_DAYS_BETWEEN_SCREEN_DATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 45,
            "name": "V_LENGTH_OF_TIME_PLAN_OPEN",
            "type": "string",
            "display": "V_LENGTH_OF_TIME_PLAN_OPEN",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 46,
            "name": "V_INVEST_DEC_DATE",
            "type": "string",
            "display": "V_INVEST_DEC_DATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 47,
            "name": "V_INVEST_DEC_OUTCOME",
            "type": "string",
            "display": "V_INVEST_DEC_OUTCOME",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 48,
            "name": "MIN_PLAN_CREATE_DATE",
            "type": "string",
            "display": "MIN_PLAN_CREATE_DATE",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 49,
            "name": "INV_OUTCOME",
            "type": "string",
            "display": "INV_OUTCOME",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 50,
            "name": "CDR_OUTCOME",
            "type": "string",
            "display": "CDR_OUTCOME",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 51,
            "name": "MIN_PLAN_TARGET_DATE_ALL",
            "type": "string",
            "display": "MIN_PLAN_TARGET_DATE_ALL",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 52,
            "name": "MAX_PLAN_TARGET_DATE_ALL",
            "type": "string",
            "display": "MAX_PLAN_TARGET_DATE_ALL",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 53,
            "name": "V_OPEN_INTERVEN_REVIEW",
            "type": "string",
            "display": "V_OPEN_INTERVEN_REVIEW",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375850/DP21",
      "name": "Open Supp and Interven",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "DP22_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDER.LAST_NAME BETWEEN 'AAAA' AND 'I' AND ( AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) OR 'All' IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) ) ) ), DP23_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDER.LAST_NAME BETWEEN 'I' AND 'Q' AND ( AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) OR 'All' IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) ) ) ), DP24_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDER.LAST_NAME BETWEEN 'Q' AND 'ZZZZ' AND ( AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) OR 'All' IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) ) ) ), dataset_base_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, TRUNC( MONTHS_BETWEEN(CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12 ) AS AGE_IN_YEARS, AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID AS AGY_LOC_ID, AT_OFFENDER_CSIP_REPORTS.CSIP_SEQ AS CSIP_SEQ, AT_OFFENDER_CSIP_REPORTS.CSIP_ID AS CSIP_ID, AT_REF_CSIP_TYPE.DESCRIPTION AS DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED AS RFR_DATE_REPORTED, AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION AS CDR_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME_DATE AS CDR_OUTCOME_DATE, AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION AS DEC_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME_DATE AS INV_OUTCOME_DATE, AT_OFFENDER_CSIP_REPORTS.CASE_MANAGER AS CASE_MANAGER, AT_OFFENDER_CSIP_REPORTS.REASON AS REASON, AT_OFFENDER_CSIP_PLANS.PLAN_ID AS PLAN_ID, AT_OFFENDER_CSIP_PLANS.TARGET_DATE AS TARGET_DATE, AT_OFFENDER_CSIP_PLANS.CLOSED_DATE AS CLOSED_DATE, AT_OFFENDER_CSIP_REVIEWS.REVIEW_SEQ AS REVIEW_SEQ, AT_OFFENDER_CSIP_REVIEWS.CLOSE_DATE AS CLOSE_DATE, AT_OFFENDER_CSIP_REVIEWS.NEXT_REVIEW_DATE AS NEXT_REVIEW_DATE, AT_OFFENDER_CSIP_REVIEWS.CREATE_DATE AS CREATE_DATE, AT_OFFENDER_CSIP_REPORTS.CASE_REV_DATE AS CASE_REV_DATE, AT_OFFENDER_CSIP_REPORTS.REFERRAL_COMPLETED_BY AS REFERRAL_COMPLETED_BY, AT_OFFENDER_CSIP_PLANS.CREATE_DATE AS PLN_CREATE_DATE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_TYPE, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_CONSID_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_DECISION_OUTCOME, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS, OMS_OWNER.OFFENDER_CSIP_PLANS AT_OFFENDER_CSIP_PLANS, OMS_OWNER.OFFENDER_CSIP_REVIEWS AT_OFFENDER_CSIP_REVIEWS, undefined_, undefined_, undefined_ WHERE ( ( ( ( AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID ) AND ( AT_OFFENDER_CSIP_REVIEWS.CSIP_ID = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_PLANS.CSIP_ID = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE = AT_REF_CSIP_TYPE.CODE ) AND ( AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME = AT_REF_CSIP_CONSID_OUTCOME.CODE ) AND ( AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME = AT_REF_CSIP_DECISION_OUTCOME.CODE ) AND (AT_REF_CSIP_DECISION_OUTCOME.domain = 'CSIP_OUT') AND (AT_REF_CSIP_CONSID_OUTCOME.domain = 'CSIP_OUT') AND (AT_REF_CSIP_TYPE.domain = 'CSIP_TYP') AND ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( ( AT_OFFENDER.OFFENDER_ID_DISPLAY IN ( SELECT OFFENDER_ID_DISPLAY FROM DP22_ ) OR AT_OFFENDER.OFFENDER_ID_DISPLAY IN ( SELECT OFFENDER_ID_DISPLAY FROM DP23_ ) OR AT_OFFENDER.OFFENDER_ID_DISPLAY IN ( SELECT OFFENDER_ID_DISPLAY FROM DP24_ ) ) AND ( AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION = 'Progress to CSIP' OR AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION = 'Progress to CSIP' ) AND NOT AT_OFFENDER_CSIP_PLANS.PLAN_ID IS NULL ) ) AND (undefined) ) AND (undefined) ) AND (undefined) ), dataset_ AS ( SELECT OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGE_IN_YEARS, AGY_LOC_ID, CSIP_SEQ, CSIP_ID, DESCRIPTION, RFR_DATE_REPORTED, CDR_OUTCOME_DESCRIPTION, CDR_OUTCOME_DATE, DEC_OUTCOME_DESCRIPTION, INV_OUTCOME_DATE, CASE_MANAGER, REASON, PLAN_ID, TARGET_DATE, CLOSED_DATE, REVIEW_SEQ, CLOSE_DATE, NEXT_REVIEW_DATE, CREATE_DATE, CASE_REV_DATE, REFERRAL_COMPLETED_BY, PLN_CREATE_DATE, UNIT_DESCRIPTION_4_SHORT AS V_LOCATION, CASE WHEN V_ACTIVE_ACCT = 1 THEN 'Y' ELSE 'N' END AS V_ACTIVE_ACCT_DISPLAY, 'TBD' AS V_LENGTH_OF_TIME_PLAN_OPEN_O45, 'TBD' AS V_LENGTH_OF_TIME_PLAN_OPEN, 'TBD' AS MIN_PLAN_TARGET_DATE_ALL, 'TBD' AS MAX_PLAN_TARGET_DATE_ALL FROM dataset_base_ )",
      "parameters": [
        {
          "index": 0,
          "name": "wing",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Wing (All for all)",
          "description": "@Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "establishment_code",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Establishment Code (All for all)",
          "description": "@Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP21.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP21.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP21.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "AGE_IN_YEARS",
            "type": "double",
            "display": "Age in Years",
            "legacyId": "DP21.DO10a15",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "CSIP Agy Loc Id",
            "legacyId": "DP21.DO6c4",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "CSIP_SEQ",
            "type": "string",
            "display": "CSIP Log #",
            "legacyId": "DP21.DO65d",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "CSIP_ID",
            "type": "double",
            "display": "RFR CSIP ID",
            "legacyId": "DP21.DO65c",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "RFR Incident Type Description",
            "legacyId": "DP21.DO679",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "RFR_DATE_REPORTED",
            "type": "date",
            "display": "RFR Date Referred",
            "legacyId": "DP21.DO664",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "CDR_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "CDR Outcome Description",
            "legacyId": "DP21.DO680",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "CDR_OUTCOME_DATE",
            "type": "date",
            "display": "CDR Outcome Date",
            "legacyId": "DP21.DO66b",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "DEC_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "DEC Outcome Description",
            "legacyId": "DP21.DO697",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "INV_OUTCOME_DATE",
            "type": "date",
            "display": "DEC Outcome Date",
            "legacyId": "DP21.DO68d",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "CASE_MANAGER",
            "type": "string",
            "display": "PLN Case Manager",
            "legacyId": "DP21.DO699",
            "legacySqlClass": "column"
          },
          {
            "index": 14,
            "name": "REASON",
            "type": "string",
            "display": "PLN Reason",
            "legacyId": "DP21.DO69a",
            "legacySqlClass": "column"
          },
          {
            "index": 15,
            "name": "PLAN_ID",
            "type": "double",
            "display": "PLN Plan Id",
            "legacyId": "DP21.DO69b",
            "legacySqlClass": "column"
          },
          {
            "index": 16,
            "name": "TARGET_DATE",
            "type": "date",
            "display": "PLN Target Date",
            "legacyId": "DP21.DO6a0",
            "legacySqlClass": "column"
          },
          {
            "index": 17,
            "name": "CLOSED_DATE",
            "type": "date",
            "display": "PLN Closed Date",
            "legacyId": "DP21.DO6a1",
            "legacySqlClass": "column"
          },
          {
            "index": 18,
            "name": "REVIEW_SEQ",
            "type": "double",
            "display": "REV Review Seq",
            "legacyId": "DP21.DO6a6",
            "legacySqlClass": "column"
          },
          {
            "index": 19,
            "name": "CLOSE_DATE",
            "type": "date",
            "display": "REV Close Date",
            "legacyId": "DP21.DO6ad",
            "legacySqlClass": "column"
          },
          {
            "index": 20,
            "name": "NEXT_REVIEW_DATE",
            "type": "date",
            "display": "REV Next Review Date",
            "legacyId": "DP21.DO6a4",
            "legacySqlClass": "column"
          },
          {
            "index": 21,
            "name": "CREATE_DATE",
            "type": "date",
            "display": "REV Date",
            "legacyId": "DP21.DO6a7",
            "legacySqlClass": "column"
          },
          {
            "index": 22,
            "name": "CASE_REV_DATE",
            "type": "date",
            "display": "PLN Case Rev Date",
            "legacyId": "DP21.DO6ca",
            "legacySqlClass": "column"
          },
          {
            "index": 23,
            "name": "REFERRAL_COMPLETED_BY",
            "type": "string",
            "display": "RFR Completed By",
            "legacyId": "DP21.DO6c5",
            "legacySqlClass": "column"
          },
          {
            "index": 24,
            "name": "PLN_CREATE_DATE",
            "type": "date",
            "display": "PLN Create Date",
            "legacyId": "DP21.DO69d",
            "legacySqlClass": "column"
          },
          {
            "index": 25,
            "name": "V_LOCATION",
            "type": "string",
            "display": "V_LOCATION",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 26,
            "name": "V_ACTIVE_ACCT_DISPLAY",
            "type": "string",
            "display": "V_ACTIVE_ACCT_DISPLAY",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 27,
            "name": "V_LENGTH_OF_TIME_PLAN_OPEN_O45",
            "type": "string",
            "display": "V_LENGTH_OF_TIME_PLAN_OPEN_O45",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 28,
            "name": "V_LENGTH_OF_TIME_PLAN_OPEN",
            "type": "string",
            "display": "V_LENGTH_OF_TIME_PLAN_OPEN",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 29,
            "name": "MIN_PLAN_TARGET_DATE_ALL",
            "type": "string",
            "display": "MIN_PLAN_TARGET_DATE_ALL",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 30,
            "name": "MAX_PLAN_TARGET_DATE_ALL",
            "type": "string",
            "display": "MAX_PLAN_TARGET_DATE_ALL",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375850/DP22",
      "name": "A-I",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID) AND (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDER.LAST_NAME BETWEEN 'AAAA' AND 'I' AND (AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN (SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */) OR 'All' IN (SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */)) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */) OR 'All' IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */)))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DESCRIPTION, AGY_AND_LOCATION, UNIT_DESCRIPTION_4_SHORT, AGY_LOC_ID FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "wing",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Wing (All for all)",
          "description": "@Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "establishment_code",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Establishment Code (All for all)",
          "description": "@Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP22.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Level 1 Living Unit",
            "legacyId": "DP22.DO109fb",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "AGY_AND_LOCATION",
            "type": "string",
            "display": "Agy and Location",
            "legacyId": "DP22.DO11069",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "UNIT_DESCRIPTION_4_SHORT",
            "type": "string",
            "display": "Unit Description 4 Short",
            "legacyId": "DP22.DO10427",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "Establishment Code",
            "legacyId": "DP22.DO1043b",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375850/DP23",
      "name": "J-Q",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID) AND (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDER.LAST_NAME BETWEEN 'I' AND 'Q' AND (AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN (SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */) OR 'All' IN (SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */)) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */) OR 'All' IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */)))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DESCRIPTION, AGY_AND_LOCATION, UNIT_DESCRIPTION_4_SHORT, AGY_LOC_ID FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "wing",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Wing (All for all)",
          "description": "@Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "establishment_code",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Establishment Code (All for all)",
          "description": "@Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP23.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Level 1 Living Unit",
            "legacyId": "DP23.DO109fb",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "AGY_AND_LOCATION",
            "type": "string",
            "display": "Agy and Location",
            "legacyId": "DP23.DO11069",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "UNIT_DESCRIPTION_4_SHORT",
            "type": "string",
            "display": "Unit Description 4 Short",
            "legacyId": "DP23.DO10427",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "Establishment Code",
            "legacyId": "DP23.DO1043b",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375850/DP24",
      "name": "R-Z",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION)) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID) AND (AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID) AND (NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC')) AND (AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID) AND (AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID) AND (WING_CASELOAD_SECURITY.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDER.LAST_NAME BETWEEN 'Q' AND 'ZZZZ' AND (AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN (SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */) OR 'All' IN (SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */)) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */) OR 'All' IN (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3) */)))), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DESCRIPTION, AGY_AND_LOCATION, UNIT_DESCRIPTION_4_SHORT, AGY_LOC_ID FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "wing",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Wing (All for all)",
          "description": "@Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "establishment_code",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Establishment Code (All for all)",
          "description": "@Prompt('Establishment Code (All for all)','A','Establishment\\Establishment Code',multi,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP24.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Level 1 Living Unit",
            "legacyId": "DP24.DO109fb",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "AGY_AND_LOCATION",
            "type": "string",
            "display": "Agy and Location",
            "legacyId": "DP24.DO11069",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "UNIT_DESCRIPTION_4_SHORT",
            "type": "string",
            "display": "Unit Description 4 Short",
            "legacyId": "DP24.DO10427",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "Establishment Code",
            "legacyId": "DP24.DO1043b",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375850/DP26",
      "name": "CSIP Count",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "DP22_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( ( AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) OR 'All' IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) ) ) ), DP_RAW_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER_CSIP_REPORTS.CSIP_ID AS CSIP_ID, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME AS INV_OUTCOME, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME AS CDR_OUTCOME , AT_OFFENDER_CSIP_PLANS.PLAN_ID AS PLAN_ID, AT_OFFENDER_CSIP_REPORTS.CASE_REV_DATE AS CASE_REV_DATE, AT_OFFENDER_CSIP_PLANS.TARGET_DATE AS TARGET_DATE, AT_OFFENDER_ALERTS.ALERT_CODE AS ALERT_CODE, AT_OFFENDER_ALERTS.ALERT_STATUS AS ALERT_STATUS, AT_OFFENDER_BOOKING.BOOKING_STATUS AS BOOKING_STATUS FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS, OMS_OWNER.OFFENDER_CSIP_PLANS AT_OFFENDER_CSIP_PLANS WHERE ( ( AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID ) AND ( AT_OFFENDER_CSIP_PLANS.CSIP_ID (+)= AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER.OFFENDER_ID_DISPLAY IN ( SELECT OFFENDER_ID_DISPLAY FROM DP22_ ) ) ) ), DP_CISP_XX AS ( SELECT DP_RAW_.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, DP_RAW_.CSIP_ID AS CSIP_ID, DP_RAW_.FIRST_NAME AS FIRST_NAME, DP_RAW_.LAST_NAME AS LAST_NAME, AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION AS DESCRIPTION, DP_RAW_.INV_OUTCOME AS INV_OUTCOME, AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION AS DEC_OUTCOME_DESCRIPTION, DP_RAW_.PLAN_ID AS PLAN_ID, DP_RAW_.CASE_REV_DATE AS CASE_REV_DATE, DP_RAW_.TARGET_DATE AS TARGET_DATE, DP_RAW_.ALERT_CODE AS ALERT_CODE, DP_RAW_.ALERT_STATUS AS ALERT_STATUS, DP_RAW_.BOOKING_STATUS AS BOOKING_STATUS FROM DP_RAW_, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_CONSID_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_DECISION_OUTCOME WHERE ( ( DP_RAW_.CDR_OUTCOME = AT_REF_CSIP_CONSID_OUTCOME.CODE ) AND ( (DP_RAW_.INV_OUTCOME = AT_REF_CSIP_DECISION_OUTCOME.CODE) ) AND (AT_REF_CSIP_DECISION_OUTCOME.domain = 'CSIP_OUT') AND (AT_REF_CSIP_CONSID_OUTCOME.domain = 'CSIP_OUT') ) ), DP_CISP_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER_CSIP_REPORTS.CSIP_ID AS CSIP_ID, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, AT_OFFENDER.LAST_NAME AS LAST_NAME, CASE WHEN AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME IS NOT NULL THEN AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION ELSE NULL END AS CDR_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME AS INV_OUTCOME, CASE WHEN AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME IS NOT NULL THEN AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION ELSE NULL END AS DEC_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_PLANS.PLAN_ID AS PLAN_ID, AT_OFFENDER_CSIP_REPORTS.CASE_REV_DATE AS CASE_REV_DATE, AT_OFFENDER_CSIP_PLANS.CREATE_DATE AS CREATE_DATE, AT_OFFENDER_CSIP_PLANS.TARGET_DATE AS TARGET_DATE, AT_OFFENDER_ALERTS.ALERT_CODE AS ALERT_CODE, AT_OFFENDER_ALERTS.ALERT_STATUS AS ALERT_STATUS, AT_OFFENDER_BOOKING.BOOKING_STATUS AS BOOKING_STATUS FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_CONSID_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_DECISION_OUTCOME, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS, OMS_OWNER.OFFENDER_CSIP_PLANS AT_OFFENDER_CSIP_PLANS WHERE ( ( AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID ) AND ( AT_OFFENDER_CSIP_PLANS.CSIP_ID (+)= AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( (AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME = AT_REF_CSIP_CONSID_OUTCOME.CODE) or AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME IS NULL ) AND ( (AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME = AT_REF_CSIP_DECISION_OUTCOME.CODE) or AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME IS NULL ) AND (AT_REF_CSIP_DECISION_OUTCOME.domain = 'CSIP_OUT') AND (AT_REF_CSIP_CONSID_OUTCOME.domain = 'CSIP_OUT') AND ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER.OFFENDER_ID_DISPLAY IN ( SELECT OFFENDER_ID_DISPLAY FROM DP22_ ) ) ) ), PREV_INVESTIGATIONS_ AS ( SELECT DISTINCT OFFENDER_ID_DISPLAY, COUNT(DISTINCT CSIP_ID) OVER ( PARTITION BY DP_CISP_.OFFENDER_ID_DISPLAY, CASE WHEN CDR_OUTCOME_DESCRIPTION = 'Progress to Investigation' THEN 1 END ) AS PREV_INV_COUNT FROM DP_CISP_ ), PREV_INVESTIGATIONS_TOTAL_ AS ( SELECT OFFENDER_ID_DISPLAY, MAX(PREV_INV_COUNT) AS PREV_INV_COUNT FROM PREV_INVESTIGATIONS_ GROUP BY OFFENDER_ID_DISPLAY ), PLANS_ AS ( SELECT OFFENDER_ID_DISPLAY, COUNT(DISTINCT PLAN_ID) OVER ( PARTITION BY DP_CISP_.CSIP_ID, DP_CISP_.OFFENDER_ID_DISPLAY ) AS PLAN_COUNT FROM DP_CISP_ ), PLANS_TOTAL_ AS ( SELECT OFFENDER_ID_DISPLAY, max(PLAN_COUNT) AS MAX_PLAN_COUNT FROM PLANS_ GROUP BY OFFENDER_ID_DISPLAY ), PLANS_TOTAL_2 AS ( SELECT OFFENDER_ID_DISPLAY, COUNT(PLAN_COUNT) OVER ( PARTITION BY OFFENDER_ID_DISPLAY ) AS MAX_PLAN_COUNT FROM PLANS_ ), dataset_base_ AS ( SELECT DISTINCT DP_CISP_.OFFENDER_ID_DISPLAY, DP_CISP_.FIRST_NAME, DP_CISP_.LAST_NAME, PREV_INVESTIGATIONS_TOTAL_.PREV_INV_COUNT AS V_COUNT_PREV_INVESTIGATIONS, ( COUNT(DISTINCT DP_CISP_.CSIP_ID) OVER ( PARTITION BY DP_CISP_.OFFENDER_ID_DISPLAY ) ) AS V_COUNT_CSIP_ID, PLANS_TOTAL_.MAX_PLAN_COUNT AS V_COUNT_PREV_PLANS_V2 FROM DP_CISP_, PREV_INVESTIGATIONS_TOTAL_, PLANS_TOTAL_ WHERE PREV_INVESTIGATIONS_TOTAL_.OFFENDER_ID_DISPLAY(+) = DP_CISP_.OFFENDER_ID_DISPLAY AND PLANS_TOTAL_.OFFENDER_ID_DISPLAY (+) = DP_CISP_.OFFENDER_ID_DISPLAY ), dataset_ AS ( SELECT DISTINCT OFFENDER_ID_DISPLAY, FIRST_NAME, LAST_NAME, V_COUNT_PREV_INVESTIGATIONS, V_COUNT_CSIP_ID, V_COUNT_PREV_PLANS_V2 FROM dataset_base_ )",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "wing",
          "filterType": "autocomplete",
          "referenceType": "wing",
          "reportFieldType": "string",
          "display": "Wing (All for all)",
          "description": "@Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP26.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "Given Name 1",
            "legacyId": "DP26.DO11066",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP26.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "V_COUNT_PREV_INVESTIGATIONS",
            "type": "string",
            "display": "V_COUNT_PREV_INVESTIGATIONS",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 4,
            "name": "V_COUNT_CSIP_ID",
            "type": "string",
            "display": "V_COUNT_CSIP_ID",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 5,
            "name": "V_COUNT_PREV_PLANS_V2",
            "type": "string",
            "display": "V_COUNT_PREV_PLANS_V2",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3375850/DASH_1",
      "name": "CSIP Referrals",
      "description": "OR - Incidents",
      "datasource": "nomis",
      "query": "DP22_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDER.LAST_NAME BETWEEN 'AAAA' AND 'I' AND ( AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) OR 'All' IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) ) ) ), DP23_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDER.LAST_NAME BETWEEN 'I' AND 'Q' AND ( AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) OR 'All' IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) ) ) ), DP24_ AS ( SELECT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_LIVING_UNITS.DESCRIPTION AS DESCRIPTION, AT_ALL_LIVING_UNITS.AGY_LOC_ID || '-' || AT_ALL_LIVING_UNITS.LEVEL_1_CODE AS AGY_AND_LOCATION, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_OFFENDERS_LOCATIONS.AGY_LOC_ID AS AGY_LOC_ID FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.LIVING_UNITS AT_LIVING_UNITS, OMS_OWNER.LIVING_UNITS AT_ALL_LIVING_UNITS, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID = AT_LIVING_UNITS.LIVING_UNIT_ID ) AND ( NOT AT_LIVING_UNITS.HOUSING_UNIT_TYPE IN ('OU', 'REC') ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID (+) = AT_ALL_LIVING_UNITS.LIVING_UNIT_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDER.LAST_NAME BETWEEN 'Q' AND 'ZZZZ' AND ( AT_LIVING_UNITS.AGY_LOC_ID || '-' || AT_LIVING_UNITS.LEVEL_1_CODE IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) OR 'All' IN ( SELECT WING FROM prompt_ /* = #Prompt('Wing (All for all)','A','Cell\\\\\\\\\\\\\\\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4) */ ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) OR 'All' IN ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #Prompt('Establishment Code (All for all)','A','Establishment\\\\\\\\\\\\\\\\Establishment Code',multi,free,,Not_Persistent,,User:3) */ ) ) ) ), DP1D_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, TRUNC( MONTHS_BETWEEN (CURRENT_TIMESTAMP, AT_OFFENDER.BIRTH_DATE) / 12 ) AS AGE_IN_YEARS, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END AS ETHNIC_CODE, CASE WHEN AT_OFFENDER.RACE_CODE = 'W8' THEN 'W3' WHEN AT_OFFENDER.RACE_CODE = 'O1' THEN 'A4' ELSE AT_OFFENDER.RACE_CODE END || '-' || CASE WHEN AT_ETHNICITY_DESC.CODE = 'W8' THEN 'White: Gypsy or Irish Traveller' WHEN AT_ETHNICITY_DESC.CODE = 'O1' THEN 'Asian/Asian British: Chinese' ELSE AT_ETHNICITY_DESC.DESCRIPTION END AS ETHNIC_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.AGY_LOC_ID AS AGY_LOC_ID, AT_OFFENDER_CSIP_REPORTS.CSIP_SEQ AS CSIP_SEQ, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_DATE AS RFR_INCIDENT_DATE, TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_date) + ( AT_OFFENDER_CSIP_REPORTS.rfr_incident_time - TRUNC(AT_OFFENDER_CSIP_REPORTS.rfr_incident_time) ) AS RFR_INCIDENT_TIME_, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE AS RFR_INCIDENT_TYPE, AT_REF_CSIP_TYPE.DESCRIPTION AS DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION AS RFR_INCIDENT_LOCATION, AT_REF_CSIP_LOC.DESCRIPTION AS RFR_INCIDENT_LOCATION_DESCRI33, AT_OFFENDER_CSIP_REPORTS.RFR_REPORTED_BY AS RFR_REPORTED_BY, AT_REF_CSIP_FUNC.DESCRIPTION AS RFR_AREA_OF_WORK_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.RFR_DATE_REPORTED AS RFR_DATE_REPORTED, AT_OFFENDER_CSIP_REPORTS.RFR_PROACTIVE_RESPONSE AS RFR_PROACTIVE_RESPONSE, AT_OFFENDER_CSIP_REPORTS.RFR_STAFF_ASSAULTED AS RFR_STAFF_ASSAULTED, AT_OFFENDER_CSIP_REPORTS.CSIP_ID AS CSIP_ID, AT_REF_CSIP_DECISION_OUTCOME.DESCRIPTION AS DEC_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME_DATE AS INV_OUTCOME_DATE, AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME_DATE AS CDR_OUTCOME_DATE, AT_REF_CSIP_CONSID_OUTCOME.DESCRIPTION AS CDR_OUTCOME_DESCRIPTION, AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR AS CSIP_FACTOR, AT_REF_CSIP_FAC.DESCRIPTION AS CDR_FACTOR_DESCRIPTION, AT_OFFENDER_CSIP_REPORTS.INV_OCCURRENCE_REASON AS INV_OCCURRENCE_REASON, AT_OFFENDER_CSIP_REPORTS.CASE_MANAGER AS CASE_MANAGER, AT_OFFENDER_CSIP_REPORTS.REASON AS REASON, AT_OFFENDER_CSIP_PLANS.CREATE_DATE AS CREATE_DATE, AT_OFFENDER_CSIP_PLANS.TARGET_DATE AS TARGET_DATE, AT_OFFENDER_CSIP_PLANS.CLOSED_DATE AS CLOSED_DATE, AT_OFFENDER_CSIP_PLANS.PLAN_ID AS PLAN_ID, AT_OFFENDER_CSIP_REVIEWS.NEXT_REVIEW_DATE AS NEXT_REVIEW_DATE, AT_OFFENDER_CSIP_REVIEWS.CREATE_DATE AS REV_DATE, AT_OFFENDER_CSIP_REVIEWS.CLOSE_DATE AS CLOSE_DATE, AT_OFFENDER_CSIP_REVIEWS.REVIEW_SEQ AS REVIEW_SEQ, AT_OFFENDER_CSIP_REPORTS.CDR_DECISION_REASON AS CDR_DECISION_REASON, AT_OFFENDER_CSIP_REPORTS.CASE_REV_DATE AS CASE_REV_DATE, AT_OFFENDER_CSIP_REPORTS.REFERRAL_COMPLETED_BY AS REFERRAL_COMPLETED_BY, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, CASE WHEN MAX( CASE WHEN AT_OFFENDER_ALERTS.ALERT_CODE = 'HA' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_TYPE = 'H' THEN CASE WHEN AT_OFFENDER_ALERTS.ALERT_STATUS = 'ACTIVE' THEN 2 ELSE 1 END ELSE 1 END ELSE 1 END ) OVER ( PARTITION BY (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID) ) = 2 THEN 'Y' ELSE 'N' END AS ACCT_ACTIVE FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_ETHNICITY_DESC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_TYPE, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_LOC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FUNC, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_DECISION_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_CONSID_OUTCOME, OMS_OWNER.REFERENCE_CODES AT_REF_CSIP_FAC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.OFFENDER_CSIP_REPORTS AT_OFFENDER_CSIP_REPORTS, OMS_OWNER.OFFENDER_CSIP_FACTORS AT_OFFENDER_CSIP_FACTORS, OMS_OWNER.OFFENDER_CSIP_PLANS AT_OFFENDER_CSIP_PLANS, OMS_OWNER.OFFENDER_CSIP_REVIEWS AT_OFFENDER_CSIP_REVIEWS, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.OFFENDER_ALERTS AT_OFFENDER_ALERTS WHERE ( ( AT_OFFENDER_CSIP_REPORTS.OFFENDER_BOOK_ID = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID AND AT_OFFENDER_CSIP_REPORTS.ROOT_OFFENDER_ID = AT_OFFENDER_BOOKING.ROOT_OFFENDER_ID ) AND ( AT_OFFENDER_CSIP_REVIEWS.CSIP_ID = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_FACTORS.CSIP_ID = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_PLANS.CSIP_ID = AT_OFFENDER_CSIP_REPORTS.CSIP_ID ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_TYPE = AT_REF_CSIP_TYPE.CODE ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_INCIDENT_LOCATION = AT_REF_CSIP_LOC.CODE ) AND ( AT_OFFENDER_CSIP_REPORTS.RFR_CSIP_FUNCTION = AT_REF_CSIP_FUNC.CODE ) AND ( AT_OFFENDER_CSIP_REPORTS.CDR_OUTCOME = AT_REF_CSIP_CONSID_OUTCOME.CODE ) AND ( AT_REF_CSIP_FAC.CODE = AT_OFFENDER_CSIP_FACTORS.CSIP_FACTOR ) AND ( AT_OFFENDER_CSIP_REPORTS.INV_OUTCOME = AT_REF_CSIP_DECISION_OUTCOME.CODE ) AND (AT_REF_CSIP_DECISION_OUTCOME.domain = 'CSIP_OUT') AND (AT_REF_CSIP_CONSID_OUTCOME.domain = 'CSIP_OUT') AND (AT_REF_CSIP_FUNC.domain = 'CSIP_FUNC') AND (AT_REF_CSIP_LOC.domain = 'CSIP_LOC') AND (AT_REF_CSIP_TYPE.domain = 'CSIP_TYP') AND (AT_REF_CSIP_FAC.domain = 'CSIP_FAC') AND ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND (AT_ETHNICITY_DESC.DOMAIN = 'ETHNICITY') AND (AT_ETHNICITY_DESC.CODE = AT_OFFENDER.RACE_CODE) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDER_ALERTS.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER.OFFENDER_ID_DISPLAY IN ( SELECT OFFENDER_ID_DISPLAY FROM DP22_ ) ) ) ), FACTOR_ AS ( SELECT DISTINCT DP1D_.OFFENDER_ID_DISPLAY, LISTAGG (DP1D_.CSIP_FACTOR, ', ') WITHIN GROUP ( ORDER BY DP1D_.CSIP_FACTOR ) OVER(PARTITION BY DP1D_.OFFENDER_ID_DISPLAY) AS CONCAT_FACTORS_CODE FROM DP1D_ GROUP BY CSIP_FACTOR, OFFENDER_ID_DISPLAY ), PLAN_DATE_ AS ( SELECT DP1D_.OFFENDER_ID_DISPLAY, MIN(DP1D_.CREATE_DATE) AS MIN_PLAN_DATE FROM DP1D_ GROUP BY OFFENDER_ID_DISPLAY ), dataset_base_ AS ( SELECT DISTINCT DP1D_.OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGE_IN_YEARS, ETHNIC_CODE, ETHNIC_DESCRIPTION, AGY_LOC_ID, CSIP_SEQ, RFR_INCIDENT_DATE, RFR_INCIDENT_TIME_, RFR_INCIDENT_TYPE, DESCRIPTION, RFR_INCIDENT_LOCATION, RFR_INCIDENT_LOCATION_DESCRI33, RFR_REPORTED_BY, RFR_AREA_OF_WORK_DESCRIPTION, RFR_DATE_REPORTED, RFR_PROACTIVE_RESPONSE, RFR_STAFF_ASSAULTED, CSIP_ID, DEC_OUTCOME_DESCRIPTION, INV_OUTCOME_DATE, CDR_OUTCOME_DATE, CDR_OUTCOME_DESCRIPTION, INV_OCCURRENCE_REASON, CASE_MANAGER, REASON, CREATE_DATE, TARGET_DATE, CLOSED_DATE, PLAN_ID, NEXT_REVIEW_DATE, REV_DATE, CLOSE_DATE, REVIEW_SEQ, CDR_DECISION_REASON, CASE_REV_DATE, REFERRAL_COMPLETED_BY, UNIT_DESCRIPTION_4_SHORT AS V_LOCATION, ACCT_ACTIVE AS V_ACTIVE_ACCT_DISPLAY, FACTOR_.CONCAT_FACTORS_CODE AS V_MAX_CONCAT_FACTORS_CODE, CASE WHEN REFERRAL_COMPLETED_BY IS NULL THEN 'No' ELSE 'Yes' END AS V_REFERRAL_CONT_COMPLETE_, CASE WHEN CDR_OUTCOME_DESCRIPTION = 'Progress to Investigation' THEN 'Yes' ELSE 'No' END AS V_INVEST_INFO_GATHERING, ( TO_DATE(RFR_DATE_REPORTED, 'DD/MM/YYYY') - TO_DATE(TRUNC(SYSDATE), 'DD/MM/YYYY') ) AS V_LENGTH_OF_TIME_OPEN, CASE WHEN CREATE_DATE IS NULL THEN 'No' ELSE 'Yes' END AS V_PLAN_CREATED_, ( TO_DATE(CDR_OUTCOME_DATE, 'DD/MM/YYYY') - TO_DATE(INV_OUTCOME_DATE, 'DD/MM/YYYY') ) AS V_DAYS_BETWEEN_SCREEN_DATE, ( TO_DATE(PLAN_DATE_.MIN_PLAN_DATE, 'DD/MM/YYYY') - TO_DATE(CLOSE_DATE, 'DD/MM/YYYY') ) AS V_LENGTH_OF_TIME_PLAN_OPEN, INV_OUTCOME_DATE AS V_INVEST_DEC_DATE, DEC_OUTCOME_DESCRIPTION AS V_INVEST_DEC_OUTCOME, PLAN_DATE_.MIN_PLAN_DATE AS MIN_PLAN_CREATE_DATE FROM DP1D_, FACTOR_, PLAN_DATE_ WHERE FACTOR_.OFFENDER_ID_DISPLAY(+) = DP1D_.OFFENDER_ID_DISPLAY AND ( PLAN_DATE_.OFFENDER_ID_DISPLAY(+) = DP1D_.OFFENDER_ID_DISPLAY ) ), RAW_STATS AS ( SELECT DISTINCT OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGY_LOC_ID, TO_DATE(RFR_DATE_REPORTED, 'DD/MM/YYYY') as RFR_DATE_REPORTED, DEC_OUTCOME_DESCRIPTION, CDR_OUTCOME_DESCRIPTION, V_LOCATION, V_INVEST_INFO_GATHERING, V_REFERRAL_CONT_COMPLETE_, CSIP_SEQ, CASE WHEN (CDR_OUTCOME_DESCRIPTION = 'Progress to Investigation' OR CDR_OUTCOME_DESCRIPTION IS NULL) AND DEC_OUTCOME_DESCRIPTION IS NULL AND V_REFERRAL_CONT_COMPLETE_ ='No' THEN 1 ELSE 0 END AS V_REFERAL_COUNT, CASE WHEN CDR_OUTCOME_DESCRIPTION = 'Progress to Investigation' AND DEC_OUTCOME_DESCRIPTION IS NULL AND V_INVEST_INFO_GATHERING = 'No' THEN 1 ELSE 0 END AS V_SCREENING_COUNT, CASE WHEN CDR_OUTCOME_DESCRIPTION = 'Progress to Investigation' AND DEC_OUTCOME_DESCRIPTION IS NULL AND V_INVEST_INFO_GATHERING = 'No' THEN 1 ELSE 0 END AS V_INFO_GATHERING_COUNT, CASE WHEN CDR_OUTCOME_DESCRIPTION = 'Progress to Investigation' AND DEC_OUTCOME_DESCRIPTION IS NULL AND V_INVEST_INFO_GATHERING = 'Yes' THEN 1 ELSE 0 END AS V_INVEST_DEC_COUNT FROM dataset_base_ ), REF_INVEST_ AS ( SELECT DISTINCT OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGY_LOC_ID, TO_DATE(RFR_DATE_REPORTED, 'DD/MM/YYYY') as RFR_DATE_REPORTED, DEC_OUTCOME_DESCRIPTION, CDR_OUTCOME_DESCRIPTION, V_LOCATION, V_REFERAL_COUNT, V_SCREENING_COUNT, V_INFO_GATHERING_COUNT, V_INVEST_DEC_COUNT FROM RAW_STATS ), WING_STATS_ AS ( SELECT CSIP_SEQ, sum(V_REFERAL_COUNT) AS V_REFERAL_COUNT, sum(V_SCREENING_COUNT) AS V_SCREENING_COUNT, sum(V_INFO_GATHERING_COUNT) AS V_INFO_GATHERING_COUNT, sum(V_INVEST_DEC_COUNT) AS V_INVEST_DEC_COUNT FROM RAW_STATS GROUP by CSIP_SEQ ), dataset_ AS ( SELECT DISTINCT OFFENDER_ID_DISPLAY, LAST_NAME, FIRST_NAME, AGY_LOC_ID, RFR_DATE_REPORTED, DEC_OUTCOME_DESCRIPTION, CDR_OUTCOME_DESCRIPTION, V_LOCATION, null AS CSIP_SEQ, V_REFERAL_COUNT, V_SCREENING_COUNT, V_INFO_GATHERING_COUNT V_INVEST_DEC_COUNT FROM REF_INVEST_ UNION SELECT null AS OFFENDER_ID_DISPLAY, null AS LAST_NAME, null AS FIRST_NAME, null AS AGY_LOC_ID, null as RFR_DATE_REPORTED, null AS DEC_OUTCOME_DESCRIPTION, null AS CDR_OUTCOME_DESCRIPTION, null AS V_LOCATION, CSIP_SEQ, V_REFERAL_COUNT, V_SCREENING_COUNT, V_INFO_GATHERING_COUNT V_INVEST_DEC_COUNT FROM WING_STATS_ )",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "autocomplete",
          "referenceType": "establishment",
          "reportFieldType": "string",
          "display": "Establishment",
          "description": "@Prompt('Establishment Code','A','Establishment\\Establishment Code',mono,free,,Not_Persistent,,User:3)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "wing",
          "filterType": "autocomplete",
          "referenceType": "wing",
          "reportFieldType": "string",
          "display": "Wing (All for all)",
          "description": "@Prompt('Wing (All for all)','A','Cell\\Level 1 Living Unit LOV',multi,free,,Not_Persistent,,User:4)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP1d.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP1d.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP1d.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "AGY_LOC_ID",
            "type": "string",
            "display": "CSIP Agy Loc Id",
            "legacyId": "DP1d.DO6c4",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "RFR_DATE_REPORTED",
            "type": "date",
            "display": "RFR Date Referred",
            "legacyId": "DP21.DO664",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "DEC_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "DEC Outcome Description",
            "legacyId": "DP1d.DO697",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "CDR_OUTCOME_DESCRIPTION",
            "type": "string",
            "display": "CDR Outcome Description",
            "legacyId": "DP1d.DO680",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "V_LOCATION",
            "type": "string",
            "display": "V_LOCATION",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 8,
            "name": "V_INVEST_INFO_GATHERING",
            "type": "string",
            "display": "V_INVEST_INFO_GATHERING",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 9,
            "name": "V_REFERRAL_CONT_COMPLETE_",
            "type": "string",
            "display": "V_REFERRAL_CONT_COMPLETE_",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 10,
            "name": "CSIP_SEQ",
            "type": "string",
            "display": "CSIP Log #",
            "legacyId": "DP1d.DO65d",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "V_REFERAL_COUNT",
            "type": "string",
            "display": "PENDING REF COUNT",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 12,
            "name": "V_SCREENING_COUNT",
            "type": "string",
            "display": "PENDING SCREEN_COUNT",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 13,
            "name": "V_INFO_GATHERING_COUNT",
            "type": "string",
            "display": "PENDING INFO_GATHERING_COUNT",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 14,
            "name": "V_INVEST_DEC_COUNT",
            "type": "string",
            "display": "PENDING INVEST_DEC_COUNT",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "169628.RS",
      "name": "Ref and Invest Open",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375850/DP1d_NEW",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (DEC_OUTCOME_DESCRIPTION IS NULL AND (CDR_OUTCOME_DESCRIPTION = 'Progress to Investigation' OR V_REFERRAL_CONT_COMPLETE_ = 'No' OR CDR_OUTCOME_DESCRIPTION IS NULL)))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:CSIP_ID",
            "display": "RFR CSIP ID",
            "formula": "",
            "visible": "false",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO65c"
          },
          {
            "name": "$ref:AGY_LOC_ID",
            "display": "CSIP Estab",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO6c4"
          },
          {
            "name": "$ref:CSIP_SEQ",
            "display": "CSIP Log #",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO65d"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10045"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10046"
          },
          {
            "name": "$ref:V_LOCATION",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Unit Description 4 Short]"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10a15"
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO10088"
          },
          {
            "name": "$ref:V_ACTIVE_ACCT_DISPLAY",
            "display": "ACCT Open?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([v_Active_ACCT] = 1;\"Y\";\"N\" )"
          },
          {
            "name": "$ref:RFR_PROACTIVE_RESPONSE",
            "display": "RFR Proactive Referral (Prevention)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO666"
          },
          {
            "name": "$ref:RFR_STAFF_ASSAULTED",
            "display": "RFR Staff Assaulted",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO667"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "RFR Incident Type Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO679"
          },
          {
            "name": "$ref:RFR_AREA_OF_WORK_DESCRIPTION",
            "display": "RFR Area of Work Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO67b"
          },
          {
            "name": "$ref:V_MAX_CONCAT_FACTORS_CODE",
            "display": "Cont. Factor(s)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[v_concat_factors] Where ([v_Factors]= [v_max_factors]) "
          },
          {
            "name": "$ref:RFR_DATE_REPORTED",
            "display": "Date Referred",
            "formula": "format_date(${RFR_DATE_REPORTED}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": true,
            "legacyId": "DP1d.DO664"
          },
          {
            "name": "$ref:V_REFERRAL_CONT_COMPLETE_",
            "display": "Referral Cont. Complete?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([RFR Completed By]);\"No\";\"Yes\")"
          },
          {
            "name": "$ref:CDR_OUTCOME_DATE",
            "display": "CDR Outcome Date",
            "formula": "format_date(${CDR_OUTCOME_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO66b"
          },
          {
            "name": "$ref:CDR_OUTCOME_DESCRIPTION",
            "display": "CDR Outcome Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO680"
          },
          {
            "name": "$ref:V_INVEST_INFO_GATHERING",
            "display": "Invest Info Gathering",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([v_is_null_Occurrence_reason] = 0; \"No\"; \"Yes\")"
          },
          {
            "name": "$ref:INV_OUTCOME_DATE",
            "display": "DEC Outcome Date",
            "formula": "format_date(${INV_OUTCOME_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO68d"
          },
          {
            "name": "$ref:DEC_OUTCOME_DESCRIPTION",
            "display": "DEC Outcome Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO697"
          },
          {
            "name": "$ref:V_LENGTH_OF_TIME_OPEN",
            "display": "No. of days Ref Open",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=DaysBetween([CSIP Referrals].[RFR Date Referred];CurrentDate())"
          }
        ]
      }
    },
    {
      "id": "169685.RS",
      "name": "Ref and Invest Closed",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375850/DP1d_NEW",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (DEC_OUTCOME_DESCRIPTION IS NOT NULL OR (CDR_OUTCOME_DESCRIPTION IN ('Progress to CSIP','No Further Action','Support to be provided outside of CSIP'))))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:CSIP_ID",
            "display": "RFR CSIP ID",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO65c"
          },
          {
            "name": "$ref:AGY_LOC_ID",
            "display": "CSIP Agy Loc Id",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO6c4"
          },
          {
            "name": "$ref:CSIP_SEQ",
            "display": "CSIP Log #",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO65d"
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP26.DO10044"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10045"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10046"
          },
          {
            "name": "$ref:V_LOCATION",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Unit Description 4 Short]"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age in Years",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10a15"
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO10088"
          },
          {
            "name": "$ref:RFR_PROACTIVE_RESPONSE",
            "display": "RFR Proactive Referral (Prevention)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO666"
          },
          {
            "name": "$ref:RFR_STAFF_ASSAULTED",
            "display": "RFR Staff Assaulted",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO667"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "RFR Incident Type Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO679"
          },
          {
            "name": "$ref:RFR_AREA_OF_WORK_DESCRIPTION",
            "display": "RFR Area of Work Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO67b"
          },
          {
            "name": "$ref:V_MAX_CONCAT_FACTORS_CODE",
            "display": "Cont. Factor(s)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[v_concat_factors] Where ([v_Factors]= [v_max_factors]) "
          },
          {
            "name": "$ref:RFR_DATE_REPORTED",
            "display": "Date Referred",
            "formula": "format_date(${RFR_DATE_REPORTED}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": true,
            "legacyId": "DP1d.DO664"
          },
          {
            "name": "$ref:CDR_OUTCOME_DATE",
            "display": "CDR Outcome Date",
            "formula": "format_date(${CDR_OUTCOME_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO66b"
          },
          {
            "name": "$ref:CDR_OUTCOME_DESCRIPTION",
            "display": "CDR Outcome Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO680"
          },
          {
            "name": "$ref:V_INVEST_INFO_GATHERING",
            "display": "Invest Info Gathering",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([v_is_null_Occurrence_reason] = 0; \"No\"; \"Yes\")"
          },
          {
            "name": "$ref:V_INVEST_DEC_DATE",
            "display": "Investigation Dec. Date",
            "formula": "format_date(${V_INVEST_DEC_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([CSIP Referrals].[CDR Outcome Description] = \"Progress to Investigation\" And ([v_is_null_Occurrence_reason] =1); [DEC Outcome Date];If([CDR Outcome Description] InList(\"No Further Action\"; \"Support to be provided outside of CSIP\");\"N/A\";[DEC Outcome Date]))"
          },
          {
            "name": "$ref:V_INVEST_DEC_OUTCOME",
            "display": "Decision Outcome",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([CSIP Referrals].[CDR Outcome Description] = \"Progress to Investigation\" And ([v_is_null_Occurrence_reason] =1); [DEC Outcome Description];If([CDR Outcome Description] InList(\"No Further Action\"; \"Support to be provided outside of CSIP\");\"N/A\";[DEC Outcome Description]))"
          },
          {
            "name": "$ref:V_PLAN_CREATED_",
            "display": "Plan Created?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If(IsNull([CSIP Referrals].[PLN Create Date]); \"No\";\"Yes\")"
          },
          {
            "name": "$ref:V_DAYS_BETWEEN_SCREEN_DATE",
            "display": "Days between Screen and Dec",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([v_Invest_Dec.Outcome_Description] = \"N/A\"; \"N/A\"; If(IsNull([v_No._of_days_from_ cons_date_to_Decision_date]); 0;[v_No._of_days_from_ cons_date_to_Decision_date]))"
          }
        ]
      }
    },
    {
      "id": "175473.RS",
      "name": "All Open Supp and Interven Plans",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375850/21_NEW",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE V_OPEN_INTERVEN_REVIEW = 1 OR (V_OPEN_INTERVEN_REVIEW = 1 AND NEXT_REVIEW_DATE IS NULL))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:CSIP_ID",
            "display": "RFR CSIP ID",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO65c"
          },
          {
            "name": "$ref:AGY_LOC_ID",
            "display": "CSIP Agy Loc Id",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO6c4"
          },
          {
            "name": "$ref:CSIP_SEQ",
            "display": "CSIP Log #",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO65d"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true,
            "legacyId": "DP21.DO10045"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP21.DO10046"
          },
          {
            "name": "$ref:V_LOCATION",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Unit Description 4 Short]"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age in Years",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO10a15"
          },
          {
            "name": "$ref:V_ACTIVE_ACCT_DISPLAY",
            "display": "ACCT Open?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([v_Active_ACCT] = 1;\"Y\";\"N\" )"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "RFR Incident Type Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO679"
          },
          {
            "name": "$ref:RFR_DATE_REPORTED",
            "display": "RFR Date Referred",
            "formula": "format_date(${RFR_DATE_REPORTED}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP21.DO664"
          },
          {
            "name": "$ref:CDR_OUTCOME_DATE",
            "display": "CDR Outcome Date",
            "formula": "format_date(${CDR_OUTCOME_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO66b"
          },
          {
            "name": "$ref:INV_OUTCOME_DATE",
            "display": "DEC Outcome Date",
            "formula": "format_date(${INV_OUTCOME_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO68d"
          },
          {
            "name": "$ref:REASON",
            "display": "PLN Reason",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO69a"
          },
          {
            "name": "$ref:CASE_MANAGER",
            "display": "PLN Case Manager",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO699"
          },
          {
            "name": "$ref:CASE_REV_DATE",
            "display": "First Case Rev. Date",
            "formula": "format_date(${CASE_REV_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO68d"
          },
          {
            "name": "$ref:MIN_PLAN_TARGET_DATE_ALL",
            "display": "Min Plan Target Date",
            "formula": "format_date(${MIN_PLAN_TARGET_DATE_ALL}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Min([Open Supp and Interven].[PLN Target Date]) In ([Open Supp and Interven].[RFR CSIP ID])"
          },
          {
            "name": "$ref:MAX_PLAN_TARGET_DATE_ALL",
            "display": "Max Plan Target Date",
            "formula": "format_date(${MAX_PLAN_TARGET_DATE_ALL}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Max([Open Supp and Interven].[PLN Target Date]) In ([Open Supp and Interven].[RFR CSIP ID])"
          },
          {
            "name": "$ref:NEXT_REVIEW_DATE",
            "display": "REV Next Review Date",
            "formula": "format_date(${NEXT_REVIEW_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO6a4"
          },
          {
            "name": "$ref:REVIEW_SEQ",
            "display": "REV Review Seq",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO6a6"
          },
          {
            "name": "$ref:V_LENGTH_OF_TIME_PLAN_OPEN",
            "display": "Number of days Plan open",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=DaysBetween([min_plan_create_date];CurrentDate()) In ([Open Supp and Interven].[RFR CSIP ID])"
          },
          {
            "name": "$ref:V_OPEN_INTERVEN_REVIEW",
            "display": "V_OPEN_INTERVEN_REVIEW",
            "formula": "",
            "visible": "false",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO6a6"
          }
        ]
      }
    },
    {
      "id": "173037.RS",
      "name": "Closed Supp and Interven Plans",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375850/21_CLOSED",
      "filter": {
        "name": "prefilter_",
        "query": "prefilter_ AS (SELECT * FROM dataset_ WHERE (CDR_OUTCOME_DESCRIPTION = 'Progress to CSIP' OR DEC_OUTCOME_DESCRIPTION = 'Progress to CSIP') AND (CLOSE_DATE IS NOT NULL AND CLOSED_DATE IS NOT NULL ))"
      },
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:CSIP_ID",
            "display": "RFR CSIP ID",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO65c"
          },
          {
            "name": "$ref:AGY_LOC_ID",
            "display": "CSIP Agy Loc Id",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO6c4"
          },
          {
            "name": "$ref:CSIP_SEQ",
            "display": "CSIP Log #",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO65d"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO10045"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO10046"
          },
          {
            "name": "$ref:V_LOCATION",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Unit Description 4 Short]"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age in Years",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10a15"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "RFR Incident Type Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO679"
          },
          {
            "name": "$ref:RFR_DATE_REPORTED",
            "display": "Date Referred",
            "formula": "format_date(${RFR_DATE_REPORTED}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": true,
            "legacyId": "DP1d.DO664"
          },
          {
            "name": "$ref:INV_OUTCOME_DATE",
            "display": "DEC Outcome Date",
            "formula": "format_date(${INV_OUTCOME_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO68d"
          },
          {
            "name": "$ref:MIN_PLAN_CREATE_DATE",
            "display": "Min Plan Create Date",
            "formula": "format_date(${MIN_PLAN_CREATE_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=Min([PLN Create Date]) In ([RFR CSIP ID])"
          },
          {
            "name": "$ref:REASON",
            "display": "PLN Reason",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO69a"
          },
          {
            "name": "$ref:CASE_MANAGER",
            "display": "PLN Case Manager",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO699"
          },
          {
            "name": "$ref:CLOSE_DATE",
            "display": "REV Close Date",
            "formula": "format_date(${CLOSE_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO6ad"
          },
          {
            "name": "$ref:REVIEW_SEQ",
            "display": "REV Review Seq",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP21.DO6a6"
          },
          {
            "name": "$ref:V_LENGTH_OF_TIME_PLAN_OPEN",
            "display": "Number of days Plan open",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=DaysBetween([min_plan_create_date];[Open Supp and Interven].[REV Close Date]) In ([Open Supp and Interven].[RFR CSIP ID])"
          }
        ]
      }
    },
    {
      "id": "166802.RS",
      "name": "All Referrals by Date",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375850/DP1d_NEW",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:CSIP_ID",
            "display": "RFR CSIP ID",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO65c"
          },
          {
            "name": "$ref:AGY_LOC_ID",
            "display": "CSIP Agy Loc Id",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO6c4"
          },
          {
            "name": "$ref:CSIP_SEQ",
            "display": "CSIP Log #",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO65d"
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10045"
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10046"
          },
          {
            "name": "$ref:V_LOCATION",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[Unit Description 4 Short]"
          },
          {
            "name": "$ref:AGE_IN_YEARS",
            "display": "Age in Years",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO10a15"
          },
          {
            "name": "$ref:ETHNIC_CODE",
            "display": "Ethnic Code",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO10088"
          },
          {
            "name": "$ref:V_ACTIVE_ACCT_DISPLAY",
            "display": "ACCT Open?",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=If([v_Active_ACCT] = 1;\"Y\";\"N\" )"
          },
          {
            "name": "$ref:RFR_PROACTIVE_RESPONSE",
            "display": "RFR Proactive Referral (Prevention)",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO666"
          },
          {
            "name": "$ref:RFR_STAFF_ASSAULTED",
            "display": "RFR Staff Assaulted",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO667"
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "RFR Incident Type Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO679"
          },
          {
            "name": "$ref:RFR_AREA_OF_WORK_DESCRIPTION",
            "display": "RFR Area of Work Description",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false,
            "legacyId": "DP1d.DO67b"
          },
          {
            "name": "$ref:V_MAX_CONCAT_FACTORS_CODE",
            "display": "Cont. Factor(s)",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacySql": "=[v_concat_factors] Where ([v_Factors]= [v_max_factors]) "
          },
          {
            "name": "$ref:RFR_DATE_REPORTED",
            "display": "Date Referred",
            "formula": "format_date(${RFR_DATE_REPORTED}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": true,
            "legacyId": "DP1d.DO664"
          },
          {
            "name": "$ref:CDR_OUTCOME_DATE",
            "display": "CDR Outcome Date",
            "formula": "format_date(${CDR_OUTCOME_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO66b"
          },
          {
            "name": "$ref:CDR_OUTCOME_DESCRIPTION",
            "display": "CDR Outcome Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO680"
          },
          {
            "name": "$ref:INV_OUTCOME_DATE",
            "display": "DEC Outcome Date",
            "formula": "format_date(${INV_OUTCOME_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO68d"
          },
          {
            "name": "$ref:DEC_OUTCOME_DESCRIPTION",
            "display": "DEC Outcome Description",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": "DP1d.DO697"
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_LENGTH_OF_TIME_PLAN_OPEN :: Error: =DaysBetween([min_plan_create_date];[Open Supp and Interven].[REV Close Date]) In ([Open Supp and Interven].[RFR CSIP ID]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:80",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : V_INVEST_DEC_DATE :: Error: argument 'sql': 'NoneType' object cannot be converted to 'PyString'",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : V_INVEST_DEC_OUTCOME_DESCRIP32 :: Error: argument 'sql': 'NoneType' object cannot be converted to 'PyString'",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : MIN_PLAN_CREATE_DATE :: Error: Invalid expression / Unexpected token. Line 1, Col: 21.\n  MIN(CREATE_DATE) IN \u001b[4m,\u001b[0mCSIP_ID,",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_LENGTH_OF_TIME_PLAN_OPEN :: Error: =DaysBetween([min_plan_create_date];[Open Supp and Interven].[REV Close Date]) In ([Open Supp and Interven].[RFR CSIP ID]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:80",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_LENGTH_OF_TIME_PLAN_OPEN_O45 :: Error: =DaysBetween([min_plan_create_date];CurrentDate()) In ([Open Supp and Interven].[RFR CSIP ID]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:52",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_LENGTH_OF_TIME_PLAN_OPEN :: Error: =DaysBetween([min_plan_create_date];[Open Supp and Interven].[REV Close Date]) In ([Open Supp and Interven].[RFR CSIP ID]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:80",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : MIN_PLAN_TARGET_DATE_ALL :: Error: Invalid expression / Unexpected token. Line 1, Col: 44.\n  MIN(OPEN_SUPP_AND_INTERVEN.TARGET_DATE) IN \u001b[4m,\u001b[0mOPEN_SUPP_AND_INTERVEN.CSIP_ID,",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : MAX_PLAN_TARGET_DATE_ALL :: Error: Invalid expression / Unexpected token. Line 1, Col: 44.\n  MAX(OPEN_SUPP_AND_INTERVEN.TARGET_DATE) IN \u001b[4m,\u001b[0mOPEN_SUPP_AND_INTERVEN.CSIP_ID,",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_LENGTH_OF_TIME_PLAN_OPEN_O45 :: Error: =DaysBetween([min_plan_create_date];CurrentDate()) In ([Open Supp and Interven].[RFR CSIP ID]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:52",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : MIN_PLAN_CREATE_DATE :: Error: Invalid expression / Unexpected token. Line 1, Col: 21.\n  MIN(CREATE_DATE) IN \u001b[4m,\u001b[0mCSIP_ID,",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_LENGTH_OF_TIME_PLAN_OPEN :: Error: =DaysBetween([min_plan_create_date];[Open Supp and Interven].[REV Close Date]) In ([Open Supp and Interven].[RFR CSIP ID]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:80",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::resolveCTEs parse error for : $ref:V_COUNT_PREV_INVESTIGATIONS :: Error: =Count([CSIP Count].[RFR CSIP ID]) Where ([CSIP Count].[CDR Outcome Description] = \"Progress to Investigation\" ) In ([NOMS Number]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:114",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : V_COUNT_CSIP_ID :: Error: Invalid expression / Unexpected token. Line 1, Col: 30.\n  COUNT(CSIP_COUNT.CSIP_ID) IN \u001b[4m,\u001b[0mCSIP_COUNT.OFFENDER_ID_DISPLAY,",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations parse error for : $ref:V_COUNT_PREV_INVESTIGATIONS :: Error: =Count([CSIP Count].[RFR CSIP ID]) Where ([CSIP Count].[CDR Outcome Description] = \"Progress to Investigation\" ) In ([NOMS Number]) ==> Error: Expected end of input but \"I\" found.\n at undefined:1:114",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "enhanced",
      "error": "dataset::injectCalculations unable to append column : V_COUNT_PREV_PLANS_V2 :: Error: Invalid expression / Unexpected token. Line 1, Col: 47.\n  COUNT(V_MAX_PLAN_ID_IN_CSIP_ID_COUNT_CSIP) IN \u001b[4m,\u001b[0mOFFENDER_ID_DISPLAY,",
      "entityId": "FgBBilwnsg4AzT4AAHB7YF8YACJIAAzC",
      "entityType": "dpd"
    },
    {
      "type": "schema",
      "error": "Report field V_INVEST_DEC_DATE does not have corresponding dataset schema field",
      "entityId": "169685.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_INVEST_DEC_OUTCOME_DESCRIP32 does not have corresponding dataset schema field",
      "entityId": "169685.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field MIN_PLAN_TARGET_DATE_ALL does not have corresponding dataset schema field",
      "entityId": "175473.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field MAX_PLAN_TARGET_DATE_ALL does not have corresponding dataset schema field",
      "entityId": "175473.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field MIN_PLAN_CREATE_DATE does not have corresponding dataset schema field",
      "entityId": "173037.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_COUNT_CSIP_ID does not have corresponding dataset schema field",
      "entityId": "177297.RS",
      "entityType": "variant"
    },
    {
      "type": "schema",
      "error": "Report field V_COUNT_PREV_PLANS_V2 does not have corresponding dataset schema field",
      "entityId": "177297.RS",
      "entityType": "variant"
    },
    {
      "type": "sqlQuery",
      "error": "Error: ORA-00920: invalid relational operator\nHelp: https://docs.oracle.com/error-help/db/ora-00920/",
      "entityId": "3375850/DP1d",
      "entityType": "dataset"
    },
    {
      "type": "sqlQuery",
      "error": "Error: ORA-00920: invalid relational operator\nHelp: https://docs.oracle.com/error-help/db/ora-00920/",
      "entityId": "3375850/DP21",
      "entityType": "dataset"
    },
    {
      "type": "sqlQuery",
      "error": "Error: ORA-00920: invalid relational operator\nHelp: https://docs.oracle.com/error-help/db/ora-00920/",
      "entityId": "3375850/DP26",
      "entityType": "dataset"
    }
  ]
}