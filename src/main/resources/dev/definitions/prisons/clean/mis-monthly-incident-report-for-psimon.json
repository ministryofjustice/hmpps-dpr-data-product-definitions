{
  "id": "okgjK.YACcHaRqkAaACEcEP6YRI",
  "name": "MIS Monthly Incident Report for PSIMON",
  "description": "This report provides a count of selected incidents by type which have occurred at establishments between the first of the month (derived from the date entered by the user) and up to 12 months later.<br/>INC0008 - v00.00.03 Last Modified: 09/12/08",
  "metadata": {
    "version": "1.0.0",
    "tags": [
      "INC0008 v00.00.03 drop9.1_9.2"
    ]
  },
  "datasource": [
    {
      "id": "bodmis",
      "name": "BODMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "bodmis"
    }
  ],
  "dataset": [
    {
      "id": "3375377/DP3",
      "name": "Incidents",
      "description": "MIS Incidents",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT DISTINCT INITCAP(AT_INCIDENT_TYPE.INCIDENT_TYPE_DESC) AS INCIDENT_TYPE, TO_DATE('01/' || TO_CHAR(AT_INCIDENT_DATE.DAY_DATE, 'MM/YYYY'), 'DD/MM/YYYY') AS 1ST_OF_THE_MONTH, AT_INCIDENT_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION AS ESTABLISHMENT_DESCRIPTION, COUNT(DISTINCT (AT_INCIDENT.INCIDENT_CASE_ID)) AS NUMBER_OF_INCIDENTS FROM BODIMIS.FACT_INCIDENT_QUESTIONNAIRE AT_INCIDENT_QUESTIONNAIRE, BODIMIS.FACT_INCIDENT AT_INCIDENT, BODIMIS.DIM_ESTABLISHMENT AT_INCIDENT_ESTABLISHMENT, BODIMIS.DIM_INCIDENT_TYPE AT_INCIDENT_TYPE, BODIMIS.DIM_DATE AT_INCIDENT_DATE, BODIMIS.DIM_INCIDENT_ANSWER AT_INCIDENT_ANSWER, BODIMIS.DIM_INCIDENT_QUESTION AT_INCIDENT_QUESTION WHERE (AT_INCIDENT_ESTABLISHMENT.ESTABLISHMENT_SK = AT_INCIDENT.ESTABLISHMENT_SK) AND (AT_INCIDENT_DATE.DATE_SK = AT_INCIDENT.INCIDENT_DATE_SK) AND (AT_INCIDENT_QUESTIONNAIRE.INCIDENT_CASE_ID = AT_INCIDENT.INCIDENT_CASE_ID) AND (AT_INCIDENT_ANSWER.INCIDENT_QUESTION_SK = AT_INCIDENT_QUESTION.INCIDENT_QUESTION_SK) AND (AT_INCIDENT_QUESTIONNAIRE.INCIDENT_ANSWER_SK = AT_INCIDENT_ANSWER.INCIDENT_ANSWER_SK) AND (AT_INCIDENT_QUESTION.QUESTIONNAIRE_ID = AT_INCIDENT_TYPE.QUESTIONNAIRE_ID) AND ((AT_INCIDENT_DATE.DAY_DATE >= TO_DATE('01/' || TO_CHAR(ADD_MONTHS(TO_DATE('01-12-2008 00:00:00', 'DD-MM-YYYY HH24:MI:SS'), 0), 'MM/YYYY'), 'DD/MM/YYYY') AND AT_INCIDENT_DATE.DAY_DATE <= LAST_DAY(ADD_MONTHS(CURRENT_TIMESTAMP, -1)) AND AT_INCIDENT_DATE.DAY_DATE <= LAST_DAY(ADD_MONTHS(TO_DATE('01-12-2008 00:00:00', 'DD-MM-YYYY HH24:MI:SS'), 11))) AND AT_INCIDENT_TYPE.INCIDENT_TYPE_CODE_NK IN ('ABSCOND', 'ASSAULT', 'ATT_ESC_E', 'ATT_ESCAPE', 'SELF_HARM', 'DRUGS', 'TRF', 'CON_INDISC')) GROUP BY INITCAP(AT_INCIDENT_TYPE.INCIDENT_TYPE_DESC), TO_DATE('01/' || TO_CHAR(AT_INCIDENT_DATE.DAY_DATE, 'MM/YYYY'), 'DD/MM/YYYY'), AT_INCIDENT_ESTABLISHMENT.ESTABLISHMENT_DESCRIPTION), dataset_ AS (SELECT FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": []
      }
    },
    {
      "id": "3375377/DP5",
      "name": "Incident Types",
      "description": "MIS Incidents",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT INITCAP(AT_INCIDENT_TYPE.INCIDENT_TYPE_DESC) AS INCIDENT_TYPE FROM BODIMIS.DIM_INCIDENT_TYPE AT_INCIDENT_TYPE WHERE AT_INCIDENT_TYPE.INCIDENT_TYPE_CODE_NK IN ('ABSCOND', 'ASSAULT', 'ATT_ESC_E', 'ATT_ESCAPE', 'SELF_HARM', 'DRUGS', 'TRF', 'CON_INDISC')), dataset_ AS (SELECT INCIDENT_TYPE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "INCIDENT_TYPE",
            "type": "string",
            "display": "Incident Type",
            "legacyId": "DP5.DO9",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3375377/DP4",
      "name": "MIS Load",
      "description": "MIS Incidents",
      "datasource": "bodmis",
      "query": "dataset_base_ AS (SELECT TRUNC(BODIMIS.ETL_LOAD_LOG.LOAD_END_DATETIME) AS LOAD_END_DATE FROM BODIMIS.ETL_LOAD_LOG WHERE (BODIMIS.ETL_LOAD_LOG.LOAD_ID = (SELECT MAX(LOAD_ID) FROM BODIMIS.ETL_LOAD_LOG WHERE NOT LOAD_END_DATETIME IS NULL))), dataset_ AS (SELECT LOAD_END_DATE FROM dataset_base_)",
      "parameters": [],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "LOAD_END_DATE",
            "type": "date",
            "display": "Load End Date",
            "legacyId": "DP4.DO104dd",
            "legacySqlClass": "column"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": [
                "${role}",
                "ROLE_PRISONS_REPORTING_USER"
              ]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "117079.RS",
      "name": "Monthly Incident Report",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3375377/DP3",
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "crosstab",
        "field": [
          {
            "name": "$ref:DP3_DOC9",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DOC9",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DOCB",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DO20",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          },
          {
            "name": "$ref:DP3_DOC9",
            "display": "",
            "formula": "",
            "visible": "true",
            "sortable": false,
            "defaultsort": false,
            "legacyId": ""
          }
        ]
      }
    }
  ],
  "errors": []
}