{
  "id": "FgOVB12wiAIA4WsAAHAbaV8RACJIABRd",
  "name": "ORS Admissions",
  "description": "A list of active prisoners on a prison roll who were admitted between the dates specified. The data is presented over 3 tabs: by admission time order (most recent first), by cell, by prisoner surname and Simple View MOV0031 - v2 Last Modified: 07/08/23",
  "metadata": {
    "version": "1.0.0",
    "tags": ["MOV0031  v2 DPR"]
  },
  "datasource": [
    {
      "id": "nomis",
      "name": "NOMIS",
      "database": "DIGITAL_PRISON_REPORTING",
      "catalog": "nomis"
    }
  ],
  "dataset": [
    {
      "id": "3376286/DP3",
      "name": "Admissions",
      "description": "OR - Sentence",
      "datasource": "nomis",
      "query": "DPF_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFNCS_DEMG_NO_OFF.DESCRIPTION AS DESCRIPTION FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_MOV_TYPE_DESC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_MOV_LOC_TO_OFFND_LOCTION, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENCES AT_OFFNCS_DEMG_NO_OFF, USER_ACCESSIBLE_CASELOADS, OMS_OWNER.OFFENDER_CASES AT_OFFENDER_CASES, OMS_OWNER.OFFENDER_CHARGES AT_OFF_CHARGS_DEMG_NO_OFF WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_CASES.OFFENDER_BOOK_ID (+) ) AND ( AT_MOV_TYPE_DESC.CODE (+) = AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE ) AND (AT_MOV_TYPE_DESC.DOMAIN (+) = ('MOVE_TYPE')) AND ( AT_OFFENDER_EXTERNAL_MOVEMENTS.TO_AGY_LOC_ID = AT_MOV_LOC_TO_OFFND_LOCTION.AGY_LOC_ID (+) ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFF_CHARGS_DEMG_NO_OFF.OFFENDER_BOOK_ID (+) ) AND ( AT_OFF_CHARGS_DEMG_NO_OFF.CHARGE_STATUS = ('A') OR AT_OFF_CHARGS_DEMG_NO_OFF.CHARGE_STATUS IS NULL ) AND ( AT_OFF_CHARGS_DEMG_NO_OFF.STATUTE_CODE = AT_OFFNCS_DEMG_NO_OFF.STATUTE_CODE AND AT_OFF_CHARGS_DEMG_NO_OFF.OFFENCE_CODE = AT_OFFNCS_DEMG_NO_OFF.OFFENCE_CODE ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_MOV_LOC_TO_OFFND_LOCTION.AGENCY_LOCATION_TYPE = 'INST' ) AND ( (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #prompt('Establishment Code','A','Establishment/Establishment Code',Mono,Free,Not_Persistent,,User:0) */ ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND AT_OFFENDER_CASES.CASE_STATUS = 'A' AND AT_OFF_CHARGS_DEMG_NO_OFF.MOST_SERIOUS_FLAG = 'Y' AND AT_MOV_LOC_TO_OFFND_LOCTION.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #prompt('Establishment Code','A','External Movements/Movement To Establishment Code',Mono,Free,Not_Persistent,,User:0) */ ) AND AT_MOV_TYPE_DESC.DESCRIPTION = 'Admission' AND TRUNC(AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE) >= ( SELECT START_DATE FROM prompt_ /* = #prompt('Admission Start Date','D',,Mono,Free,Not_Persistent,,User:1) */ ) AND TRUNC(AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE) <= ( SELECT END_DATE FROM prompt_ /* = #prompt('Admission End Date','D',,Mono,Free,Not_Persistent,,User:2) */ ) AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE = 'IN' AND AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_REASON_CODE <> 'R' ) ), MAIN_OFFENCES_ AS ( SELECT OFFENDER_ID_DISPLAY, DESCRIPTION AS MAIN_OFFENCE FROM DPF_ ), DP10_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, COALESCE( AT_OFFENDER_SENT_CALCULATIONS.HDCED_OVERRIDED_DATE, AT_OFFENDER_SENT_CALCULATIONS.HDCED_CALCULATED_DATE ) AS HDCED_DATE, CASE WHEN NOT AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE WHEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN DT_LAST_RELEASE_DATE.LAST_REL_DATE ELSE NULL END AS CURRENT_RELEASE_DATE, CASE WHEN DT_OFFENDER_LIFE_FLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE AT_OFFENDER_SENT_CALCULATIONS.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_MOV_TYPE_DESC, OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_MOV_LOC_TO_OFFND_LOCTION, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_RELEASE_DETAILS AT_OFFENDER_RELEASE_DETAILS, ( SELECT AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID, CASE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE /* when AT_OFFENDER_SENT_CALCULATIONS.ETD_OVERRIDED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.ETD_OVERRIDED_DATE when AT_OFFENDER_SENT_CALCULATIONS.ETD_CALCULATED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.ETD_CALCULATED_DATE when AT_OFFENDER_SENT_CALCULATIONS.LTD_OVERRIDED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.LTD_OVERRIDED_DATE when AT_OFFENDER_SENT_CALCULATIONS.LTD_CALCULATED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.LTD_CALCULATED_DATE */ ELSE NULL END AS Last_Rel_Date, EFFECTIVE_SENTENCE_LENGTH FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = ( SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID ) ) DT_LAST_RELEASE_DATE, ( SELECT DISTINCT OFFENDER_SENTENCE_TERMS.OFFENDER_BOOK_ID, OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG FROM OFFENDER_SENTENCE_TERMS WHERE OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y' ) DT_OFFENDER_LIFE_FLAG, USER_ACCESSIBLE_CASELOADS WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID (+) ) AND ( AT_MOV_TYPE_DESC.CODE (+) = AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE ) AND (AT_MOV_TYPE_DESC.DOMAIN (+) = ('MOVE_TYPE')) AND ( AT_OFFENDER_EXTERNAL_MOVEMENTS.TO_AGY_LOC_ID = AT_MOV_LOC_TO_OFFND_LOCTION.AGY_LOC_ID (+) ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_RELEASE_DETAILS.OFFENDER_BOOK_ID (+) ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_LAST_RELEASE_DATE.OFFENDER_BOOK_ID (+) ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( DT_OFFENDER_LIFE_FLAG.OFFENDER_BOOK_ID (+) = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID ) AND ( AT_MOV_LOC_TO_OFFND_LOCTION.AGENCY_LOCATION_TYPE = 'INST' ) AND ( ( AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = ( SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID ) ) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #prompt('Establishment Code','A','Establishment/Establishment Code',Mono,Free,Not_Persistent,,User:0) */ ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND AT_MOV_LOC_TO_OFFND_LOCTION.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #prompt('Establishment Code','A','External Movements/Movement To Establishment Code',Mono,Free,Not_Persistent,,User:0) */ ) AND AT_MOV_TYPE_DESC.DESCRIPTION = 'Admission' AND TRUNC(AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE) >= ( SELECT START_DATE FROM prompt_ /* = #prompt('Admission Start Date','D',,Mono,Free,Not_Persistent,,User:1) */ ) AND TRUNC(AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE) <= ( SELECT END_DATE FROM prompt_ /* = #prompt('Admission End Date','D',,Mono,Free,Not_Persistent,,User:2) */ ) AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE = 'IN' AND AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_REASON_CODE <> 'R' ) ), RELEASE_ AS ( SELECT DISTINCT OFFENDER_ID_DISPLAY, HDCED_DATE, CURRENT_RELEASE_DATE, EFFECTIVE_SENTENCE_LENGTH, CURRENT_RELEASE_DATE AS V_CURRENT_RELEASE_DATE, EFFECTIVE_SENTENCE_LENGTH AS V_EFFECTIVE_SENTENCE_LENGTH, HDCED_DATE AS V_HDCED FROM DP10_ ), dataset_base_ AS ( SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFENDER_BOOKING.BOOKING_NO AS BOOKING_NO, AT_OFFENDER.FIRST_NAME AS FIRST_NAME, AT_OFFENDER.LAST_NAME AS LAST_NAME, AT_OFFENDER.BIRTH_DATE AS BIRTH_DATE, SUBSTR( AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID) + 2, LENGTH(AT_AGENCY_INTERNAL_LOCATION_L4.DESCRIPTION) ) AS UNIT_DESCRIPTION_4_SHORT, AT_HEADER_BLOCK.STATUS_2 AS STATUS_2, CASE WHEN AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS IN ( '14FTR_ORA', '14FTRHDC_ORA', 'CUR_ORA', 'FTR/08', 'FTR_HDC', 'FTR_HDC_ORA', 'FTR_ORA', 'FTR_SCH15', 'FTRSCH15_ORA', 'HDR_ORA', 'LR', 'LR_ALP', 'LR_ALP_LASPO', 'LR_DLP', 'LR_DPP', 'LR_EPP', 'LR_ES', 'LR_HDC', 'LR_IPP', 'LR_LASPO_AR', 'LR_LASPO_DR', 'LR_LIFE', 'LR_MLP', 'LR_ORA', 'LR_SEC236A', 'LR_SEC91_ORA', 'LR_YOI', 'LR_YOI_ORA', 'FTRSCH18_ORA', 'FTRSCH18', 'LR_ALP_CDE18', 'LR_ALP_CDE21', 'LR_EDS18', 'LR_EDS21', 'LR_SOPC18', 'LR_SOPC21', 'LRSEC250_ORA', 'LR_EDSU18' ) THEN 'Recall' WHEN AT_IMPRISON_STATUSES.BAND_CODE = '0' THEN 'Dead' WHEN AT_IMPRISON_STATUSES.BAND_CODE = '1' THEN 'Indeterminate Sentence' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('2', '3') THEN 'Sentenced' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('4', '5', '6', '7') THEN 'Convicted Unsentenced' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('9', '10') OR AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS = 'CIV_RMD' THEN 'Civil Prisoners' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('8', '11') THEN 'Immigration Detainees' WHEN AT_IMPRISON_STATUSES.BAND_CODE IN ('12', '13', '14') THEN 'Remand' WHEN AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS = 'UNKNOWN' THEN 'Unknown' ELSE 'Other' END AS LEGAL_STATUS_GROUPING, AT_RELIGION.DESCRIPTION AS DESCRIPTION, AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TIME AS MOVEMENT_TIME, AT_MOVEMENT_REASONS.DESCRIPTION AS MOVEMENT_REASON_DESCRIPTION, COALESCE( AT_EXT_MOV_FROM_AGY.DESCRIPTION, AT_FROM_CITY_CODES.DESCRIPTION, AT_FROM_ADDRESS_ATTENDED.STREET || ' ' || AT_FROM_ADDRESS_ATTENDED.LOCALITY || ' ' || AT_FROM_ADDRESS_ATTENDED.POSTAL_CODE ) AS FROM_, AT_OFFENDER_PNC.IDENTIFIER AS IDENTIFIER, MAIN_OFFENCES_.MAIN_OFFENCE AS MAIN_OFFENCE, RELEASE_.V_CURRENT_RELEASE_DATE, RELEASE_.V_EFFECTIVE_SENTENCE_LENGTH, RELEASE_.V_HDCED FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.AGENCY_INTERNAL_LOCATIONS AT_AGENCY_INTERNAL_LOCATION_L4, OMS_OWNER.REFERENCE_CODES AT_FROM_CITY_CODES, OMS_OWNER.REFERENCE_CODES AT_MOV_TYPE_DESC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_EXT_MOV_FROM_AGY, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_MOV_LOC_TO_OFFND_LOCTION, OMS_OWNER.AGENCY_LOCATIONS AT_WING_ESTABLISHMENT, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS, OMS_OWNER.OFFENDER_PROFILE_DETAILS AT_OFFENDER_RELIGION, OMS_OWNER.MOVEMENT_REASONS AT_MOVEMENT_REASONS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.IMPRISONMENT_STATUSES AT_IMPRISON_STATUSES, OMS_OWNER.V_HEADER_BLOCK AT_HEADER_BLOCK, USER_ACCESSIBLE_CASELOADS WING_CASELOAD_SECURITY, OMS_OWNER.PROFILE_CODES AT_RELIGION, ADDRESSES AT_FROM_ADDRESS_ATTENDED, OMS_OWNER.OFFENDER_IDENTIFIERS AT_OFFENDER_PNC, USER_ACCESSIBLE_CASELOADS, OMS_OWNER.OFFENDER_IMPRISON_STATUSES AT_OFFENDER_IMPRISON_STATUSES, MAIN_OFFENCES_, RELEASE_ WHERE ( AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_OFFENDER_BOOKING.LIVING_UNIT_ID = AT_AGENCY_INTERNAL_LOCATION_L4.INTERNAL_LOCATION_ID ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID (+) ) AND ( AT_OFFENDER_RELIGION.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND (AT_OFFENDER_RELIGION.PROFILE_TYPE (+) = 'RELF') AND ( AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE = AT_MOVEMENT_REASONS.MOVEMENT_TYPE AND AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_REASON_CODE = AT_MOVEMENT_REASONS.MOVEMENT_REASON_CODE ) AND ( AT_OFFENDER_IMPRISON_STATUSES.OFFENDER_BOOK_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID ) AND ( AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS = 'Y' OR AT_OFFENDER_IMPRISON_STATUSES.LATEST_STATUS IS NULL ) AND ( AT_MOV_TYPE_DESC.CODE (+) = AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE ) AND (AT_MOV_TYPE_DESC.DOMAIN (+) = ('MOVE_TYPE')) AND ( AT_OFFENDER_EXTERNAL_MOVEMENTS.TO_AGY_LOC_ID = AT_MOV_LOC_TO_OFFND_LOCTION.AGY_LOC_ID (+) ) AND ( AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST' ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID ) AND (AT_OFFENDER_PNC.IDENTIFIER_TYPE (+) = 'PNC') AND ( AT_OFFENDER_PNC.OFFENDER_ID (+) = AT_OFFENDER_BOOKING.OFFENDER_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID ) AND ( AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+) ) AND ( NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI') ) AND ( AT_AGENCY_INTERNAL_LOCATION_L4.AGY_LOC_ID = AT_WING_ESTABLISHMENT.AGY_LOC_ID ) AND ( AT_WING_ESTABLISHMENT.AGY_LOC_ID = WING_CASELOAD_SECURITY.CASELOAD_ID ) AND ( AT_IMPRISON_STATUSES.IMPRISONMENT_STATUS (+) = AT_OFFENDER_IMPRISON_STATUSES.IMPRISONMENT_STATUS ) AND ( AT_RELIGION.PROFILE_CODE (+) = AT_OFFENDER_RELIGION.PROFILE_CODE ) AND ( AT_RELIGION.PROFILE_TYPE (+) = AT_OFFENDER_RELIGION.PROFILE_TYPE ) AND ( AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_HEADER_BLOCK.OFFENDER_BOOK_ID (+) ) AND ( AT_MOV_LOC_TO_OFFND_LOCTION.AGENCY_LOCATION_TYPE = 'INST' ) AND ( AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_AGY_LOC_ID = AT_EXT_MOV_FROM_AGY.AGY_LOC_ID (+) ) AND ( AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_CITY = AT_FROM_CITY_CODES.CODE (+) ) AND ( AT_FROM_CITY_CODES.DOMAIN = 'CITY' OR AT_FROM_CITY_CODES.DOMAIN IS NULL ) AND ( AT_OFFENDER_EXTERNAL_MOVEMENTS.FROM_ADDRESS_ID = AT_FROM_ADDRESS_ATTENDED.ADDRESS_ID (+) ) AND ( WING_CASELOAD_SECURITY.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND ( (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #prompt('Establishment Code','A','Establishment/Establishment Code',Mono,Free,Not_Persistent,,User:0) */ ) AND ( USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER( ( SELECT username FROM context_ /* = #Variable('BOUSER') */ ) ) ) AND AT_MOV_LOC_TO_OFFND_LOCTION.AGY_LOC_ID = ( SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #prompt('Establishment Code','A','External Movements/Movement To Establishment Code',Mono,Free,Not_Persistent,,User:0) */ ) AND AT_MOV_TYPE_DESC.DESCRIPTION = 'Admission' AND TRUNC(AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE) >= ( SELECT START_DATE FROM prompt_ /* = #prompt('Admission Start Date','D',,Mono,Free,Not_Persistent,,User:1) */ ) AND TRUNC(AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE) <= ( SELECT END_DATE FROM prompt_ /* = #prompt('Admission End Date','D',,Mono,Free,Not_Persistent,,User:2) */ ) AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE = 'IN' AND AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_REASON_CODE <> 'R' AND ( MAIN_OFFENCES_.OFFENDER_ID_DISPLAY (+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) AND ( RELEASE_.OFFENDER_ID_DISPLAY (+) = AT_OFFENDER.OFFENDER_ID_DISPLAY ) ) ), dataset_ AS ( SELECT OFFENDER_ID_DISPLAY, BOOKING_NO, FIRST_NAME, LAST_NAME, BIRTH_DATE, UNIT_DESCRIPTION_4_SHORT, STATUS_2, LEGAL_STATUS_GROUPING, DESCRIPTION, MOVEMENT_TIME, MOVEMENT_REASON_DESCRIPTION, FROM_, IDENTIFIER, MAIN_OFFENCE as V_MAINOFFENCES, V_CURRENT_RELEASE_DATE, V_EFFECTIVE_SENTENCE_LENGTH, V_HDCED FROM dataset_base_ )",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Establishment Code",
          "description": "@prompt('Establishment Code','A','Establishment\\Establishment Code',Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Admission Start Date",
          "description": "@prompt('Admission Start Date','D',,Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Admission End Date",
          "description": "@prompt('Admission End Date','D',,Mono,Free,Not_Persistent,,User:2)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP3.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "BOOKING_NO",
            "type": "string",
            "display": "Booking No",
            "legacyId": "DP3.DO10c23",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "FIRST_NAME",
            "type": "string",
            "display": "First Name",
            "legacyId": "DP3.DO10046",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "LAST_NAME",
            "type": "string",
            "display": "Last Name",
            "legacyId": "DP3.DO10045",
            "legacySqlClass": "column"
          },
          {
            "index": 4,
            "name": "BIRTH_DATE",
            "type": "date",
            "display": "Date of Birth",
            "legacyId": "DP3.DO10075",
            "legacySqlClass": "column"
          },
          {
            "index": 5,
            "name": "UNIT_DESCRIPTION_4_SHORT",
            "type": "string",
            "display": "Unit Description 4 Short",
            "legacyId": "DP3.DO10427",
            "legacySqlClass": "column"
          },
          {
            "index": 6,
            "name": "STATUS_2",
            "type": "string",
            "display": "Security Category",
            "legacyId": "DP3.DO10265",
            "legacySqlClass": "column"
          },
          {
            "index": 7,
            "name": "LEGAL_STATUS_GROUPING",
            "type": "string",
            "display": "Legal Status Grouping",
            "legacyId": "DP3.DO1108a",
            "legacySqlClass": "column"
          },
          {
            "index": 8,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Religion Description",
            "legacyId": "DP3.DO10c29",
            "legacySqlClass": "column"
          },
          {
            "index": 9,
            "name": "MOVEMENT_TIME",
            "type": "date",
            "display": "Movement Time  (external)",
            "legacyId": "DP3.DO1059a",
            "legacySqlClass": "column"
          },
          {
            "index": 10,
            "name": "MOVEMENT_REASON_DESCRIPTION",
            "type": "string",
            "display": "Movement Reason Description",
            "legacyId": "DP3.DO1083b",
            "legacySqlClass": "column"
          },
          {
            "index": 11,
            "name": "FROM_",
            "type": "string",
            "display": "From",
            "legacyId": "DP3.DO10d98",
            "legacySqlClass": "column"
          },
          {
            "index": 12,
            "name": "IDENTIFIER",
            "type": "string",
            "display": "PNC ID",
            "legacyId": "DP3.DO10b9b",
            "legacySqlClass": "column"
          },
          {
            "index": 13,
            "name": "V_MAINOFFENCES",
            "type": "string",
            "display": "Main Offences",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 14,
            "name": "V_CURRENT_RELEASE_DATE",
            "type": "string",
            "display": "Current Release Date",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 15,
            "name": "V_EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "???",
            "legacySqlClass": "alias"
          },
          {
            "index": 16,
            "name": "V_HDCED",
            "type": "string",
            "display": "HDCED",
            "legacyId": "???",
            "legacySqlClass": "alias"
          }
        ]
      }
    },
    {
      "id": "3376286/DPf",
      "name": "Main Offences",
      "description": "OR - Sentence",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, AT_OFFNCS_DEMG_NO_OFF.DESCRIPTION AS DESCRIPTION FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_MOV_TYPE_DESC, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_MOV_LOC_TO_OFFND_LOCTION, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENCES AT_OFFNCS_DEMG_NO_OFF, USER_ACCESSIBLE_CASELOADS, OMS_OWNER.OFFENDER_CASES AT_OFFENDER_CASES, OMS_OWNER.OFFENDER_CHARGES AT_OFF_CHARGS_DEMG_NO_OFF WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_CASES.OFFENDER_BOOK_ID (+)) AND (AT_MOV_TYPE_DESC.CODE (+) = AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE) AND (AT_MOV_TYPE_DESC.DOMAIN (+) = ('MOVE_TYPE')) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.TO_AGY_LOC_ID = AT_MOV_LOC_TO_OFFND_LOCTION.AGY_LOC_ID (+)) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFF_CHARGS_DEMG_NO_OFF.OFFENDER_BOOK_ID (+)) AND (AT_OFF_CHARGS_DEMG_NO_OFF.CHARGE_STATUS = ('A') OR AT_OFF_CHARGS_DEMG_NO_OFF.CHARGE_STATUS IS NULL) AND (AT_OFF_CHARGS_DEMG_NO_OFF.STATUTE_CODE = AT_OFFNCS_DEMG_NO_OFF.STATUTE_CODE AND AT_OFF_CHARGS_DEMG_NO_OFF.OFFENCE_CODE = AT_OFFNCS_DEMG_NO_OFF.OFFENCE_CODE) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (AT_MOV_LOC_TO_OFFND_LOCTION.AGENCY_LOCATION_TYPE = 'INST') AND ((AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #prompt('Establishment Code','A','Establishment\\Establishment Code',Mono,Free,Not_Persistent,,User:0) */) AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND AT_OFFENDER_CASES.CASE_STATUS = 'A' AND AT_OFF_CHARGS_DEMG_NO_OFF.MOST_SERIOUS_FLAG = 'Y' AND AT_MOV_LOC_TO_OFFND_LOCTION.AGY_LOC_ID = (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #prompt('Establishment Code','A','External Movements\\Movement To Establishment Code',Mono,Free,Not_Persistent,,User:0) */) AND AT_MOV_TYPE_DESC.DESCRIPTION = 'Admission' AND TRUNC(AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE) >= (SELECT START_DATE FROM prompt_ /* = #prompt('Admission Start Date','D',,Mono,Free,Not_Persistent,,User:1) */) AND TRUNC(AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE) <= (SELECT END_DATE FROM prompt_ /* = #prompt('Admission End Date','D',,Mono,Free,Not_Persistent,,User:2) */) AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE = 'IN' AND AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_REASON_CODE <> 'R')), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, DESCRIPTION FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Establishment Code",
          "description": "@prompt('Establishment Code','A','Establishment\\Establishment Code',Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Admission Start Date",
          "description": "@prompt('Admission Start Date','D',,Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Admission End Date",
          "description": "@prompt('Admission End Date','D',,Mono,Free,Not_Persistent,,User:2)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DPf.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "DESCRIPTION",
            "type": "string",
            "display": "Offence Description",
            "legacyId": "DPf.DO10abd",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "3376286/DP10",
      "name": "Sentence",
      "description": "OR - Sentence",
      "datasource": "nomis",
      "query": "dataset_base_ AS (SELECT DISTINCT AT_OFFENDER.OFFENDER_ID_DISPLAY AS OFFENDER_ID_DISPLAY, COALESCE(AT_OFFENDER_SENT_CALCULATIONS.HDCED_OVERRIDED_DATE, AT_OFFENDER_SENT_CALCULATIONS.HDCED_CALCULATED_DATE) AS HDCED_DATE, CASE WHEN NOT AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE WHEN AT_OFFENDER_RELEASE_DETAILS.RELEASE_DATE IS NULL THEN DT_LAST_RELEASE_DATE.LAST_REL_DATE ELSE NULL END AS CURRENT_RELEASE_DATE, CASE WHEN DT_OFFENDER_LIFE_FLAG.LIFE_SENTENCE_FLAG = 'Y' THEN 'Life' ELSE AT_OFFENDER_SENT_CALCULATIONS.EFFECTIVE_SENTENCE_LENGTH END AS EFFECTIVE_SENTENCE_LENGTH FROM OMS_OWNER.OFFENDERS AT_OFFENDER, OMS_OWNER.REFERENCE_CODES AT_MOV_TYPE_DESC, OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS, OMS_OWNER.OFFENDER_BOOKINGS AT_OFFENDER_BOOKING, OMS_OWNER.AGENCY_LOCATIONS AT_OFFENDERS_LOCATIONS, OMS_OWNER.AGENCY_LOCATIONS AT_MOV_LOC_TO_OFFND_LOCTION, OMS_OWNER.OFFENDER_EXTERNAL_MOVEMENTS AT_OFFENDER_EXTERNAL_MOVEMENTS, OMS_OWNER.CASELOAD_AGENCY_LOCATIONS AT_CASELOAD_LOCATIONS, OMS_OWNER.OFFENDER_RELEASE_DETAILS AT_OFFENDER_RELEASE_DETAILS, (SELECT AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID, CASE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.HDCAD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.APD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.PRRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.ARD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.CRD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.NPD_CALCULATED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_OVERRIDED_DATE WHEN NOT AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE IS NULL THEN AT_OFFENDER_SENT_CALCULATIONS.MTD_CALCULATED_DATE /* when AT_OFFENDER_SENT_CALCULATIONS.ETD_OVERRIDED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.ETD_OVERRIDED_DATE when AT_OFFENDER_SENT_CALCULATIONS.ETD_CALCULATED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.ETD_CALCULATED_DATE when AT_OFFENDER_SENT_CALCULATIONS.LTD_OVERRIDED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.LTD_OVERRIDED_DATE when AT_OFFENDER_SENT_CALCULATIONS.LTD_CALCULATED_DATE is not null then AT_OFFENDER_SENT_CALCULATIONS.LTD_CALCULATED_DATE */ ELSE NULL END AS Last_Rel_Date, EFFECTIVE_SENTENCE_LENGTH FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS AT_OFFENDER_SENT_CALCULATIONS WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = (SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID)) DT_LAST_RELEASE_DATE, (SELECT DISTINCT OFFENDER_SENTENCE_TERMS.OFFENDER_BOOK_ID, OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG FROM OFFENDER_SENTENCE_TERMS WHERE OFFENDER_SENTENCE_TERMS.LIFE_SENTENCE_FLAG = 'Y') DT_OFFENDER_LIFE_FLAG, USER_ACCESSIBLE_CASELOADS WHERE (AT_OFFENDER.OFFENDER_ID = AT_OFFENDER_BOOKING.OFFENDER_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_EXTERNAL_MOVEMENTS.OFFENDER_BOOK_ID (+)) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID (+)) AND (AT_MOV_TYPE_DESC.CODE (+) = AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_TYPE) AND (AT_MOV_TYPE_DESC.DOMAIN (+) = ('MOVE_TYPE')) AND (AT_OFFENDER_EXTERNAL_MOVEMENTS.TO_AGY_LOC_ID = AT_MOV_LOC_TO_OFFND_LOCTION.AGY_LOC_ID (+)) AND (AT_OFFENDERS_LOCATIONS.AGENCY_LOCATION_TYPE = 'INST') AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = AT_OFFENDER_RELEASE_DETAILS.OFFENDER_BOOK_ID (+)) AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND (AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = USER_ACCESSIBLE_CASELOADS.CASELOAD_ID) AND (AT_OFFENDER_BOOKING.OFFENDER_BOOK_ID = DT_LAST_RELEASE_DATE.OFFENDER_BOOK_ID (+)) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDER_BOOKING.AGY_LOC_ID) AND (AT_CASELOAD_LOCATIONS.AGY_LOC_ID = AT_OFFENDERS_LOCATIONS.AGY_LOC_ID (+)) AND (NOT AT_CASELOAD_LOCATIONS.AGY_LOC_ID IN ('OUT', 'TRN') AND NOT AT_CASELOAD_LOCATIONS.CASELOAD_ID IN ('ADMINC', 'CADM_I', 'MULTI')) AND (DT_OFFENDER_LIFE_FLAG.OFFENDER_BOOK_ID (+) = AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID) AND (AT_MOV_LOC_TO_OFFND_LOCTION.AGENCY_LOCATION_TYPE = 'INST') AND ((AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_SENT_CALCULATION_ID = (SELECT MAX(A.OFFENDER_SENT_CALCULATION_ID) FROM OMS_OWNER.OFFENDER_SENT_CALCULATIONS A WHERE AT_OFFENDER_SENT_CALCULATIONS.OFFENDER_BOOK_ID = A.OFFENDER_BOOK_ID)) AND (AT_OFFENDER_BOOKING.ACTIVE_FLAG = 'Y') AND AT_OFFENDERS_LOCATIONS.AGY_LOC_ID = (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #prompt('Establishment Code','A','Establishment\\Establishment Code',Mono,Free,Not_Persistent,,User:0) */) AND (USER_ACCESSIBLE_CASELOADS.USERNAME = UPPER((SELECT username FROM context_ /* = #Variable('BOUSER') */))) AND AT_MOV_LOC_TO_OFFND_LOCTION.AGY_LOC_ID = (SELECT ESTABLISHMENT_CODE FROM prompt_ /* = #prompt('Establishment Code','A','External Movements\\Movement To Establishment Code',Mono,Free,Not_Persistent,,User:0) */) AND AT_MOV_TYPE_DESC.DESCRIPTION = 'Admission' AND TRUNC(AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE) >= (SELECT START_DATE FROM prompt_ /* = #prompt('Admission Start Date','D',,Mono,Free,Not_Persistent,,User:1) */) AND TRUNC(AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_DATE) <= (SELECT END_DATE FROM prompt_ /* = #prompt('Admission End Date','D',,Mono,Free,Not_Persistent,,User:2) */) AND AT_OFFENDER_EXTERNAL_MOVEMENTS.DIRECTION_CODE = 'IN' AND AT_OFFENDER_EXTERNAL_MOVEMENTS.MOVEMENT_REASON_CODE <> 'R')), dataset_ AS (SELECT OFFENDER_ID_DISPLAY, HDCED_DATE, CURRENT_RELEASE_DATE, EFFECTIVE_SENTENCE_LENGTH, OFFENCE_DESCRIPTION AS V_MAINOFFENCES, CURRENT_RELEASE_DATE AS V_CURRENT_RELEASE_DATE , EFFECTIVE_SENTENCE_LENGTH AS V_EFFECTIVE_SENTENCE_LENGTH, HDCED_DATE AS V_HDCED FROM dataset_base_)",
      "parameters": [
        {
          "index": 0,
          "name": "establishment_code",
          "filterType": "text",
          "reportFieldType": "string",
          "display": "Establishment Code",
          "description": "@prompt('Establishment Code','A','Establishment\\Establishment Code',Mono,Free,Not_Persistent,,User:0)",
          "mandatory": "true"
        },
        {
          "index": 1,
          "name": "start_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Admission Start Date",
          "description": "@prompt('Admission Start Date','D',,Mono,Free,Not_Persistent,,User:1)",
          "mandatory": "true"
        },
        {
          "index": 2,
          "name": "end_date",
          "filterType": "date",
          "reportFieldType": "date",
          "display": "Admission End Date",
          "description": "@prompt('Admission End Date','D',,Mono,Free,Not_Persistent,,User:2)",
          "mandatory": "true"
        }
      ],
      "schema": {
        "field": [
          {
            "index": 0,
            "name": "OFFENDER_ID_DISPLAY",
            "type": "string",
            "display": "NOMS Number",
            "legacyId": "DP10.DO10044",
            "legacySqlClass": "column"
          },
          {
            "index": 1,
            "name": "HDCED_DATE",
            "type": "date",
            "display": "HDCED Date",
            "legacyId": "DP10.DO10463",
            "legacySqlClass": "column"
          },
          {
            "index": 2,
            "name": "CURRENT_RELEASE_DATE",
            "type": "date",
            "display": "Current Release Date",
            "legacyId": "DP10.DO10b29",
            "legacySqlClass": "column"
          },
          {
            "index": 3,
            "name": "EFFECTIVE_SENTENCE_LENGTH",
            "type": "string",
            "display": "Effective Sentence Length",
            "legacyId": "DP10.DO1082f",
            "legacySqlClass": "column"
          }
        ]
      }
    },
    {
      "id": "admissions-total-distinct-prisoner-count",
      "name": "Total prisoner count",
      "datasource": "redshift",
      "query": "select count(distinct OFFENDER_ID_DISPLAY) as PRISONER_COUNT from ${tableId}",
      "schema": {
        "field": [
          {
            "name": "PRISONER_COUNT",
            "type": "int",
            "display": "Total Prisoner Count"
          }
        ]
      }
    }
  ],
  "policy": [
    {
      "id": "access",
      "type": "access",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": ["${role}", "ROLE_PRISONS_REPORTING_USER"]
            }
          ]
        }
      ]
    }
  ],
  "report": [
    {
      "id": "170110.RS",
      "name": "By Admission Time",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3",
      "summary": [
        {
          "id": "admissions-total-distinct-prisoner-count",
          "template": "page-header",
          "dataset": "$ref:admissions-total-distinct-prisoner-count"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Admission Time",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:BOOKING_NO",
            "display": "Booking No",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_DESCRIPTION_4_SHORT",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Date of Birth",
            "formula": "format_date(${BIRTH_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Religion",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:LEGAL_STATUS_GROUPING",
            "display": "Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:STATUS_2",
            "display": "Security Category",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:FROM_",
            "display": "From",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:MOVEMENT_REASON_DESCRIPTION",
            "display": "Reason",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_MAINOFFENCES",
            "display": "Main Offence",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:IDENTIFIER",
            "display": "PNC ID",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_CURRENT_RELEASE_DATE",
            "display": "Release Date",
            "formula": "format_date(${V_CURRENT_RELEASE_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    },
    {
      "id": "170313.RS",
      "name": "By Location",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3",
      "summary": [
        {
          "id": "admissions-total-distinct-prisoner-count",
          "template": "page-header",
          "dataset": "$ref:admissions-total-distinct-prisoner-count"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Admission Time",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:BOOKING_NO",
            "display": "Booking No",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_DESCRIPTION_4_SHORT",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Date of Birth",
            "formula": "format_date(${BIRTH_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Religion",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:LEGAL_STATUS_GROUPING",
            "display": "Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:STATUS_2",
            "display": "Security Category",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:FROM_",
            "display": "From",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:MOVEMENT_REASON_DESCRIPTION",
            "display": "Reason",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_MAINOFFENCES",
            "display": "Main Offence",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:IDENTIFIER",
            "display": "PNC ID",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    },
    {
      "id": "170382.RS",
      "name": "By Surname",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3",
      "summary": [
        {
          "id": "admissions-total-distinct-prisoner-count",
          "template": "page-header",
          "dataset": "$ref:admissions-total-distinct-prisoner-count"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Admission Time",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:BOOKING_NO",
            "display": "Booking No",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_DESCRIPTION_4_SHORT",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Date of Birth",
            "formula": "format_date(${BIRTH_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:DESCRIPTION",
            "display": "Religion",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:LEGAL_STATUS_GROUPING",
            "display": "Legal Status",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:STATUS_2",
            "display": "Security Category",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:FROM_",
            "display": "From",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:MOVEMENT_REASON_DESCRIPTION",
            "display": "Reason",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_MAINOFFENCES",
            "display": "Main Offence",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:IDENTIFIER",
            "display": "PNC ID",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    },
    {
      "id": "170509.RS",
      "name": "Admissions with Release Detail",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3",
      "summary": [
        {
          "id": "admissions-total-distinct-prisoner-count",
          "template": "page-header",
          "dataset": "$ref:admissions-total-distinct-prisoner-count"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:BIRTH_DATE",
            "display": "Date of Birth",
            "formula": "format_date(${BIRTH_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_DESCRIPTION_4_SHORT",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Admission Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          },
          {
            "name": "$ref:V_MAINOFFENCES",
            "display": "Main Offence",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_EFFECTIVE_SENTENCE_LENGTH",
            "display": "Effective Sentence Length",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_HDCED",
            "display": "HDCED",
            "formula": "format_date(${V_HDCED}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:V_CURRENT_RELEASE_DATE",
            "display": "Release Date",
            "formula": "format_date(${V_CURRENT_RELEASE_DATE}, 'dd/MM/yyyy')",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    },
    {
      "id": "170669.RS",
      "name": "Simple View",
      "classification": "OFFICIAL",
      "version": "1.0.0",
      "render": "HTML",
      "dataset": "3376286/DP3",
      "summary": [
        {
          "id": "admissions-total-distinct-prisoner-count",
          "template": "page-header",
          "dataset": "$ref:admissions-total-distinct-prisoner-count"
        }
      ],
      "feature": [
        {
          "type": "print"
        }
      ],
      "specification": {
        "template": "list",
        "field": [
          {
            "name": "$ref:OFFENDER_ID_DISPLAY",
            "display": "NOMS Number",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:LAST_NAME",
            "display": "Last Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": true
          },
          {
            "name": "$ref:FIRST_NAME",
            "display": "First Name",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:UNIT_DESCRIPTION_4_SHORT",
            "display": "Location",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          },
          {
            "name": "$ref:MOVEMENT_TIME",
            "display": "Movement Date",
            "formula": "",
            "visible": "true",
            "sortable": true,
            "defaultsort": false
          }
        ]
      }
    }
  ]
}
